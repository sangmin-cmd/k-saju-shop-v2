<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>케이사주 페이트메이트 | 사주 × MBTI 운세</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #000;
      --bg-secondary: #111;
      --bg-tertiary: #0a0a0a;
      --bg-card: #111;
      --border-color: #222;
      --border-hover: #444;
      --text-primary: #fff;
      --text-secondary: #888;
      --text-muted: #666;
      --text-dim: #555;
      --accent: #ffd700;
      --accent-secondary: #ff6b6b;
      --accent-purple: #a855f7;
      --accent-blue: #3b82f6;
      --modal-bg: linear-gradient(135deg, #1a1a2e, #0f0f1a);
      --daymaster-bg: linear-gradient(135deg, #1a1a2e, #16213e);
      --input-bg: #111;
      --synergy-gradient: linear-gradient(135deg, #22c55e, #16a34a);
      --conflict-gradient: linear-gradient(135deg, #ef4444, #dc2626);
      --chemistry-gradient: linear-gradient(135deg, #667eea, #764ba2);
    }
    
    [data-theme="light"] {
      --bg-primary: #f5f5f7;
      --bg-secondary: #fff;
      --bg-tertiary: #f0f0f2;
      --bg-card: #fff;
      --border-color: #e0e0e0;
      --border-hover: #ccc;
      --text-primary: #1a1a1a;
      --text-secondary: #555;
      --text-muted: #777;
      --text-dim: #999;
      --accent: #d4a000;
      --accent-secondary: #e05555;
      --modal-bg: linear-gradient(135deg, #fff, #f8f8fc);
      --daymaster-bg: linear-gradient(135deg, #e8e8f0, #f0f0f8);
      --input-bg: #fff;
    }
    
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; transition: background 0.3s, color 0.3s; }
    .screen { display: none; min-height: 100vh; }
    .screen.active { display: flex; }
    
    .settings-bar { position: fixed; top: 12px; right: 12px; display: flex; gap: 8px; z-index: 100; }
    .settings-btn { background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
    .settings-btn:hover { background: var(--bg-tertiary); border-color: var(--border-hover); color: var(--text-primary); }
    
    .intro-screen { flex-direction: column; align-items: center; justify-content: center; padding: 40px 24px; text-align: center; }
    .badge { font-size: 12px; font-weight: 700; letter-spacing: 4px; color: var(--accent); margin-bottom: 24px; }
    .title { font-size: 36px; font-weight: 700; line-height: 1.3; margin-bottom: 16px; }
    .highlight { background: linear-gradient(135deg, #ffd700, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { font-size: 15px; color: var(--text-secondary); margin-bottom: 40px; line-height: 1.7; }
    .cta-btn { display: inline-flex; align-items: center; gap: 12px; padding: 16px 32px; background: var(--text-primary); color: var(--bg-primary); border: none; border-radius: 999px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .cta-btn:hover { opacity: 0.9; transform: scale(1.02); }
    .footer-text { margin-top: 32px; font-size: 12px; color: var(--text-muted); }
    
    .input-screen { flex-direction: column; padding: 24px; max-width: 420px; margin: 0 auto; }
    .back-btn { background: none; border: none; color: var(--text-secondary); font-size: 14px; cursor: pointer; margin-bottom: 24px; text-align: left; }
    .back-btn:hover { color: var(--text-primary); }
    .input-title { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
    .input-subtitle { font-size: 14px; color: var(--text-secondary); margin-bottom: 28px; }
    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
    .input-group { display: flex; flex-direction: column; gap: 8px; }
    .input-group label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
    .input-group input, .input-group select { padding: 14px 16px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 12px; color: var(--text-primary); font-size: 16px; outline: none; }
    .input-group input:focus, .input-group select:focus { border-color: var(--accent); }
    
    /* Gender Selection */
    .gender-group { grid-column: span 2; }
    .gender-buttons { display: flex; gap: 12px; }
    .gender-btn { flex: 1; padding: 14px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; color: var(--text-secondary); font-size: 15px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .gender-btn:hover { border-color: var(--border-hover); color: var(--text-primary); }
    .gender-btn.selected { background: rgba(255, 215, 0, 0.15); border-color: var(--accent); color: var(--accent); }
    .gender-btn .icon { font-size: 20px; }
    
    /* MBTI Section */
    .mbti-group { grid-column: span 2; margin-top: 8px; padding-top: 20px; border-top: 1px dashed var(--border-color); }
    .mbti-label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .mbti-label { font-size: 12px; color: var(--accent); letter-spacing: 1px; display: flex; align-items: center; gap: 6px; }
    .mbti-optional { font-size: 11px; color: var(--text-muted); }
    .mbti-select-wrapper { position: relative; }
    .mbti-select-wrapper select { width: 100%; appearance: none; padding-right: 40px; }
    .mbti-select-wrapper::after { content: '▼'; position: absolute; right: 16px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 12px; pointer-events: none; }
    .mbti-desc { margin-top: 10px; padding: 12px; background: rgba(168, 85, 247, 0.1); border-radius: 10px; font-size: 13px; color: var(--text-secondary); display: none; }
    .mbti-desc.active { display: block; }
    
    .result-screen { flex-direction: column; padding: 24px; max-width: 460px; margin: 0 auto; }
    .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .result-date { font-size: 12px; color: var(--text-secondary); }
    
    .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
    .card-label { font-size: 11px; color: var(--accent); letter-spacing: 2px; margin-bottom: 12px; }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .refresh-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 12px; }
    .refresh-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .message-text { font-size: 18px; font-weight: 500; line-height: 1.5; font-style: italic; margin-bottom: 16px; }
    .element-badge { display: flex; align-items: center; gap: 10px; }
    .element-hanja { font-size: 28px; color: var(--accent); }
    .element-name { color: var(--text-secondary); font-size: 14px; }
    
    /* Identity Card - B안 핵심! 맨 위에 표시 */
    .identity-card { 
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); 
      border: 2px solid rgba(255, 215, 0, 0.3); 
      border-radius: 24px; 
      padding: 28px 24px; 
      margin-bottom: 24px; 
      text-align: center; 
      position: relative; 
      overflow: hidden; 
    }
    .identity-card::before { 
      content: ''; 
      position: absolute; 
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at top, rgba(255,215,0,0.1) 0%, transparent 60%);
      pointer-events: none;
    }
    .identity-badge { 
      display: inline-block;
      font-size: 10px; 
      font-weight: 700; 
      letter-spacing: 3px; 
      color: var(--accent); 
      background: rgba(255,215,0,0.1);
      padding: 6px 14px;
      border-radius: 20px;
      margin-bottom: 16px; 
    }
    .identity-label { 
      font-size: 28px; 
      font-weight: 700; 
      color: #fff; 
      margin-bottom: 8px;
      text-shadow: 0 2px 20px rgba(255,215,0,0.3);
    }
    .identity-combo { 
      font-size: 14px; 
      color: var(--text-secondary); 
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .identity-combo-item {
      background: rgba(255,255,255,0.1);
      padding: 4px 12px;
      border-radius: 12px;
    }
    .identity-tagline { 
      font-size: 15px; 
      color: rgba(255,255,255,0.9); 
      line-height: 1.6;
      font-style: italic;
      margin-bottom: 20px;
      padding: 0 12px;
    }
    .identity-score { 
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(168,85,247,0.2));
      padding: 10px 20px;
      border-radius: 30px;
      border: 1px solid rgba(255,215,0,0.3);
    }
    .identity-score-label { font-size: 12px; color: var(--text-secondary); }
    .identity-score-value { font-size: 24px; font-weight: 700; color: var(--accent); }
    .identity-score-max { font-size: 14px; color: var(--text-muted); }
    
    /* Chemistry Card - 핵심 차별화 */
    .chemistry-card { background: var(--chemistry-gradient); border: none; border-radius: 20px; padding: 24px; margin-bottom: 24px; color: #fff; position: relative; overflow: hidden; }
    .chemistry-card::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); }
    .chemistry-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
    .chemistry-icon { font-size: 28px; }
    .chemistry-title { font-size: 16px; font-weight: 600; }
    .chemistry-badge { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; font-size: 11px; margin-left: auto; }
    
    .chemistry-main { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 16px; }
    .chemistry-type { text-align: center; flex: 1; }
    .chemistry-type-label { font-size: 10px; opacity: 0.8; margin-bottom: 6px; }
    .chemistry-type-value { font-size: 15px; font-weight: 600; }
    .chemistry-type-sub { font-size: 20px; margin-top: 4px; }
    .chemistry-vs { font-size: 24px; opacity: 0.6; }
    
    .chemistry-score { text-align: center; margin-bottom: 20px; }
    .chemistry-score-label { font-size: 12px; opacity: 0.8; margin-bottom: 8px; }
    .chemistry-score-value { font-size: 48px; font-weight: 700; }
    .chemistry-score-bar { height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; margin-top: 12px; overflow: hidden; }
    .chemistry-score-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #22c55e); border-radius: 4px; transition: width 1s ease; }
    
    .chemistry-insight { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px; }
    .chemistry-insight-title { font-size: 12px; opacity: 0.8; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .chemistry-insight-text { font-size: 14px; line-height: 1.6; }
    
    /* Synergy & Conflict */
    .synergy-conflict { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
    .synergy-box, .conflict-box { padding: 14px; border-radius: 12px; }
    .synergy-box { background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(34, 197, 94, 0.5); }
    .conflict-box { background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(239, 68, 68, 0.5); }
    .synergy-title, .conflict-title { font-size: 12px; margin-bottom: 8px; display: flex; align-items: center; gap: 4px; font-weight: 600; }
    .synergy-title { color: #4ade80; }
    .conflict-title { color: #f87171; }
    .synergy-item, .conflict-item { font-size: 13px; color: #fff; margin-bottom: 6px; line-height: 1.5; }
    
    /* Comparison Card */
    .comparison-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
    .comparison-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
    .comparison-col { text-align: center; flex: 1; }
    .comparison-col-icon { font-size: 24px; margin-bottom: 6px; }
    .comparison-col-title { font-size: 12px; color: var(--accent); }
    .comparison-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
    .comparison-row:last-child { border-bottom: none; }
    .comparison-label { width: 70px; font-size: 11px; color: var(--text-muted); text-align: center; }
    .comparison-value { flex: 1; text-align: center; font-size: 13px; padding: 0 8px; line-height: 1.6; }
    .comparison-value.mbti { color: var(--accent-purple); }
    .comparison-value.saju { color: var(--accent); }
    
    .comparison-conclusion { margin-top: 16px; padding: 14px; background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(168,85,247,0.1)); border-radius: 12px; border-left: 3px solid var(--accent); }
    .comparison-conclusion-title { font-size: 11px; color: var(--accent); margin-bottom: 6px; }
    .comparison-conclusion-text { font-size: 14px; line-height: 1.6; color: var(--text-primary); }
    
    /* Day Master */
    .daymaster-card { background: var(--daymaster-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; margin-bottom: 20px; cursor: pointer; transition: all 0.2s; }
    .daymaster-card:hover { transform: scale(1.01); }
    .daymaster-hanja { font-size: 32px; font-weight: 600; margin-bottom: 8px; }
    .daymaster-title { font-size: 16px; color: var(--accent); margin-bottom: 8px; }
    .daymaster-traits { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }
    .click-hint { font-size: 10px; color: var(--text-muted); text-align: center; margin-top: 8px; }
    
    .pillars-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 12px; }
    .pillar { text-align: center; padding: 12px 6px; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border-color); }
    .pillar.day-master { border-color: var(--accent); background: rgba(255, 215, 0, 0.05); }
    .pillar-label { font-size: 10px; color: var(--text-muted); margin-bottom: 8px; }
    .pillar-stem { font-size: 22px; color: var(--accent); }
    .pillar-branch { font-size: 22px; color: var(--text-secondary); }
    .pillar-animal { font-size: 10px; color: var(--text-muted); margin-top: 6px; }
    .day-master-badge { font-size: 8px; color: var(--accent); margin-top: 6px; letter-spacing: 1px; }
    .pillars-note { font-size: 11px; color: var(--text-dim); text-align: center; }
    
    .element-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .element-icon { width: 55px; display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .element-icon span:first-child { font-size: 16px; }
    .bar-track { flex: 1; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
    .bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
    .bar-count { width: 20px; text-align: right; font-size: 12px; color: var(--text-secondary); }
    
    .lucky-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .lucky-item { text-align: center; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; }
    .lucky-label { font-size: 11px; color: var(--text-secondary); margin-bottom: 8px; }
    .lucky-numbers { font-size: 22px; font-weight: 700; color: var(--accent); letter-spacing: 3px; }
    .lucky-colors { display: flex; gap: 8px; justify-content: center; }
    .color-dot { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--border-color); }
    
    /* Premium Tabs - 티저 업그레이드 */
    .premium-section { margin-top: 24px; }
    .premium-title { font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .premium-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .premium-item { 
      display: flex; flex-direction: column; 
      padding: 16px; 
      background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(59,130,246,0.1)); 
      border: 1px solid rgba(168,85,247,0.3); 
      border-radius: 14px; 
      position: relative; 
      cursor: pointer;
      transition: all 0.2s;
    }
    .premium-item:hover { 
      border-color: rgba(168,85,247,0.5); 
      transform: translateY(-2px);
    }
    .premium-item-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .premium-item-icon { font-size: 20px; }
    .premium-item-title { font-size: 13px; font-weight: 600; color: var(--text-primary); }
    .premium-item-lock { font-size: 12px; margin-left: auto; }
    .premium-item-hint { font-size: 12px; color: var(--accent-purple); line-height: 1.5; }
    .premium-item-cta { 
      font-size: 10px; 
      color: var(--text-muted); 
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed rgba(168,85,247,0.3);
    }
    .premium-coming { text-align: center; margin-top: 12px; font-size: 11px; color: var(--text-dim); }
    
    /* 궁합 프리미엄 아이템 특별 스타일 */
    .premium-compatibility {
      grid-column: span 2;
      background: linear-gradient(135deg, rgba(236,72,153,0.15), rgba(168,85,247,0.15)) !important;
      border-color: rgba(236,72,153,0.4) !important;
    }
    .premium-compatibility:hover {
      border-color: rgba(236,72,153,0.6) !important;
      box-shadow: 0 4px 20px rgba(236,72,153,0.2);
    }
    .premium-item-badge {
      background: linear-gradient(135deg, #ec4899, #a855f7);
      color: #fff;
      font-size: 9px;
      padding: 3px 8px;
      border-radius: 10px;
      font-weight: 700;
      margin-left: auto;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* 궁합 티저 모달 */
    .compatibility-modal {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      border: 2px solid rgba(236,72,153,0.4);
      border-radius: 24px;
      padding: 28px;
      max-width: 440px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
    }
    .compatibility-modal-icon { font-size: 48px; margin-bottom: 16px; text-align: center; }
    .compatibility-modal-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, #ec4899, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; }
    .compatibility-modal-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; text-align: center; }
    
    /* 궁합 입력 폼 */
    .compat-form { display: flex; flex-direction: column; gap: 14px; margin-bottom: 20px; }
    .compat-input-group { display: flex; flex-direction: column; gap: 6px; }
    .compat-input-group label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
    .compat-input-group input, .compat-input-group select {
      padding: 12px 14px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(236,72,153,0.3);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
    }
    .compat-input-group input:focus, .compat-input-group select:focus {
      border-color: #ec4899;
    }
    .compat-input-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    .compat-input-row.two { grid-template-columns: 1fr 1fr; }
    
    .compat-relation-btns { display: flex; gap: 8px; }
    .compat-rel-btn {
      flex: 1;
      padding: 10px 8px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(236,72,153,0.3);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .compat-rel-btn:hover { border-color: rgba(236,72,153,0.5); }
    .compat-rel-btn.active {
      background: rgba(236,72,153,0.2);
      border-color: #ec4899;
      color: #ec4899;
    }
    
    .compat-error { color: #ef4444; font-size: 12px; text-align: center; margin-top: 10px; }
    
    .compatibility-cta {
      background: linear-gradient(135deg, #ec4899, #a855f7);
      color: #fff;
      border: none;
      padding: 14px 28px;
      border-radius: 30px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
    }
    .compatibility-cta:hover { transform: scale(1.02); box-shadow: 0 4px 20px rgba(236,72,153,0.4); }
    
    .compat-back-btn {
      background: transparent;
      border: 1px solid rgba(236,72,153,0.3);
      color: var(--text-secondary);
      padding: 12px 20px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
      transition: all 0.2s;
    }
    .compat-back-btn:hover { border-color: #ec4899; color: #ec4899; }
    
    /* 궁합 결과 화면 */
    .compat-result-header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(236,72,153,0.2);
      margin-bottom: 20px;
    }
    .compat-vs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .compat-person {
      text-align: center;
    }
    .compat-person-icon { font-size: 36px; margin-bottom: 6px; }
    .compat-person-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .compat-person-dm { font-size: 12px; color: var(--accent); }
    .compat-heart { font-size: 28px; animation: heartbeat 1s infinite; }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    .compat-total-score {
      background: linear-gradient(135deg, rgba(236,72,153,0.2), rgba(168,85,247,0.2));
      border-radius: 20px;
      padding: 20px;
      text-align: center;
    }
    .compat-score-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; }
    .compat-score-value { font-size: 48px; font-weight: 700; background: linear-gradient(135deg, #ec4899, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .compat-score-grade { font-size: 16px; color: var(--accent); margin-top: 4px; }
    
    .compat-section {
      background: rgba(0,0,0,0.2);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 14px;
    }
    .compat-section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .compat-section-icon { font-size: 20px; }
    .compat-section-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .compat-section-score {
      margin-left: auto;
      background: rgba(236,72,153,0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      color: #ec4899;
    }
    .compat-section-content { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }
    .compat-section-content em { color: #ec4899; font-style: normal; font-weight: 500; }
    
    .compat-element-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: center;
      margin: 14px 0;
    }
    .compat-element-box {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }
    .compat-element-icon { font-size: 24px; margin-bottom: 4px; }
    .compat-element-name { font-size: 12px; color: var(--text-secondary); }
    .compat-element-arrow { font-size: 24px; }
    .compat-element-arrow.good { color: #22c55e; }
    .compat-element-arrow.bad { color: #ef4444; }
    .compat-element-arrow.neutral { color: #fbbf24; }
    
    .compat-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .compat-tag {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
    }
    .compat-tag.good { background: rgba(34,197,94,0.15); color: #22c55e; }
    .compat-tag.bad { background: rgba(239,68,68,0.15); color: #ef4444; }
    .compat-tag.tip { background: rgba(251,191,36,0.15); color: #fbbf24; }
    
    .compat-advice-box {
      background: linear-gradient(135deg, rgba(236,72,153,0.1), rgba(168,85,247,0.1));
      border: 1px solid rgba(236,72,153,0.3);
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
    }
    .compat-advice-title { font-size: 13px; font-weight: 600; color: #ec4899; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .compat-advice-content { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }
    
    .topic-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .topic-btn { display: flex; align-items: center; gap: 8px; padding: 14px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; color: var(--text-primary); font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .topic-btn:hover { background: var(--bg-secondary); border-color: var(--border-hover); }
    .topic-btn.active { border-color: var(--accent); background: rgba(255, 215, 0, 0.1); }
    .topic-icon { font-size: 18px; }
    .analysis-box { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-top: 16px; font-size: 14px; line-height: 1.8; white-space: pre-wrap; color: var(--text-secondary); max-height: 500px; overflow-y: auto; }
    
    .share-section { margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color); }
    .share-title { font-size: 13px; color: var(--text-secondary); text-align: center; margin-bottom: 16px; }
    .share-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .share-btn { display: flex; align-items: center; gap: 8px; padding: 12px 20px; border-radius: 12px; border: none; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .share-btn:hover { transform: scale(1.05); }
    .share-btn.kakao { background: #FEE500; color: #000; }
    .share-btn.twitter { background: #000; color: #fff; }
    .share-btn.copy { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
    .share-toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--accent); color: #000; padding: 12px 24px; border-radius: 999px; font-size: 14px; font-weight: 600; z-index: 1000; animation: toastIn 0.3s ease; }
    @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
    
    .history-section { margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-color); }
    .history-title { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .history-list { display: flex; flex-direction: column; gap: 10px; }
    .history-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
    .history-item:hover { background: var(--bg-tertiary); border-color: var(--border-hover); }
    .history-info { display: flex; flex-direction: column; gap: 4px; }
    .history-dm { font-size: 16px; color: var(--accent); }
    .history-date { font-size: 11px; color: var(--text-muted); }
    .history-element { font-size: 20px; }
    .history-delete { background: none; border: none; color: var(--text-muted); font-size: 16px; cursor: pointer; padding: 4px 8px; }
    .history-delete:hover { color: #ff6b6b; }
    .history-empty { text-align: center; padding: 20px; color: var(--text-dim); font-size: 13px; }
    
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: var(--modal-bg); border: 1px solid var(--accent); border-radius: 20px; padding: 24px; max-width: 380px; width: 100%; max-height: 80vh; overflow-y: auto; animation: modalIn 0.3s ease; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .modal-close { background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; float: right; line-height: 1; }
    .modal-close:hover { color: var(--text-primary); }
    .modal-hanja { font-size: 48px; text-align: center; margin: 16px 0 8px; }
    .modal-title { font-size: 18px; color: var(--accent); text-align: center; margin-bottom: 16px; }
    .modal-section { margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 12px; }
    .modal-section-title { font-size: 12px; color: var(--accent); margin-bottom: 8px; letter-spacing: 1px; }
    .modal-section-content { font-size: 14px; color: var(--text-secondary); line-height: 1.6; }
    .modal-traits { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .modal-trait { padding: 6px 12px; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 20px; font-size: 12px; color: var(--accent); }
    
    .result-footer { text-align: center; padding: 20px; color: var(--text-dim); font-size: 11px; }
    .fade-in { animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    
    /* ===== 이중 분석 (Deep Dive) 카드 ===== */
    .deep-dive-section { margin: 24px 0; }
    .deep-dive-header { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 16px; 
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }
    .deep-dive-title { font-size: 16px; font-weight: 600; color: var(--text-primary); }
    .deep-dive-badge { 
      background: linear-gradient(135deg, #a855f7, #6366f1); 
      color: #fff; 
      font-size: 10px; 
      padding: 4px 10px; 
      border-radius: 20px;
      font-weight: 600;
    }
    
    .axis-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .axis-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      transition: all 0.2s;
    }
    .axis-card:hover { border-color: var(--border-hover); }
    .axis-card.active { border-color: var(--accent-purple); background: rgba(168,85,247,0.05); }
    
    .axis-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
    .axis-mbti { 
      font-size: 14px; 
      font-weight: 700; 
      color: var(--accent-purple);
      background: rgba(168,85,247,0.15);
      padding: 4px 10px;
      border-radius: 8px;
    }
    .axis-label { font-size: 11px; color: var(--text-secondary); }
    
    .axis-sipseong { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 6px; 
      margin-bottom: 10px; 
    }
    .axis-sipseong-tag {
      font-size: 10px;
      padding: 3px 8px;
      background: rgba(255,215,0,0.1);
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 12px;
      color: var(--accent);
    }
    
    .axis-description {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    .axis-description strong { color: var(--accent); }
    
    /* ===== 충돌/시너지 분석 카드 ===== */
    .pattern-section { margin: 24px 0; }
    .pattern-card {
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .pattern-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }
    .pattern-card.conflict {
      background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05));
      border: 1px solid rgba(239,68,68,0.3);
    }
    .pattern-card.conflict::before { background: linear-gradient(90deg, #ef4444, #dc2626); }
    
    .pattern-card.synergy {
      background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(34,197,94,0.05));
      border: 1px solid rgba(34,197,94,0.3);
    }
    .pattern-card.synergy::before { background: linear-gradient(90deg, #22c55e, #16a34a); }
    
    .pattern-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .pattern-icon { font-size: 24px; }
    .pattern-type { 
      font-size: 10px; 
      font-weight: 600; 
      padding: 4px 10px; 
      border-radius: 12px;
    }
    .pattern-card.conflict .pattern-type { background: rgba(239,68,68,0.2); color: #f87171; }
    .pattern-card.synergy .pattern-type { background: rgba(34,197,94,0.2); color: #4ade80; }
    
    .pattern-title { 
      font-size: 18px; 
      font-weight: 700; 
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    .pattern-description {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 16px;
    }
    .pattern-description strong { color: var(--accent); }
    
    .pattern-advice {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 14px 16px;
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.6;
      border-left: 3px solid;
    }
    .pattern-card.conflict .pattern-advice { border-left-color: #ef4444; }
    .pattern-card.synergy .pattern-advice { border-left-color: #22c55e; }
    
    .pattern-empty {
      text-align: center;
      padding: 24px;
      color: var(--text-muted);
      font-size: 13px;
      background: var(--bg-secondary);
      border-radius: 16px;
      border: 1px dashed var(--border-color);
    }
    
    /* ===== v2.5 B안: 3블록 구조 스타일 ===== */
    .topic-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    
    .topic-block {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
    }
    
    .topic-block.mbti-block {
      border-left: 4px solid #60a5fa;
    }
    
    .topic-block.saju-block {
      border-left: 4px solid #f472b6;
    }
    
    .topic-block.integrated-block {
      border-left: 4px solid #34d399;
      background: linear-gradient(135deg, rgba(52,211,153,0.05), rgba(52,211,153,0.02));
    }
    
    .topic-block.sipseong-block {
      border-left: 4px solid #a855f7;
      background: linear-gradient(135deg, rgba(168,85,247,0.05), rgba(168,85,247,0.02));
    }
    
    .block-header {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .mbti-block .block-header { color: #60a5fa; }
    .saju-block .block-header { color: #f472b6; }
    .integrated-block .block-header { color: #34d399; }
    .sipseong-block .block-header { color: #a855f7; }
    
    /* 십성 분포 시각화 */
    .sipseong-chart {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
      padding: 14px;
      background: rgba(168,85,247,0.08);
      border-radius: 12px;
      border: 1px solid rgba(168,85,247,0.2);
    }
    .sipseong-item {
      background: rgba(0,0,0,0.3);
      border: 2px solid rgba(168,85,247,0.4);
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 100px;
      justify-content: center;
    }
    .sipseong-item .sipseong-label {
      color: var(--text-secondary);
    }
    .sipseong-item.highlight {
      background: linear-gradient(135deg, rgba(168,85,247,0.3), rgba(168,85,247,0.15));
      border-color: #a855f7;
      box-shadow: 0 0 12px rgba(168,85,247,0.3);
    }
    .sipseong-item.highlight .sipseong-label {
      color: #a855f7;
      font-weight: 600;
    }
    .sipseong-item.zero {
      background: rgba(0,0,0,0.2);
      border-color: rgba(255,255,255,0.1);
      border-style: dashed;
    }
    .sipseong-item.zero .sipseong-label {
      color: var(--text-muted);
    }
    .sipseong-count {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
    }
    .sipseong-item.zero .sipseong-count {
      color: var(--text-muted);
    }
    .sipseong-unit {
      font-size: 11px;
      color: var(--text-muted);
    }
    .sipseong-analysis {
      background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.02));
      border-radius: 14px;
      padding: 18px;
      margin-top: 14px;
      border: 1px solid rgba(168,85,247,0.15);
    }
    .sipseong-verdict {
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 14px;
      line-height: 1.4;
    }
    .sipseong-story {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.8;
      margin-bottom: 14px;
      padding: 14px;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      border-left: 3px solid #a855f7;
    }
    .sipseong-story em {
      color: #a855f7;
      font-style: normal;
      font-weight: 500;
    }
    .sipseong-jobs {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 10px;
    }
    .sipseong-jobs strong {
      color: var(--accent);
    }
    
    .block-content {
      font-size: 14px;
      line-height: 1.7;
      color: var(--text-secondary);
    }
    
    .insight-summary {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
    }
    
    .insight-detail {
      margin-bottom: 14px;
      color: var(--text-secondary);
    }
    
    .insight-tags {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .tag-strength, .tag-caution {
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 8px;
      display: block;
    }
    
    .tag-strength {
      background: rgba(96,165,250,0.1);
      color: #60a5fa;
    }
    
    .tag-caution {
      background: rgba(251,191,36,0.1);
      color: #fbbf24;
    }
    
    .integrated-type {
      font-size: 1.2rem;
      font-weight: 700;
      color: #34d399;
      margin-bottom: 12px;
      text-align: center;
      padding: 10px;
      background: rgba(52,211,153,0.1);
      border-radius: 12px;
    }
    
    .integrated-synergy {
      font-size: 14px;
      margin-bottom: 10px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    
    .integrated-tip {
      font-size: 14px;
      padding: 12px;
      background: linear-gradient(90deg, rgba(52,211,153,0.1), transparent);
      border-left: 3px solid #34d399;
      border-radius: 0 8px 8px 0;
    }
    
    /* ===== v2.91: 상단 탭 네비게이션 ===== */
    .main-tabs {
      display: flex;
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 4px;
      margin-bottom: 20px;
      gap: 4px;
      border: 1px solid var(--border-color);
    }
    .main-tab {
      flex: 1;
      padding: 12px 8px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .main-tab:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
    .main-tab.active {
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,107,107,0.15));
      color: var(--accent);
      font-weight: 600;
    }
    .main-tab-icon {
      font-size: 18px;
    }
    .main-tab-text {
      font-size: 11px;
    }
    .main-tab.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .main-tab.disabled:hover {
      background: transparent;
      color: var(--text-secondary);
    }
    
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* ===== v2.91: 2026년 운세 화면 ===== */
    .fortune-2026-header {
      text-align: center;
      padding: 24px 0;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      border-radius: 20px;
      border: 1px solid rgba(255,215,0,0.2);
      position: relative;
      overflow: hidden;
    }
    .fortune-2026-header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at top, rgba(255,215,0,0.1) 0%, transparent 60%);
      pointer-events: none;
    }
    .fortune-2026-year {
      font-size: 14px;
      color: var(--accent);
      letter-spacing: 3px;
      margin-bottom: 8px;
    }
    .fortune-2026-title {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }
    .fortune-2026-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
    }
    .fortune-2026-snake {
      font-size: 48px;
      margin-bottom: 12px;
    }
    
    /* 월별 선택 버튼 */
    .month-selector {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin-bottom: 24px;
    }
    .month-btn {
      padding: 12px 8px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .month-btn:hover {
      border-color: var(--border-hover);
      color: var(--text-primary);
    }
    .month-btn.active {
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,107,107,0.1));
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 600;
    }
    .month-btn.current {
      position: relative;
    }
    .month-btn.current::after {
      content: '●';
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 6px;
      color: #22c55e;
    }
    
    /* 분야별 운세 카드 */
    .fortune-category-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-bottom: 24px;
    }
    .fortune-category-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    .fortune-category-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent, rgba(255,215,0,0.08));
      opacity: 0;
      transition: opacity 0.35s ease;
    }
    .fortune-category-card::after {
      content: '자세히 보기 →';
      position: absolute;
      bottom: 12px;
      right: 14px;
      font-size: 11px;
      color: var(--accent);
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.3s ease;
    }
    .fortune-category-card:hover {
      border-color: var(--accent);
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 32px rgba(0,0,0,0.4), 0 0 0 1px var(--accent);
    }
    .fortune-category-card:hover::before {
      opacity: 1;
    }
    .fortune-category-card:hover::after {
      opacity: 1;
      transform: translateX(0);
    }
    .fortune-category-card:hover .fortune-cat-icon {
      transform: scale(1.25) rotate(-5deg);
    }
    .fortune-category-card:hover .fortune-cat-name {
      color: var(--accent);
    }
    .fortune-category-card:hover .fortune-cat-desc {
      color: var(--text-primary);
    }
    .fortune-category-card:active {
      transform: translateY(-2px) scale(1.01);
    }
    .fortune-category-card.active {
      border-color: var(--accent);
      background: rgba(255,215,0,0.05);
    }
    .fortune-cat-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .fortune-cat-icon {
      font-size: 26px;
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .fortune-cat-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      transition: color 0.3s ease;
    }
    .fortune-cat-score {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    .fortune-cat-bar {
      flex: 1;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }
    .fortune-cat-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .fortune-cat-bar-fill.high { background: linear-gradient(90deg, #22c55e, #16a34a); box-shadow: 0 0 8px rgba(34,197,94,0.4); }
    .fortune-cat-bar-fill.mid { background: linear-gradient(90deg, #fbbf24, #f59e0b); box-shadow: 0 0 8px rgba(251,191,36,0.4); }
    .fortune-cat-bar-fill.low { background: linear-gradient(90deg, #ef4444, #dc2626); box-shadow: 0 0 8px rgba(239,68,68,0.4); }
    .fortune-cat-score-num {
      font-size: 15px;
      font-weight: 700;
      color: var(--accent);
      min-width: 32px;
      text-align: right;
    }
    .fortune-cat-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.7;
      min-height: 90px;
      transition: color 0.3s ease;
      padding-bottom: 16px;
    }
    
    /* 상세 운세 카드 */
    .fortune-detail-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .fortune-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }
    .fortune-detail-icon {
      font-size: 28px;
    }
    .fortune-detail-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .fortune-detail-month {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .fortune-detail-content {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.8;
      margin-bottom: 16px;
    }
    .fortune-detail-content strong {
      color: var(--accent);
    }
    .fortune-detail-tips {
      background: rgba(255,215,0,0.05);
      border-radius: 12px;
      padding: 14px;
    }
    .fortune-detail-tips-title {
      font-size: 12px;
      color: var(--accent);
      margin-bottom: 8px;
      font-weight: 600;
    }
    .fortune-detail-tips-list {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.7;
    }
    .fortune-detail-tips-list li {
      margin-bottom: 4px;
      list-style: none;
      padding-left: 16px;
      position: relative;
    }
    .fortune-detail-tips-list li::before {
      content: '•';
      position: absolute;
      left: 0;
      color: var(--accent);
    }
    
    /* 년운 요약 카드 */
    .yearly-summary-card {
      background: linear-gradient(135deg, rgba(168,85,247,0.1), rgba(99,102,241,0.1));
      border: 1px solid rgba(168,85,247,0.3);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .yearly-summary-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .yearly-summary-icon {
      font-size: 24px;
    }
    .yearly-summary-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--accent-purple);
    }
    .yearly-summary-content {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.7;
    }
    .yearly-summary-content em {
      color: var(--accent);
      font-style: normal;
      font-weight: 500;
    }
    
    /* 행운의 시기 */
    .lucky-months-section {
      margin-top: 16px;
    }
    .lucky-months-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .lucky-months-label {
      font-size: 12px;
      font-weight: 600;
      min-width: 80px;
      padding: 4px 0;
    }
    .lucky-months-label.good {
      color: #22c55e;
    }
    .lucky-months-label.caution {
      color: #ef4444;
    }
    .lucky-months-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .lucky-month-tag {
      padding: 6px 14px;
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: #22c55e;
    }
    .caution-month-tag {
      padding: 6px 14px;
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: #ef4444;
    }
    
    /* 범례 영역 */
    .fortune-legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed var(--border-color);
    }
    .fortune-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-secondary);
    }
    .fortune-legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .fortune-legend-dot.good {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 0 6px rgba(34,197,94,0.5);
    }
    .fortune-legend-dot.caution {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 0 6px rgba(239,68,68,0.5);
    }
    
    /* ===== v2.91: 음력/양력 선택 버튼 ===== */
    .calendar-type-btns {
      display: flex;
      gap: 10px;
    }
    .calendar-type-btns.small {
      gap: 6px;
    }
    .calendar-btn {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      min-width: 70px;
    }
    .calendar-type-btns.small .calendar-btn {
      padding: 10px 14px;
      font-size: 13px;
      min-width: 65px;
    }
    .calendar-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }
    .calendar-btn.active {
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,165,0,0.1));
      border-color: var(--accent);
      color: var(--accent);
    }
    .lunar-notice {
      margin-top: 8px;
      padding: 10px 12px;
      background: rgba(251,191,36,0.1);
      border: 1px solid rgba(251,191,36,0.3);
      border-radius: 8px;
      font-size: 12px;
      color: #fbbf24;
      display: none;
    }
    .lunar-notice.show {
      display: block;
    }
    
    /* ===== 궁합 탭 숨김 (solo 모드) ===== */
    #tab-btn-compat { display: none !important; }
    #tab-compat { display: none !important; }
    #compatibility-modal { display: none !important; }
  </style>
  <!-- v2.91: 음력 변환 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/korean-lunar-calendar@0.3.5/dist/korean-lunar-calendar.min.js"></script>
</head>
<body>
  <div class="settings-bar">
    <button class="settings-btn" id="theme-toggle" onclick="toggleTheme()">
      <span id="theme-icon">🌙</span>
      <span id="theme-text">다크</span>
    </button>
  </div>

  <!-- Intro Screen -->
  <div id="intro" class="screen active intro-screen">
    <div class="badge">K-SAJU × MBTI</div>
    <h1 class="title">사주와 MBTI로<br><span class="highlight">나를 발견하다</span></h1>
    <p class="subtitle">동양의 사주명리와 서양의 MBTI를<br>융합한 새로운 자기이해 시스템<br><br>🔮 사주가 보는 나<br>🧠 MBTI가 보는 나<br>⚡ 둘의 케미는?</p>
    <button class="cta-btn" onclick="showScreen('input')">분석 시작 →</button>
    <!-- ===== 가격 정책 버튼 (비활성화 상태 - 나중에 활성화) =====
    <button class="pricing-link" onclick="showScreen('pricing')" style="margin-top: 12px; background: none; border: none; color: rgba(255,255,255,0.6); font-size: 13px; cursor: pointer; text-decoration: underline;">💎 프리미엄 서비스 안내</button>
    ===== -->
    <p class="footer-text">🇰🇷 K-Saju • Made with ♡ in Seoul</p>
  </div>

  <!-- ===== 가격 정책 화면 (비활성화 상태 - 나중에 활성화) =====
  <div id="pricing" class="screen pricing-screen">
    <button class="back-btn" onclick="showScreen('intro')">← 처음으로</button>
    <h2 class="input-title">💎 프리미엄 서비스</h2>
    <p class="input-subtitle">나에게 맞는 플랜을 선택하세요</p>
    
    <div style="display: flex; flex-direction: column; gap: 16px; padding: 20px;">
      
      <div class="pricing-card" style="background: rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="font-size: 14px; color: rgba(255,255,255,0.6);">기본</div>
        <div style="font-size: 24px; font-weight: bold; color: white; margin: 8px 0;">무료</div>
        <ul style="font-size: 13px; color: rgba(255,255,255,0.8); list-style: none; padding: 0; margin: 16px 0;">
          <li style="margin: 8px 0;">✓ 사주 × MBTI 기본 분석</li>
          <li style="margin: 8px 0;">✓ 2026년 월별 운세</li>
          <li style="margin: 8px 0;">✓ TXT 스크립트 다운로드</li>
        </ul>
        <button style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: none; border-radius: 8px; color: white; cursor: pointer;">현재 이용 중</button>
      </div>
      
      <div class="pricing-card" style="background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(99,102,241,0.2)); border-radius: 16px; padding: 20px; border: 2px solid rgba(139,92,246,0.5);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="font-size: 14px; color: #a78bfa;">프리미엄</div>
          <div style="background: linear-gradient(135deg, #8b5cf6, #6366f1); padding: 4px 8px; border-radius: 4px; font-size: 11px;">추천</div>
        </div>
        <div style="font-size: 24px; font-weight: bold; color: white; margin: 8px 0;">₩9,900</div>
        <ul style="font-size: 13px; color: rgba(255,255,255,0.8); list-style: none; padding: 0; margin: 16px 0;">
          <li style="margin: 8px 0;">✓ 기본 분석 전체 포함</li>
          <li style="margin: 8px 0;">✓ 🎧 AI 음성 리딩 (약 15분)</li>
          <li style="margin: 8px 0;">✓ 📊 상세 PDF 리포트</li>
          <li style="margin: 8px 0;">✓ 🔮 3개월 심화 운세</li>
        </ul>
        <button style="width: 100%; padding: 12px; background: linear-gradient(135deg, #8b5cf6, #6366f1); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">프리미엄 시작하기</button>
      </div>
      
      <div class="pricing-card" style="background: rgba(255,215,0,0.1); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,215,0,0.3);">
        <div style="font-size: 14px; color: #fbbf24;">VIP</div>
        <div style="font-size: 24px; font-weight: bold; color: white; margin: 8px 0;">₩29,900</div>
        <ul style="font-size: 13px; color: rgba(255,255,255,0.8); list-style: none; padding: 0; margin: 16px 0;">
          <li style="margin: 8px 0;">✓ 프리미엄 전체 포함</li>
          <li style="margin: 8px 0;">✓ 🎬 맞춤형 영상 리딩</li>
          <li style="margin: 8px 0;">✓ 💬 1:1 전문가 상담 (30분)</li>
          <li style="margin: 8px 0;">✓ 📅 월간 운세 알림 서비스</li>
        </ul>
        <button style="width: 100%; padding: 12px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">VIP 시작하기</button>
      </div>
      
    </div>
    
    <p style="font-size: 11px; color: rgba(255,255,255,0.4); text-align: center; margin-top: 16px;">
      * 결제 후 24시간 내 제공됩니다<br>
      * 문의: support@k-saju.com
    </p>
  </div>
  ===== -->

  <!-- Input Screen -->
  <div id="input" class="screen input-screen">
    <button class="back-btn" onclick="showScreen('intro')">← 처음으로</button>
    <h2 class="input-title">기본 정보 입력</h2>
    <p class="input-subtitle">양력 기준으로 입력해주세요</p>
    
    <div class="input-grid">
      <!-- Gender -->
      <div class="input-group gender-group">
        <label>성별</label>
        <div class="gender-buttons">
          <button class="gender-btn" onclick="selectGender('m')" id="gender-m">
            <span class="icon">👨</span>
            <span>남성</span>
          </button>
          <button class="gender-btn" onclick="selectGender('f')" id="gender-f">
            <span class="icon">👩</span>
            <span>여성</span>
          </button>
        </div>
      </div>
      
      <!-- v2.91: 음력/양력 선택 -->
      <div class="input-group" style="grid-column: span 2;">
        <label>달력 유형</label>
        <div class="calendar-type-btns">
          <button type="button" class="calendar-btn active" data-cal="solar" onclick="selectCalendarType('solar')">
            ☀️ 양력
          </button>
          <button type="button" class="calendar-btn" data-cal="lunar" onclick="selectCalendarType('lunar')">
            🌙 음력
          </button>
        </div>
        <div id="lunar-notice" class="lunar-notice">
          ⚠️ 음력 날짜를 양력으로 변환하여 계산합니다.
        </div>
      </div>
      
      <!-- Birth Date -->
      <div class="input-group" style="grid-column: span 2;">
        <label>출생년도</label>
        <input type="number" id="year" placeholder="1990" value="1990" min="1900" max="2030">
      </div>
      <div class="input-group">
        <label>월</label>
        <select id="month"></select>
      </div>
      <div class="input-group">
        <label>일</label>
        <select id="day"></select>
      </div>
      <div class="input-group" style="grid-column: span 2;">
        <label>출생시간</label>
        <select id="hour"></select>
      </div>
      
      <!-- MBTI -->
      <div class="input-group mbti-group">
        <div class="mbti-label-row">
          <span class="mbti-label">🧠 MBTI 유형</span>
          <span class="mbti-optional">선택사항</span>
        </div>
        <div class="mbti-select-wrapper">
          <select id="mbti" onchange="showMbtiDesc()">
            <option value="">-- MBTI 선택 (모르면 건너뛰기) --</option>
            <optgroup label="분석가형 (NT)">
              <option value="INTJ">INTJ - 전략가</option>
              <option value="INTP">INTP - 논리술사</option>
              <option value="ENTJ">ENTJ - 통솔자</option>
              <option value="ENTP">ENTP - 변론가</option>
            </optgroup>
            <optgroup label="외교관형 (NF)">
              <option value="INFJ">INFJ - 옹호자</option>
              <option value="INFP">INFP - 중재자</option>
              <option value="ENFJ">ENFJ - 선도자</option>
              <option value="ENFP">ENFP - 활동가</option>
            </optgroup>
            <optgroup label="관리자형 (SJ)">
              <option value="ISTJ">ISTJ - 현실주의자</option>
              <option value="ISFJ">ISFJ - 수호자</option>
              <option value="ESTJ">ESTJ - 경영자</option>
              <option value="ESFJ">ESFJ - 집정관</option>
            </optgroup>
            <optgroup label="탐험가형 (SP)">
              <option value="ISTP">ISTP - 장인</option>
              <option value="ISFP">ISFP - 모험가</option>
              <option value="ESTP">ESTP - 사업가</option>
              <option value="ESFP">ESFP - 연예인</option>
            </optgroup>
          </select>
        </div>
        <div class="mbti-desc" id="mbti-desc"></div>
      </div>
    </div>
    
    <button class="cta-btn" onclick="calculate()" style="width:100%;">분석 시작 ✨</button>
    
    <div class="history-section">
      <div class="history-title">📚 최근 분석 기록</div>
      <div class="history-list" id="history-list">
        <div class="history-empty">저장된 기록이 없습니다</div>
      </div>
    </div>
  </div>

  <!-- Result Screen -->
  <div id="result" class="screen result-screen">
    <div class="result-header">
      <button class="back-btn" onclick="showScreen('input')">← 다시 분석</button>
      <span class="result-date" id="result-date"></span>
    </div>
    
    <!-- v2.91: 상단 탭 네비게이션 -->
    <div class="main-tabs">
      <button class="main-tab active" id="tab-btn-saju" onclick="showTab('saju')">
        <span class="main-tab-icon">🔮</span>
        <span class="main-tab-text">나의 사주</span>
      </button>
      <button class="main-tab" id="tab-btn-fortune2026" onclick="showTab('fortune2026')">
        <span class="main-tab-icon">🐍</span>
        <span class="main-tab-text">2026운세</span>
      </button>
      <button class="main-tab" id="tab-btn-compat" onclick="showTab('compat')">
        <span class="main-tab-icon">💕</span>
        <span class="main-tab-text">궁합</span>
      </button>
      <button class="main-tab disabled" id="tab-btn-ai" onclick="showTab('ai')">
        <span class="main-tab-icon">🤖</span>
        <span class="main-tab-text">AI사주</span>
      </button>
    </div>
    
    <!-- 탭 콘텐츠: 나의 사주 -->
    <div id="tab-saju" class="tab-content active">
      <div id="result-content" class="fade-in"></div>
    </div>
    
    <!-- 탭 콘텐츠: 2026년 운세 -->
    <div id="tab-fortune2026" class="tab-content">
      <div id="fortune-2026-content"></div>
    </div>
    
    <!-- 탭 콘텐츠: 궁합 (모달 대신 탭으로) -->
    <div id="tab-compat" class="tab-content">
      <div id="compat-tab-content">
        <!-- 입력 화면 -->
        <div id="compat-tab-input">
          <div class="fortune-2026-header" style="background: linear-gradient(135deg, #2d1a3e 0%, #1a2e4e 100%);">
            <div style="font-size: 48px; margin-bottom: 12px;">💑</div>
            <div class="fortune-2026-title">사주 궁합 분석</div>
            <div class="fortune-2026-subtitle">상대방 정보를 입력하면<br>두 사람의 케미를 분석해드려요!</div>
          </div>
          
          <div class="compat-form" style="margin-top: 20px;">
            <div class="compat-input-group">
              <label>관계 유형</label>
              <div class="compat-relation-btns">
                <button type="button" class="compat-rel-btn active" data-rel="lover" onclick="selectRelation('lover')">💕 연인</button>
                <button type="button" class="compat-rel-btn" data-rel="friend" onclick="selectRelation('friend')">👫 친구</button>
                <button type="button" class="compat-rel-btn" data-rel="business" onclick="selectRelation('business')">🤝 비즈니스</button>
              </div>
            </div>
            
            <div class="compat-input-group">
              <label>상대방 이름 (선택)</label>
              <input type="text" id="compat-name2" placeholder="예: 홍길동">
            </div>
            
            <div class="compat-input-row">
              <div class="compat-input-group">
                <label>성별</label>
                <select id="compat-gender2">
                  <option value="">선택</option>
                  <option value="male">남성</option>
                  <option value="female">여성</option>
                </select>
              </div>
              <div class="compat-input-group" style="flex: 1.5;">
                <label>달력 유형</label>
                <div class="calendar-type-btns small">
                  <button type="button" class="calendar-btn active" data-cal="solar" onclick="selectCompatCalType('solar')">☀️ 양력</button>
                  <button type="button" class="calendar-btn" data-cal="lunar" onclick="selectCompatCalType('lunar')">🌙 음력</button>
                </div>
              </div>
            </div>
            
            <div class="compat-input-row">
              <div class="compat-input-group">
                <label>태어난 연도</label>
                <input type="number" id="compat-year2" placeholder="1990" min="1920" max="2024">
              </div>
              <div class="compat-input-group">
                <label>월</label>
                <select id="compat-month2"></select>
              </div>
              <div class="compat-input-group">
                <label>일</label>
                <select id="compat-day2"></select>
              </div>
              <div class="compat-input-group">
                <label>시</label>
                <select id="compat-hour2"></select>
              </div>
            </div>
            
            <div class="compat-input-group">
              <label>상대방 MBTI (선택)</label>
              <select id="compat-mbti2">
                <option value="">모름 / 선택안함</option>
                <optgroup label="분석가형 (NT)">
                  <option value="INTJ">INTJ - 전략가</option>
                  <option value="INTP">INTP - 논리술사</option>
                  <option value="ENTJ">ENTJ - 통솔자</option>
                  <option value="ENTP">ENTP - 변론가</option>
                </optgroup>
                <optgroup label="외교관형 (NF)">
                  <option value="INFJ">INFJ - 옹호자</option>
                  <option value="INFP">INFP - 중재자</option>
                  <option value="ENFJ">ENFJ - 선도자</option>
                  <option value="ENFP">ENFP - 활동가</option>
                </optgroup>
                <optgroup label="관리자형 (SJ)">
                  <option value="ISTJ">ISTJ - 현실주의자</option>
                  <option value="ISFJ">ISFJ - 수호자</option>
                  <option value="ESTJ">ESTJ - 경영자</option>
                  <option value="ESFJ">ESFJ - 집정관</option>
                </optgroup>
                <optgroup label="탐험가형 (SP)">
                  <option value="ISTP">ISTP - 장인</option>
                  <option value="ISFP">ISFP - 모험가</option>
                  <option value="ESTP">ESTP - 사업가</option>
                  <option value="ESFP">ESFP - 연예인</option>
                </optgroup>
              </select>
            </div>
          </div>
          
          <button class="cta-btn" style="width:100%; margin-top:20px;" onclick="analyzeCompatibilityTab()">
            💑 궁합 분석하기
          </button>
          <div class="compat-error" id="compat-error2" style="color:#ef4444; text-align:center; margin-top:12px; font-size:13px;"></div>
        </div>
        
        <!-- 결과 화면 -->
        <div id="compat-tab-result" style="display:none;">
          <div id="compat-tab-result-content"></div>
          <button class="cta-btn" style="width:100%; margin-top:20px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);" onclick="showCompatTabInput()">← 다른 사람과 비교하기</button>
        </div>
      </div>
    </div>
    
    <!-- 탭 콘텐츠: AI 사주 (향후 구현) -->
    <div id="tab-ai" class="tab-content">
      <div class="fortune-2026-header" style="background: linear-gradient(135deg, #1a2e1a 0%, #0f3460 100%); opacity: 0.7;">
        <div style="font-size: 48px; margin-bottom: 12px;">🤖</div>
        <div class="fortune-2026-title">AI 사주 (준비중)</div>
        <div class="fortune-2026-subtitle">더 깊은 분석을 제공하는<br>AI 사주 서비스가 곧 출시됩니다!</div>
      </div>
      <div class="card" style="text-align:center; padding:40px 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">🚀</div>
        <div style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Coming Soon</div>
        <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.7;">
          AI가 당신의 사주를 더 깊이 분석하고<br>
          맞춤형 조언을 제공하는 서비스를 준비 중입니다.
        </div>
      </div>
    </div>
  </div>

  <!-- Day Master Modal -->
  <div class="modal-overlay" id="dm-modal" onclick="closeDmModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeDmModal()">&times;</button>
      <div id="dm-modal-content"></div>
    </div>
  </div>

  <!-- 궁합 분석 모달 -->
  <div class="modal-overlay" id="compatibility-modal" onclick="closeCompatibilityModal(event)">
    <div class="compatibility-modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeCompatibilityModal()">&times;</button>
      
      <!-- 입력 화면 -->
      <div id="compat-input-screen">
        <div class="compatibility-modal-icon">💑</div>
        <div class="compatibility-modal-title">사주 궁합 분석</div>
        <div class="compatibility-modal-desc">
          상대방 정보를 입력하면<br>두 사람의 케미를 분석해드려요!
        </div>
        
        <div class="compat-form">
          <div class="compat-input-group">
            <label>관계 유형</label>
            <div class="compat-relation-btns">
              <button type="button" class="compat-rel-btn active" data-rel="lover" onclick="selectRelation('lover')">💕 연인</button>
              <button type="button" class="compat-rel-btn" data-rel="friend" onclick="selectRelation('friend')">👫 친구</button>
              <button type="button" class="compat-rel-btn" data-rel="business" onclick="selectRelation('business')">🤝 비즈니스</button>
            </div>
          </div>
          
          <div class="compat-input-group">
            <label>상대방 이름 (선택)</label>
            <input type="text" id="compat-name" placeholder="예: 홍길동">
          </div>
          
          <div class="compat-input-row">
            <div class="compat-input-group">
              <label>성별</label>
              <select id="compat-gender">
                <option value="">선택</option>
                <option value="male">남성</option>
                <option value="female">여성</option>
              </select>
            </div>
            <div class="compat-input-group" style="flex: 1.5;">
              <label>달력 유형</label>
              <div class="calendar-type-btns small">
                <button type="button" class="calendar-btn active" data-cal="solar" onclick="selectModalCalType('solar')">☀️ 양력</button>
                <button type="button" class="calendar-btn" data-cal="lunar" onclick="selectModalCalType('lunar')">🌙 음력</button>
              </div>
            </div>
          </div>
          
          <div class="compat-input-row">
            <div class="compat-input-group">
              <label>태어난 연도</label>
              <input type="number" id="compat-year" placeholder="1990" min="1920" max="2024">
            </div>
          </div>
          
          <div class="compat-input-row">
            <div class="compat-input-group">
              <label>월</label>
              <select id="compat-month">
                <option value="">선택</option>
                <option value="1">1월</option>
                <option value="2">2월</option>
                <option value="3">3월</option>
                <option value="4">4월</option>
                <option value="5">5월</option>
                <option value="6">6월</option>
                <option value="7">7월</option>
                <option value="8">8월</option>
                <option value="9">9월</option>
                <option value="10">10월</option>
                <option value="11">11월</option>
                <option value="12">12월</option>
              </select>
            </div>
            <div class="compat-input-group">
              <label>일</label>
              <select id="compat-day">
                <option value="">선택</option>
                <option value="1">1일</option>
                <option value="2">2일</option>
                <option value="3">3일</option>
                <option value="4">4일</option>
                <option value="5">5일</option>
                <option value="6">6일</option>
                <option value="7">7일</option>
                <option value="8">8일</option>
                <option value="9">9일</option>
                <option value="10">10일</option>
                <option value="11">11일</option>
                <option value="12">12일</option>
                <option value="13">13일</option>
                <option value="14">14일</option>
                <option value="15">15일</option>
                <option value="16">16일</option>
                <option value="17">17일</option>
                <option value="18">18일</option>
                <option value="19">19일</option>
                <option value="20">20일</option>
                <option value="21">21일</option>
                <option value="22">22일</option>
                <option value="23">23일</option>
                <option value="24">24일</option>
                <option value="25">25일</option>
                <option value="26">26일</option>
                <option value="27">27일</option>
                <option value="28">28일</option>
                <option value="29">29일</option>
                <option value="30">30일</option>
                <option value="31">31일</option>
              </select>
            </div>
            <div class="compat-input-group">
              <label>시</label>
              <select id="compat-hour">
                <option value="">모름</option>
                <option value="0">자시 (23:30~01:29)</option>
                <option value="1">축시 (01:30~03:29)</option>
                <option value="2">인시 (03:30~05:29)</option>
                <option value="3">묘시 (05:30~07:29)</option>
                <option value="4">진시 (07:30~09:29)</option>
                <option value="5">사시 (09:30~11:29)</option>
                <option value="6">오시 (11:30~13:29)</option>
                <option value="7">미시 (13:30~15:29)</option>
                <option value="8">신시 (15:30~17:29)</option>
                <option value="9">유시 (17:30~19:29)</option>
                <option value="10">술시 (19:30~21:29)</option>
                <option value="11">해시 (21:30~23:29)</option>
              </select>
            </div>
          </div>
          
          <div class="compat-input-group">
            <label>상대방 MBTI (선택)</label>
            <select id="compat-mbti">
              <option value="">모름 / 선택안함</option>
              <optgroup label="분석가형 (NT)">
                <option value="INTJ">INTJ - 전략가</option>
                <option value="INTP">INTP - 논리술사</option>
                <option value="ENTJ">ENTJ - 통솔자</option>
                <option value="ENTP">ENTP - 변론가</option>
              </optgroup>
              <optgroup label="외교관형 (NF)">
                <option value="INFJ">INFJ - 옹호자</option>
                <option value="INFP">INFP - 중재자</option>
                <option value="ENFJ">ENFJ - 선도자</option>
                <option value="ENFP">ENFP - 활동가</option>
              </optgroup>
              <optgroup label="관리자형 (SJ)">
                <option value="ISTJ">ISTJ - 현실주의자</option>
                <option value="ISFJ">ISFJ - 수호자</option>
                <option value="ESTJ">ESTJ - 경영자</option>
                <option value="ESFJ">ESFJ - 집정관</option>
              </optgroup>
              <optgroup label="탐험가형 (SP)">
                <option value="ISTP">ISTP - 장인</option>
                <option value="ISFP">ISFP - 모험가</option>
                <option value="ESTP">ESTP - 사업가</option>
                <option value="ESFP">ESFP - 연예인</option>
              </optgroup>
            </select>
          </div>
        </div>
        
        <button class="compatibility-cta" onclick="analyzeCompatibility()">
          💑 궁합 분석하기
        </button>
        <div class="compat-error" id="compat-error"></div>
      </div>
      
      <!-- 결과 화면 -->
      <div id="compat-result-screen" style="display:none;">
        <div id="compat-result-content"></div>
        <button class="compat-back-btn" onclick="showCompatInput()">← 다른 사람과 비교하기</button>
      </div>
    </div>
  </div>

  <script>
    // ===== DATA =====
    const STEMS = [
      { hanja: '甲', name: '갑목', element: 'wood', yinyang: 'yang', 
        desc: '큰 나무의 기운. 진취적이고 리더십이 강하며 성장과 발전을 추구합니다.',
        strength: '추진력, 리더십, 성장', weak: '고집, 융통성 부족',
        personality: '리더형, 추진력, 정직함' },
      { hanja: '乙', name: '을목', element: 'wood', yinyang: 'yin',
        desc: '풀과 덩굴의 기운. 유연하고 적응력이 뛰어나며 섬세한 감각을 가집니다.',
        strength: '적응력, 유연함, 섬세함', weak: '의존성, 우유부단',
        personality: '적응형, 유연함, 섬세함' },
      { hanja: '丙', name: '병화', element: 'fire', yinyang: 'yang',
        desc: '태양의 기운. 밝고 열정적이며 주변을 환하게 밝히는 에너지를 가집니다.',
        strength: '열정, 카리스마, 낙천성', weak: '성급함, 과시욕',
        personality: '열정형, 낙관적, 사교적' },
      { hanja: '丁', name: '정화', element: 'fire', yinyang: 'yin',
        desc: '촛불의 기운. 따뜻하고 집중력이 있으며 세심한 배려심을 가집니다.',
        strength: '집중력, 배려심, 따뜻함', weak: '예민함, 소심함',
        personality: '집중형, 배려심, 내향적' },
      { hanja: '戊', name: '무토', element: 'earth', yinyang: 'yang',
        desc: '산과 대지의 기운. 묵직하고 신뢰감이 있으며 안정을 추구합니다.',
        strength: '신뢰감, 안정감, 포용력', weak: '완고함, 보수적',
        personality: '안정형, 신뢰감, 포용력' },
      { hanja: '己', name: '기토', element: 'earth', yinyang: 'yin',
        desc: '논밭의 기운. 부드럽고 양육적이며 조화를 중시합니다.',
        strength: '중재력, 실용성, 양육력', weak: '걱정, 소극적',
        personality: '중재형, 실용적, 양육적' },
      { hanja: '庚', name: '경금', element: 'metal', yinyang: 'yang',
        desc: '바위와 쇠의 기운. 강직하고 결단력이 있으며 정의를 추구합니다.',
        strength: '결단력, 정의감, 강직함', weak: '냉정함, 융통성 부족',
        personality: '결단형, 정의감, 원칙적' },
      { hanja: '辛', name: '신금', element: 'metal', yinyang: 'yin',
        desc: '보석의 기운. 세련되고 완벽주의적이며 아름다움을 추구합니다.',
        strength: '심미안, 완벽성, 세련됨', weak: '예민함, 비판적',
        personality: '완벽형, 심미안, 세련됨' },
      { hanja: '壬', name: '임수', element: 'water', yinyang: 'yang',
        desc: '바다와 강의 기운. 지혜롭고 포용력이 있으며 큰 그림을 봅니다.',
        strength: '지혜, 포용력, 적응력', weak: '변덕, 일관성 부족',
        personality: '지혜형, 포용력, 큰그림' },
      { hanja: '癸', name: '계수', element: 'water', yinyang: 'yin',
        desc: '이슬과 비의 기운. 직관력이 뛰어나고 감성적이며 깊이가 있습니다.',
        strength: '직관력, 감성적, 깊이감', weak: '감정기복, 망설임',
        personality: '직관형, 감성적, 깊이감' }
    ];

    const BRANCHES = [
      { hanja: '子', name: '자', element: 'water', animal: '쥐', emoji: '🐀', time: '23:00-01:00' },
      { hanja: '丑', name: '축', element: 'earth', animal: '소', emoji: '🐂', time: '01:00-03:00' },
      { hanja: '寅', name: '인', element: 'wood', animal: '호랑이', emoji: '🐅', time: '03:00-05:00' },
      { hanja: '卯', name: '묘', element: 'wood', animal: '토끼', emoji: '🐇', time: '05:00-07:00' },
      { hanja: '辰', name: '진', element: 'earth', animal: '용', emoji: '🐉', time: '07:00-09:00' },
      { hanja: '巳', name: '사', element: 'fire', animal: '뱀', emoji: '🐍', time: '09:00-11:00' },
      { hanja: '午', name: '오', element: 'fire', animal: '말', emoji: '🐴', time: '11:00-13:00' },
      { hanja: '未', name: '미', element: 'earth', animal: '양', emoji: '🐐', time: '13:00-15:00' },
      { hanja: '申', name: '신', element: 'metal', animal: '원숭이', emoji: '🐒', time: '15:00-17:00' },
      { hanja: '酉', name: '유', element: 'metal', animal: '닭', emoji: '🐓', time: '17:00-19:00' },
      { hanja: '戌', name: '술', element: 'earth', animal: '개', emoji: '🐕', time: '19:00-21:00' },
      { hanja: '亥', name: '해', element: 'water', animal: '돼지', emoji: '🐷', time: '21:00-23:00' }
    ];

    const ELEMENTS = {
      wood:  { hanja: '木', name: '목', color: '#22c55e', icon: '🌳', desc: '성장, 창의성, 새로운 시작' },
      fire:  { hanja: '火', name: '화', color: '#ef4444', icon: '🔥', desc: '열정, 용기, 영감' },
      earth: { hanja: '土', name: '토', color: '#eab308', icon: '⛰️', desc: '안정, 신뢰, 포용' },
      metal: { hanja: '金', name: '금', color: '#94a3b8', icon: '⚔️', desc: '결단력, 정확함, 정의' },
      water: { hanja: '水', name: '수', color: '#3b82f6', icon: '💧', desc: '지혜, 유연함, 직관' }
    };

    const DAY_MASTERS = {
      "甲子": { title: "🌳💧 비전을 품은 나무", traits: "명석한 두뇌 • 빠른 직관력 • 전략적 지혜" },
      "甲寅": { title: "🌳🐅 숲 속의 호랑이", traits: "타고난 리더십 • 진취적 개척자 • 당당한 카리스마" },
      "甲辰": { title: "🌳🐉 용이 깃든 나무", traits: "장대한 기상 • 변혁의 힘 • 원대한 야망" },
      "甲午": { title: "🌳🐴 햇살 받은 참나무", traits: "활기찬 에너지 • 강한 추진력 • 주목받는 존재" },
      "甲申": { title: "🌳🐒 지혜로운 참나무", traits: "영리한 전략가 • 민첩한 사고 • 재치있는 판단" },
      "甲戌": { title: "🌳🐕 수호하는 나무", traits: "충직한 보호자 • 안정된 힘 • 믿음직한 존재" },
      "乙丑": { title: "🌿🐂 기름진 땅의 풀", traits: "인내하는 성취자 • 꾸준한 발전 • 깊은 뿌리" },
      "乙卯": { title: "🌿🐇 봄날의 꽃", traits: "자연스러운 매력 • 예술적 감성 • 부드러운 영향력" },
      "乙巳": { title: "🌿🐍 지혜의 덩굴", traits: "은밀한 지성 • 적응하는 성장 • 숨겨진 깊이" },
      "乙未": { title: "🌿🐐 정원의 관리자", traits: "양육하는 마음 • 창의적 표현 • 조용한 힘" },
      "乙酉": { title: "🌿🐓 새벽의 대나무", traits: "유연한 회복력 • 예리한 인식 • 우아한 품격" },
      "乙亥": { title: "🌿🐷 물 위의 연꽃", traits: "순수한 의도 • 감성적 깊이 • 영적 성장" },
      "丙子": { title: "☀️🐀 한밤의 태양", traits: "내면의 빛 • 숨겨진 열정 • 신비로운 매력" },
      "丙寅": { title: "☀️🐯 숲을 비추는 태양", traits: "카리스마 개척자 • 대담한 행동 • 타고난 리더" },
      "丙辰": { title: "☀️🐉 용을 품은 태양", traits: "찬란한 힘 • 거대한 비전 • 빛나는 권위" },
      "丙午": { title: "☀️🐴 타오르는 태양", traits: "최고조의 열정 • 뜨거운 심장 • 강렬한 카리스마" },
      "丙申": { title: "☀️🐒 저녁의 지혜", traits: "따뜻한 지성 • 사교적 날카로움 • 전략적 매력" },
      "丙戌": { title: "☀️🐕 가을 햇살", traits: "충직한 온기 • 보호하는 불꽃 • 변함없는 열정" },
      "丁丑": { title: "🕯️🐂 대지의 등불", traits: "인내하는 밝힘 • 안정된 따스함 • 숨겨진 빛" },
      "丁卯": { title: "🕯️🐇 숲의 촛불", traits: "은은한 영향력 • 창조적 영혼 • 조용한 힘" },
      "丁巳": { title: "🕯️🐍 신성한 불꽃", traits: "영적 통찰 • 강렬한 집중 • 변화시키는 불" },
      "丁未": { title: "🕯️🐐 화롯불", traits: "양육하는 따뜻함 • 예술적 열정 • 부드러운 힘" },
      "丁酉": { title: "🕯️🐓 보석 같은 불꽃", traits: "정제된 광채 • 정확한 열정 • 우아한 불" },
      "丁亥": { title: "🕯️🐷 물 위의 촛불", traits: "고요한 강렬함 • 감성적 깊이 • 영적인 빛" },
      "戊子": { title: "⛰️🐀 산 속 샘물", traits: "숨겨진 자원 • 깊은 기반 • 조용한 힘" },
      "戊寅": { title: "⛰️🐅 산중 호랑이", traits: "장엄한 권위 • 굳건한 야망 • 자연스러운 지배력" },
      "戊辰": { title: "⛰️🐉 산의 용", traits: "거대한 비전 • 튼튼한 기반 • 강력한 존재감" },
      "戊午": { title: "⛰️🐴 햇빛 받은 산봉우리", traits: "빛나는 안정감 • 따뜻한 권위 • 눈에 띄는 힘" },
      "戊申": { title: "⛰️🐒 지혜로운 산", traits: "전략적 인내 • 굳건한 지성 • 영리한 닻" },
      "戊戌": { title: "⛰️🐕 수호하는 산", traits: "충직한 요새 • 흔들리지 않는 힘 • 보호하는 존재" },
      "己丑": { title: "🏔️🐂 비옥한 계곡", traits: "양육하는 대지 • 인내하는 성장 • 풍요로운 잠재력" },
      "己卯": { title: "🏔️🐇 정원의 흙", traits: "창조적인 대지 • 부드러운 재배 • 자연스러운 아름다움" },
      "己巳": { title: "🏔️🐍 숨겨진 봉우리", traits: "전략적 마음 • 내면의 불 • 깊은 이해" },
      "己未": { title: "🏔️🐐 평화로운 초원", traits: "부드러운 안정 • 예술적 본성 • 조용한 힘" },
      "己酉": { title: "🏔️🐓 귀한 흙", traits: "정제된 취향 • 숨겨진 보물 • 우아한 기반" },
      "己亥": { title: "🏔️🐷 강가의 계곡", traits: "유연한 안정 • 깊은 양육 • 감성적 지혜" },
      "庚子": { title: "⚔️🐀 물속의 검", traits: "날카로운 직관 • 전략적 날 • 숨겨진 칼날" },
      "庚寅": { title: "⚔️🐅 호랑이의 칼날", traits: "맹렬한 정확함 • 대담한 일격 • 전사의 정신" },
      "庚辰": { title: "⚔️🐉 용의 검", traits: "전설적인 힘 • 결정적 권위 • 거대한 야망" },
      "庚午": { title: "⚔️🐴 철마", traits: "신속한 결단 • 굳건한 결의 • 명확한 원칙" },
      "庚申": { title: "⚔️🐒 양날의 검", traits: "날카로운 전략 • 영리한 정확함 • 통찰하는 예리함" },
      "庚戌": { title: "⚔️🐕 충직한 칼날", traits: "신의 있는 전사 • 보호하는 힘 • 변함없는 정의" },
      "辛丑": { title: "💎🐂 땅 속의 보석", traits: "숨겨진 아름다움 • 인내하는 정제 • 조용한 우아함" },
      "辛卯": { title: "💎🐇 달빛 보석", traits: "섬세한 광채 • 예술적 정확함 • 부드러운 완벽" },
      "辛巳": { title: "💎🐍 뱀의 진주", traits: "신비로운 아름다움 • 깊은 지혜 • 변화하는 우아함" },
      "辛未": { title: "💎🐐 대지의 보석", traits: "정제된 취향 • 숨겨진 가치 • 조용한 완벽주의" },
      "辛酉": { title: "💎🐓 완벽한 다이아몬드", traits: "궁극의 정확함 • 순수한 아름다움 • 높은 기준" },
      "辛亥": { title: "💎🐷 물속의 진주", traits: "감성적 깊이 • 정제된 직관 • 우아한 지혜" },
      "壬子": { title: "🌊🐀 대양의 깊이", traits: "무한한 지혜 • 강력한 직관 • 숨겨진 조류" },
      "壬寅": { title: "🌊🐅 폭포의 호랑이", traits: "힘찬 흐름 • 대담한 움직임 • 자연의 힘" },
      "壬辰": { title: "🌊🐉 바다의 용", traits: "광대한 힘 • 변화하는 파도 • 전설적 깊이" },
      "壬午": { title: "🌊🐴 불의 강", traits: "열정적 흐름 • 역동적 에너지 • 균형 잡힌 힘" },
      "壬申": { title: "🌊🐒 흐르는 지혜", traits: "적응하는 천재 • 빠른 재치 • 타고난 외교관" },
      "壬戌": { title: "🌊🐕 충직한 물결", traits: "신의 있는 깊이 • 보호하는 흐름 • 변함없는 조류" },
      "癸丑": { title: "💧🐂 겨울 샘물", traits: "인내하는 양육 • 숨겨진 깊이 • 조용한 인내" },
      "癸卯": { title: "💧🐇 아침 비", traits: "부드러운 자양분 • 은은한 힘 • 예술적 흐름" },
      "癸巳": { title: "💧🐍 안개 뱀", traits: "신비로운 직관 • 변화하는 영혼 • 깊은 통찰" },
      "癸未": { title: "💧🐐 부드러운 비", traits: "양육하는 마음 • 평화로운 흐름 • 부드러운 힘" },
      "癸酉": { title: "💧🐓 아침 이슬", traits: "정확한 사고 • 예리한 인식 • 우아한 마음" },
      "癸亥": { title: "💧🐷 끝없는 바다", traits: "무한한 깊이 • 영적 지혜 • 무한한 감성" }
    };

    // MBTI 데이터 (오행 + 설명)
    const MBTI_DATA = {
      "INTJ": { 
        name: "전략가", 
        elements: { 목: 0.20, 화: 0.10, 토: 0.25, 금: 0.25, 수: 0.20 },
        traits: "독립적, 전략적, 완벽주의",
        style: "계획형, 논리적, 미래지향",
        keyword: "전략과 비전"
      },
      "INTP": { 
        name: "논리술사", 
        elements: { 목: 0.25, 화: 0.10, 토: 0.20, 금: 0.30, 수: 0.15 },
        traits: "분석적, 호기심, 논리적",
        style: "탐구형, 객관적, 이론적",
        keyword: "논리와 분석"
      },
      "ENTJ": { 
        name: "통솔자", 
        elements: { 목: 0.20, 화: 0.25, 토: 0.25, 금: 0.20, 수: 0.10 },
        traits: "결단력, 리더십, 효율적",
        style: "지도형, 목표지향, 추진력",
        keyword: "리더십과 결단"
      },
      "ENTP": { 
        name: "변론가", 
        elements: { 목: 0.35, 화: 0.30, 토: 0.05, 금: 0.15, 수: 0.15 },
        traits: "혁신적, 논쟁적, 영리함",
        style: "도전형, 창의적, 적응력",
        keyword: "혁신과 논쟁"
      },
      "INFJ": { 
        name: "옹호자", 
        elements: { 목: 0.25, 화: 0.15, 토: 0.15, 금: 0.10, 수: 0.35 },
        traits: "통찰력, 이상적, 헌신적",
        style: "비전형, 공감적, 원칙적",
        keyword: "통찰과 이상"
      },
      "INFP": { 
        name: "중재자", 
        elements: { 목: 0.30, 화: 0.20, 토: 0.10, 금: 0.05, 수: 0.35 },
        traits: "이상적, 창의적, 감성적",
        style: "치유형, 진정성, 개인적",
        keyword: "감성과 이상"
      },
      "ENFJ": { 
        name: "선도자", 
        elements: { 목: 0.25, 화: 0.30, 토: 0.20, 금: 0.10, 수: 0.15 },
        traits: "카리스마, 이타적, 설득력",
        style: "지도형, 사교적, 영감적",
        keyword: "영감과 이끔"
      },
      "ENFP": { 
        name: "활동가", 
        elements: { 목: 0.35, 화: 0.35, 토: 0.05, 금: 0.10, 수: 0.15 },
        traits: "열정적, 창의적, 사교적",
        style: "탐험형, 자유로움, 낙관적",
        keyword: "열정과 가능성"
      },
      "ISTJ": { 
        name: "현실주의자", 
        elements: { 목: 0.10, 화: 0.10, 토: 0.40, 금: 0.25, 수: 0.15 },
        traits: "신뢰성, 실용적, 체계적",
        style: "관리형, 전통적, 책임감",
        keyword: "책임과 신뢰"
      },
      "ISFJ": { 
        name: "수호자", 
        elements: { 목: 0.20, 화: 0.15, 토: 0.30, 금: 0.10, 수: 0.25 },
        traits: "헌신적, 따뜻함, 세심함",
        style: "보호형, 전통적, 충성심",
        keyword: "헌신과 보호"
      },
      "ESTJ": { 
        name: "경영자", 
        elements: { 목: 0.15, 화: 0.20, 토: 0.35, 금: 0.20, 수: 0.10 },
        traits: "조직력, 실용적, 결단력",
        style: "관리형, 효율적, 원칙적",
        keyword: "조직과 효율"
      },
      "ESFJ": { 
        name: "집정관", 
        elements: { 목: 0.20, 화: 0.30, 토: 0.30, 금: 0.10, 수: 0.10 },
        traits: "사교적, 배려심, 협동적",
        style: "돌봄형, 사회적, 조화로움",
        keyword: "조화와 배려"
      },
      "ISTP": { 
        name: "장인", 
        elements: { 목: 0.20, 화: 0.15, 토: 0.20, 금: 0.30, 수: 0.15 },
        traits: "논리적, 실용적, 관찰력",
        style: "분석형, 독립적, 유연함",
        keyword: "실용과 분석"
      },
      "ISFP": { 
        name: "모험가", 
        elements: { 목: 0.30, 화: 0.20, 토: 0.10, 금: 0.10, 수: 0.30 },
        traits: "예술적, 온화함, 감각적",
        style: "탐험형, 유연함, 현재적",
        keyword: "감각과 자유"
      },
      "ESTP": { 
        name: "사업가", 
        elements: { 목: 0.25, 화: 0.35, 토: 0.10, 금: 0.20, 수: 0.10 },
        traits: "대담함, 현실적, 에너지",
        style: "행동형, 적응력, 실용적",
        keyword: "행동과 현실"
      },
      "ESFP": { 
        name: "연예인", 
        elements: { 목: 0.30, 화: 0.40, 토: 0.05, 금: 0.10, 수: 0.15 },
        traits: "사교적, 낙관적, 즉흥적",
        style: "연예형, 현재적, 열정적",
        keyword: "즐거움과 활력"
      }
    };

    // ===== MBTI × 일간 160개 조합 라벨 (신규 맵핑 로직 v1.0) =====
    // key: "MBTI_stemIndex" (stemIndex: 0=갑, 1=을, 2=병, 3=정, 4=무, 5=기, 6=경, 7=신, 8=임, 9=계)
    const COMBO_LABELS = {
      // INTJ (전략가) × 일간
      "INTJ_0": { label: "뿌리 깊은 설계자", tagline: "자신만의 철학을 절대 굽히지 않는 고집 있는 천재" },
      "INTJ_1": { label: "변칙적 전략가", tagline: "한 가지 길에 집착하지 않고 플랜 B를 늘 준비하는 지능캐" },
      "INTJ_2": { label: "비전을 보는 선각자", tagline: "미래의 흐름을 읽고 빛의 속도로 앞서 나가는 분석가" },
      "INTJ_3": { label: "밤의 연구원", tagline: "고요한 속에서 진리를 탐구하고 핵심을 찌르는 통찰가" },
      "INTJ_4": { label: "난공불락의 요새", tagline: "자신의 논리 체계를 성벽처럼 견고하게 쌓아 올린 학자" },
      "INTJ_5": { label: "정밀한 실무 기획자", tagline: "이론을 현실에 적용 가능한 데이터로 바꾸는 변환기" },
      "INTJ_6": { label: "원칙주의 분석가", tagline: "예외를 허용하지 않는 엄격한 논리 체계의 수호자" },
      "INTJ_7": { label: "베일에 싸인 예언자", tagline: "신금의 고결함과 직관이 만나 세상에 영감을 주는 지주" },
      "INTJ_8": { label: "깊은 지혜의 창고", tagline: "방대한 지식을 머릿속에 담고 있는 살아있는 도서관" },
      "INTJ_9": { label: "보이지 않는 설계자", tagline: "드러나지 않게 뒤에서 모든 상황을 조종하는 흑막" },

      // INTP (논리술사) × 일간
      "INTP_0": { label: "고독한 탐구자", tagline: "한 우물만 깊게 파서 결국 최고의 권위자가 되는 장인" },
      "INTP_1": { label: "자유로운 사색가", tagline: "어디에도 얽매이지 않고 지적 유희를 즐기는 방랑 학자" },
      "INTP_2": { label: "진리를 비추는 등불", tagline: "복잡한 이론을 명쾌하고 밝게 풀어내는 강연가 타입" },
      "INTP_3": { label: "내면의 연금술사", tagline: "자신만의 실험실에서 세상을 바꿀 공식을 만드는 연구원" },
      "INTP_4": { label: "철학적 산맥", tagline: "거대한 이론 체계를 묵묵히 탐구하는 현대의 소크라테스" },
      "INTP_5": { label: "실용적 데이터 분석가", tagline: "흩어진 정보들을 모아 쓸모 있는 지식으로 분류하는 정리왕" },
      "INTP_6": { label: "냉정한 비판적 사고가", tagline: "감정을 배제하고 오직 논리로만 세상을 재단하는 칼날" },
      "INTP_7": { label: "결벽적 논리주의자", tagline: "작은 오류 하나도 용납하지 않는 완벽한 코드 분석가" },
      "INTP_8": { label: "철학의 바다", tagline: "세상 모든 만물의 원리를 이해하려는 거대한 지적 갈망" },
      "INTP_9": { label: "논리의 심해 탐사선", tagline: "계수의 침투력과 분석력이 만나 보이지 않는 원리 탐구" },

      // ENTJ (통솔자) × 일간
      "ENTJ_0": { label: "불도저형 설계자", tagline: "갑목의 추진력과 ENTJ의 전략이 만나 거대한 조직을 구축하는 리더" },
      "ENTJ_1": { label: "유연한 비즈니스 설계자", tagline: "목표를 향해 넝쿨처럼 뻗어 나가는 적응력 갑(甲) 리더" },
      "ENTJ_2": { label: "태양의 정복자", tagline: "압도적인 카리스마와 화려한 화술로 좌중을 압도하는 CEO" },
      "ENTJ_3": { label: "실속형 브레인", tagline: "겉은 따뜻하나 속은 치밀한 계산으로 결과를 내는 승부사" },
      "ENTJ_4": { label: "제국의 건설자", tagline: "흔들리지 않는 신념으로 거대 조직을 운영하는 관리자" },
      "ENTJ_5": { label: "치밀한 현실주의 리더", tagline: "이상보다는 수익과 실리를 꼼꼼하게 챙기는 사업가" },
      "ENTJ_6": { label: "냉혈한 집행관", tagline: "공과 사가 확실하며 결과가 없으면 가차 없는 심판자" },
      "ENTJ_7": { label: "예리한 혁신가", tagline: "기존의 틀을 정교하게 깎아 새로운 가치를 만드는 기획자" },
      "ENTJ_8": { label: "유연한 정복자", tagline: "임수의 변화무쌍함과 목표의식이 만나 전술에 능한 리더" },
      "ENTJ_9": { label: "전략적 지략가", tagline: "조용히 흐르는 물처럼 상대를 파악하고 판을 짜는 모사" },

      // ENTP (변론가) × 일간
      "ENTP_0": { label: "거침없는 개척자", tagline: "새로운 아이디어를 보면 바로 뿌리 내리고 키우는 발명가" },
      "ENTP_1": { label: "능구렁이 협상가", tagline: "어떤 상황에서도 말로 살아남는 유연한 화술의 소유자" },
      "ENTP_2": { label: "무대 위의 선동가", tagline: "대중을 열광시키는 아이디어와 쇼맨십을 가진 혁신가" },
      "ENTP_3": { label: "번뜩이는 아이디어 맨", tagline: "찰나의 영감을 포착해 세상에 없던 솔루션을 내는 기획자" },
      "ENTP_4": { label: "현실적인 모험가", tagline: "뜬구름 잡는 소리가 아닌 돈 되는 아이디어를 찾는 사업가" },
      "ENTP_5": { label: "재치 있는 수완가", tagline: "사람들의 니즈를 정확히 파악해 맞춤형 정보를 주는 정보원" },
      "ENTP_6": { label: "독설가적 비평가", tagline: "틀린 건 틀렸다고 말해야 직성이 풀리는 팩트 폭격기" },
      "ENTP_7": { label: "정교한 트러블슈터", tagline: "복잡하게 꼬인 문제를 예리한 시각으로 풀어내는 기술자" },
      "ENTP_8": { label: "지혜의 파괴적 혁신가", tagline: "임수의 깊이와 변칙적 사고가 만나 기존 틀을 깨는 전략가" },
      "ENTP_9": { label: "변화무쌍한 책략가", tagline: "상황에 따라 가면을 바꿔 쓰며 이득을 취하는 실리주의자" },

      // INFJ (옹호자) × 일간
      "INFJ_0": { label: "곧은 신념의 예언자", tagline: "자신이 옳다고 믿는 길을 묵묵히 걷는 선구자" },
      "INFJ_1": { label: "예술적 통찰가", tagline: "섬세한 감각으로 세상의 아름다움과 슬픔을 노래하는 시인" },
      "INFJ_2": { label: "빛을 꿈꾸는 구도자", tagline: "어두운 세상에 희망의 메시지를 던지는 등불 같은 존재" },
      "INFJ_3": { label: "촛불 같은 희생자", tagline: "자신을 태워 주변을 밝히는 헌신적인 사랑의 실천가" },
      "INFJ_4": { label: "침묵의 수행자", tagline: "겉으로 드러내지 않으나 거대한 내면세계를 가진 명상가" },
      "INFJ_5": { label: "다정한 상담가", tagline: "소리 없이 다가와 마음의 짐을 들어주는 든든한 대지" },
      "INFJ_6": { label: "단호한 원칙가", tagline: "선함 속에서도 옳고 그름은 명확히 가리는 외유내강" },
      "INFJ_7": { label: "고결한 정신의 수호자", tagline: "자신만의 도덕적 결벽을 유지하며 영감을 주는 존재" },
      "INFJ_8": { label: "지혜의 우물", tagline: "인생의 본질적인 질문에 답을 줄 수 있는 현자" },
      "INFJ_9": { label: "안개 속의 몽상가", tagline: "신비롭고 몽환적인 분위기를 가진 영성가" },

      // INFP (중재자) × 일간
      "INFP_0": { label: "꿈꾸는 나무", tagline: "하늘을 향해 높게 이상을 뻗어 올리는 순수한 영혼" },
      "INFP_1": { label: "풀잎 같은 감성", tagline: "작은 것에도 감동하고 눈물 흘리는 섬세한 예술가" },
      "INFP_2": { label: "해맑은 어린아이", tagline: "세상의 풍파에도 순수함을 잃지 않는 낙천가" },
      "INFP_3": { label: "달빛 아래 시인", tagline: "고요한 밤에 자신의 내면을 글로 쓰는 창작자" },
      "INFP_4": { label: "외유내강의 거인", tagline: "단단한 중심과 이상주의가 만나 신념을 지키는 존재" },
      "INFP_5": { label: "포근한 안식처", tagline: "곁에 있기만 해도 마음이 편안해지는 무해한 사람" },
      "INFP_6": { label: "고집 있는 이상주의자", tagline: "겉은 약해 보여도 자신의 가치관만큼은 꺾지 않는 강단" },
      "INFP_7": { label: "예민한 완벽주의자", tagline: "자신의 작품이나 글에 있어 타협 없는 장인 정신" },
      "INFP_8": { label: "사색의 호수", tagline: "깊은 생각에 잠겨 인생의 의미를 반추하는 철학자" },
      "INFP_9": { label: "지혜로운 치유자", tagline: "타인의 아픔을 조용히 적셔주는 공감 능력자" },

      // ENFJ (선도자) × 일간
      "ENFJ_0": { label: "숲을 가꾸는 정원사", tagline: "책임감과 공감 능력이 만나 사람들을 키워내는 멘토" },
      "ENFJ_1": { label: "부드러운 카리스마", tagline: "강요하지 않으면서도 사람들을 이끄는 봄바람 같은 리더" },
      "ENFJ_2": { label: "열정의 전도사", tagline: "긍정 에너지를 전파하여 세상을 밝게 바꾸려는 활동가" },
      "ENFJ_3": { label: "세심한 멘토", tagline: "한 사람 한 사람의 마음을 어루만지는 따뜻한 상담가" },
      "ENFJ_4": { label: "포용력 있는 지도자", tagline: "어떤 사람의 허물도 덮어주는 넓은 가슴을 가진 정신적 지주" },
      "ENFJ_5": { label: "살림꾼 리더", tagline: "공동체의 화합뿐만 아니라 현실적 복지까지 챙기는 관리자" },
      "ENFJ_6": { label: "정의로운 개혁가", tagline: "잘못된 사회 시스템을 바로잡으려 앞장서는 열혈 의사" },
      "ENFJ_7": { label: "고결한 이상주의자", tagline: "도덕적 완벽함을 추구하며 타의 모범이 되는 선비 타입" },
      "ENFJ_8": { label: "포용하는 바다", tagline: "갈등을 중재하고 모든 의견을 수렴하는 소통의 달인" },
      "ENFJ_9": { label: "단비 같은 조력자", tagline: "지친 사람들에게 꼭 필요한 위로와 희망을 주는 치유자" },

      // ENFP (활동가) × 일간
      "ENFP_0": { label: "성장하는 아이디어", tagline: "끊임없이 새로운 도전을 멈추지 않는 에너자이저" },
      "ENFP_1": { label: "넝쿨째 굴러온 복", tagline: "어디서든 적응하며 인맥을 확장하는 사교왕" },
      "ENFP_2": { label: "태양 아래 에너지원", tagline: "멈추지 않는 열정으로 주변의 사기를 북돋는 비타민" },
      "ENFP_3": { label: "감성 톡톡 튀는 요정", tagline: "반짝이는 감수성으로 사람들을 즐겁게 하는 분위기 메이커" },
      "ENFP_4": { label: "든든한 모험가", tagline: "자유롭지만 선은 넘지 않는 믿음직한 여행자" },
      "ENFP_5": { label: "생활 밀착형 활동가", tagline: "사람들과 어울리며 소소한 행복을 찾아내는 재주꾼" },
      "ENFP_6": { label: "거침없는 행동파", tagline: "생각나면 바로 실행에 옮겨 결과를 보고야 마는 행동가" },
      "ENFP_7": { label: "반짝이는 보석", tagline: "남다른 안목과 스타일로 트렌드를 선도하는 아이콘" },
      "ENFP_8": { label: "자유로운 영혼", tagline: "구속을 거부하고 전 세계를 누비는 글로벌 노마드" },
      "ENFP_9": { label: "변화의 마법사", tagline: "분위기에 맞춰 자신을 변화시키는 매력적인 카멜레온" },

      // ISTJ (현실주의자) × 일간
      "ISTJ_0": { label: "우직한 원칙 수호자", tagline: "한 번 정한 규칙은 끝까지 지켜내는 조직의 신뢰 기둥" },
      "ISTJ_1": { label: "성실한 실무 보조자", tagline: "적응력이 뛰어나며 맡은 바 책임을 다하는 살림꾼" },
      "ISTJ_2": { label: "밝은 에너지 공무원", tagline: "성실함에 쾌활함을 더해 조직의 활력을 주는 이" },
      "ISTJ_3": { label: "보이지 않는 헌신가", tagline: "뒤에서 묵묵히 제 역할을 다하며 등불이 되어주는 사람" },
      "ISTJ_4": { label: "신뢰의 바윗덩어리", tagline: "변함없는 태도로 공동체의 안녕을 책임지는 파수꾼" },
      "ISTJ_5": { label: "대지의 관리자", tagline: "현실적인 자원을 아끼고 관리하여 내실을 기하는 수호자" },
      "ISTJ_6": { label: "단단한 수호 방패", tagline: "외풍으로부터 조직을 지켜내는 강직한 원칙주의자" },
      "ISTJ_7": { label: "완벽주의 기록관", tagline: "한 치의 오차도 없는 문서 작업과 데이터의 장인" },
      "ISTJ_8": { label: "지혜로운 기록가", tagline: "과거의 경험을 토대로 미래의 위험을 대비하는 예방가" },
      "ISTJ_9": { label: "세심한 보급관", tagline: "작은 것 하나 놓치지 않고 챙기는 꼼꼼한 실무자" },

      // ISFJ (수호자) × 일간
      "ISFJ_0": { label: "우직한 조력자", tagline: "한 사람을 위해 평생 헌신할 수 있는 지조 있는 사람" },
      "ISFJ_1": { label: "상냥한 서포터", tagline: "주변의 요구에 민감하게 반응하며 도움을 주는 이" },
      "ISFJ_2": { label: "밝은 봉사자", tagline: "자신의 헌신으로 주변이 밝아지는 것을 즐기는 천사" },
      "ISFJ_3": { label: "은은한 촛불", tagline: "드러나지 않게 주변을 돌보는 헌신적인 사랑의 실천가" },
      "ISFJ_4": { label: "대지의 어머니", tagline: "수용적 성품으로 모든 이의 허물을 덮어주는 안식처" },
      "ISFJ_5": { label: "포근한 관리자", tagline: "내실 있는 가정과 조직을 꾸리는 데 최적화된 사람" },
      "ISFJ_6": { label: "단단한 내조자", tagline: "겉은 부드럽지만 속은 강직하게 원칙을 지키는 외유내강" },
      "ISFJ_7": { label: "세심한 보석 감정사", tagline: "소중한 가치를 알아보고 정성껏 보듬는 수호자" },
      "ISFJ_8": { label: "지혜로운 내실가", tagline: "깊은 통찰로 가족과 조직의 앞날을 대비하는 사람" },
      "ISFJ_9": { label: "단비 같은 반려자", tagline: "가장 필요한 순간에 곁을 지켜주는 든든한 조력자" },

      // ESTJ (경영자) × 일간
      "ESTJ_0": { label: "위풍당당한 사령관", tagline: "추진력으로 질서를 바로잡고 성과를 쟁취하는 리더" },
      "ESTJ_1": { label: "관리형 협상가", tagline: "유연한 태도로 실무진을 독려하여 목표를 달성하는 관리자" },
      "ESTJ_2": { label: "열정적인 실무 리더", tagline: "화끈한 리더십으로 현장을 진두지휘하는 행동 대장" },
      "ESTJ_3": { label: "따뜻한 원칙주의자", tagline: "규율을 중시하면서도 팀원의 사정을 살피는 인간미" },
      "ESTJ_4": { label: "흔들리지 않는 집행관", tagline: "묵직한 신뢰감을 바탕으로 조직의 법도를 세우는 자" },
      "ESTJ_5": { label: "내실 있는 운영자", tagline: "화려함보다는 실질적인 수익과 복지를 챙기는 실무파" },
      "ESTJ_6": { label: "철혈의 규율반장", tagline: "공과 사를 칼같이 구분하며 효율을 극대화하는 심판자" },
      "ESTJ_7": { label: "정교한 관리 기획자", tagline: "꼼꼼한 데이터로 시스템의 빈틈을 메우는 완벽주의자" },
      "ESTJ_8": { label: "통찰력 있는 사령관", tagline: "넓은 안목으로 시장의 흐름을 읽고 대처하는 전략가" },
      "ESTJ_9": { label: "유연한 조직 관리자", tagline: "상황에 맞춰 규정을 적용하는 영리한 리더" },

      // ESFJ (집정관) × 일간
      "ESFJ_0": { label: "당당한 커뮤니티 장", tagline: "사람들을 모아 공동의 성장을 이끄는 활발한 리더" },
      "ESFJ_1": { label: "다정한 중재자", tagline: "갈등 사이에서 꽃을 피우듯 화합을 만들어내는 사람" },
      "ESFJ_2": { label: "축제의 호스트", tagline: "모두가 즐거운 분위기를 만드는 데 탁월한 사교가" },
      "ESFJ_3": { label: "포근한 사랑방 주인", tagline: "주변의 고민을 들어주고 온기를 나누는 등대" },
      "ESFJ_4": { label: "믿음직한 보호자", tagline: "가족과 동료를 산처럼 든든하게 지켜주는 사람" },
      "ESFJ_5": { label: "실속 있는 살림꾼", tagline: "공동체의 안녕과 현실적 복지를 꼼꼼히 챙기는 관리자" },
      "ESFJ_6": { label: "정의로운 수호자", tagline: "공동체의 질서를 위해 악역도 자처하는 강단 있는 이" },
      "ESFJ_7": { label: "섬세한 코디네이터", tagline: "사람들의 장점을 찾아내어 빛나게 해주는 조력자" },
      "ESFJ_8": { label: "포용력 있는 사교가", tagline: "다양한 사람들과 유연하게 소통하는 인맥의 왕" },
      "ESFJ_9": { label: "다정한 멘토", tagline: "지친 이들에게 적절한 위로와 가이드를 주는 치유자" },

      // ISTP (장인) × 일간
      "ISTP_0": { label: "독립적인 장인", tagline: "간섭을 거부하고 자신만의 기술 세계를 구축하는 고수" },
      "ISTP_1": { label: "유연한 기술자", tagline: "도구 활용 능력이 뛰어나며 어떤 환경에도 적응하는 이" },
      "ISTP_2": { label: "밝은 탐험가", tagline: "호기심을 바탕으로 세상을 직접 경험하고 분석하는 이" },
      "ISTP_3": { label: "내면의 설계자", tagline: "조용히 사물을 관찰하여 최적의 효율을 찾아내는 사람" },
      "ISTP_4": { label: "과묵한 해결사", tagline: "말보다는 행동으로 꼬인 문제를 풀어버리는 실전 전문가" },
      "ISTP_5": { label: "실용적 제작자", tagline: "생활에 필요한 도구를 뚝딱 만들어내는 현실주의자" },
      "ISTP_6": { label: "무심한 전문가", tagline: "냉정한 분석력으로 기계나 시스템의 오류를 잡는 칼날" },
      "ISTP_7": { label: "정밀한 분석가", tagline: "작은 디테일까지 파고들어 완벽한 결과물을 내는 장인" },
      "ISTP_8": { label: "지혜로운 방랑자", tagline: "세상 이치를 몸소 부딪치며 깨닫는 고독한 철학자" },
      "ISTP_9": { label: "조용한 해결사", tagline: "스며들 듯 다가가 문제를 해결하고 사라지는 지략가" },

      // ISFP (모험가) × 일간
      "ISFP_0": { label: "독창적 예술가", tagline: "자신만의 미적 기준을 고집스럽게 지키는 순수 작가" },
      "ISFP_1": { label: "바람을 타는 여행가", tagline: "구속을 거부하며 자연스러운 아름다움을 찾는 이" },
      "ISFP_2": { label: "색채의 마술사", tagline: "세상의 화려한 색감을 캔버스에 옮기는 예술가" },
      "ISFP_3": { label: "따뜻한 감성가", tagline: "작은 소품 하나에도 영혼을 담는 섬세한 공예가" },
      "ISFP_4": { label: "침묵의 예술가", tagline: "자연의 평온함을 사랑하고 그 속에서 영감을 얻는 이" },
      "ISFP_5": { label: "소박한 안식처", tagline: "화려하지 않아도 편안한 아름다움을 추구하는 사람" },
      "ISFP_6": { label: "강단 있는 미학자", tagline: "자신만의 가치관을 작품에 투영하는 외유내강형" },
      "ISFP_7": { label: "예민한 장인", tagline: "극강의 섬세함으로 완벽한 미를 추구하는 완벽주의자" },
      "ISFP_8": { label: "사색하는 아티스트", tagline: "깊은 내면의 흐름을 예술로 승화시키는 사람" },
      "ISFP_9": { label: "이슬 머금은 꽃잎", tagline: "여린 감수성으로 세상의 작은 아름다움을 포착함" },

      // ESTP (사업가) × 일간
      "ESTP_0": { label: "거침없는 야생마", tagline: "직관적으로 기회를 포착하여 행동으로 옮기는 승부사" },
      "ESTP_1": { label: "재치 있는 영업왕", tagline: "뛰어난 임기응변으로 상대를 설득하는 비즈니스맨" },
      "ESTP_2": { label: "현장의 주인공", tagline: "화려한 퍼포먼스로 위기 상황을 돌파하는 해결사" },
      "ESTP_3": { label: "예리한 행동파", tagline: "순간적인 집중력으로 핵심 문제를 타격하는 실전형" },
      "ESTP_4": { label: "현실적 모험가", tagline: "리스크를 관리하며 큰 판을 노리는 대범한 사업가" },
      "ESTP_5": { label: "수완 좋은 활동가", tagline: "사람들 사이의 정보를 돈으로 바꾸는 정보원" },
      "ESTP_6": { label: "냉철한 도전자", tagline: "감정을 배제하고 오직 효율과 결과로 증명하는 전사" },
      "ESTP_7": { label: "정교한 테크니션", tagline: "기술적인 문제를 감각적으로 풀어내는 현장의 장인" },
      "ESTP_8": { label: "변칙적 투자자", tagline: "상황의 흐름을 타고 이득을 취하는 유연한 투자자" },
      "ESTP_9": { label: "기민한 전략가", tagline: "상대의 약점을 파고들어 실익을 챙기는 실용주의자" },

      // ESFP (연예인) × 일간
      "ESFP_0": { label: "자신감 넘치는 스타", tagline: "새로운 유행을 선도하며 당당하게 자신을 드러내는 이" },
      "ESFP_1": { label: "트렌디한 카멜레온", tagline: "분위기에 맞춰 매력을 발산하는 타고난 엔터테이너" },
      "ESFP_2": { label: "무대 위 태양", tagline: "압도적인 에너지로 좌중을 열광시키는 축제의 주인공" },
      "ESFP_3": { label: "무대 위 불꽃놀이", tagline: "순간의 즐거움을 위해 자신을 불태우는 열정가" },
      "ESFP_4": { label: "낙천적 모험가", tagline: "어디서든 적응하며 즐거움을 찾아내는 긍정 대장" },
      "ESFP_5": { label: "현실적 향락주의자", tagline: "소소한 행복과 미식, 예술을 즐길 줄 아는 재주꾼 " },
      "ESFP_6": { label: "거침없는 쇼맨", tagline: "화끈한 행동으로 사람들의 시선을 사로잡는 승부사" },
      "ESFP_7": { label: "반짝이는 아이콘", tagline: "독보적인 스타일과 안목으로 주목받는 패셔니스타" },
      "ESFP_8": { label: "글로벌 노마드", tagline: "전 세계를 무대로 자유롭게 소통하는 자유로운 영혼" },
      "ESFP_9": { label: "매력적인 변신가", tagline: "다양한 가면을 쓰며 사람들을 즐겁게 하는 연기자" }
    };

    // ===== v2.94: MBTI × 일간 케미 데이터베이스 (160개 조합) =====
    // 키 형식: "MBTI_stemIndex" (0=甲, 1=乙, 2=丙, 3=丁, 4=戊, 5=己, 6=庚, 7=辛, 8=壬, 9=癸)
    const CHEMISTRY_DB = {
      // ===== 甲木 (stemIndex: 0) =====
      "INTJ_0": { score: 88, grade: "S", title: "전략적 대목", subtitle: "비전을 향해 곧게 뻗는 전략가의 나무", advice: "최고의 실행력을 자랑합니다. 유연한 리더가 더 큰 숲을 만듭니다." },
      "INTP_0": { score: 72, grade: "B+", title: "사색하는 나무", subtitle: "깊은 뿌리로 진리를 탐구하는 철학자", advice: "생각 50%, 행동 50%로 균형을 잡아보세요." },
      "ENTJ_0": { score: 95, grade: "S+", title: "정복자의 소나무", subtitle: "하늘을 향해 뻗어 세계를 호령하는 대장군", advice: "역사에 남을 업적을 만들 수 있는 최강 조합입니다." },
      "ENTP_0": { score: 78, grade: "A", title: "혁신하는 거목", subtitle: "새로운 가능성을 향해 가지를 뻗는 혁명가", advice: "'완료' 리스트를 만들어 관리하세요." },
      "INFJ_0": { score: 82, grade: "A", title: "이상을 품은 나무", subtitle: "세상을 바꿀 비전을 키우는 현자의 나무", advice: "INFJ의 섬세한 감정을 무시하지 마세요." },
      "INFP_0": { score: 68, grade: "B", title: "꿈을 품은 나무", subtitle: "내면의 이상을 현실에서 키워가는 몽상가", advice: "甲木은 더 부드럽게, INFP는 더 현실적으로." },
      "ENFJ_0": { score: 85, grade: "A+", title: "사람을 키우는 나무", subtitle: "그늘을 만들어 모두를 품는 대장목", advice: "'함께 이끈다'는 마인드가 필요해요." },
      "ENFP_0": { score: 76, grade: "A-", title: "자유로운 거목", subtitle: "바람에 흔들려도 뿌리는 견고한 자유주의자", advice: "'먼저 하나 끝내고 다음' 원칙을 세워보세요." },
      "ISTJ_0": { score: 80, grade: "A", title: "전통의 대목", subtitle: "오래된 숲처럼 든든하고 믿음직한 수호목", advice: "번갈아 양보하는 습관을 만드세요." },
      "ISFJ_0": { score: 74, grade: "B+", title: "보호하는 나무", subtitle: "작은 것들을 품고 키우는 따뜻한 숲", advice: "서로의 다름을 인정하면 균형 잡힌 팀이 됩니다." },
      "ESTJ_0": { score: 90, grade: "S", title: "조직의 대장목", subtitle: "질서 있는 숲을 만드는 관리자의 나무", advice: "'효율'만 추구하다 '사람'을 잃지 않도록 주의하세요." },
      "ESFJ_0": { score: 77, grade: "A-", title: "마을의 당산목", subtitle: "사람들이 모이는 따뜻한 그늘을 만드는 나무", advice: "'원칙'과 '조화' 사이에서 균형을 잘 잡으세요." },
      "ISTP_0": { score: 70, grade: "B", title: "실용적 목수", subtitle: "나무를 다루어 실질적 가치를 만드는 장인", advice: "가끔은 '마음'을 표현하는 연습을 해보세요." },
      "ISFP_0": { score: 65, grade: "B-", title: "예술가의 나무", subtitle: "아름다움과 강인함을 함께 품은 수목", advice: "서로의 차이를 존중하고 천천히 이해하세요." },
      "ESTP_0": { score: 75, grade: "B+", title: "모험의 나무", subtitle: "거친 바람 속에서도 뿌리 내리는 개척자", advice: "결정 전 24시간 생각하는 규칙을 만들어보세요." },
      "ESFP_0": { score: 67, grade: "B", title: "축제의 나무", subtitle: "사람들을 모으고 기쁨을 나누는 생명의 나무", advice: "'일할 때 일, 놀 때 놀자' 밸런스를 유지하세요." },
      
      // ===== 乙木 (stemIndex: 1) =====
      "INTJ_1": { score: 70, grade: "B", title: "전략적 덩굴", subtitle: "어디든 파고들어 목표를 달성하는 은밀한 전략가", advice: "당신의 의견도 중요합니다. 목소리를 내세요." },
      "INTP_1": { score: 73, grade: "B+", title: "탐구하는 풀", subtitle: "틈새를 파고들어 진리를 찾는 조용한 연구자", advice: "'매일 작은 실행 하나'를 목표로 삼으세요." },
      "ENTJ_1": { score: 62, grade: "C+", title: "참모의 덩굴", subtitle: "강한 리더 옆에서 지혜를 더하는 조력자", advice: "종속이 아닌 파트너십이 되어야 해요." },
      "ENTP_1": { score: 74, grade: "B+", title: "변화무쌍한 덩굴", subtitle: "새로운 것을 탐험하며 뻗어나가는 호기심의 촉수", advice: "시작한 것 중 50%만 끝내겠다는 목표를 세우세요." },
      "INFJ_1": { score: 85, grade: "A+", title: "영혼의 덩굴", subtitle: "깊은 내면으로 연결되는 정서적 유대", advice: "상처받았을 때 숨지 말고 솔직하게 표현하세요." },
      "INFP_1": { score: 88, grade: "S", title: "꿈꾸는 풀밭", subtitle: "부드럽게 흔들리며 이상을 품은 낭만주의자", advice: "작은 목표를 세우고 함께 달성하는 연습을 하세요." },
      "ENFJ_1": { score: 80, grade: "A", title: "화합의 꽃밭", subtitle: "사람들 사이에서 조화를 만드는 중재의 꽃", advice: "자신의 필요도 솔직하게 이야기해야 해요." },
      "ENFP_1": { score: 82, grade: "A", title: "춤추는 덩굴", subtitle: "바람 따라 자유롭게 흔들리는 생명의 율동", advice: "한 달에 한 번은 진지하게 미래를 이야기하세요." },
      "ISTJ_1": { score: 72, grade: "B+", title: "정원의 풀", subtitle: "정해진 자리에서 묵묵히 역할을 다하는 조화", advice: "서로의 스타일을 존중하고 조율하세요." },
      "ISFJ_1": { score: 84, grade: "A+", title: "따뜻한 풀밭", subtitle: "서로를 보듬으며 편안함을 나누는 안식처", advice: "가끔은 밖으로 나가 새로운 자극을 받아야 해요." },
      "ESTJ_1": { score: 64, grade: "C+", title: "관리되는 정원", subtitle: "질서 안에서 자라나는 순응의 풀", advice: "乙木은 자신의 의견을 표현하는 연습이 필요합니다." },
      "ESFJ_1": { score: 83, grade: "A", title: "화단의 조화", subtitle: "함께 어우러져 아름다움을 만드는 꽃밭", advice: "'네가 원하는 건 뭐야?'라고 솔직하게 물어보세요." },
      "ISTP_1": { score: 68, grade: "B", title: "실용의 풀", subtitle: "필요한 곳에 조용히 자라나는 유용한 생명", advice: "'고마워' 같은 작은 표현이 관계를 따뜻하게 합니다." },
      "ISFP_1": { score: 86, grade: "A+", title: "자연의 교감", subtitle: "말없이 통하는 섬세한 영혼의 공명", advice: "힘든 이야기도 피하지 말고 나누세요." },
      "ESTP_1": { score: 66, grade: "B-", title: "모험가의 풀", subtitle: "거친 환경에서도 살아남는 유연한 생명력", advice: "서로의 페이스를 존중하면 좋은 팀이 됩니다." },
      "ESFP_1": { score: 75, grade: "B+", title: "축제의 꽃", subtitle: "화려함 속에 조용히 빛나는 들꽃", advice: "乙木에게 혼자만의 시간을 주세요." },
      
      // ===== 丙火 (stemIndex: 2) =====
      "INTJ_2": { score: 75, grade: "B+", title: "불꽃 전략가", subtitle: "냉철한 전략에 열정을 더하는 빛의 지략가", advice: "열정을 꺾지 말고, 계획을 무시하지 마세요." },
      "INTP_2": { score: 68, grade: "B", title: "이론에 불을 지피다", subtitle: "깊은 사색에 열정의 불꽃을 더하는 탐구자", advice: "서로의 강점을 배우면 성장할 수 있어요." },
      "ENTJ_2": { score: 92, grade: "S+", title: "태양왕", subtitle: "천하를 비추는 찬란한 정복자의 태양", advice: "정기적으로 '멈춤'의 시간을 갖고 에너지를 재충전하세요." },
      "ENTP_2": { score: 85, grade: "A+", title: "혁명의 불꽃", subtitle: "기존의 것을 태우고 새것을 만드는 혁신가", advice: "시작한 것 중 하나라도 끝까지 가보세요." },
      "INFJ_2": { score: 78, grade: "A", title: "이상에 불을 밝히다", subtitle: "어두운 세상을 밝히는 희망의 횃불", advice: "INFJ가 지치지 않도록 페이스 조절이 필요합니다." },
      "INFP_2": { score: 70, grade: "B", title: "꿈에 불을 붙이다", subtitle: "내면의 이상을 세상에 비추는 낭만적 불꽃", advice: "서로의 다름을 존중하면 아름다운 창작물을 만들 수 있어요." },
      "ENFJ_2": { score: 90, grade: "S", title: "희망의 태양", subtitle: "사람들에게 희망을 비추는 따뜻한 지도자", advice: "자기 관리가 중요해요. 서로의 에너지를 잘 챙기세요." },
      "ENFP_2": { score: 88, grade: "S", title: "불꽃 축제", subtitle: "어디서든 빛나고 흥을 돋우는 축제의 주인공", advice: "재미와 책임의 균형을 함께 잡아보세요." },
      "ISTJ_2": { score: 65, grade: "B-", title: "규칙 속의 불꽃", subtitle: "안정적 기반 위에 타오르는 열정의 불", advice: "丙火의 열정 + ISTJ의 안정 = 지속 가능한 성공." },
      "ISFJ_2": { score: 72, grade: "B+", title: "가정의 난로", subtitle: "가족을 따뜻하게 지키는 든든한 불빛", advice: "서로의 페이스를 존중하세요." },
      "ESTJ_2": { score: 78, grade: "A", title: "현실의 건축가", subtitle: "논리로 불을 다스리고 현실에 성을 쌓는 사람", advice: "가끔은 효율 말고 '마음'에 대해서도 이야기하세요." },
      "ESFJ_2": { score: 85, grade: "A+", title: "마을의 태양", subtitle: "모두를 따뜻하게 비추는 공동체의 중심", advice: "'남의 시선'에 너무 에너지를 쓰지 마세요." },
      "ISTP_2": { score: 70, grade: "B", title: "불 속의 장인", subtitle: "열정의 불로 철을 다루는 대장장이", advice: "말보다 함께 뭔가를 만들어보세요." },
      "ISFP_2": { score: 76, grade: "A-", title: "예술의 불꽃", subtitle: "감성을 태워 아름다움을 만드는 예술가", advice: "예술로 연결되면 깊이 있는 관계가 됩니다." },
      "ESTP_2": { score: 82, grade: "A", title: "모험의 불꽃", subtitle: "어디든 뛰어드는 불타는 모험가", advice: "큰 결정 전에 24시간 냉각 규칙을 만들어보세요." },
      "ESFP_2": { score: 90, grade: "S", title: "파티의 불꽃", subtitle: "어디서든 축제를 만드는 빛나는 주인공", advice: "가끔은 조용히 쉬는 시간도 가지세요." },
      
      // ===== 丁火 (stemIndex: 3) =====
      "INTJ_3": { score: 82, grade: "A", title: "촛불 전략가", subtitle: "어둠 속에서 길을 밝히는 은밀한 지략가", advice: "가끔은 밖으로 나와야 해요. 세상과 연결하세요." },
      "INTP_3": { score: 80, grade: "A", title: "밤을 밝히는 등대", subtitle: "어둠 속에서 진리를 찾는 고요한 탐구자", advice: "배운 것을 세상에 나눠야 의미가 있어요." },
      "ENTJ_3": { score: 72, grade: "B+", title: "제왕의 촛불", subtitle: "왕좌 옆에서 지혜를 밝히는 현자", advice: "丁火는 조언자 역할을 잘 해주고, ENTJ는 귀 기울이세요." },
      "ENTP_3": { score: 74, grade: "B+", title: "아이디어에 불을 밝히다", subtitle: "번뜩이는 아이디어를 깊이 있게 비추는 등불", advice: "서로의 속도를 존중하고 조율하면 훌륭한 결과물이 나옵니다." },
      "INFJ_3": { score: 90, grade: "S", title: "영혼의 촛불", subtitle: "내면의 깊은 곳을 비추는 영적인 빛", advice: "예민함 때문에 상처도 깊을 수 있어요. 솔직한 소통이 중요해요." },
      "INFP_3": { score: 87, grade: "A+", title: "밤하늘의 별빛", subtitle: "어두운 밤을 수놓는 아름다운 빛들", advice: "서로에게 '행동하자'고 격려해주세요." },
      "ENFJ_3": { score: 82, grade: "A", title: "희망의 촛불", subtitle: "어둠 속에서 길을 비추는 따뜻한 안내자", advice: "서로의 에너지 레벨을 존중하고 조율하세요." },
      "ENFP_3": { score: 78, grade: "A", title: "별빛 축제", subtitle: "밤하늘을 수놓는 반짝이는 축제의 빛", advice: "서로의 페이스를 존중하면 아름다운 균형이 됩니다." },
      "ISTJ_3": { score: 70, grade: "B", title: "서재의 촛불", subtitle: "묵묵히 책을 밝히는 꾸준한 빛", advice: "가끔은 새로운 것도 시도해보세요." },
      "ISFJ_3": { score: 83, grade: "A", title: "가정의 촛불", subtitle: "가족을 따뜻하게 지키는 은은한 빛", advice: "'나는 이게 필요해'라고 말하는 연습을 하세요." },
      "ESTJ_3": { score: 68, grade: "B", title: "조직의 등불", subtitle: "체계 속에서 길을 밝히는 섬세한 안내자", advice: "서로의 장점을 존중하면 좋은 팀이 됩니다." },
      "ESFJ_3": { score: 80, grade: "A", title: "마을의 등불", subtitle: "모두에게 따뜻한 빛을 비추는 공동체의 불빛", advice: "갈등을 피하기만 하면 안 돼요." },
      "ISTP_3": { score: 65, grade: "B-", title: "장인의 램프", subtitle: "세밀한 작업을 비추는 집중의 빛", advice: "감정도 공유하는 연습을 해보세요." },
      "ISFP_3": { score: 85, grade: "A+", title: "아틀리에의 촛불", subtitle: "예술가의 감성을 비추는 은은한 빛", advice: "현실 문제도 함께 해결해야 해요." },
      "ESTP_3": { score: 60, grade: "C+", title: "모험가의 랜턴", subtitle: "거친 여정을 비추는 작은 빛", advice: "서로의 다름을 존중하세요." },
      "ESFP_3": { score: 68, grade: "B", title: "무대의 조명", subtitle: "화려한 무대를 은은하게 비추는 빛", advice: "균형이 중요해요." },
      
      // ===== 戊土 (stemIndex: 4) =====
      "INTJ_4": { score: 78, grade: "A", title: "산 위의 전략가", subtitle: "흔들림 없이 멀리 내다보는 현자", advice: "변화도 필요해요. 가끔은 새로운 방법을 시도해보세요." },
      "INTP_4": { score: 70, grade: "B", title: "산중의 현자", subtitle: "고요한 산속에서 진리를 탐구하는 사색가", advice: "작게라도 실천해보세요. 세상과 연결되어야 해요." },
      "ENTJ_4": { score: 80, grade: "A", title: "제국의 기반", subtitle: "위대한 건설을 위한 흔들림 없는 땅", advice: "서로의 속도를 존중하고 조율하세요." },
      "ENTP_4": { score: 65, grade: "B-", title: "바위와 바람", subtitle: "변치 않는 것과 끊임없이 변하는 것의 만남", advice: "열린 마음으로 서로를 이해하세요." },
      "INFJ_4": { score: 75, grade: "B+", title: "산 위의 현자", subtitle: "깊은 지혜를 품은 고요한 산", advice: "戊土는 감정 표현을 더 하고, INFJ는 행동을 이해해야 해요." },
      "INFP_4": { score: 68, grade: "B", title: "산과 들꽃", subtitle: "든든한 산이 지켜주는 작고 아름다운 꽃", advice: "戊土는 감정 표현을, INFP는 현실 감각을 배우세요." },
      "ENFJ_4": { score: 76, grade: "A-", title: "마을을 품은 산", subtitle: "사람들을 보호하는 든든한 울타리", advice: "서로의 속도를 존중하세요." },
      "ENFP_4": { score: 62, grade: "C+", title: "산과 나비", subtitle: "변치 않는 산 위를 날아다니는 자유로운 나비", advice: "서로의 차이를 장점으로 활용하세요." },
      "ISTJ_4": { score: 88, grade: "S", title: "반석 위의 성", subtitle: "흔들림 없는 기반 위에 세워진 견고한 성", advice: "일 년에 한 번은 새로운 시도를 해보세요." },
      "ISFJ_4": { score: 85, grade: "A+", title: "마을의 수호산", subtitle: "소중한 것들을 지키는 든든한 산", advice: "가끔은 밖으로 나가 새로운 경험도 해보세요." },
      "ESTJ_4": { score: 85, grade: "A+", title: "제국의 기둥", subtitle: "조직을 지탱하는 흔들림 없는 기반", advice: "가끔은 새로운 의견에 귀 기울여보세요." },
      "ESFJ_4": { score: 82, grade: "A", title: "마을 광장의 산", subtitle: "사람들이 모이는 든든한 중심", advice: "戊土는 감정 표현을 더 하도록 노력하세요." },
      "ISTP_4": { score: 72, grade: "B+", title: "산속의 대장장이", subtitle: "단단한 터전에서 묵묵히 일하는 장인", advice: "'고마워'라는 말 한마디가 관계를 따뜻하게 합니다." },
      "ISFP_4": { score: 70, grade: "B", title: "산과 야생화", subtitle: "거대한 산 위에 피어난 아름다운 꽃", advice: "戊土는 감정에 더 반응하고, ISFP는 필요를 표현하세요." },
      "ESTP_4": { score: 68, grade: "B", title: "산과 모험가", subtitle: "든든한 베이스캠프가 되어주는 산", advice: "서로의 역할을 인정하세요." },
      "ESFP_4": { score: 65, grade: "B-", title: "산 아래 축제", subtitle: "든든한 산 아래서 펼쳐지는 즐거운 잔치", advice: "열린 마음으로 다가가세요." },
      
      // ===== 己土 (stemIndex: 5) =====
      "INTJ_5": { score: 68, grade: "B", title: "전략가의 밭", subtitle: "치밀한 계획을 심고 키우는 비옥한 땅", advice: "己土는 자신의 의견도 표현해야 해요." },
      "INTP_5": { score: 70, grade: "B", title: "연구실의 화분", subtitle: "조용한 탐구를 돕는 편안한 공간", advice: "작은 것이라도 함께 '실행'해보세요." },
      "ENTJ_5": { score: 65, grade: "B-", title: "정복자의 농장", subtitle: "강한 리더를 뒷받침하는 든든한 식량 기지", advice: "己土는 자신의 한계를 지키세요." },
      "ENTP_5": { score: 72, grade: "B+", title: "아이디어 농장", subtitle: "새로운 씨앗이 싹트는 비옥한 실험장", advice: "서로의 속도를 조율하는 게 관건입니다." },
      "INFJ_5": { score: 82, grade: "A", title: "현자의 정원", subtitle: "깊은 지혜가 싹트는 고요한 정원", advice: "때로는 자신들의 필요도 주장해야 해요." },
      "INFP_5": { score: 85, grade: "A+", title: "꿈의 정원", subtitle: "이상과 상상이 자라나는 따뜻한 땅", advice: "꿈을 현실로 만드는 작은 실천을 해보세요." },
      "ENFJ_5": { score: 80, grade: "A", title: "공동체의 텃밭", subtitle: "모두를 위해 열매를 맺는 나눔의 땅", advice: "己土는 자신도 돌봐야 해요." },
      "ENFP_5": { score: 78, grade: "A", title: "자유로운 농장", subtitle: "열정의 씨앗이 마음껏 자라는 자유로운 땅", advice: "서로의 페이스를 존중하세요." },
      "ISTJ_5": { score: 80, grade: "A", title: "전통의 농장", subtitle: "대대로 이어지는 풍요로운 땅", advice: "가끔은 새로운 방법도 시도해보세요." },
      "ISFJ_5": { score: 88, grade: "S", title: "가정의 텃밭", subtitle: "가족을 위해 정성껏 가꾸는 따뜻한 땅", advice: "'나를 위한 시간'도 꼭 가지세요." },
      "ESTJ_5": { score: 75, grade: "B+", title: "관리되는 농장", subtitle: "체계적으로 운영되는 효율적인 땅", advice: "己土는 필요할 때 목소리를 내세요." },
      "ESFJ_5": { score: 85, grade: "A+", title: "마을의 공동 텃밭", subtitle: "모두가 함께 가꾸고 나누는 따뜻한 땅", advice: "서로에게 솔직해야 해요." },
      "ISTP_5": { score: 68, grade: "B", title: "장인의 작업장", subtitle: "실용적인 것을 만들어내는 조용한 땅", advice: "가끔은 마음을 표현하세요." },
      "ISFP_5": { score: 83, grade: "A", title: "예술가의 정원", subtitle: "아름다움을 키워내는 섬세한 땅", advice: "서로에게 용기를 주세요." },
      "ESTP_5": { score: 65, grade: "B-", title: "모험가의 베이스캠프", subtitle: "거친 모험 후 돌아올 따뜻한 땅", advice: "서로의 역할을 인정하세요." },
      "ESFP_5": { score: 72, grade: "B+", title: "축제의 농장", subtitle: "수확의 기쁨을 함께 나누는 풍요로운 땅", advice: "己土에게 쉴 시간을 주세요." },
      
      // ===== 庚金 (stemIndex: 6) =====
      "INTJ_6": { score: 88, grade: "S", title: "강철 전략가", subtitle: "냉철한 두뇌와 날카로운 실행력의 결합", advice: "결과만큼 과정도 중요해요." },
      "INTP_6": { score: 72, grade: "B+", title: "분석하는 검", subtitle: "논리로 세상을 해부하는 날카로운 지성", advice: "서로의 장점을 활용하세요." },
      "ENTJ_6": { score: 92, grade: "S+", title: "정복자의 검", subtitle: "세계를 정복하는 무적의 대장군", advice: "서로의 영역을 존중하고 협력하면 무적입니다." },
      "ENTP_6": { score: 78, grade: "A", title: "혁명의 검", subtitle: "낡은 것을 베고 새로운 것을 세우는 혁신가", advice: "충돌 시 한 발 물러서세요." },
      "INFJ_6": { score: 70, grade: "B", title: "정의의 검", subtitle: "이상을 위해 싸우는 고결한 전사", advice: "목표는 같으니 방법을 조율하세요." },
      "INFP_6": { score: 62, grade: "C+", title: "검과 꽃", subtitle: "강함과 부드러움의 극적인 만남", advice: "庚金은 부드러움을, INFP는 강인함을 배우세요." },
      "ENFJ_6": { score: 75, grade: "B+", title: "지도자의 검", subtitle: "사람들을 이끌고 지키는 카리스마 전사", advice: "서로의 스타일을 배우세요." },
      "ENFP_6": { score: 68, grade: "B", title: "자유로운 전사", subtitle: "열정을 지키는 강인한 수호자", advice: "서로의 다름을 인정하면 좋은 팀이 됩니다." },
      "ISTJ_6": { score: 85, grade: "A+", title: "철의 규율", subtitle: "원칙을 지키는 흔들림 없는 강철 의지", advice: "가끔은 유연해져야 할 때도 있어요." },
      "ISFJ_6": { score: 75, grade: "B+", title: "가정의 수호검", subtitle: "소중한 것을 지키는 든든한 전사", advice: "庚金은 말을 조금 부드럽게 하세요." },
      "ESTJ_6": { score: 88, grade: "S", title: "조직의 철권", subtitle: "조직을 이끄는 강력하고 효율적인 리더", advice: "양보하는 법도 배우세요." },
      "ESFJ_6": { score: 72, grade: "B+", title: "마을의 수호검", subtitle: "공동체를 지키는 든든한 전사", advice: "서로의 스타일을 존중하면 좋은 팀입니다." },
      "ISTP_6": { score: 82, grade: "A", title: "무기 제작자", subtitle: "최고의 무기를 만드는 대장장이", advice: "가끔은 마음도 표현하세요." },
      "ISFP_6": { score: 65, grade: "B-", title: "검과 꽃", subtitle: "강함이 아름다움을 지키는 관계", advice: "庚金은 많이 부드러워져야 해요." },
      "ESTP_6": { score: 85, grade: "A+", title: "전장의 영웅", subtitle: "위험을 두려워하지 않는 용감한 전사", advice: "큰 결정 전에 한 박자 쉬세요." },
      "ESFP_6": { score: 72, grade: "B+", title: "축제의 전사", subtitle: "즐거움을 지키는 활기찬 수호자", advice: "서로의 세계를 이해하세요." },
      
      // ===== 辛金 (stemIndex: 7) =====
      "INTJ_7": { score: 85, grade: "A+", title: "다이아몬드 전략가", subtitle: "완벽을 추구하는 빛나는 지략가", advice: "완벽하지 않아도 시작하세요." },
      "INTP_7": { score: 80, grade: "A", title: "분석하는 보석", subtitle: "순수한 논리로 세상을 이해하는 지성", advice: "생각을 세상과 나누세요." },
      "ENTJ_7": { score: 78, grade: "A", title: "왕관의 보석", subtitle: "리더의 품격을 빛내는 고귀한 보석", advice: "辛金은 비판을 너무 예민하게 받지 마세요." },
      "ENTP_7": { score: 72, grade: "B+", title: "빛나는 아이디어", subtitle: "창의성을 연마해 보석으로 만드는 혁신가", advice: "완성도에 너무 집착하지 마세요." },
      "INFJ_7": { score: 82, grade: "A", title: "영혼의 보석", subtitle: "내면의 깊이를 간직한 순수한 빛", advice: "둘 다 예민하니 상처 주지 않게 조심하세요." },
      "INFP_7": { score: 80, grade: "A", title: "꿈의 보석", subtitle: "이상을 품은 순수하고 아름다운 빛", advice: "현실도 함께 마주해야 해요." },
      "ENFJ_7": { score: 75, grade: "B+", title: "빛나는 리더", subtitle: "품격과 따뜻함을 겸비한 지도자", advice: "辛金은 비판에 너무 예민하지 마세요." },
      "ENFP_7": { score: 70, grade: "B", title: "자유로운 보석", subtitle: "틀에 박히지 않는 독특한 아름다움", advice: "서로의 속도를 맞춰보세요." },
      "ISTJ_7": { score: 82, grade: "A", title: "정밀한 시계", subtitle: "완벽한 정확성을 추구하는 장인정신", advice: "가끔은 불완전도 받아들이세요." },
      "ISFJ_7": { score: 78, grade: "A", title: "가보의 보석", subtitle: "대대로 전해지는 소중한 가치", advice: "자신을 너무 몰아붙이지 마세요." },
      "ESTJ_7": { score: 76, grade: "A-", title: "조직의 보석", subtitle: "효율과 품격을 겸비한 관리자", advice: "완벽을 추구하되 사람도 챙기세요." },
      "ESFJ_7": { score: 75, grade: "B+", title: "사교계의 보석", subtitle: "품위 있게 사람들과 어울리는 빛", advice: "남의 시선에 너무 신경 쓰지 마세요." },
      "ISTP_7": { score: 74, grade: "B+", title: "정밀 도구", subtitle: "섬세함으로 만들어내는 완벽한 작품", advice: "감정 표현도 연습하세요." },
      "ISFP_7": { score: 82, grade: "A", title: "예술가의 보석", subtitle: "아름다움을 창조하는 섬세한 손길", advice: "함께 아름다운 것을 만드세요." },
      "ESTP_7": { score: 65, grade: "B-", title: "모험가의 보석", subtitle: "거친 여정에서도 빛을 잃지 않는 가치", advice: "서로의 속도를 존중하세요." },
      "ESFP_7": { score: 70, grade: "B", title: "무대의 보석", subtitle: "스포트라이트 아래 빛나는 아름다움", advice: "辛金은 가끔 즐기는 법도 배우세요." },
      
      // ===== 壬水 (stemIndex: 8) =====
      "INTJ_8": { score: 82, grade: "A", title: "심해의 전략가", subtitle: "깊은 바다처럼 헤아릴 수 없는 지략가", advice: "깊이와 비전의 조합, 세상과 연결하세요." },
      "INTP_8": { score: 85, grade: "A+", title: "지식의 바다", subtitle: "모든 것을 흡수하는 무한한 지성", advice: "깊이 있는 탐구, 하지만 행동도 필요해요." },
      "ENTJ_8": { score: 78, grade: "A", title: "대양의 정복자", subtitle: "거대한 파도처럼 밀어붙이는 리더", advice: "壬水의 유연함과 ENTJ의 추진력을 조화시키세요." },
      "ENTP_8": { score: 88, grade: "S", title: "가능성의 바다", subtitle: "무한한 아이디어가 넘실대는 창조의 바다", advice: "깊이와 넓이의 환상적 조합!" },
      "INFJ_8": { score: 85, grade: "A+", title: "영혼의 바다", subtitle: "깊은 공감으로 모든 것을 품는 대양", advice: "둘 다 깊이 있어서 현실도 함께 걸어야 해요." },
      "INFP_8": { score: 83, grade: "A", title: "꿈의 바다", subtitle: "상상력이 끝없이 펼쳐지는 무한의 공간", advice: "꿈을 현실로 만드는 실천도 필요해요." },
      "ENFJ_8": { score: 80, grade: "A", title: "희망의 바다", subtitle: "모든 사람을 품고 이끄는 따뜻한 대양", advice: "壬水의 자유와 ENFJ의 헌신 사이 균형을 찾으세요." },
      "ENFP_8": { score: 85, grade: "A+", title: "모험의 바다", subtitle: "새로운 대륙을 찾아 항해하는 탐험가", advice: "함께하면 세상 어디든 갈 수 있어요!" },
      "ISTJ_8": { score: 68, grade: "B", title: "댐과 바다", subtitle: "자유로운 물을 관리하는 체계적 시스템", advice: "서로의 방식을 존중하면 균형이 됩니다." },
      "ISFJ_8": { score: 72, grade: "B+", title: "호수와 집", subtitle: "가정을 위해 잠시 머무르는 깊은 물", advice: "壬水는 가끔 닻을 내리고 머무르세요." },
      "ESTJ_8": { score: 65, grade: "B-", title: "운하와 바다", subtitle: "방향을 정해 흐르게 하는 관리자", advice: "壬水의 자유와 ESTJ의 통제 사이 조율이 필요해요." },
      "ESFJ_8": { score: 72, grade: "B+", title: "마을의 강", subtitle: "사람들에게 생명을 주는 흐르는 물", advice: "서로의 에너지 방향을 이해하세요." },
      "ISTP_8": { score: 78, grade: "A", title: "심해 탐험가", subtitle: "깊은 바다의 비밀을 탐구하는 잠수부", advice: "함께 탐구하면 좋은 팀입니다." },
      "ISFP_8": { score: 80, grade: "A", title: "예술의 바다", subtitle: "감성이 넘실대는 아름다운 대양", advice: "함께 아름다운 것을 발견하세요." },
      "ESTP_8": { score: 82, grade: "A", title: "파도타기", subtitle: "거친 파도를 즐기는 모험가", advice: "역동적인 조합, 충동 조절만 주의하세요." },
      "ESFP_8": { score: 80, grade: "A", title: "해변의 파티", subtitle: "즐거움이 파도처럼 밀려오는 축제", advice: "함께하면 인생이 축제가 됩니다!" },
      
      // ===== 癸水 (stemIndex: 9) =====
      "INTJ_9": { score: 80, grade: "A", title: "이슬의 전략가", subtitle: "조용히 스며들어 목표를 달성하는 은밀한 지략가", advice: "직관과 전략의 조합, 세상과 연결하세요." },
      "INTP_9": { score: 82, grade: "A", title: "샘물의 지혜", subtitle: "깊은 곳에서 솟아나는 순수한 통찰", advice: "깊은 사색, 하지만 나누는 것도 필요해요." },
      "ENTJ_9": { score: 68, grade: "B", title: "제왕의 비", subtitle: "강한 리더에게 지혜를 내리는 촉촉한 비", advice: "癸水는 자신의 가치를 인정받아야 해요." },
      "ENTP_9": { score: 75, grade: "B+", title: "아이디어의 이슬", subtitle: "창의성을 적시는 신선한 영감", advice: "ENTP의 속도를 癸水가 따라가기 어려울 수 있어요." },
      "INFJ_9": { score: 90, grade: "S", title: "영혼의 샘", subtitle: "깊은 내면에서 솟아나는 영적인 물", advice: "가장 깊이 연결되는 조합 중 하나입니다." },
      "INFP_9": { score: 88, grade: "S", title: "꿈의 이슬", subtitle: "상상의 세계를 적시는 신비로운 물방울", advice: "아름답고 깊은 조합, 현실도 함께 걸어요." },
      "ENFJ_9": { score: 78, grade: "A", title: "자비의 비", subtitle: "모두에게 은혜를 내리는 따뜻한 비", advice: "癸水의 에너지를 잘 관리하세요." },
      "ENFP_9": { score: 76, grade: "A-", title: "무지개 비", subtitle: "열정에 아름다운 색을 더하는 신비로운 비", advice: "서로의 페이스를 존중하세요." },
      "ISTJ_9": { score: 68, grade: "B", title: "정원의 물뿌리개", subtitle: "규칙적으로 생명을 주는 꾸준한 물", advice: "다른 세계지만 서로 배울 점이 있어요." },
      "ISFJ_9": { score: 82, grade: "A", title: "가정의 샘물", subtitle: "가족을 위해 조용히 흐르는 맑은 물", advice: "따뜻하고 헌신적인 조합입니다." },
      "ESTJ_9": { score: 62, grade: "C+", title: "관개 시스템", subtitle: "효율적으로 물을 관리하는 체계", advice: "매우 다른 조합, 서로 존중이 필요해요." },
      "ESFJ_9": { score: 76, grade: "A-", title: "마을의 샘", subtitle: "모두에게 생명을 주는 공동체의 물", advice: "癸水는 자기 필요도 표현하세요." },
      "ISTP_9": { score: 70, grade: "B", title: "이슬과 도구", subtitle: "섬세함으로 완성도를 높이는 조합", advice: "둘 다 감정 표현이 어려워요. 연습하세요." },
      "ISFP_9": { score: 85, grade: "A+", title: "안개 속의 꽃", subtitle: "신비로운 아름다움을 함께 만드는 조합", advice: "말없이 통하는 아름다운 조합입니다." },
      "ESTP_9": { score: 62, grade: "C+", title: "이슬과 모험가", subtitle: "섬세함과 거침없음의 극적인 만남", advice: "매우 다른 속도와 스타일, 인내가 필요해요." },
      "ESFP_9": { score: 70, grade: "B", title: "축제의 이슬", subtitle: "화려함에 신비로움을 더하는 조합", advice: "癸水에게 혼자만의 시간을 주세요." }
    };

    // 등급 색상 매핑
    const GRADE_COLORS = {
      "S+": "#FFD700", "S": "#FFA500", "A+": "#9ACD32", "A": "#32CD32", 
      "A-": "#3CB371", "B+": "#4682B4", "B": "#6495ED", "B-": "#7B68EE", 
      "C+": "#9370DB", "C": "#BA55D3"
    };

    // ===== v2.94: 상세 리포트용 데이터 =====
    
    // MBTI 4축 → 오행 매핑
    const MBTI_AXIS_OHANG = {
      'E': { ohang: '火', name: '화', color: '#ef4444', icon: '🔥', desc: '외향은 밖으로 발산하는 火 에너지' },
      'I': { ohang: '水', name: '수', color: '#3b82f6', icon: '💧', desc: '내향은 안으로 수렴하는 水 에너지' },
      'S': { ohang: '土', name: '토', color: '#eab308', icon: '⛰️', desc: '감각은 현실에 뿌리내린 土 에너지' },
      'N': { ohang: '木', name: '목', color: '#22c55e', icon: '🌳', desc: '직관은 가능성을 향해 뻗는 木 에너지' },
      'T': { ohang: '金', name: '금', color: '#a855f7', icon: '⚔️', desc: '사고는 날카롭게 분석하는 金 에너지' },
      'F': { ohang: '木', name: '목', color: '#22c55e', icon: '🌿', desc: '감정은 공감하며 연결하는 木 에너지' },
      'J': { ohang: '土', name: '토', color: '#eab308', icon: '🏔️', desc: '판단은 체계를 세우는 土 에너지' },
      'P': { ohang: '水', name: '수', color: '#3b82f6', icon: '🌊', desc: '인식은 유연하게 흐르는 水 에너지' }
    };
    
    // 일간 → 오행 매핑 (stemIndex 기준)
    const STEM_OHANG = {
      0: '木', 1: '木', 2: '火', 3: '火', 4: '土', 5: '土', 6: '金', 7: '金', 8: '水', 9: '水'
    };
    
    // 오행 상생/상극 관계
    const OHANG_RELATIONS = {
      '木': { generates: '火', isGeneratedBy: '水', controls: '土', isControlledBy: '金', same: '木' },
      '火': { generates: '土', isGeneratedBy: '木', controls: '金', isControlledBy: '水', same: '火' },
      '土': { generates: '金', isGeneratedBy: '火', controls: '水', isControlledBy: '木', same: '土' },
      '金': { generates: '水', isGeneratedBy: '土', controls: '木', isControlledBy: '火', same: '金' },
      '水': { generates: '木', isGeneratedBy: '金', controls: '火', isControlledBy: '土', same: '水' }
    };
    
    // 오행 관계 판정 함수
    function getOhangRelation(fromOhang, toOhang) {
      if (fromOhang === toOhang) return { type: '동기', desc: '같은 오행 - 에너지 강화', color: '#f59e0b', symbol: '═══' };
      const rel = OHANG_RELATIONS[fromOhang];
      if (rel.generates === toOhang) return { type: '상생', desc: '내가 생하는 관계', color: '#22c55e', symbol: '──▶' };
      if (rel.isGeneratedBy === toOhang) return { type: '상생', desc: '나를 생해주는 관계', color: '#22c55e', symbol: '◀──' };
      if (rel.controls === toOhang) return { type: '상극', desc: '내가 극하는 관계', color: '#ef4444', symbol: '──×' };
      if (rel.isControlledBy === toOhang) return { type: '상극', desc: '나를 극하는 관계', color: '#ef4444', symbol: '×──' };
      return { type: '무관', desc: '관계 없음', color: '#888', symbol: '───' };
    }
    
    // 16 MBTI 인지기능 스택
    const COGNITIVE_STACKS = {
      'INTJ': { main: 'Ni', aux: 'Te', tert: 'Fi', inf: 'Se', name: '전략가', desc: '내향 직관 + 외향 사고' },
      'INTP': { main: 'Ti', aux: 'Ne', tert: 'Si', inf: 'Fe', name: '논리술사', desc: '내향 사고 + 외향 직관' },
      'ENTJ': { main: 'Te', aux: 'Ni', tert: 'Se', inf: 'Fi', name: '통솔자', desc: '외향 사고 + 내향 직관' },
      'ENTP': { main: 'Ne', aux: 'Ti', tert: 'Fe', inf: 'Si', name: '변론가', desc: '외향 직관 + 내향 사고' },
      'INFJ': { main: 'Ni', aux: 'Fe', tert: 'Ti', inf: 'Se', name: '옹호자', desc: '내향 직관 + 외향 감정' },
      'INFP': { main: 'Fi', aux: 'Ne', tert: 'Si', inf: 'Te', name: '중재자', desc: '내향 감정 + 외향 직관' },
      'ENFJ': { main: 'Fe', aux: 'Ni', tert: 'Se', inf: 'Ti', name: '선도자', desc: '외향 감정 + 내향 직관' },
      'ENFP': { main: 'Ne', aux: 'Fi', tert: 'Te', inf: 'Si', name: '활동가', desc: '외향 직관 + 내향 감정' },
      'ISTJ': { main: 'Si', aux: 'Te', tert: 'Fi', inf: 'Ne', name: '현실주의자', desc: '내향 감각 + 외향 사고' },
      'ISFJ': { main: 'Si', aux: 'Fe', tert: 'Ti', inf: 'Ne', name: '수호자', desc: '내향 감각 + 외향 감정' },
      'ESTJ': { main: 'Te', aux: 'Si', tert: 'Ne', inf: 'Fi', name: '경영자', desc: '외향 사고 + 내향 감각' },
      'ESFJ': { main: 'Fe', aux: 'Si', tert: 'Ne', inf: 'Ti', name: '집정관', desc: '외향 감정 + 내향 감각' },
      'ISTP': { main: 'Ti', aux: 'Se', tert: 'Ni', inf: 'Fe', name: '장인', desc: '내향 사고 + 외향 감각' },
      'ISFP': { main: 'Fi', aux: 'Se', tert: 'Ni', inf: 'Te', name: '모험가', desc: '내향 감정 + 외향 감각' },
      'ESTP': { main: 'Se', aux: 'Ti', tert: 'Fe', inf: 'Ni', name: '사업가', desc: '외향 감각 + 내향 사고' },
      'ESFP': { main: 'Se', aux: 'Fi', tert: 'Te', inf: 'Ni', name: '연예인', desc: '외향 감각 + 내향 감정' }
    };
    
    // 인지기능 → 오행 매핑
    const FUNC_OHANG = {
      'Te': { ohang: '金', name: '외향 사고', desc: '체계적으로 조직하고 효율을 추구하는 기능' },
      'Ti': { ohang: '金', name: '내향 사고', desc: '논리적으로 분석하고 원리를 파악하는 기능' },
      'Fe': { ohang: '木', name: '외향 감정', desc: '조화를 이루고 공감하는 기능' },
      'Fi': { ohang: '木', name: '내향 감정', desc: '내면의 가치와 진정성을 추구하는 기능' },
      'Se': { ohang: '土', name: '외향 감각', desc: '현재 순간과 실제 경험을 중시하는 기능' },
      'Si': { ohang: '土', name: '내향 감각', desc: '과거 경험과 전통을 참고하는 기능' },
      'Ne': { ohang: '火', name: '외향 직관', desc: '가능성을 탐색하고 아이디어를 발산하는 기능' },
      'Ni': { ohang: '水', name: '내향 직관', desc: '통찰력으로 미래를 예측하는 기능' }
    };

    // ===== MBTI 4축 × 십신 매핑 (3-way 엔진 핵심) =====
    const MBTI_SIPSEONG_MAP = {
      // 에너지 방향: E(외향) / I(내향)
      'E': { 
        sipseong: ['식상', '비겁'], 
        elements: ['화', '목'],
        trait: '외향적 에너지 발산',
        keyword: '표현/활동',
        description: 'MBTI의 **E(외향)** 유형은 사주의 **식상(표현력)**과 **비겁(사회성)** 에너지와 유사합니다. 외부에 자신을 드러내고 관계 속에서 에너지를 재충전하는 성향이 여기서 드러납니다.'
      },
      'I': { 
        sipseong: ['인성', '관성'], 
        elements: ['수', '금'],
        trait: '내향적 에너지 수렴',
        keyword: '성찰/집중',
        description: 'MBTI의 **I(내향)** 유형은 사주의 **인성(사색)**과 **관성(통제)** 에너지와 유사합니다. 혼자만의 공간에서 깊이 있는 생각과 내면 성찰을 통해 안정감을 얻는 성향이 여기서 드러납니다.'
      },
      // 인식 기능: S(감각) / N(직관)
      'S': { 
        sipseong: ['재성', '정관'], 
        elements: ['토', '금'],
        trait: '현실 감각 중시',
        keyword: '실용/구체',
        description: 'MBTI의 **S(감각)** 유형은 사주의 **재성(재물/결과)** 에너지와 유사합니다. 이상보다는 눈앞의 가시적이고 실용적인 성과를 중시하는 당신의 성향이 여기서 드러납니다.'
      },
      'N': { 
        sipseong: ['인성', '식신'], 
        elements: ['목', '화'],
        trait: '직관적 통찰 중시',
        keyword: '가능성/영감',
        description: 'MBTI의 **N(직관)** 유형은 사주의 **인성(지혜)** 에너지와 유사합니다. 당장의 현실보다는 미래의 잠재적 의미와 아이디어를 탐구하는 성향이 여기서 드러납니다.'
      },
      // 판단 기능: T(사고) / F(감정)
      'T': { 
        sipseong: ['정관', '편관'], 
        elements: ['금', '수'],
        trait: '객관적 논리 중시',
        keyword: '분석/원칙',
        description: 'MBTI의 **T(사고)** 유형은 사주의 **정관(규범)** 에너지와 유사합니다. 개인의 감정보다 조직의 논리나 객관적인 사실을 먼저 파악해야 결정을 내릴 수 있는 합리적인 성향이 여기서 드러납니다.'
      },
      'F': { 
        sipseong: ['식상', '인성'], 
        elements: ['목', '수'],
        trait: '주관적 가치 중시',
        keyword: '공감/조화',
        description: 'MBTI의 **F(감정)** 유형은 사주의 **식상(공감 능력)** 에너지와 유사합니다. 결정이란 사람들과의 조화와 윤리적 가치를 최우선으로 고려하는 따뜻한 성향이 여기서 드러납니다.'
      },
      // 생활 양식: J(판단) / P(인식)
      'J': { 
        sipseong: ['관성', '인성'], 
        elements: ['금', '토'],
        trait: '계획적 통제 선호',
        keyword: '체계/질서',
        description: 'MBTI의 **J(판단)** 유형은 사주의 **관성(통제)** 에너지와 유사합니다. 미리 계획하고 예측하는 구조적인 삶에서 편안함을 느끼며, 질서가 무너지는 상황을 가장 경계하는 성향이 여기서 드러납니다.'
      },
      'P': { 
        sipseong: ['식상', '재성'], 
        elements: ['수', '목'],
        trait: '유연한 적응 선호',
        keyword: '자유/즉흥',
        description: 'MBTI의 **P(인식)** 유형은 사주의 **식상(자유로운 표현)** 에너지와 유사합니다. 융통성 있는 변화를 선호하며, 정해진 틀보다는 열린 가능성 속에서 더 큰 잠재력을 발휘하는 성향이 여기서 드러납니다.'
      }
    };

    // ===== 충돌/시너지 분석 패턴 =====
    const CONFLICT_PATTERNS = [
      {
        id: 'E_vs_관성',
        mbti: 'E',
        sajuCondition: (r) => (r.sipseong['정관'] || 0) + (r.sipseong['편관'] || 0) >= 3,
        type: '충돌',
        title: '행동 vs 제어',
        description: '**외부로 발산하려는 에너지(E)**가 내면의 **강한 규율(관성)**에 의해 억제되어 활동성 저하나 극심한 스트레스로 나타납니다.',
        advice: '"하고 싶지만 해야만 하는 일에 묶여있는 상태" - 작은 것부터 자유롭게 표현하는 연습이 필요합니다.'
      },
      {
        id: 'F_vs_금',
        mbti: 'F',
        sajuCondition: (r) => r.elementAnalysis.elements['금'] >= 3,
        type: '충돌',
        title: '감정 vs 논리',
        description: '**사람 중심의 가치(F)**와 **냉철한 현실 논리(금)**  사이에서 결정 장애를 겪습니다. 타인의 감정을 헤아리면서도 결국 논리적 판단을 내려야 하는 상황에서 괴리감을 느낍니다.',
        advice: '감정과 논리 모두 당신의 일부입니다. "무엇이 옳은가"와 "무엇이 좋은가"의 균형점을 찾으세요.'
      },
      {
        id: 'J_vs_식상',
        mbti: 'J',
        sajuCondition: (r) => (r.sipseong['식신'] || 0) + (r.sipseong['상관'] || 0) >= 3,
        type: '충돌',
        title: '계획 vs 자유',
        description: '**계획을 세워야 안정되는 기질(J)**이 **끊임없이 새로운 것을 추구**하고 싶어 하는 에너지(식상)**와 충돌하여 계획을 세우고도 지키지 못하는 모순이 발생합니다.',
        advice: '계획에 "유연성 여백"을 두세요. 80% 계획 + 20% 즉흥이 당신에게 맞는 비율일 수 있습니다.'
      },
      {
        id: 'N_vs_재성',
        mbti: 'N',
        sajuCondition: (r) => (r.sipseong['정재'] || 0) + (r.sipseong['편재'] || 0) >= 3,
        type: '충돌',
        title: '이상 vs 현실',
        description: '**이상적 비전(N)**은 뛰어나지만, 그것을 **현실화할 수 있는 구체적인 실행력(재성)**이 부족하여 공상가에 머무를 위험이 있습니다.',
        advice: '큰 그림을 작은 단계로 쪼개세요. 비전을 현실로 만드는 "실행 파트너"를 찾는 것도 좋습니다.'
      }
    ];

    const SYNERGY_PATTERNS = [
      {
        id: 'TJ_관인상생',
        mbti: ['T', 'J'],
        sajuCondition: (r) => ((r.sipseong['정관'] || 0) + (r.sipseong['편관'] || 0) >= 2) && ((r.sipseong['정인'] || 0) + (r.sipseong['편인'] || 0) >= 1),
        type: '시너지',
        title: '목표 달성형',
        description: '**이성적 분석(T)**과 **체계적인 실행력(J)**이 **인성(지식/수용)**과 **관성(규율/목표)** 구조를 통해 확고하게 뒷받침하여 **뛰어난 성과**를 도출합니다.',
        advice: '당신의 강점을 최대한 활용하세요. 장기 프로젝트, 전략 수립, 시스템 구축에서 빛납니다.'
      },
      {
        id: 'NP_식상',
        mbti: ['N', 'P'],
        sajuCondition: (r) => (r.sipseong['식신'] || 0) + (r.sipseong['상관'] || 0) >= 2,
        type: '시너지',
        title: '창조적 표현형',
        description: '**새로운 가능성(N)**을 자유롭고 **유연하게(P)** 표현하는 능력이 **창의적인 식상의 기운**을 만나 예술, 기획 등에서 **독창성을 극대화**합니다.',
        advice: '아이디어를 세상에 내놓으세요. 창작, 기획, 콘텐츠 분야에서 당신만의 색깔이 빛납니다.'
      },
      {
        id: 'ES_비겁재성',
        mbti: ['E', 'S'],
        sajuCondition: (r) => ((r.sipseong['비견'] || 0) + (r.sipseong['겁재'] || 0) >= 1) && ((r.sipseong['정재'] || 0) + (r.sipseong['편재'] || 0) >= 2),
        type: '시너지',
        title: '사업적 실행형',
        description: '**외향적 행동력(E)**과 **현실적인 판단(S)**이 **비겁(추진력)**→**재성(결과)** 으로 이어지는 사주 구조와 결합하여 **사업적 실행력**을 폭발시킵니다.',
        advice: '행동이 곧 성과로 이어지는 타입입니다. 영업, 창업, 프로젝트 리딩에서 강점을 발휘하세요.'
      },
      {
        id: 'EF_인성비겁',
        mbti: ['E', 'F'],
        sajuCondition: (r) => ((r.sipseong['정인'] || 0) + (r.sipseong['편인'] || 0) >= 1) && ((r.sipseong['비견'] || 0) + (r.sipseong['겁재'] || 0) >= 1),
        type: '시너지',
        title: '공감 리더형',
        description: '**외부와의 관계(E)**를 중요시하고 **타인에게 공감(F)**하는 능력이 **인성(배려심)**의 힘을 받아 사람들을 끌어 모으는 **따뜻한 리더십**을 발휘합니다.',
        advice: '사람을 이끄는 자리가 어울립니다. 팀 리딩, 코칭, 상담 분야에서 진가를 발휘하세요.'
      }
    ];

    const MESSAGES = [
      "오늘 첫 느낌을 믿으세요.", "서두르지 마세요. 타이밍이 완벽합니다.",
      "작은 것이 기분을 바꿀 거예요.", "지금 느끼는 것보다 당신은 강합니다.",
      "말하기 전에 들으세요.", "오늘은 부드러운 솔직함이 필요해요.",
      "작은 위험이 큰 해방을 가져옵니다.", "감정이 숨쉴 수 있게 해주세요.",
      "떠나려는 것과 싸우지 마세요.", "새로운 무언가가 조용히 다가오고 있어요.",
      "여유로운 아침을 가질 자격이 있어요.", "죄책감 없이 거절하세요.",
      "잊혀진 꿈이 오늘 깨어납니다.", "소음으로부터 에너지를 보호하세요.",
      "누군가 당신을 생각하고 있어요.", "개인적으로 받아들이지 마세요.",
      "다시 시도하세요. 오늘은 두 번째 기회가 있어요.", "모든 것을 고칠 필요 없어요.",
      "휴식도 진정한 결정입니다.", "불분명한 것에도 의미가 있어요."
    ];

    const ENERGY_TIPS = [
      "밝은 명확함 • 날카로운 집중", "고요한 평온 • 내면의 평화",
      "열린 마음 • 따뜻한 연결", "신선한 추진력 • 새 시작",
      "대담한 힘 • 결단력", "부드러운 휴식 • 회복 모드",
      "창의적 불꽃 • 영감 충만", "보호된 에너지 • 안전한 경계",
      "꾸준한 결의 • 집중된 의도", "변화의 전환 • 새 문이 열림"
    ];

    const CAUTIONS = [
      "감정이 논리를 앞서지 않게 하세요.", "결정을 서두르지 마세요.",
      "말을 조심하세요.", "가까운 사람과 오해 가능성이 있어요.",
      "집중력을 분산시키지 마세요.", "마음의 휴식을 취하세요.",
      "과소비를 피하세요.", "들은 모든 것을 믿지 마세요.",
      "피로에 주의하세요.", "압박 속에서도 중심을 잡으세요."
    ];

    // ===== v2.92: 오행별 건강 리스크 데이터 (보험사 PoC 대응) =====
    const HEALTH_BY_ELEMENT = {
      wood: {
        name: '목(木)',
        organs: { main: '간(肝)', sub: '담(膽)' },
        bodyParts: ['눈', '근육', '손톱', '힘줄', '신경계'],
        emotions: { positive: '인내, 계획성', negative: '분노, 짜증, 우울' },
        diseases: {
          deficiency: ['시력저하', '근육경련', '만성피로', '빈혈', '면역력저하', '손톱갈라짐'],
          excess: ['두통', '고혈압', '근육긴장', '눈충혈', '간염', '지방간', '담석']
        },
        seasonalRisk: { season: '봄', months: [3, 4, 5], risk: '간 기능 과부하, 알레르기' },
        stressType: '분노억압형 - 감정을 속으로 삼키며 간에 부담',
        prevention: ['녹색 채소 섭취', '눈 휴식 (20-20-20 규칙)', '스트레칭', '분노 표출 연습'],
        foods: { good: ['시금치', '브로콜리', '녹차', '신맛 과일'], bad: ['술', '기름진 음식', '인스턴트'] },
        exercises: ['요가', '스트레칭', '숲속 산책', '눈 운동'],
        checkups: ['간기능검사', '안과검진', '근전도검사']
      },
      fire: {
        name: '화(火)',
        organs: { main: '심장(心)', sub: '소장(小腸)' },
        bodyParts: ['혀', '혈관', '얼굴', '가슴', '손'],
        emotions: { positive: '기쁨, 열정', negative: '조급함, 불안, 흥분' },
        diseases: {
          deficiency: ['저혈압', '무기력', '우울증', '소화불량', '수족냉증', '집중력저하'],
          excess: ['고혈압', '부정맥', '불면증', '화병', '안면홍조', '심장두근거림', '조울증']
        },
        seasonalRisk: { season: '여름', months: [6, 7, 8], risk: '심장 부담, 열사병, 불면' },
        stressType: '과흥분형 - 감정 기복이 심하고 심장에 무리',
        prevention: ['규칙적 수면', '명상/심호흡', '카페인 절제', '적정 체온 유지'],
        foods: { good: ['토마토', '수박', '녹두', '쓴맛 채소'], bad: ['카페인', '매운 음식', '술'] },
        exercises: ['수영', '아쿠아로빅', '저녁 산책', '태극권'],
        checkups: ['심전도', '혈압측정', '스트레스검사', '수면다원검사']
      },
      earth: {
        name: '토(土)',
        organs: { main: '비장(脾)', sub: '위(胃)' },
        bodyParts: ['입', '살(근육)', '입술', '소화기관'],
        emotions: { positive: '안정, 사려깊음', negative: '걱정, 우유부단, 과잉사고' },
        diseases: {
          deficiency: ['소화불량', '식욕부진', '영양실조', '무력감', '설사', '빈혈'],
          excess: ['비만', '당뇨', '위염', '위궤양', '역류성식도염', '과식증', '부종']
        },
        seasonalRisk: { season: '환절기', months: [3, 6, 9, 12], risk: '소화기 약화, 면역저하' },
        stressType: '과잉걱정형 - 생각이 많아 소화기에 영향',
        prevention: ['규칙적 식사', '천천히 씹기', '과식 금지', '걱정 내려놓기 연습'],
        foods: { good: ['현미', '고구마', '단호박', '꿀', '대추'], bad: ['찬 음식', '밀가루', '설탕과다'] },
        exercises: ['걷기', '가벼운 조깅', '필라테스', '코어운동'],
        checkups: ['위내시경', '혈당검사', '체성분분석', '영양상태검사']
      },
      metal: {
        name: '금(金)',
        organs: { main: '폐(肺)', sub: '대장(大腸)' },
        bodyParts: ['코', '피부', '털/모발', '호흡기'],
        emotions: { positive: '의지, 결단력', negative: '슬픔, 우울, 집착' },
        diseases: {
          deficiency: ['호흡기약화', '피부건조', '변비', '감기잦음', '알레르기', '천식'],
          excess: ['피부염', '비염', '폐렴', '대장염', '치질', '피부트러블', '과민성대장']
        },
        seasonalRisk: { season: '가을', months: [9, 10, 11], risk: '호흡기 질환, 피부건조' },
        stressType: '억압슬픔형 - 감정을 억누르며 폐와 피부에 영향',
        prevention: ['깊은 호흡 연습', '피부 보습', '충분한 수분', '감정 표현 연습'],
        foods: { good: ['배', '도라지', '무', '마늘', '흰색 채소'], bad: ['맵고 자극적 음식', '건조식품'] },
        exercises: ['호흡운동', '등산', '사이클링', '노래부르기'],
        checkups: ['폐기능검사', '피부과검진', '대장내시경', '알레르기검사']
      },
      water: {
        name: '수(水)',
        organs: { main: '신장(腎)', sub: '방광(膀胱)' },
        bodyParts: ['귀', '뼈', '치아', '머리카락', '생식기', '허리'],
        emotions: { positive: '지혜, 의지력', negative: '두려움, 공포, 불안' },
        diseases: {
          deficiency: ['신장기능저하', '요통', '골다공증', '청력저하', '탈모', '불임', '조루'],
          excess: ['부종', '방광염', '신장결석', '전립선비대', '생리불순', '자궁질환', '냉증']
        },
        seasonalRisk: { season: '겨울', months: [12, 1, 2], risk: '신장 부담, 관절통, 냉증' },
        stressType: '공포회피형 - 두려움이 신장과 뼈에 영향',
        prevention: ['허리 보온', '짠 음식 절제', '충분한 수면', '두려움 직면 연습'],
        foods: { good: ['검은콩', '미역', '다시마', '호두', '흑임자'], bad: ['짠 음식', '찬 음료', '과도한 수분'] },
        exercises: ['수영', '아쿠아요가', '허리강화운동', '케겔운동'],
        checkups: ['신장기능검사', '골밀도검사', '청력검사', '비뇨기과검진']
      }
    };

    // 십성별 건강 리스크 패턴
    const HEALTH_BY_SIPSEONG = {
      '비견': { risk: '과로, 경쟁스트레스', weak: '근골격계', tip: '휴식 시간 확보 필수' },
      '겁재': { risk: '충동적 행동, 사고', weak: '외상, 골절', tip: '안전 주의, 보험 필수' },
      '식신': { risk: '과식, 소화기 문제', weak: '위장', tip: '식이조절 중요' },
      '상관': { risk: '신경과민, 정신건강', weak: '신경계', tip: '스트레스 관리 필수' },
      '정재': { risk: '과도한 절약으로 건강 소홀', weak: '만성질환', tip: '정기검진 투자' },
      '편재': { risk: '불규칙한 생활', weak: '간, 순환기', tip: '생활 리듬 조절' },
      '정관': { risk: '스트레스성 질환', weak: '위, 심장', tip: '압박감 해소 필요' },
      '편관': { risk: '급성질환, 사고', weak: '혈압, 심장', tip: '격한 운동 주의' },
      '정인': { risk: '운동부족, 비만', weak: '순환기', tip: '규칙적 운동 필수' },
      '편인': { risk: '불면, 신경쇠약', weak: '정신건강', tip: '수면 관리 중요' }
    };

    // 월별 건강 리스크 가중치
    const MONTHLY_HEALTH_RISK = {
      1: { element: 'water', risk: '추위로 인한 혈관수축, 관절통 주의', focus: '보온, 관절관리' },
      2: { element: 'water', risk: '면역력 최저, 감기/독감 주의', focus: '면역력 강화' },
      3: { element: 'wood', risk: '알레르기 시작, 간 해독 시기', focus: '알레르기 관리' },
      4: { element: 'wood', risk: '춘곤증, 피로누적', focus: '수면/피로관리' },
      5: { element: 'wood', risk: '황사/미세먼지, 호흡기 주의', focus: '호흡기 보호' },
      6: { element: 'fire', risk: '장마, 곰팡이, 피부질환 주의', focus: '습도관리, 피부' },
      7: { element: 'fire', risk: '폭염, 심장/혈압 부담', focus: '열사병 예방' },
      8: { element: 'fire', risk: '열대야 불면, 체력저하', focus: '수면, 체력관리' },
      9: { element: 'metal', risk: '일교차, 호흡기/피부 건조', focus: '보습, 호흡기' },
      10: { element: 'metal', risk: '환절기 감기, 알레르기', focus: '면역관리' },
      11: { element: 'metal', risk: '건조, 피부트러블 증가', focus: '보습, 수분섭취' },
      12: { element: 'water', risk: '추위시작, 관절/허리 주의', focus: '보온, 관절관리' }
    };

    const TOPICS = [
      { id: 'wealth', icon: '💰', name: '재물운' },
      { id: 'love', icon: '❤️', name: '연애운' },
      { id: 'career', icon: '💼', name: '직장운' },
      { id: 'health', icon: '💪', name: '건강운' },
      { id: 'direction', icon: '🧭', name: '길방위' },
      { id: 'timing', icon: '📅', name: '길일' }
    ];

    let result = null;
    let selectedGender = null;
    let calendarType = 'solar'; // v2.91: 음력/양력
    let compatCalendarType = 'solar'; // v2.91: 궁합 탭용
    let modalCalendarType = 'solar'; // v2.91: 궁합 모달용

    // ===== INIT =====
    function init() {
      const monthSelect = document.getElementById('month');
      for (let i = 1; i <= 12; i++) {
        monthSelect.innerHTML += `<option value="${i}">${i}월</option>`;
      }
      monthSelect.value = 6;

      const daySelect = document.getElementById('day');
      for (let i = 1; i <= 31; i++) {
        daySelect.innerHTML += `<option value="${i}">${i}일</option>`;
      }
      daySelect.value = 15;

      // v2.92: 시진 형태로 시간 선택 (30분 기준)
      const hourSelect = document.getElementById('hour');
      const hourLabels = [
        { label: '자시 (23:30~01:29)', value: 0 },
        { label: '축시 (01:30~03:29)', value: 2 },
        { label: '인시 (03:30~05:29)', value: 4 },
        { label: '묘시 (05:30~07:29)', value: 6 },
        { label: '진시 (07:30~09:29)', value: 8 },
        { label: '사시 (09:30~11:29)', value: 10 },
        { label: '오시 (11:30~13:29)', value: 12 },
        { label: '미시 (13:30~15:29)', value: 14 },
        { label: '신시 (15:30~17:29)', value: 16 },
        { label: '유시 (17:30~19:29)', value: 18 },
        { label: '술시 (19:30~21:29)', value: 20 },
        { label: '해시 (21:30~23:29)', value: 22 }
      ];
      hourSelect.innerHTML = '<option value="-1">모름</option>';
      hourLabels.forEach(h => {
        hourSelect.innerHTML += `<option value="${h.value}">${h.label}</option>`;
      });
      hourSelect.value = 12;

      renderHistory();
      const savedTheme = localStorage.getItem('k-saju-theme') || 'dark';
      if (savedTheme === 'light') {
        document.body.setAttribute('data-theme', 'light');
        document.getElementById('theme-icon').textContent = '☀️';
        document.getElementById('theme-text').textContent = '라이트';
      }
      
      // v2.91: 궁합 탭 폼 초기화
      initCompatTab();
    }

    function selectGender(g) {
      selectedGender = g;
      document.querySelectorAll('.gender-btn').forEach(btn => btn.classList.remove('selected'));
      document.getElementById(`gender-${g}`).classList.add('selected');
    }

    // v2.91: 메인 입력 음력/양력 선택
    function selectCalendarType(type) {
      calendarType = type;
      document.querySelectorAll('.calendar-type-btns:not(.small) .calendar-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.cal === type) btn.classList.add('active');
      });
      const notice = document.getElementById('lunar-notice');
      if (notice) notice.classList.toggle('show', type === 'lunar');
    }
    
    // v2.91: 궁합 입력 음력/양력 선택
    function selectCompatCalType(type) {
      compatCalendarType = type;
      document.querySelectorAll('.calendar-type-btns.small .calendar-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.cal === type) btn.classList.add('active');
      });
    }
    
    // v2.91: 궁합 모달 음력/양력 선택
    function selectModalCalType(type) {
      modalCalendarType = type;
      // 모달 내부 버튼만 선택
      document.querySelectorAll('#compatibility-modal .calendar-type-btns .calendar-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.cal === type) btn.classList.add('active');
      });
    }
    
    // v2.91: 음력 → 양력 변환 함수
    function convertLunarToSolar(year, month, day) {
      try {
        if (typeof KoreanLunarCalendar !== 'undefined') {
          const calendar = new KoreanLunarCalendar();
          calendar.setLunarDate(year, month, day, false);
          const solar = calendar.getSolarCalendar();
          console.log(`🌙 음력 ${year}.${month}.${day} → 양력 ${solar.year}.${solar.month}.${solar.day}`);
          return { year: solar.year, month: solar.month, day: solar.day, success: true };
        } else {
          console.warn('음력 변환 라이브러리 로드 실패');
          return { year, month, day, success: true, warning: '라이브러리 없음' };
        }
      } catch (error) {
        console.error('음력 변환 오류:', error);
        return { success: false, error: '유효하지 않은 음력 날짜입니다.' };
      }
    }

    function showMbtiDesc() {
      const mbti = document.getElementById('mbti').value;
      const descEl = document.getElementById('mbti-desc');
      if (mbti && MBTI_DATA[mbti]) {
        const data = MBTI_DATA[mbti];
        descEl.innerHTML = `<strong>${mbti} - ${data.name}</strong><br>${data.traits}<br>💡 키워드: ${data.keyword}`;
        descEl.classList.add('active');
      } else {
        descEl.classList.remove('active');
      }
    }

    function toggleTheme() {
      const body = document.body;
      const isLight = body.getAttribute('data-theme') === 'light';
      body.setAttribute('data-theme', isLight ? '' : 'light');
      document.getElementById('theme-icon').textContent = isLight ? '🌙' : '☀️';
      document.getElementById('theme-text').textContent = isLight ? '다크' : '라이트';
      localStorage.setItem('k-saju-theme', isLight ? 'dark' : 'light');
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'input') renderHistory();
    }

    // ===== v2.91: 탭 네비게이션 =====
    let currentTab = 'saju';
    let selectedMonth2026 = new Date().getMonth() + 1; // 현재 월
    let selectedRelation = 'lover';
    
    function showTab(tabId) {
      // AI 탭은 비활성화
      if (tabId === 'ai') {
        showToast('AI 사주 기능은 준비 중입니다!');
        return;
      }
      
      currentTab = tabId;
      
      // 탭 버튼 상태 변경
      document.querySelectorAll('.main-tab').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`tab-btn-${tabId}`).classList.add('active');
      
      // 탭 콘텐츠 변경
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabId}`).classList.add('active');
      
      // 2026년 운세 탭 선택 시 렌더링
      if (tabId === 'fortune2026' && result) {
        render2026Fortune();
      }
    }
    
    // ===== v2.91: 2026년 운세 =====
    // 2026년 = 병오년 (丙午年)
    const YEAR_2026 = {
      stem: 2, // 丙 (병화)
      branch: 6, // 午 (오화)
      stemName: '丙',
      branchName: '午',
      stemKr: '병',
      branchKr: '오',
      element: 'fire',
      animal: '뱀',
      theme: '화(火)의 해 - 열정과 도약의 시기'
    };
    
    // 월운 천간 (2026년 기준)
    // 년간이 丙(양화)이면, 정월(寅월)은 庚寅부터 시작
    const MONTH_STEMS_2026 = [
      { stem: 6, branch: 0 },  // 1월: 庚寅
      { stem: 7, branch: 1 },  // 2월: 辛卯
      { stem: 8, branch: 2 },  // 3월: 壬辰
      { stem: 9, branch: 3 },  // 4월: 癸巳
      { stem: 0, branch: 4 },  // 5월: 甲午
      { stem: 1, branch: 5 },  // 6월: 乙未
      { stem: 2, branch: 6 },  // 7월: 丙申
      { stem: 3, branch: 7 },  // 8월: 丁酉
      { stem: 4, branch: 8 },  // 9월: 戊戌
      { stem: 5, branch: 9 },  // 10월: 己亥
      { stem: 6, branch: 10 }, // 11월: 庚子
      { stem: 7, branch: 11 }  // 12월: 辛丑
    ];
    
    function calculate2026YearFortune() {
      if (!result) return null;
      
      const dayStem = result.pillars.day.stem;
      const dayBranch = result.pillars.day.branch;
      const dayStemElement = STEMS[dayStem].element;
      
      const yearStemElement = STEMS[YEAR_2026.stem].element; // fire
      
      // 오행 상생상극
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      const generatedBy = { wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal' };
      const controlledBy = { wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth' };
      
      let yearScore = 65; // 기본 점수
      let yearAnalysis = [];
      let luckyMonths = [];
      let cautionMonths = [];
      
      // 년운과 일간의 관계
      if (yearStemElement === dayStemElement) {
        yearScore += 10;
        yearAnalysis.push('2026년은 나와 같은 <em>화(火)</em> 기운의 해입니다. 기본 에너지가 높아지고, 자신감이 상승하는 해입니다.');
      } else if (generating[dayStemElement] === yearStemElement) {
        yearScore += 15;
        yearAnalysis.push('2026년 <em>화(火)</em>의 기운이 당신의 표현력과 창의성을 촉진합니다. 아이디어를 실현하기 좋은 해입니다.');
      } else if (generatedBy[dayStemElement] === yearStemElement) {
        yearScore += 12;
        yearAnalysis.push('2026년 <em>화(火)</em>의 기운이 당신에게 활력과 지원을 제공합니다. 도움을 받기 쉬운 해입니다.');
      } else if (controlling[dayStemElement] === yearStemElement) {
        yearScore -= 5;
        yearAnalysis.push('2026년 <em>화(火)</em>의 기운이 당신의 활동을 견제할 수 있습니다. 신중한 판단이 필요합니다.');
      } else if (controlledBy[dayStemElement] === yearStemElement) {
        yearScore += 8;
        yearAnalysis.push('2026년 <em>화(火)</em>의 기운을 당신이 통제할 수 있습니다. 적극적인 행동이 성과를 가져옵니다.');
      }
      
      // 지지 관계 (일지 ↔ 년지)
      if (dayBranch === YEAR_2026.branch) {
        yearScore += 15;
        yearAnalysis.push('일지와 년지가 같아 <em>자형(自刑)</em> 또는 강한 에너지 집중이 예상됩니다. 자기 관리가 중요합니다.');
      }
      
      // 육합/삼합/충 체크
      const BRANCH_COMBINES = {
        0: 11, 1: 10, 2: 9, 3: 8, 4: 7, 5: 6, 6: 5, 7: 4, 8: 3, 9: 2, 10: 1, 11: 0
      };
      const BRANCH_CLASHES = { 0: 6, 1: 7, 2: 8, 3: 9, 4: 10, 5: 11, 6: 0, 7: 1, 8: 2, 9: 3, 10: 4, 11: 5 };
      
      if (BRANCH_COMBINES[dayBranch] === YEAR_2026.branch) {
        yearScore += 15;
        yearAnalysis.push('일지와 년지가 <em>육합</em>을 이룹니다. 좋은 인연과 기회가 많은 해입니다.');
      }
      
      if (BRANCH_CLASHES[dayBranch] === YEAR_2026.branch) {
        yearScore -= 10;
        yearAnalysis.push('일지와 년지가 <em>상충</em>합니다. 변화가 많고 예상치 못한 일이 생길 수 있습니다.');
        cautionMonths.push(6, 12);
      }
      
      // 십성 기반 분석
      const dayStemYin = dayStem % 2 === 1;
      const yearStemYin = YEAR_2026.stem % 2 === 1;
      const sameYinYang = dayStemYin === yearStemYin;
      
      let yearSipseong = '';
      if (yearStemElement === dayStemElement) {
        yearSipseong = sameYinYang ? '비견' : '겁재';
      } else if (yearStemElement === generating[dayStemElement]) {
        yearSipseong = sameYinYang ? '식신' : '상관';
      } else if (yearStemElement === controlling[dayStemElement]) {
        yearSipseong = sameYinYang ? '편재' : '정재';
      } else if (yearStemElement === controlledBy[dayStemElement]) {
        yearSipseong = sameYinYang ? '편관' : '정관';
      } else if (yearStemElement === generatedBy[dayStemElement]) {
        yearSipseong = sameYinYang ? '편인' : '정인';
      }
      
      const sipseongMsgs = {
        '비견': '경쟁과 협력의 해. 독립심이 강해지고, 새로운 도전을 시작하기 좋습니다.',
        '겁재': '재물 관리에 주의가 필요한 해. 충동적 결정을 피하세요.',
        '식신': '창의력과 표현력이 빛나는 해. 재능을 발휘할 기회가 많습니다.',
        '상관': '변화와 도전의 해. 기존 틀을 깨고 새로운 시도를 해보세요.',
        '정재': '안정적인 재물운. 꾸준한 노력이 결실을 맺습니다.',
        '편재': '예상치 못한 재물 기회. 투자나 사업에 관심을 가져보세요.',
        '정관': '승진, 인정의 해. 책임감 있는 역할이 주어집니다.',
        '편관': '도전과 압박의 해. 스트레스 관리가 중요합니다.',
        '정인': '학습과 성장의 해. 자격증, 학위 취득에 유리합니다.',
        '편인': '통찰과 영감의 해. 색다른 관점으로 돌파구를 찾습니다.'
      };
      
      if (yearSipseong) {
        yearAnalysis.push(`2026년 당신에게 <em>${yearSipseong}</em>의 해입니다. ${sipseongMsgs[yearSipseong]}`);
      }
      
      // 행운의 월 / 주의할 월 계산
      MONTH_STEMS_2026.forEach((monthInfo, idx) => {
        const monthStemEl = STEMS[monthInfo.stem].element;
        const month = idx + 1;
        
        if (generatedBy[dayStemElement] === monthStemEl || generating[dayStemElement] === monthStemEl) {
          if (luckyMonths.length < 3) luckyMonths.push(month);
        }
        if (controlling[dayStemElement] === monthStemEl && cautionMonths.length < 2) {
          if (!cautionMonths.includes(month)) cautionMonths.push(month);
        }
      });
      
      // 기본 행운월 보장
      if (luckyMonths.length === 0) {
        luckyMonths = [3, 7, 11]; // 기본값
      }
      if (cautionMonths.length === 0) {
        cautionMonths = [2, 8]; // 기본값
      }
      
      return {
        score: Math.min(100, Math.max(40, yearScore)),
        analysis: yearAnalysis,
        yearSipseong,
        luckyMonths,
        cautionMonths
      };
    }
    
    function calculate2026MonthFortune(month) {
      if (!result) return null;
      
      const monthInfo = MONTH_STEMS_2026[month - 1];
      const dayStem = result.pillars.day.stem;
      const dayStemElement = STEMS[dayStem].element;
      const monthStemElement = STEMS[monthInfo.stem].element;
      
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      const generatedBy = { wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal' };
      const controlledBy = { wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth' };
      
      // 분야별 점수 계산
      let scores = {
        love: 60 + Math.floor(Math.random() * 20),
        wealth: 60 + Math.floor(Math.random() * 20),
        career: 60 + Math.floor(Math.random() * 20),
        social: 60 + Math.floor(Math.random() * 20)
      };
      
      // 오행 관계에 따른 점수 조정
      if (monthStemElement === dayStemElement) {
        scores.career += 10;
        scores.social += 8;
      } else if (generating[dayStemElement] === monthStemElement) {
        scores.wealth += 12;
        scores.career += 8;
      } else if (generatedBy[dayStemElement] === monthStemElement) {
        scores.love += 10;
        scores.social += 10;
      } else if (controlling[dayStemElement] === monthStemElement) {
        scores.career -= 5;
        scores.wealth += 8;
      } else if (controlledBy[dayStemElement] === monthStemElement) {
        scores.love -= 5;
        scores.career += 10;
      }
      
      // MBTI 영향
      if (result.mbti) {
        if (result.mbti.includes('E')) scores.social += 5;
        if (result.mbti.includes('F')) scores.love += 5;
        if (result.mbti.includes('T')) scores.career += 5;
        if (result.mbti.includes('J')) scores.wealth += 5;
      }
      
      // 범위 조정
      Object.keys(scores).forEach(key => {
        scores[key] = Math.min(95, Math.max(45, scores[key]));
      });
      
      // 분야별 상세 운세 생성
      const fortuneDetails = {
        love: generateLoveFortune(month, scores.love, result),
        wealth: generateWealthFortune(month, scores.wealth, result),
        career: generateCareerFortune(month, scores.career, result),
        social: generateSocialFortune(month, scores.social, result)
      };
      
      return { scores, details: fortuneDetails };
    }
    
    function generateLoveFortune(month, score, r) {
      const isHigh = score >= 75;
      const isMid = score >= 55 && score < 75;
      
      // MBTI 기반 추가 메시지
      const mbtiExtra = r.mbti ? (
        r.mbti.includes('E') ? ' 사교적인 성향이 매력으로 작용할 때입니다.' :
        r.mbti.includes('I') ? ' 깊은 대화를 통해 마음을 열어보세요.' : ''
      ) : '';
      
      const highMsgs = [
        `${month}월은 연애운이 크게 상승하는 시기입니다! 솔로라면 새로운 인연을 만날 확률이 높고, 커플이라면 관계가 한 단계 더 깊어질 수 있어요.${mbtiExtra} 특히 이 시기에는 당신의 진솔한 모습이 상대방에게 큰 매력으로 다가갑니다. 두려워하지 말고 먼저 다가가보세요. 용기 있는 고백이나 프로포즈도 좋은 결과를 기대할 수 있습니다.`,
        `${month}월에는 로맨틱한 기운이 가득 감돕니다. 평소와 다른 분위기의 데이트를 계획해보세요.${mbtiExtra} 상대방도 당신에게 특별한 감정을 느끼고 있을 가능성이 높습니다. 감정을 숨기기보다 적극적으로 표현하는 것이 좋으며, 서로의 미래에 대해 진지하게 이야기 나눌 수 있는 좋은 시기입니다.`,
        `${month}월, 사랑의 기운이 당신을 감싸고 있어요. 진심을 전하면 반드시 통하는 시기입니다.${mbtiExtra} 이 달에는 운명적인 만남이 있을 수도 있으니 새로운 장소, 새로운 모임에 적극적으로 참여해보세요. 기존 관계도 더욱 돈독해지며, 서로에 대한 신뢰가 깊어집니다.`
      ];
      const midMsgs = [
        `${month}월은 안정적이고 평온한 연애운입니다. 급하게 관계를 진전시키기보다는 자연스러운 흐름에 맡기는 것이 좋아요.${mbtiExtra} 일상 속에서 작은 배려와 관심이 큰 힘이 됩니다. 커플이라면 함께 요리하거나 영화를 보는 소소한 데이트가 관계를 더 깊게 만들어줄 거예요. 솔로라면 조급해하지 말고 자신을 가꾸는 시간을 가져보세요.`,
        `${month}월에는 관계의 질을 높이는 것이 중요합니다. 많은 만남보다 깊은 대화가 더 가치 있는 시기예요.${mbtiExtra} 상대방의 말에 귀 기울이고, 진정한 관심을 보여주세요. 서로의 취미나 관심사를 공유하며 공감대를 넓혀가는 것이 좋습니다. 작은 선물이나 편지로 마음을 전해보는 것도 추천드려요.`,
        `${month}월, 감정보다는 이성적인 판단이 필요한 시기입니다. 상대방의 입장에서 생각해보세요.${mbtiExtra} 오해가 생기기 쉬운 시기이므로 명확한 의사소통이 중요해요. 불필요한 다툼은 피하고, 서로 존중하는 마음을 잊지 마세요. 솔로라면 친구 관계에서 시작하는 연애가 좋은 결과를 가져올 수 있어요.`
      ];
      const lowMsgs = [
        `${month}월은 연애보다 자기 관리와 내면 성장에 집중하는 것이 좋습니다. 지금은 외로움을 느낄 수 있지만, 이 시간이 더 좋은 인연을 위한 준비 기간이에요.${mbtiExtra} 자신을 사랑하고 돌보는 연습을 해보세요. 취미 활동이나 자기계발에 투자하면 나중에 더 매력적인 모습으로 사랑을 맞이할 수 있습니다.`,
        `${month}월에는 관계에서 오해나 갈등이 생기기 쉽습니다. 감정적으로 반응하기보다 한 발 물러서서 상황을 객관적으로 바라보세요.${mbtiExtra} 이 시기에는 무리하게 관계를 진전시키려 하지 마세요. 솔로라면 억지로 만남을 만들기보다 자연스러운 인연을 기다리는 것이 좋습니다. 기존 관계도 서로에게 공간을 주는 것이 현명해요.`,
        `${month}월, 감정의 기복이 심할 수 있어 연애에 있어 신중함이 필요합니다. 충동적인 고백이나 결정은 피하세요.${mbtiExtra} 이 시기에 시작된 관계는 오래 가기 어려울 수 있으니, 때를 기다리는 것이 좋아요. 대신 친구나 가족과의 관계에 에너지를 쏟으면 정서적 안정을 얻을 수 있습니다.`
      ];
      
      const tips = isHigh 
        ? ['추천 데이트: ' + ['분위기 좋은 레스토랑', '야경 명소', '전시회/공연', '테마파크'][month % 4], 
           '행운의 요일: ' + ['월요일', '수요일', '금요일', '토요일'][month % 4],
           '적극적인 애정 표현하기',
           '미래에 대해 진지하게 대화하기']
        : isMid 
        ? ['서로의 공간과 시간 존중하기', 
           '작은 선물이나 편지로 마음 전하기',
           '함께 새로운 취미 시작해보기',
           '솔직하고 명확한 대화 나누기']
        : ['자기 자신을 먼저 사랑하기', 
           '친구들과 즐거운 시간 보내기',
           '새로운 취미나 자기계발에 투자',
           '감정 일기 쓰며 마음 정리하기'];
      
      return {
        content: isHigh ? highMsgs[month % 3] : isMid ? midMsgs[month % 3] : lowMsgs[month % 3],
        tips
      };
    }
    
    function generateWealthFortune(month, score, r) {
      const isHigh = score >= 75;
      const isMid = score >= 55 && score < 75;
      
      // MBTI 기반 추가 메시지
      const mbtiExtra = r.mbti ? (
        r.mbti.includes('J') ? ' 체계적인 재무 계획이 빛을 발할 때입니다.' :
        r.mbti.includes('P') ? ' 유연하게 기회를 포착하는 것이 유리합니다.' : ''
      ) : '';
      
      const highMsgs = [
        `${month}월은 재물운이 크게 상승하는 시기입니다! 그동안 준비해온 투자나 사업 아이디어가 있다면 실행에 옮기기 좋습니다.${mbtiExtra} 예상치 못한 수입이나 보너스의 가능성도 있어요. 다만, 큰 돈이 들어오더라도 한 번에 다 쓰지 말고 일정 부분은 저축이나 투자로 돌리세요. 재테크에 관심이 있다면 전문가 상담을 받아보는 것도 좋습니다.`,
        `${month}월에 재물의 기회가 찾아옵니다. 부업이나 추가 수입의 기회가 생길 수 있으니 주변을 잘 살펴보세요.${mbtiExtra} 평소 관심 있던 분야에서 부수입을 창출할 수 있는 아이디어가 떠오를 수 있습니다. 투자를 고려한다면 분산 투자를 권장드리며, 단기보다는 중장기적인 관점으로 접근하세요. 금전 거래 시 서류 확인은 꼼꼼히!`,
        `${month}월, 금전적인 면에서 직감이 잘 맞는 시기입니다. 평소 망설이던 재정적 결정을 내리기에 좋습니다.${mbtiExtra} 사업을 하신다면 새로운 거래처 확보나 계약 성사의 가능성이 높아요. 급여 협상이나 이직을 고려 중이라면 이 시기에 움직이는 것이 유리합니다. 재물운이 좋을 때 주변과 나눔을 실천하면 운이 더 좋아집니다.`
      ];
      const midMsgs = [
        `${month}월은 재정적으로 안정을 유지하는 시기입니다. 급격한 변화보다는 현상 유지에 초점을 맞추세요.${mbtiExtra} 큰 투자나 지출은 다음 달로 미루는 것이 안전합니다. 대신 이 시기에 가계부를 작성하고 지출 패턴을 분석해보세요. 불필요한 구독 서비스나 고정 지출을 정리하면 생각보다 큰 절약이 가능합니다.`,
        `${month}월에는 저축의 습관을 들이기 좋습니다. 작은 금액이라도 꾸준히 모으는 것이 중요해요.${mbtiExtra} 자동 이체 저축을 설정해두면 무리 없이 목돈을 만들 수 있습니다. 쇼핑할 때는 충동구매를 피하고, 정말 필요한 것인지 하루 정도 생각해본 후 결정하세요. 현금 흐름 관리에 신경 쓰면 다음 달 더 좋은 기회를 잡을 수 있어요.`,
        `${month}월, 계획된 소비가 중요한 시기입니다. 월초에 예산을 세우고 그 범위 내에서 지출하세요.${mbtiExtra} 예상치 못한 경조사비나 모임 비용이 발생할 수 있으니 여유분을 남겨두세요. 투자보다는 안전한 적금이나 예금이 적합하며, 리스크가 큰 금융 상품은 피하는 것이 좋습니다. 재정 관련 공부를 시작하기에도 좋은 시기예요.`
      ];
      const lowMsgs = [
        `${month}월은 재물 관리에 각별한 주의가 필요합니다. 큰 투자나 대출, 보증은 절대 피하세요.${mbtiExtra} 지금은 돈을 불리는 것보다 지키는 것이 중요한 시기입니다. 신용카드 사용을 줄이고, 현금 위주로 생활하면 지출을 통제하기 쉬워요. 금전 문제로 인간관계가 상할 수 있으니 돈 거래는 가급적 피하세요.`,
        `${month}월에는 예상치 못한 지출이 발생할 가능성이 높습니다. 비상금을 확보해두는 것이 현명해요.${mbtiExtra} 차량 수리, 의료비, 경조사 등 갑작스러운 지출에 대비하세요. 이 시기에는 새로운 투자나 사업 시작을 미루고, 기존의 것을 정리하는 데 집중하세요. 사기나 허위 광고에 현혹되지 않도록 조심하세요.`,
        `${month}월, 충동적인 소비 욕구가 높아질 수 있습니다. 쇼핑 전 정말 필요한 것인지 자문해보세요.${mbtiExtra} 세일이나 할인에 현혹되어 불필요한 물건을 사지 않도록 주의하세요. 친구의 투자 권유나 부업 제안은 신중하게 검토하세요. 이 시기를 잘 넘기면 다음 달부터 재물운이 회복되니 조금만 참아보세요.`
      ];
      
      const tips = isHigh 
        ? ['투자 포트폴리오 점검 및 리밸런싱', 
           '재테크 관련 서적이나 강의 수강',
           '부수입 창출 방법 적극 모색',
           '주변과 나눔 실천으로 복 불러오기']
        : isMid 
        ? ['가계부 작성으로 지출 패턴 파악', 
           '자동 이체 적금 설정하기',
           '불필요한 구독 서비스 해지',
           '월 예산 계획 세우고 지키기']
        : ['신용카드 대신 현금/체크카드 사용', 
           '비상금 확보 (월 지출의 3배 이상)',
           '큰 지출이나 투자 결정 미루기',
           '돈 관련 인간관계 조심하기'];
      
      return {
        content: isHigh ? highMsgs[month % 3] : isMid ? midMsgs[month % 3] : lowMsgs[month % 3],
        tips
      };
    }
    
    function generateCareerFortune(month, score, r) {
      const isHigh = score >= 75;
      const isMid = score >= 55 && score < 75;
      
      // MBTI 기반 추가 메시지
      const mbtiExtra = r.mbti ? (
        r.mbti.includes('T') ? ' 논리적인 접근이 높이 평가받는 시기입니다.' :
        r.mbti.includes('F') ? ' 팀원들과의 공감과 협력이 성과를 높여줍니다.' : ''
      ) : '';
      
      const highMsgs = [
        `${month}월은 업무에서 두각을 나타낼 수 있는 절호의 시기입니다! 새로운 프로젝트나 역할에 적극적으로 도전해보세요.${mbtiExtra} 상사나 클라이언트에게 좋은 인상을 남길 수 있으며, 승진이나 보너스의 기회가 열릴 수 있습니다. 아이디어가 있다면 주저하지 말고 제안하세요. 이 시기에 맺은 비즈니스 관계는 장기적으로 큰 도움이 됩니다.`,
        `${month}월에 그동안의 노력이 인정받는 시기가 옵니다. 성과를 적극적으로 어필하세요.${mbtiExtra} 프레젠테이션이나 보고가 있다면 철저히 준비하면 기대 이상의 결과를 얻을 수 있습니다. 이직이나 커리어 전환을 고려 중이라면 좋은 제안이 들어올 수 있으니 링크드인 등 프로필을 업데이트해두세요. 자신감을 가지고 목표를 향해 나아가세요.`,
        `${month}월, 리더십을 발휘하기 좋은 시기입니다. 팀 프로젝트에서 주도적인 역할을 맡아보세요.${mbtiExtra} 새로운 기술이나 트렌드를 빠르게 습득하면 경쟁 우위를 점할 수 있습니다. 업계 네트워킹 행사나 세미나에 참석하면 좋은 인연을 만날 수 있어요. 자기계발에 투자하면 미래에 큰 보상으로 돌아옵니다.`
      ];
      const midMsgs = [
        `${month}월은 묵묵히 맡은 바를 수행하며 실력을 쌓는 시기입니다. 기본에 충실하세요.${mbtiExtra} 화려한 성과보다는 신뢰를 쌓는 것이 중요해요. 데드라인을 잘 지키고, 품질 높은 결과물을 내놓으면 자연스럽게 인정받게 됩니다. 동료들과의 관계도 소홀히 하지 마세요. 팀워크가 나중에 큰 기회로 연결될 수 있습니다.`,
        `${month}월에는 팀워크와 협업이 중요해집니다. 혼자 하려고 하기보다 동료들과 함께 하세요.${mbtiExtra} 다른 부서와의 협업 기회가 생긴다면 적극적으로 참여하세요. 새로운 관점을 배울 수 있는 좋은 기회입니다. 업무 관련 스킬업에 시간을 투자하면 다음 기회가 왔을 때 더 잘 잡을 수 있어요. 온라인 강의나 자격증 취득을 고려해보세요.`,
        `${month}월, 자기계발에 집중하기 좋은 시기입니다. 새로운 기술이나 지식을 습득해보세요.${mbtiExtra} 당장의 성과보다 장기적인 커리어 성장을 위한 투자가 필요한 때입니다. 멘토를 찾거나 선배에게 조언을 구해보세요. 커리어 방향에 대해 고민이 있다면 정리해볼 좋은 기회이기도 합니다.`
      ];
      const lowMsgs = [
        `${month}월은 업무에서 스트레스가 높아질 수 있습니다. 워라밸을 지키며 건강을 챙기세요.${mbtiExtra} 완벽하려고 하기보다 80%의 결과물을 제때 내놓는 것이 낫습니다. 야근을 줄이고, 퇴근 후에는 업무 생각을 내려놓는 연습을 하세요. 명상이나 운동으로 스트레스를 관리하면 업무 효율도 높아집니다.`,
        `${month}월에는 상사나 동료와의 관계에서 갈등이 생길 수 있습니다. 말과 행동을 신중히 하세요.${mbtiExtra} 감정적으로 대응하면 상황이 악화될 수 있으니, 한 템포 쉬고 반응하세요. 회의에서는 불필요한 발언을 줄이고, 경청하는 자세를 보여주세요. 이 시기만 잘 넘기면 관계가 회복됩니다.`,
        `${month}월, 큰 결정이나 변화는 다음 달로 미루는 것이 좋습니다. 때를 기다리세요.${mbtiExtra} 이직이나 부서 이동 등 중요한 결정은 급하게 내리지 마세요. 지금은 현재 위치에서 최선을 다하며 기회를 노리는 것이 현명합니다. 업무 실수에 주의하고, 중요한 문서는 꼭 더블체크하세요.`
      ];
      
      const tips = isHigh 
        ? ['새로운 프로젝트에 적극 지원하기', 
           '성과 정리해서 상사에게 어필하기',
           '업계 네트워킹 행사 참석',
           '이직/승진 기회 적극 탐색']
        : isMid 
        ? ['맡은 일 꼼꼼히 마무리하기', 
           '동료들과 좋은 관계 유지',
           '업무 관련 스킬업 강의 수강',
           '선배나 멘토에게 조언 구하기']
        : ['워라밸 지키며 건강 관리', 
           '스트레스 관리에 시간 투자',
           '감정적 대응 피하고 신중하게',
           '중요한 결정은 다음 달로 미루기'];
      
      return {
        content: isHigh ? highMsgs[month % 3] : isMid ? midMsgs[month % 3] : lowMsgs[month % 3],
        tips
      };
    }
    
    function generateSocialFortune(month, score, r) {
      const isHigh = score >= 75;
      const isMid = score >= 55 && score < 75;
      
      // MBTI 기반 추가 메시지
      const mbtiExtra = r.mbti ? (
        r.mbti.includes('E') ? ' 외향적인 에너지가 빛을 발하는 시기입니다.' :
        r.mbti.includes('I') ? ' 소수와의 깊은 대화가 더 큰 가치를 줍니다.' : ''
      ) : '';
      
      const highMsgs = [
        `${month}월은 대인관계가 크게 활발해지는 시기입니다! 새로운 인연이 좋은 기회로 이어질 수 있으니 적극적으로 사람을 만나세요.${mbtiExtra} 모임이나 행사에서 중심 역할을 하게 될 수 있으며, 주변 사람들에게 좋은 영향력을 미칠 수 있습니다. 명함을 주고받거나 연락처를 교환할 기회가 많으니, 후속 연락을 잊지 마세요. 이 시기에 맺은 인연은 오랫동안 이어질 귀한 관계가 될 수 있습니다.`,
        `${month}월에 귀인을 만날 가능성이 매우 높습니다. 예상치 못한 곳에서 도움을 주는 사람이 나타날 수 있어요.${mbtiExtra} 동창회, 동호회, 세미나 등 사람이 많이 모이는 곳에 적극적으로 참여하세요. 평소 연락이 뜸했던 지인에게 먼저 연락해보는 것도 좋습니다. SNS 활동도 활발히 하면 좋은 기회가 찾아올 수 있어요. 주변 사람들의 부탁이나 요청에 성심껏 응하면 더 큰 복으로 돌아옵니다.`,
        `${month}월, 사회적 평판과 인정이 높아지는 시기입니다. 주변의 신뢰를 얻기 좋은 때예요.${mbtiExtra} 리더십을 발휘할 기회가 생길 수 있으며, 커뮤니티나 그룹에서 중요한 역할을 맡게 될 수 있습니다. 이 시기에는 남을 돕는 일에 적극적으로 나서보세요. 봉사활동이나 멘토링 등 나눔의 실천이 더 큰 인복을 가져다줍니다. 인간관계의 폭이 넓어지면서 다양한 분야의 사람들과 교류할 수 있는 시기입니다.`
      ];
      const midMsgs = [
        `${month}월은 기존 관계를 더욱 돈독히 하기 좋은 시기입니다. 새로운 만남보다 오래된 친구에게 연락해보세요.${mbtiExtra} 함께 식사를 하거나 안부 전화 한 통이 관계를 따뜻하게 유지시켜줍니다. 가족과의 시간도 중요하니, 주말에 가족 모임이나 나들이를 계획해보세요. 갈등이 있던 관계가 있다면 화해의 손을 먼저 내미는 것도 좋습니다. 작은 배려와 관심이 관계를 깊게 만듭니다.`,
        `${month}월에는 양보다 질이 중요한 시기입니다. 많은 사람을 만나기보다 진정성 있는 교류에 집중하세요.${mbtiExtra} 상대방의 이야기에 진심으로 귀 기울이면 더 깊은 신뢰를 얻을 수 있습니다. 약속은 반드시 지키고, 한 번 한 말은 책임지세요. 소소한 모임이라도 준비를 잘 하면 좋은 인상을 남길 수 있습니다. SNS보다는 직접 만나서 대화하는 것이 더 효과적인 시기입니다.`,
        `${month}월, 경청의 힘이 중요해지는 시기입니다. 말하는 것보다 듣는 것에 집중하세요.${mbtiExtra} 상대의 고민을 들어주고 공감해주면 관계가 한층 깊어집니다. 조언보다는 공감을, 판단보다는 이해를 먼저 해주세요. 이 시기에는 새로운 인맥을 넓히기보다 기존 인간관계를 정리하고 강화하는 데 에너지를 쓰는 것이 좋습니다. 연말이 가까워진다면 감사 인사를 전하는 것도 좋아요.`
      ];
      const lowMsgs = [
        `${month}월은 인간관계에서 오해나 갈등이 생기기 쉬운 시기입니다. 섣부른 판단이나 성급한 말을 피하세요.${mbtiExtra} 특히 SNS나 메신저로 중요한 이야기를 나누는 것은 삼가세요. 오해를 부를 수 있습니다. 직접 만나서 이야기하거나, 중요한 대화는 다음 달로 미루는 것이 현명합니다. 가까운 사람과도 불필요한 언쟁이 생길 수 있으니 한 발 물러서는 자세가 필요해요.`,
        `${month}월에는 불필요한 갈등이나 험담에 휘말리지 않도록 주의하세요. 중립을 지키는 것이 최선입니다.${mbtiExtra} 다른 사람의 일에 지나치게 관여하거나 편을 드는 것은 피하세요. 오히려 화살이 당신에게 돌아올 수 있습니다. 에너지를 빼앗는 관계가 있다면 적당한 거리를 두는 것도 방법이에요. 모든 관계를 유지할 필요는 없습니다. 자신의 평화가 가장 중요합니다.`,
        `${month}월, 혼자만의 시간이 필요한 시기입니다. 무리해서 사람을 만나기보다 에너지를 재충전하세요.${mbtiExtra} 불필요한 약속은 정중히 사양하고, 독서나 명상 등 자신을 돌보는 시간을 가지세요. 지금은 내면을 들여다보고 스스로를 이해하는 데 집중하면 좋습니다. 신뢰할 수 있는 한두 명과만 깊은 대화를 나누는 것이 많은 사람을 얕게 만나는 것보다 나을 수 있어요.`
      ];
      
      const tips = isHigh 
        ? ['동창회, 동호회, 네트워킹 행사 참석', 
           '먼저 연락하고 관계 주도하기',
           '새로운 사람 만나는 것에 적극적으로',
           '봉사활동이나 나눔 실천하기']
        : isMid 
        ? ['감사와 사랑 표현 자주 하기', 
           '상대 입장에서 먼저 생각해보기',
           '가족, 오랜 친구와 시간 보내기',
           '약속은 반드시 지키기']
        : ['에너지 뺏는 관계 정리하기', 
           '혼자만의 취미나 휴식 시간 갖기',
           '불필요한 모임 정중히 사양하기',
           '신뢰할 수 있는 소수와 깊은 대화'];
      
      return {
        content: isHigh ? highMsgs[month % 3] : isMid ? midMsgs[month % 3] : lowMsgs[month % 3],
        tips
      };
    }
    
    // ===== v2.92: 학업운 함수 =====
    function generateStudyFortune(month, score, r) {
      const isHigh = score >= 75;
      const isMid = score >= 55 && score < 75;
      
      const mbtiExtra = r.mbti ? (
        r.mbti.includes('J') ? ' 계획적인 성향이 학습에 큰 도움이 됩니다.' :
        r.mbti.includes('P') ? ' 유연한 학습 방식이 오히려 효과적일 수 있어요.' : ''
      ) : '';
      
      const highMsgs = [
        `${month}월은 학업운이 매우 좋은 시기입니다! 집중력이 높아지고 이해력이 빨라지는 때예요.${mbtiExtra} 새로운 분야를 배우거나 자격증에 도전하기 좋습니다. 시험을 앞두고 있다면 좋은 결과를 기대해도 좋아요. 스터디 그룹 활동이나 멘토링도 효과적인 시기입니다.`,
        `${month}월, 머리가 맑아지고 기억력이 향상되는 시기입니다.${mbtiExtra} 어려운 개념도 술술 이해되고, 오래 기억에 남습니다. 중요한 시험이나 면접이 있다면 이 시기에 집중적으로 준비하세요. 온라인 강의, 독서, 세미나 참석 모두 좋은 결과로 이어집니다.`,
        `${month}월은 배움의 열정이 불타오르는 시기입니다!${mbtiExtra} 관심 있던 분야에 본격적으로 뛰어들어도 좋아요. 학습 효율이 높아 같은 시간을 투자해도 더 많이 흡수합니다. 자격증 시험, 승진 시험, 어학 시험 등 도전하면 좋은 결과를 얻을 수 있습니다.`
      ];
      const midMsgs = [
        `${month}월 학업운은 안정적입니다. 꾸준히 하던 공부를 이어가기 좋은 시기예요.${mbtiExtra} 새로운 것을 시작하기보다 기존 학습을 복습하고 정리하는 데 집중하세요. 무리한 계획보다 실현 가능한 목표를 세우는 것이 효과적입니다. 컨디션 관리도 중요해요.`,
        `${month}월에는 학습 환경 정리가 필요합니다. 책상 정리, 학습 계획 재점검 등 기본부터 다져보세요.${mbtiExtra} 슬럼프가 올 수 있으니, 너무 자책하지 말고 쉬어갈 줄도 알아야 해요. 친구나 동료와 함께 공부하면 동기부여가 됩니다.`,
        `${month}월, 차분하게 기초를 다지는 시간으로 삼으세요.${mbtiExtra} 급하게 진도를 나가기보다 이해가 부족한 부분을 보충하세요. 틀린 문제를 다시 푸는 것이 새 문제를 푸는 것보다 효과적인 시기입니다. 규칙적인 생활 패턴이 학습 효율을 높입니다.`
      ];
      const lowMsgs = [
        `${month}월은 집중력이 흐트러지기 쉬운 시기입니다. 중요한 시험은 가능하면 피하세요.${mbtiExtra} 공부가 잘 안 된다고 자책하지 마세요. 이 시기는 휴식과 재충전이 필요합니다. 억지로 밀어붙이면 번아웃이 올 수 있어요. 가벼운 독서나 관심 분야 탐색 정도로 부담 없이 보내세요.`,
        `${month}월에는 학습 효율이 떨어질 수 있습니다. 양보다 질에 집중하세요.${mbtiExtra} 긴 시간 공부보다 짧은 시간 집중하는 것이 효과적입니다. 체력 관리가 중요하니 운동과 수면을 충분히 챙기세요. 스트레스를 받지 않는 선에서 천천히 나아가세요.`,
        `${month}월, 무리한 학습 계획은 금물입니다.${mbtiExtra} 이 시기에는 새로운 시작보다 기존 것을 유지하는 데 집중하세요. 시험이 있다면 컨디션 관리에 더 신경 쓰세요. 몸과 마음이 지치면 아무것도 들어오지 않습니다. 충분히 쉬면서 에너지를 비축하세요.`
      ];
      
      const tips = isHigh 
        ? ['새로운 자격증/시험 도전', '스터디 그룹 참여', '집중 학습 시간 확보', '목표 상향 조정']
        : isMid 
        ? ['기존 학습 복습/정리', '학습 환경 개선', '규칙적 루틴 유지', '컨디션 관리']
        : ['무리한 계획 피하기', '충분한 휴식', '가벼운 학습만', '다음 달 준비'];
      
      return {
        content: isHigh ? highMsgs[month % 3] : isMid ? midMsgs[month % 3] : lowMsgs[month % 3],
        tips
      };
    }
    
    // ===== v2.92: 월별 종합 점수 계산 및 TOP 3 추출 =====
    function calculate2026AllMonthScores(r) {
      const monthlyData = [];
      
      for (let m = 1; m <= 12; m++) {
        const fortune = calculate2026MonthFortune(m);
        if (fortune) {
          const avgScore = Math.round(
            (fortune.scores.love + fortune.scores.wealth + 
             fortune.scores.career + fortune.scores.social) / 4
          );
          monthlyData.push({
            month: m,
            avgScore,
            scores: fortune.scores,
            details: fortune.details
          });
        }
      }
      
      // 점수순 정렬
      const sorted = [...monthlyData].sort((a, b) => b.avgScore - a.avgScore);
      
      return {
        all: monthlyData,
        best3: sorted.slice(0, 3).map(d => ({ month: d.month, score: d.avgScore })),
        worst3: sorted.slice(-3).reverse().map(d => ({ month: d.month, score: d.avgScore }))
      };
    }
    
    // ===== v2.93: 오디오/텍스트 스크립트 생성 (브루 TTS 친화 버전) =====
    function generateFullScript(r, userName = '') {
      const name = userName || '회원';
      const monthScores = calculate2026AllMonthScores(r);
      const healthRisk = r.healthRisk || analyzeHealthRisk(r);
      
      // 조합 라벨
      const comboKey = r.mbti ? `${r.mbti}_${r.dayStemIndex}` : null;
      const comboLabel = comboKey && COMBO_LABELS[comboKey] ? COMBO_LABELS[comboKey] : null;
      
      // 오행 정보
      const dominantEl = ELEMENTS[r.dominant]?.name || r.dominant;
      const weakEl = ELEMENTS[r.weak]?.name || r.weak;
      const dominantDesc = ELEMENTS[r.dominant]?.desc || '';
      const weakDesc = ELEMENTS[r.weak]?.desc || '';
      
      // MBTI 정보
      const mbtiName = r.mbti && MBTI_DATA[r.mbti] ? MBTI_DATA[r.mbti].name : '';
      const mbtiDesc = r.mbti && MBTI_DATA[r.mbti] ? MBTI_DATA[r.mbti].desc : '';
      
      // 일간 정보
      const dayStemName = STEMS[r.pillars.day.stem]?.name || '';
      const dayStemYinYang = STEMS[r.pillars.day.stem]?.yinyang === 'yang' ? '양' : '음';
      
      // ===== Opening용 변수 생성 =====
      // 오늘의 에너지 (dominant 오행 기반)
      const todayEnergyMap = {
        'wood': '성장과 새로운 시작의',
        'fire': '열정과 활력이 넘치는',
        'earth': '안정과 신뢰의',
        'metal': '정리와 결단의',
        'water': '유연하고 흐르는 듯한'
      };
      const todayEnergy = todayEnergyMap[r.dominant] || '균형 잡힌';
      
      // 감정 패턴 (오행 + MBTI F/T 조합)
      const emotionPatternMap = {
        'wood': r.mbti?.includes('F') ? '희망적이면서도 감성적인' : '진취적이고 도전적인',
        'fire': r.mbti?.includes('F') ? '따뜻하고 열린' : '자신감 넘치는',
        'earth': r.mbti?.includes('F') ? '포근하고 안정적인' : '차분하고 신중한',
        'metal': r.mbti?.includes('F') ? '섬세하고 예민한' : '날카롭고 명확한',
        'water': r.mbti?.includes('F') ? '깊고 감성적인' : '통찰력 있는'
      };
      const emotionPattern = emotionPatternMap[r.dominant] || '균형 잡힌';
      
      // 사고 패턴 (MBTI 기반)
      const thinkingPatternMap = {
        'TJ': '논리적이고 체계적인',
        'TP': '분석적이고 유연한',
        'FJ': '공감하고 조화를 추구하는',
        'FP': '감성적이고 자유로운'
      };
      const mbtiTF = r.mbti ? (r.mbti.includes('T') ? 'T' : 'F') : 'T';
      const mbtiJP = r.mbti ? (r.mbti.includes('J') ? 'J' : 'P') : 'J';
      const thinkingPattern = thinkingPatternMap[mbtiTF + mbtiJP] || '균형 잡힌';
      
      let script = '';
      
      // ===== Opening =====
      script += `${name}님, 오늘은 전체적으로 ${todayEnergy} 흐름이 들어오는 날이에요.

감정은 ${emotionPattern} 쪽으로,
생각은 ${thinkingPattern} 방향으로 기울기 쉽습니다.

잠깐 숨 한 번 고르고 시작할까요?

좋아요. 이제 시작할게요.

안녕하세요, ${name}님.
지금부터 ${name}님만을 위한 2026년 운세 리딩을 시작할게요.

${name}님의 타고난 기운과,
2026년에 어떤 흐름이 들어오는지,
하나씩 같이 살펴볼게요.

준비되셨죠? 그럼 시작합니다.

`;

      // ===== Part 1: 핵심 성향 =====
      script += `먼저 ${name}님의 핵심 성향부터 말씀드릴게요.

${name}님의 타고난 기운부터 볼게요.

${name}님은 '${dayStemName}' 일간이에요.
${dayStemYinYang}의 기운을 타고나셨고,
${r.dmInfo?.title || '특별한 성향'}을 가지고 계세요.

${r.dmInfo?.traits ? `
기본적으로 ${r.dmInfo.traits.split('.')[0]}하는 성향이에요.
${r.dmInfo.traits.split('.')[1] ? r.dmInfo.traits.split('.')[1] + '.' : ''}
` : ''}

${r.mbti ? `
MBTI에서는 ${r.mbti}, ${mbtiName}이시죠.
${mbtiDesc ? mbtiDesc.split('.')[0] + '하는 스타일이에요.' : ''}

이 두 가지가 만나면요,
${name}님은 '${comboLabel ? comboLabel.label : '독특한 조합'}' 타입으로 보여요.
${comboLabel ? `"${comboLabel.tagline}"` : ''}
` : ''}

다음으로 오행 에너지 흐름을 볼게요.

${name}님 사주에서 가장 강한 기운은 '${dominantEl}'이에요.
${dominantDesc ? `${dominantDesc.split(',')[0]} 느낌이 기본적으로 깔려 있어요.` : ''}

반면에 '${weakEl}' 기운은 좀 부족한 편이에요.
${weakDesc ? `${weakDesc.split(',')[0]} 부분은 의식적으로 채워주면 좋아요.` : ''}

이건 나쁜 게 아니라,
어디에 에너지를 쓰고, 어디를 보완하면 좋은지 알려주는 거예요.

${r.chemistry ? `
그럼 MBTI와 사주가 얼마나 잘 맞는지 볼게요.

조화도 점수가 ${r.chemistry.score}점이에요.

${r.chemistry.score >= 75 ? `
꽤 잘 맞는 편이에요!
안과 밖이 비슷하게 흘러가서, 일관성 있게 보이실 거예요.
` : r.chemistry.score >= 55 ? `
적당히 균형 잡힌 조합이에요.
때로는 다른 모습이 나올 수 있는데, 그게 오히려 매력이 될 수 있어요.
` : `
안과 밖이 좀 다른 조합이에요.
겉으로 보이는 ${name}님과 속마음이 다를 때가 있을 거예요.
근데 이게 나쁜 게 아니라, 깊이가 있다는 뜻이기도 해요.
`}

${r.chemistry.synergies?.length > 0 ? `
시너지가 나는 부분은요,
${r.chemistry.synergies.slice(0, 2).map(s => `${s}`).join(', ')}
` : ''}

${r.chemistry.conflicts?.length > 0 ? `
다만 이런 부분은 조금 주의하시면 좋아요.
${r.chemistry.conflicts.slice(0, 2).map(c => `${c}`).join(', ')}
` : ''}
` : ''}

`;

      // ===== Part 2: 2026년 월별 운세 =====
      const best3 = monthScores.best3;
      const worst3 = monthScores.worst3;
      
      script += `자, 이제 2026년 전체 흐름을 이야기해볼게요.

먼저 결론부터 말씀드리면요,

특히 좋은 달은요,

${best3[0].month}월이 가장 좋아요. ${best3[0].score}점!
이때는 뭘 해도 잘 풀리는 느낌이 들 거예요.

그 다음이 ${best3[1].month}월, ${best3[2].month}월이에요.
이 시기에 중요한 일을 몰아서 하시면 좋겠어요.

조심해야 할 달은요,

${worst3[0].month}월은 좀 주의가 필요해요.
무리하게 밀어붙이기보다는, 
준비하고 관찰하는 시간으로 쓰시면 좋겠어요.

${worst3[1].month}월, ${worst3[2].month}월도 비슷해요.
큰 결정은 피하고, 안정적으로 가시는 게 좋아요.

월별로 간단히 정리하면요,

`;
      
      monthScores.all.forEach(d => {
        const level = d.avgScore >= 75 ? '좋음' : d.avgScore >= 60 ? '보통' : '주의';
        script += `${d.month}월은 ${level}이에요. `;
        
        if (d.avgScore >= 75) {
          script += '적극적으로 움직여도 좋아요.\n';
        } else if (d.avgScore >= 60) {
          script += '무난하게 흘러가는 달이에요.\n';
        } else {
          script += '조금 쉬어가는 게 좋겠어요.\n';
        }
      });

      // ===== Part 3: 연애운 =====
      const loveSorted = [...monthScores.all].sort((a, b) => b.scores.love - a.scores.love);
      const loveBest = loveSorted.slice(0, 3);
      const loveWorst = loveSorted.slice(-2);
      
      script += `
다음은 연애 이야기 해볼게요.

${name}님이 가진 연애에서의 장점은요,
${r.mbti?.includes('F') ? '감정을 잘 표현하고 상대방에게 따뜻하게 다가가는 거예요.' : 
  r.mbti?.includes('T') ? '상대방을 이해하려고 노력하고, 논리적으로 문제를 풀어가는 거예요.' :
  '진심을 담아 상대를 대하는 거예요.'}

${dominantEl === '화(火)' ? '열정적이고 표현력이 좋아서, 상대방이 사랑받는다고 느끼기 쉬워요.' :
  dominantEl === '수(水)' ? '감성적이고 깊이가 있어서, 깊은 교감을 나눌 수 있어요.' :
  dominantEl === '목(木)' ? '성장을 함께하고 싶어하는 마음이 있어서, 건강한 관계를 만들어요.' :
  dominantEl === '금(金)' ? '한번 마음 주면 끝까지 가는 진중함이 있어요.' :
  '안정적이고 든든한 느낌을 주는 게 매력이에요.'}

연애 좋은 시기를 말씀드리면요,

${loveBest[0].month}월, ${loveBest[1].month}월, ${loveBest[2].month}월이 연애운이 좋아요.

${loveBest[0].month}월에는요,
새로운 만남이든, 기존 관계든, 
좋은 에너지가 흘러요.
고백이나 중요한 대화를 하기 좋은 때예요.

연애 주의 시기는요,

${loveWorst[0].month}월, ${loveWorst[1].month}월은 좀 주의하세요.

작은 오해가 생기기 쉬운 때예요.
말의 끝만 조금 부드럽게 해주시면,
불필요한 다툼을 피할 수 있어요.

이 시기에는 상대방 탓하기보다,
"내가 어떻게 표현하고 있지?" 한 번 돌아보시면 좋겠어요.

`;

      // ===== Part 4: 재물운 =====
      const wealthSorted = [...monthScores.all].sort((a, b) => b.scores.wealth - a.scores.wealth);
      const wealthBest = wealthSorted.slice(0, 3);
      const wealthWorst = wealthSorted.slice(-2);
      
      script += `다음은 재물 이야기 해볼게요.

${name}님의 돈에 대한 기본 성향은요,
${r.mbti?.includes('J') ? '계획적으로 관리하는 편이에요. 이건 장점이에요.' :
  r.mbti?.includes('P') ? '유연하게 쓰는 편인데, 가끔 충동구매가 있을 수 있어요.' :
  '상황에 따라 유연하게 대응하는 편이에요.'}

${dominantEl === '금(金)' ? '기본적으로 재물 복이 있는 편이에요. 모으는 힘이 있어요.' :
  dominantEl === '수(水)' ? '흐름을 잘 타면 큰 돈이 들어올 수 있어요. 타이밍이 중요해요.' :
  dominantEl === '토(土)' ? '안정적으로 쌓아가는 스타일이에요. 꾸준히 하면 됩니다.' :
  dominantEl === '목(木)' ? '성장하면서 돈이 따라오는 타입이에요. 자기 발전에 투자하세요.' :
  '열정적으로 벌고, 잘 쓰는 스타일이에요.'}

재물 좋은 시기를 말씀드리면요,

${wealthBest[0].month}월, ${wealthBest[1].month}월, ${wealthBest[2].month}월이 재물운이 좋아요.

투자나 중요한 재정 결정은 이 시기에 하시면 좋겠어요.
뜻밖의 수입이 생기거나,
노력한 게 금전적으로 돌아오는 시기예요.

재물 주의 시기는요,

${wealthWorst[0].month}월, ${wealthWorst[1].month}월은 지출 주의하세요.

이 시기에는 '빠른 결정'보다 '짧은 관찰'이 더 유리해요.
큰 투자나 계약은 잠시 미루시고,
꼭 필요한 지출인지 한 번 더 생각해보세요.

충동구매 위험 시기이기도 해요.
장바구니에 담아두고 하루 지나서 결정하는 거, 추천드려요.

`;

      // ===== Part 5: 직장운/학업운 =====
      const careerSorted = [...monthScores.all].sort((a, b) => b.scores.career - a.scores.career);
      const careerBest = careerSorted.slice(0, 3);
      const careerWorst = careerSorted.slice(-2);
      
      script += `다음은 일과 공부 이야기 해볼게요.

${name}님의 일하는 스타일은요,
${r.mbti?.includes('T') ? '논리적이고 체계적으로 접근하는 편이에요.' :
  r.mbti?.includes('F') ? '사람들과 조화를 이루면서 일하는 걸 선호해요.' :
  '상황에 맞게 유연하게 대응하는 편이에요.'}

${r.mbti?.includes('J') ? '계획대로 진행하는 걸 좋아하고, 마감을 잘 지켜요.' :
  r.mbti?.includes('P') ? '유연하게 대응하는 게 강점이에요. 돌발 상황에 강해요.' : ''}

${dominantEl === '목(木)' ? '성장과 발전에 대한 욕구가 강해요. 새로운 도전을 두려워하지 마세요.' :
  dominantEl === '화(火)' ? '추진력이 좋아요. 시작하면 끝까지 밀어붙이는 힘이 있어요.' :
  dominantEl === '토(土)' ? '안정적이고 꾸준해요. 오래 하면 할수록 빛나는 타입이에요.' :
  dominantEl === '금(金)' ? '완성도를 중요시해요. 디테일에 강점이 있어요.' :
  '통찰력이 있어요. 큰 그림을 보는 능력이 있어요.'}

커리어 좋은 시기를 말씀드리면요,

${careerBest[0].month}월, ${careerBest[1].month}월, ${careerBest[2].month}월이 직장운이 좋아요.

승진, 이직, 새 프로젝트 시작,
중요한 발표나 시험이 있다면 이 시기를 노리세요.
노력한 게 인정받는 때예요.

학업도 마찬가지예요.
집중력이 올라가고, 
배운 게 머리에 잘 들어오는 시기예요.

커리어 주의 시기는요,

${careerWorst[0].month}월, ${careerWorst[1].month}월은 좀 조심하세요.

이 시기에는 무리하게 밀어붙이기보다,
짧고 확실한 일부터 끝내면서 리듬을 잡으세요.

새로운 시작보다는 기존 것을 정리하고,
다음을 준비하는 시간으로 쓰시면 좋겠어요.

사람 문제가 생기기 쉬운 때이기도 해요.
상사나 동료와의 대화에서 말 조심하시면 좋겠어요.

`;

      // ===== Part 6: 건강운 =====
      script += `마지막으로 건강 이야기 해볼게요.
이게 사실 제일 중요해요.

${name}님의 건강 리스크 지수는 ${healthRisk.riskScore}점이에요.
${healthRisk.riskLevel === 'high' ? '좀 신경 써야 할 부분이 있어요.' :
  healthRisk.riskLevel === 'medium' ? '보통 수준이에요. 기본 관리만 잘 하시면 돼요.' :
  '전반적으로 양호한 편이에요.'}

주의해야 할 부분을 말씀드리면요,

${name}님이 특히 신경 쓰면 좋은 장기는요,
${healthRisk.weakOrgans?.slice(0, 2).join(', ') || '특별히 취약한 장기는 없어요'}.

${healthRisk.riskDiseases?.length > 0 ? `
주의하면 좋을 질환은요,
${healthRisk.riskDiseases.slice(0, 3).join(', ')} 정도예요.

무섭게 들릴 수 있는데요,
이건 "조심하세요"가 아니라 "미리 알고 관리하세요"라는 뜻이에요.
` : ''}

스트레스 패턴에 대해 말씀드리면요,

${name}님의 스트레스 유형은 '${healthRisk.stressType || '균형형'}'이에요.

${healthRisk.stressType?.includes('분노') ? '감정을 속으로 삼키는 경향이 있어요. 적절히 표현하는 연습이 필요해요.' :
  healthRisk.stressType?.includes('과흥분') ? '에너지가 넘쳐서 탈이 날 수 있어요. 쉬어가는 연습이 필요해요.' :
  healthRisk.stressType?.includes('걱정') ? '생각이 많아서 힘들 수 있어요. 명상이나 산책이 도움이 돼요.' :
  healthRisk.stressType?.includes('슬픔') ? '감정이 쌓이면 몸으로 나타나요. 울고 싶을 땐 울어도 괜찮아요.' :
  '균형 잡힌 편이에요. 현재 패턴 유지하시면 돼요.'}

${healthRisk.seasonalRisk ? `
계절별로 보면요,
${healthRisk.seasonalRisk.season}에는 특히 주의하세요.
${healthRisk.seasonalRisk.risk}
` : '계절별로 특별히 주의할 건 없어요.'}

관리 방법을 말씀드릴게요.

${healthRisk.preventionTips?.length > 0 ? `
이렇게 관리하시면 좋아요.
${healthRisk.preventionTips.slice(0, 3).join(', ')}
` : ''}

${healthRisk.exercises?.length > 0 ? `
추천 운동은요,
${healthRisk.exercises.slice(0, 3).join(', ')} 정도예요.
` : ''}

${healthRisk.checkups?.length > 0 ? `
정기 검진 받으실 때,
${healthRisk.checkups.slice(0, 2).join(', ')} 챙겨보시면 좋겠어요.
` : ''}

`;

      // ===== 행운 정보 & 마무리 =====
      script += `
마지막으로 ${name}님의 행운 포인트 알려드릴게요.

행운의 색은 ${r.luckyColors?.join(', ') || '밝은 색상'}이에요.
옷이나 소품에 이 색을 쓰시면 좋아요.

행운의 숫자는 ${r.luckyNums?.join(', ') || '3, 7, 9'}예요.
비밀번호나 선택할 때 참고하세요.

${name}님과 잘 맞는 방향은 ${r.direction || '동쪽'} 쪽이에요.
잠깐 그 방향을 바라보는 것만으로도,
에너지가 달라지는 걸 느끼실 수 있어요.

${name}님, 여기까지가 2026년 운세 리딩이었어요.

오늘 들으신 내용 중에서,
"이건 내 얘기다" 싶은 게 있으셨을 거예요.

그 느낌을 기억해두시면 좋겠어요.
운세는 정해진 미래가 아니라,
흐름을 미리 알고 대비하는 거니까요.

좋은 달엔 적극적으로,
조심할 달엔 한 발 물러서서.

그렇게 한 해를 보내시면,
${name}님의 2026년은 분명 좋은 한 해가 될 거예요.

너무 애쓰지 않아도 괜찮아요.
${name}님은 이미 충분히 잘하고 계세요.

지금까지 케이 사주 페이트메이트였습니다.
좋은 하루, 좋은 한 해 보내세요.

감사합니다.
`;

      return script;
    }
    
    // 스크립트 복사 함수
    function copyScriptToClipboard() {
      if (!result) {
        alert('먼저 사주 분석을 진행해주세요.');
        return;
      }
      
      const userName = prompt('리딩에 사용할 이름을 입력하세요:', '') || '회원';
      const script = generateFullScript(result, userName);
      
      navigator.clipboard.writeText(script).then(() => {
        alert('✅ 스크립트가 클립보드에 복사되었습니다!');
      }).catch(err => {
        // fallback
        const textArea = document.createElement('textarea');
        textArea.value = script;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('✅ 스크립트가 복사되었습니다!');
      });
    }
    
    // 스크립트 다운로드 함수
    function downloadScript() {
      if (!result) {
        alert('먼저 사주 분석을 진행해주세요.');
        return;
      }
      
      const userName = prompt('리딩에 사용할 이름을 입력하세요:', '') || '회원';
      const script = generateFullScript(result, userName);
      
      const blob = new Blob([script], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${userName}_2026_사주리딩_스크립트.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    function render2026Fortune() {
      if (!result) return;
      
      const yearFortune = calculate2026YearFortune();
      const monthFortune = calculate2026MonthFortune(selectedMonth2026);
      const currentMonth = new Date().getMonth() + 1;
      
      const html = `
        <!-- 2026년 헤더 -->
        <div class="fortune-2026-header">
          <div class="fortune-2026-snake">🐍</div>
          <div class="fortune-2026-year">2026 丙午年</div>
          <div class="fortune-2026-title">${result.dmInfo.title}의 2026년</div>
          <div class="fortune-2026-subtitle">${YEAR_2026.theme}</div>
        </div>
        
        <!-- 년운 요약 -->
        <div class="yearly-summary-card">
          <div class="yearly-summary-header">
            <span class="yearly-summary-icon">⭐</span>
            <span class="yearly-summary-title">2026년 총운 (${yearFortune.score}점)</span>
          </div>
          <div class="yearly-summary-content">
            ${yearFortune.analysis.join('<br><br>')}
          </div>
          <div class="lucky-months-section">
            <div class="lucky-months-row">
              <span class="lucky-months-label good">🍀 행운의 달</span>
              <div class="lucky-months-tags">
                ${yearFortune.luckyMonths.map(m => `<span class="lucky-month-tag">${m}월</span>`).join('')}
              </div>
            </div>
            <div class="lucky-months-row">
              <span class="lucky-months-label caution">⚠️ 주의할 달</span>
              <div class="lucky-months-tags">
                ${yearFortune.cautionMonths.map(m => `<span class="caution-month-tag">${m}월</span>`).join('')}
              </div>
            </div>
            <div class="fortune-legend">
              <div class="fortune-legend-item">
                <span class="fortune-legend-dot good"></span>
                <span>🍀 행운의 달 = 오행이 상생하는 달</span>
              </div>
              <div class="fortune-legend-item">
                <span class="fortune-legend-dot caution"></span>
                <span>⚠️ 주의의 달 = 오행이 충돌하는 달</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 월 선택 -->
        <div class="card-label" style="margin-bottom: 12px;">📅 월별 운세</div>
        <div class="month-selector">
          ${Array.from({length: 12}, (_, i) => i + 1).map(m => `
            <button class="month-btn ${m === selectedMonth2026 ? 'active' : ''} ${m === currentMonth ? 'current' : ''}" 
                    onclick="selectMonth2026(${m})">${m}월</button>
          `).join('')}
        </div>
        
        <!-- 분야별 운세 카드 -->
        <div class="fortune-category-grid">
          <div class="fortune-category-card" onclick="showFortuneDetail('love')">
            <div class="fortune-cat-header">
              <span class="fortune-cat-icon">💕</span>
              <span class="fortune-cat-name">애정운</span>
            </div>
            <div class="fortune-cat-score">
              <div class="fortune-cat-bar">
                <div class="fortune-cat-bar-fill ${monthFortune.scores.love >= 75 ? 'high' : monthFortune.scores.love >= 55 ? 'mid' : 'low'}" 
                     style="width: ${monthFortune.scores.love}%"></div>
              </div>
              <span class="fortune-cat-score-num">${monthFortune.scores.love}</span>
            </div>
            <div class="fortune-cat-desc">${monthFortune.details.love.content.slice(0, 120)}...</div>
          </div>
          
          <div class="fortune-category-card" onclick="showFortuneDetail('wealth')">
            <div class="fortune-cat-header">
              <span class="fortune-cat-icon">💰</span>
              <span class="fortune-cat-name">재물운</span>
            </div>
            <div class="fortune-cat-score">
              <div class="fortune-cat-bar">
                <div class="fortune-cat-bar-fill ${monthFortune.scores.wealth >= 75 ? 'high' : monthFortune.scores.wealth >= 55 ? 'mid' : 'low'}" 
                     style="width: ${monthFortune.scores.wealth}%"></div>
              </div>
              <span class="fortune-cat-score-num">${monthFortune.scores.wealth}</span>
            </div>
            <div class="fortune-cat-desc">${monthFortune.details.wealth.content.slice(0, 120)}...</div>
          </div>
          
          <div class="fortune-category-card" onclick="showFortuneDetail('career')">
            <div class="fortune-cat-header">
              <span class="fortune-cat-icon">💼</span>
              <span class="fortune-cat-name">업무운</span>
            </div>
            <div class="fortune-cat-score">
              <div class="fortune-cat-bar">
                <div class="fortune-cat-bar-fill ${monthFortune.scores.career >= 75 ? 'high' : monthFortune.scores.career >= 55 ? 'mid' : 'low'}" 
                     style="width: ${monthFortune.scores.career}%"></div>
              </div>
              <span class="fortune-cat-score-num">${monthFortune.scores.career}</span>
            </div>
            <div class="fortune-cat-desc">${monthFortune.details.career.content.slice(0, 120)}...</div>
          </div>
          
          <div class="fortune-category-card" onclick="showFortuneDetail('social')">
            <div class="fortune-cat-header">
              <span class="fortune-cat-icon">👥</span>
              <span class="fortune-cat-name">대인관계</span>
            </div>
            <div class="fortune-cat-score">
              <div class="fortune-cat-bar">
                <div class="fortune-cat-bar-fill ${monthFortune.scores.social >= 75 ? 'high' : monthFortune.scores.social >= 55 ? 'mid' : 'low'}" 
                     style="width: ${monthFortune.scores.social}%"></div>
              </div>
              <span class="fortune-cat-score-num">${monthFortune.scores.social}</span>
            </div>
            <div class="fortune-cat-desc">${monthFortune.details.social.content.slice(0, 120)}...</div>
          </div>
        </div>
        
        <!-- 상세 운세 (기본: 애정운) -->
        <div id="fortune-detail-area">
          ${renderFortuneDetail('love', monthFortune)}
        </div>
      `;
      
      document.getElementById('fortune-2026-content').innerHTML = html;
    }
    
    function renderFortuneDetail(category, monthFortune) {
      if (!monthFortune) monthFortune = calculate2026MonthFortune(selectedMonth2026);
      
      const icons = { love: '💕', wealth: '💰', career: '💼', social: '👥' };
      const names = { love: '애정운', wealth: '재물운', career: '업무운', social: '대인관계운' };
      const detail = monthFortune.details[category];
      
      return `
        <div class="fortune-detail-card">
          <div class="fortune-detail-header">
            <span class="fortune-detail-icon">${icons[category]}</span>
            <div>
              <div class="fortune-detail-title">${names[category]}</div>
              <div class="fortune-detail-month">${selectedMonth2026}월 상세 운세</div>
            </div>
          </div>
          <div class="fortune-detail-content">
            ${detail.content}
          </div>
          <div class="fortune-detail-tips">
            <div class="fortune-detail-tips-title">💡 이 달의 팁</div>
            <ul class="fortune-detail-tips-list">
              ${detail.tips.map(tip => `<li>${tip}</li>`).join('')}
            </ul>
          </div>
        </div>
      `;
    }
    
    function selectMonth2026(month) {
      selectedMonth2026 = month;
      render2026Fortune();
    }
    
    function showFortuneDetail(category) {
      const monthFortune = calculate2026MonthFortune(selectedMonth2026);
      document.getElementById('fortune-detail-area').innerHTML = renderFortuneDetail(category, monthFortune);
      
      // 카드 활성화 표시
      document.querySelectorAll('.fortune-category-card').forEach(card => card.classList.remove('active'));
      event.currentTarget.classList.add('active');
    }
    
    // ===== v2.91: 궁합 탭 함수들 =====
    function initCompatTab() {
      // 월 선택
      const monthSelect = document.getElementById('compat-month2');
      if (monthSelect && monthSelect.options.length <= 1) {
        monthSelect.innerHTML = '<option value="">선택</option>';
        for (let i = 1; i <= 12; i++) {
          monthSelect.innerHTML += `<option value="${i}">${i}월</option>`;
        }
      }
      
      // 일 선택
      const daySelect = document.getElementById('compat-day2');
      if (daySelect && daySelect.options.length <= 1) {
        daySelect.innerHTML = '<option value="">선택</option>';
        for (let i = 1; i <= 31; i++) {
          daySelect.innerHTML += `<option value="${i}">${i}일</option>`;
        }
      }
      
      // 시 선택
      const hourSelect = document.getElementById('compat-hour2');
      if (hourSelect && hourSelect.options.length <= 1) {
        hourSelect.innerHTML = '<option value="">모름</option>';
        const hourLabels = ['자시 (23:30~01:29)', '축시 (01:30~03:29)', '인시 (03:30~05:29)', 
          '묘시 (05:30~07:29)', '진시 (07:30~09:29)', '사시 (09:30~11:29)',
          '오시 (11:30~13:29)', '미시 (13:30~15:29)', '신시 (15:30~17:29)',
          '유시 (17:30~19:29)', '술시 (19:30~21:29)', '해시 (21:30~23:29)'];
        hourLabels.forEach((label, i) => {
          hourSelect.innerHTML += `<option value="${i}">${label}</option>`;
        });
      }
    }
    
    function showCompatTabInput() {
      document.getElementById('compat-tab-input').style.display = 'block';
      document.getElementById('compat-tab-result').style.display = 'none';
    }
    
    function analyzeCompatibilityTab() {
      // 궁합 탭에서 분석 (기존 analyzeCompatibility 로직 재사용)
      let year = parseInt(document.getElementById('compat-year2').value);
      let month = parseInt(document.getElementById('compat-month2').value);
      let day = parseInt(document.getElementById('compat-day2').value);
      const hourVal = document.getElementById('compat-hour2').value;
      const hour = hourVal === '' ? -1 : parseInt(hourVal);
      const gender = document.getElementById('compat-gender2').value;
      const mbti = document.getElementById('compat-mbti2').value;
      const partnerName = document.getElementById('compat-name2').value || '상대방';
      
      // 유효성 검사
      if (!year || !month || !day) {
        document.getElementById('compat-error2').textContent = '생년월일을 모두 입력해주세요.';
        return;
      }
      if (year < 1920 || year > 2024) {
        document.getElementById('compat-error2').textContent = '유효한 연도를 입력해주세요.';
        return;
      }
      
      // v2.91: 내 사주가 없으면 경고
      if (!result) {
        document.getElementById('compat-error2').innerHTML = '⚠️ 먼저 <strong>내 분석</strong> 탭에서 본인 사주를 분석해주세요!';
        return;
      }
      
      // v2.91: 음력 → 양력 변환
      if (compatCalendarType === 'lunar') {
        const converted = convertLunarToSolar(year, month, day);
        if (converted.success) {
          year = converted.year;
          month = converted.month;
          day = converted.day;
        } else {
          document.getElementById('compat-error2').textContent = '음력 날짜 변환에 실패했습니다.';
          return;
        }
      }
      
      document.getElementById('compat-error2').textContent = '';
      
      // 상대방 사주 계산 (기존 calculate 로직 일부 사용)
      const partnerResult = calculatePartnerSaju(year, month, day, hour, gender, mbti);
      
      // 궁합 분석
      const compat = analyzeCompatibilityResult(result, partnerResult, selectedRelation);
      
      // 결과 렌더링
      renderCompatTabResult(compat, partnerName, partnerResult);
    }
    
    function calculatePartnerSaju(year, month, day, hour, gender, mbti) {
      // 간소화된 사주 계산 (기존 calculate 함수의 핵심 로직)
      const baseYear = 1984;
      const stemOffset = (year - baseYear) % 10;
      const branchOffset = (year - baseYear) % 12;
      const yStem = (stemOffset + 10) % 10;
      const yBranch = (branchOffset + 12) % 12;
      
      // 월주 계산
      const monthStemBase = (yStem % 5) * 2;
      const mStem = (monthStemBase + month - 1 + 10) % 10;
      const mBranch = (month + 1) % 12;
      
      // 일주 계산
      const y = year, m = month, d = day;
      const a = Math.floor((14 - m) / 12);
      const yy = y - a;
      const mm = m + 12 * a - 2;
      const jd = d + Math.floor((13 * mm - 1) / 5) + 365 * yy + Math.floor(yy / 4) - Math.floor(yy / 100) + Math.floor(yy / 400) + 1721059;
      const dStem = (jd + 9) % 10;
      const dBranch = (jd + 1) % 12;
      
      // 시주 계산 - v2.92: 30분 기준 시진 계산
      let hStem, hBranch;
      if (hour === -1) {
        hStem = 0;
        hBranch = 0;
      } else {
        // 30분 기준: 자시 23:30~01:29, 축시 01:30~03:29, ...
        const hourIndex = Math.floor((hour + 0.5) / 2) % 12;
        hBranch = hourIndex;
        hStem = (dStem * 2 + hourIndex) % 10;
      }
      
      // 오행 분석
      const sajuElements = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
      [yStem, mStem, dStem, hStem].forEach(s => sajuElements[STEMS[s].element] += 1);
      [yBranch, mBranch, dBranch, hBranch].forEach(b => sajuElements[BRANCHES[b].element] += 1);
      
      const sorted = Object.entries(sajuElements).sort((a, b) => b[1] - a[1]);
      const dominant = sorted[0][0];
      
      // 십성 계산
      const dayStemElement = STEMS[dStem].element;
      const dayStemYin = dStem % 2 === 1;
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      const generatedBy = { wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal' };
      const controlledBy = { wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth' };
      
      const sipseong = {
        '비견': 0, '겁재': 0, '식신': 0, '상관': 0, '정재': 0, '편재': 0,
        '정관': 0, '편관': 0, '정인': 0, '편인': 0
      };
      
      [yStem, mStem, hStem].forEach(stemIdx => {
        const stemElement = STEMS[stemIdx].element;
        const stemYin = stemIdx % 2 === 1;
        const sameYinYang = dayStemYin === stemYin;
        
        if (stemElement === dayStemElement) sipseong[sameYinYang ? '비견' : '겁재']++;
        else if (stemElement === generating[dayStemElement]) sipseong[sameYinYang ? '식신' : '상관']++;
        else if (stemElement === controlling[dayStemElement]) sipseong[sameYinYang ? '편재' : '정재']++;
        else if (stemElement === controlledBy[dayStemElement]) sipseong[sameYinYang ? '편관' : '정관']++;
        else if (stemElement === generatedBy[dayStemElement]) sipseong[sameYinYang ? '편인' : '정인']++;
      });
      
      const dmKey = STEMS[dStem].hanja + BRANCHES[dBranch].hanja;
      const dmInfo = DAY_MASTERS[dmKey] || { title: "🔮 특별한 기운", traits: "희귀한 조합" };
      
      return {
        pillars: {
          year: { stem: yStem, branch: yBranch },
          month: { stem: mStem, branch: mBranch },
          day: { stem: dStem, branch: dBranch },
          hour: { stem: hStem, branch: hBranch }
        },
        sajuElements, dominant, dmKey, dmInfo, gender, mbti,
        mbtiData: mbti ? MBTI_DATA[mbti] : null,
        sipseong,
        dayStemIndex: dStem
      };
    }
    
    // v2.91: 궁합 분석 결과 변환 (calculateCompatibility 래핑)
    function analyzeCompatibilityResult(me, partner, relation) {
      // 기존 calculateCompatibility 함수 호출
      const compat = calculateCompatibility(me, partner, relation);
      
      // renderCompatTabResult에서 사용하는 형식으로 변환
      return {
        totalScore: compat.total,
        scores: {
          element: {
            score: compat.scores.element.score,
            myEl: compat.scores.element.myEl,
            partnerEl: compat.scores.element.partnerEl,
            desc: compat.scores.element.desc
          },
          dayMaster: {
            score: compat.scores.dayMaster.score,
            myStem: STEMS[me.pillars.day.stem].hanja,
            partnerStem: STEMS[partner.pillars.day.stem].hanja,
            desc: compat.scores.dayMaster.desc,
            tags: compat.scores.dayMaster.tags || []
          },
          mbti: {
            score: compat.scores.mbti.score,
            desc: compat.scores.mbti.desc,
            synergies: compat.scores.mbti.synergies || [],
            conflicts: compat.scores.mbti.conflicts || []
          },
          sipseong: {
            score: compat.scores.sipseong.score,
            desc: compat.scores.sipseong.desc
          }
        },
        advice: compat.advice
      };
    }
    
    function renderCompatTabResult(compat, partnerName, partnerResult) {
      const myName = '나';
      
      const html = `
        <!-- 총점 헤더 -->
        <div class="fortune-2026-header" style="background: linear-gradient(135deg, ${compat.totalScore >= 80 ? '#1a3a2e, #163e2e' : compat.totalScore >= 60 ? '#3a2e1a, #3e3616' : '#3a1a1a, #3e1616'});">
          <div style="font-size: 48px; margin-bottom: 12px;">${compat.totalScore >= 80 ? '💕' : compat.totalScore >= 60 ? '💛' : '💔'}</div>
          <div class="fortune-2026-title">${myName} × ${partnerName}</div>
          <div style="font-size: 36px; font-weight: 700; color: ${compat.totalScore >= 80 ? '#22c55e' : compat.totalScore >= 60 ? '#fbbf24' : '#ef4444'}; margin: 16px 0;">${compat.totalScore}점</div>
          <div class="fortune-2026-subtitle">${compat.totalScore >= 80 ? '환상의 궁합! 서로를 더욱 빛나게 합니다' : compat.totalScore >= 60 ? '좋은 궁합! 노력하면 더 좋아질 수 있어요' : '조심해야 할 부분이 있어요. 이해와 배려가 필요합니다'}</div>
        </div>
        
        <!-- 오행 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">🔥</span>
            <span class="compat-section-title">오행 궁합</span>
            <span class="compat-section-score">${compat.scores.element.score}점</span>
          </div>
          <div class="compat-element-grid">
            <div class="compat-element-box">
              <div class="compat-element-icon">${ELEMENTS[compat.scores.element.myEl].icon}</div>
              <div class="compat-element-name">${ELEMENTS[compat.scores.element.myEl].name}</div>
            </div>
            <div class="compat-element-arrow ${compat.scores.element.score >= 70 ? 'good' : compat.scores.element.score >= 50 ? 'neutral' : 'bad'}">
              ${compat.scores.element.score >= 70 ? '💕' : compat.scores.element.score >= 50 ? '↔️' : '⚡'}
            </div>
            <div class="compat-element-box">
              <div class="compat-element-icon">${ELEMENTS[compat.scores.element.partnerEl].icon}</div>
              <div class="compat-element-name">${ELEMENTS[compat.scores.element.partnerEl].name}</div>
            </div>
          </div>
          <div class="compat-section-content">${compat.scores.element.desc}</div>
        </div>
        
        <!-- 일주 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">💫</span>
            <span class="compat-section-title">일주 궁합</span>
            <span class="compat-section-score">${compat.scores.dayMaster.score}점</span>
          </div>
          <div class="compat-section-content">
            ${myName}의 일간 <em>${compat.scores.dayMaster.myStem}</em> × ${partnerName}의 일간 <em>${compat.scores.dayMaster.partnerStem}</em>
            <br><br>
            ${compat.scores.dayMaster.desc}
          </div>
          ${compat.scores.dayMaster.tags?.length ? `
          <div class="compat-tags">
            ${compat.scores.dayMaster.tags.map(t => `<span class="compat-tag ${t.type}">${t.text}</span>`).join('')}
          </div>` : ''}
        </div>
        
        <!-- MBTI 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">🧠</span>
            <span class="compat-section-title">MBTI 궁합</span>
            <span class="compat-section-score">${compat.scores.mbti.score}점</span>
          </div>
          <div class="compat-section-content">
            ${result.mbti && partnerResult.mbti ? 
              `<em>${result.mbti}</em> × <em>${partnerResult.mbti}</em><br><br>${compat.scores.mbti.desc}` :
              compat.scores.mbti.desc
            }
          </div>
          ${compat.scores.mbti.synergies?.length || compat.scores.mbti.conflicts?.length ? `
          <div class="compat-tags">
            ${(compat.scores.mbti.synergies || []).map(s => `<span class="compat-tag good">✓ ${s}</span>`).join('')}
            ${(compat.scores.mbti.conflicts || []).map(c => `<span class="compat-tag bad">! ${c}</span>`).join('')}
          </div>` : ''}
        </div>
        
        <!-- 십성 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">⭐</span>
            <span class="compat-section-title">십성 관계 분석</span>
            <span class="compat-section-score">${compat.scores.sipseong.score}점</span>
          </div>
          <div class="compat-section-content">${compat.scores.sipseong.desc}</div>
        </div>
        
        <!-- 종합 조언 -->
        <div class="compat-advice-box">
          <div class="compat-advice-title">💝 종합 조언</div>
          <div class="compat-advice-content">${compat.advice.summary}</div>
        </div>
        
        <div class="compat-section" style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(34,197,94,0.2);">
            <span class="compat-section-icon">💚</span>
            <span class="compat-section-title" style="color: #22c55e;">잘 맞는 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.strengths.map(s => `<div style="margin-bottom: 8px;">${s}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(251,191,36,0.2);">
            <span class="compat-section-icon">⚠️</span>
            <span class="compat-section-title" style="color: #fbbf24;">조심해야 할 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.cautions.map(c => `<div style="margin-bottom: 8px;">${c}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(96,165,250,0.1); border: 1px solid rgba(96,165,250,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(96,165,250,0.2);">
            <span class="compat-section-icon">💡</span>
            <span class="compat-section-title" style="color: #60a5fa;">맞춰가면 좋은 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.tips.map(t => `<div style="margin-bottom: 8px;">${t}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(239,68,68,0.2);">
            <span class="compat-section-icon">🚫</span>
            <span class="compat-section-title" style="color: #ef4444;">하지 말아야 할 것</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.doNot.map(d => `<div style="margin-bottom: 8px;">${d}</div>`).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('compat-tab-result-content').innerHTML = html;
      document.getElementById('compat-tab-input').style.display = 'none';
      document.getElementById('compat-tab-result').style.display = 'block';
    }

    // ===== HISTORY =====
    const HISTORY_KEY = 'k-saju-kr-history-v2';
    const MAX_HISTORY = 3;

    function getHistory() {
      try { return JSON.parse(localStorage.getItem(HISTORY_KEY)) || []; } 
      catch (e) { return []; }
    }

    function saveToHistory(resultData, birthInfo) {
      const history = getHistory();
      history.unshift({
        id: Date.now(), savedAt: new Date().toISOString(), birthInfo,
        dmKey: resultData.dmKey, dmTitle: resultData.dmInfo.title,
        dominant: resultData.dominant, mbti: resultData.mbti, gender: resultData.gender,
        result: resultData
      });
      while (history.length > MAX_HISTORY) history.pop();
      localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
      renderHistory();
    }

    function deleteFromHistory(id) {
      let history = getHistory().filter(h => h.id !== id);
      localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
      renderHistory();
    }

    function loadFromHistory(id) {
      const h = getHistory().find(h => h.id === id);
      if (h) { result = h.result; renderResult(); showScreen('result'); }
    }

    function renderHistory() {
      const list = document.getElementById('history-list');
      const history = getHistory();
      if (!history.length) {
        list.innerHTML = '<div class="history-empty">저장된 기록이 없습니다</div>';
        return;
      }
      list.innerHTML = history.map(h => {
        const elIcon = ELEMENTS[h.dominant]?.icon || '🔮';
        const birthStr = `${h.birthInfo.year}.${h.birthInfo.month}.${h.birthInfo.day}`;
        const genderIcon = h.gender === 'm' ? '👨' : h.gender === 'f' ? '👩' : '';
        const mbtiStr = h.mbti ? ` • ${h.mbti}` : '';
        return `
          <div class="history-item" onclick="loadFromHistory(${h.id})">
            <div class="history-info">
              <div class="history-dm">${genderIcon} ${h.dmKey}</div>
              <div class="history-date">🎂 ${birthStr}${mbtiStr}</div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="history-element">${elIcon}</span>
              <button class="history-delete" onclick="event.stopPropagation();deleteFromHistory(${h.id})">🗑️</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // ===== CALCULATION =====
    function getSolarTermBranch(year, month, day) {
      const terms = [
        { m: 0, d: 6, b: 1 }, { m: 1, d: 4, b: 2 }, { m: 2, d: 6, b: 3 },
        { m: 3, d: 5, b: 4 }, { m: 4, d: 6, b: 5 }, { m: 5, d: 6, b: 6 },
        { m: 6, d: 7, b: 7 }, { m: 7, d: 8, b: 8 }, { m: 8, d: 8, b: 9 },
        { m: 9, d: 8, b: 10 }, { m: 10, d: 7, b: 11 }, { m: 11, d: 7, b: 0 }
      ];
      const birth = new Date(year, month - 1, day);
      for (let i = terms.length - 1; i >= 0; i--) {
        if (birth >= new Date(year, terms[i].m, terms[i].d)) return terms[i].b;
      }
      return 0;
    }

    function calculate() {
      let y = parseInt(document.getElementById('year').value);
      let m = parseInt(document.getElementById('month').value);
      let d = parseInt(document.getElementById('day').value);
      let h = parseInt(document.getElementById('hour').value);
      const mbti = document.getElementById('mbti').value;
      
      // v2.91: 음력 → 양력 변환
      if (calendarType === 'lunar') {
        const converted = convertLunarToSolar(y, m, d);
        if (converted.success) {
          y = converted.year;
          m = converted.month;
          d = converted.day;
        } else {
          alert('음력 날짜 변환에 실패했습니다. 날짜를 확인해주세요.');
          return;
        }
      }
      
      const unknownHour = (h === -1);
      if (unknownHour) h = 12;

      // 사주 계산
      const adjYear = new Date(y, m - 1, d) < new Date(y, 1, 4) ? y - 1 : y;
      const yStem = ((adjYear - 4) % 10 + 10) % 10;
      const yBranch = ((adjYear - 4) % 12 + 12) % 12;
      const mBranch = getSolarTermBranch(y, m, d);
      const mStem = (((yStem % 5) * 2 + 2) + ((mBranch - 2 + 12) % 12)) % 10;
      const base = Date.UTC(1900, 0, 1);
      const birth = Date.UTC(y, m - 1, d);
      const days = Math.floor((birth - base) / 86400000);
      const dStem = ((days % 10) + 10) % 10;
      const dBranch = ((days + 10) % 12 + 12) % 12;
      // v2.92: 30분 기준 시진 계산 (한국 표준시 보정)
      // 자시 23:30~01:29, 축시 01:30~03:29, ... 미시 13:30~15:29 ...
      const hBranch = Math.floor((h + 0.5) / 2) % 12;
      const hStem = ((dStem % 5) * 2 + hBranch) % 10;

      // 사주 오행
      const sajuElements = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
      [yStem, mStem, dStem, hStem].forEach(i => sajuElements[STEMS[i].element]++);
      [yBranch, mBranch, dBranch, hBranch].forEach(i => sajuElements[BRANCHES[i].element]++);
      
      // 한글 오행 키로도 저장 (v2.5 이중분석용)
      const elementAnalysis = {
        elements: {
          '목': sajuElements.wood,
          '화': sajuElements.fire,
          '토': sajuElements.earth,
          '금': sajuElements.metal,
          '수': sajuElements.water
        }
      };
      
      // ===== v2.5: 십성 계산 =====
      const dayStemElement = STEMS[dStem].element;
      const dayStemYin = dStem % 2 === 1; // 홀수 인덱스 = 음
      
      // 오행 상생상극 매핑
      const elementOrder = ['wood', 'fire', 'earth', 'metal', 'water'];
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      const generatedBy = { wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal' };
      const controlledBy = { wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth' };
      
      // 십성 초기화
      const sipseong = {
        '비견': 0, '겁재': 0,  // 비겁 (같은 오행)
        '식신': 0, '상관': 0,  // 식상 (내가 생하는)
        '정재': 0, '편재': 0,  // 재성 (내가 극하는)
        '정관': 0, '편관': 0,  // 관성 (나를 극하는)
        '정인': 0, '편인': 0   // 인성 (나를 생하는)
      };
      
      // 각 천간에 대해 십성 계산
      [yStem, mStem, hStem].forEach(stemIdx => {
        const stemElement = STEMS[stemIdx].element;
        const stemYin = stemIdx % 2 === 1;
        const sameYinYang = (dayStemYin === stemYin);
        
        if (stemElement === dayStemElement) {
          // 비겁
          sipseong[sameYinYang ? '비견' : '겁재']++;
        } else if (stemElement === generating[dayStemElement]) {
          // 식상 (내가 생하는)
          sipseong[sameYinYang ? '식신' : '상관']++;
        } else if (stemElement === controlling[dayStemElement]) {
          // 재성 (내가 극하는)
          sipseong[sameYinYang ? '편재' : '정재']++;
        } else if (stemElement === controlledBy[dayStemElement]) {
          // 관성 (나를 극하는)
          sipseong[sameYinYang ? '편관' : '정관']++;
        } else if (stemElement === generatedBy[dayStemElement]) {
          // 인성 (나를 생하는)
          sipseong[sameYinYang ? '편인' : '정인']++;
        }
      });
      
      // 지지도 간단히 계산 (지지의 본기 오행 기준)
      [yBranch, mBranch, dBranch, hBranch].forEach(branchIdx => {
        const branchElement = BRANCHES[branchIdx].element;
        // 지지는 음양 판별이 복잡하므로 편/정 구분 없이 분포만 체크
        if (branchElement === dayStemElement) {
          sipseong['비견']++;
        } else if (branchElement === generating[dayStemElement]) {
          sipseong['식신']++;
        } else if (branchElement === controlling[dayStemElement]) {
          sipseong['편재']++;
        } else if (branchElement === controlledBy[dayStemElement]) {
          sipseong['편관']++;
        } else if (branchElement === generatedBy[dayStemElement]) {
          sipseong['편인']++;
        }
      });
      
      // MBTI 오행
      let mbtiElements = null;
      let mbtiData = null;
      let chemistry = null;
      
      if (mbti && MBTI_DATA[mbti]) {
        mbtiData = MBTI_DATA[mbti];
        const mbtiMap = mbtiData.elements;
        mbtiElements = {
          wood: mbtiMap.목 * 8, fire: mbtiMap.화 * 8, earth: mbtiMap.토 * 8,
          metal: mbtiMap.금 * 8, water: mbtiMap.수 * 8
        };
        chemistry = analyzeChemistry(sajuElements, mbtiElements, STEMS[dStem], BRANCHES[dBranch], mbtiData);
      }
      
      const allElements = mbtiElements ? {
        wood: sajuElements.wood * 0.6 + mbtiElements.wood * 0.4,
        fire: sajuElements.fire * 0.6 + mbtiElements.fire * 0.4,
        earth: sajuElements.earth * 0.6 + mbtiElements.earth * 0.4,
        metal: sajuElements.metal * 0.6 + mbtiElements.metal * 0.4,
        water: sajuElements.water * 0.6 + mbtiElements.water * 0.4
      } : sajuElements;
      
      const sorted = Object.entries(allElements).sort((a, b) => b[1] - a[1]);
      const dominant = sorted[0][0];
      const weak = sorted[sorted.length - 1][0];

      const dmKey = STEMS[dStem].hanja + BRANCHES[dBranch].hanja;
      const dmInfo = DAY_MASTERS[dmKey] || { title: "🔮 특별한 기운", traits: "희귀한 조합 • 독특한 에너지" };
      
      const today = new Date();
      const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);

      const dirMap = { wood: '동쪽', fire: '남쪽', earth: '중앙', metal: '서쪽', water: '북쪽' };
      const colorMap = {
        wood: { colors: ['#22c55e', '#16a34a'], name: '초록' },
        fire: { colors: ['#ef4444', '#f97316'], name: '빨강/주황' },
        earth: { colors: ['#eab308', '#ca8a04'], name: '노랑/갈색' },
        metal: { colors: ['#f8fafc', '#94a3b8'], name: '흰색/은색' },
        water: { colors: ['#3b82f6', '#1e40af'], name: '파랑/검정' }
      };
      
      const LUCKY_NUM_SETS = [
        { nums: [3, 8, 33] }, { nums: [5, 9, 59] }, { nums: [6, 16, 36] },
        { nums: [9, 19, 39] }, { nums: [2, 22, 26] }, { nums: [7, 17, 27] },
        { nums: [8, 18, 48] }, { nums: [1, 11, 21] }, { nums: [4, 14, 44] }
      ];
      const luckySet = LUCKY_NUM_SETS[(dStem + today.getDate()) % LUCKY_NUM_SETS.length];

      result = {
        pillars: {
          year: { stem: yStem, branch: yBranch },
          month: { stem: mStem, branch: mBranch },
          day: { stem: dStem, branch: dBranch },
          hour: { stem: hStem, branch: hBranch }
        },
        sajuElements, mbtiElements, dominant, weak, dmKey, dmInfo,
        mbti, mbtiData, chemistry, gender: selectedGender,
        dayStemIndex: dStem, // B안: 조합 라벨용
        sipseong, // v2.5: 십성 분석
        elementAnalysis, // v2.5: 한글 오행 분석
        todayTip: ENERGY_TIPS[dayOfYear % ENERGY_TIPS.length],
        dailyCaution: CAUTIONS[dayOfYear % CAUTIONS.length],
        luckyNums: luckySet.nums,
        luckyColors: colorMap[dominant],
        direction: dirMap[dominant],
        unknownHour,
        message: MESSAGES[Math.floor(Math.random() * MESSAGES.length)]
      };
      
      // v2.92: 건강 리스크 분석 추가
      result.healthRisk = analyzeHealthRisk(result);

      saveToHistory(result, { year: y, month: m, day: d, hour: h });
      renderResult();
      showScreen('result');
    }

    // ===== CHEMISTRY ANALYSIS =====
    function analyzeChemistry(sajuEl, mbtiEl, dayStem, dayBranch, mbtiData) {
      // 일주 이름 (천간 첫글자 + 지지)
      const dayMasterName = dayStem.name.charAt(0) + dayBranch.name;
      
      // 주요 오행 비교
      const sajuDominant = Object.entries(sajuEl).sort((a,b) => b[1] - a[1])[0][0];
      const mbtiDominant = Object.entries(mbtiEl).sort((a,b) => b[1] - a[1])[0][0];
      
      // 오행 상생상극 관계
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      
      let score = 60; // 기본 점수
      const synergies = [];
      const conflicts = [];
      
      // 같은 오행이면 시너지
      if (sajuDominant === mbtiDominant) {
        score += 20;
        synergies.push(`${ELEMENTS[sajuDominant].name} 기운이 강화되어 특성이 배가됩니다`);
      }
      
      // 상생 관계
      if (generating[sajuDominant] === mbtiDominant) {
        score += 15;
        synergies.push(`사주가 MBTI를 도와 성장을 촉진합니다`);
      }
      if (generating[mbtiDominant] === sajuDominant) {
        score += 15;
        synergies.push(`MBTI가 사주의 잠재력을 끌어냅니다`);
      }
      
      // 상극 관계
      if (controlling[sajuDominant] === mbtiDominant) {
        score -= 10;
        conflicts.push(`내면의 충돌이 있을 수 있어요`);
      }
      if (controlling[mbtiDominant] === sajuDominant) {
        score -= 10;
        conflicts.push(`본능과 성격 사이 갈등 가능`);
      }
      
      // 사주 일간 특성과 MBTI 연결
      if (dayStem.yinyang === 'yang' && mbtiData.name.includes('활동가')) {
        score += 10;
        synergies.push(`양(陽) 기운과 활동적 성향이 잘 맞아요`);
      }
      if (dayStem.element === 'water' && (mbtiData.elements.수 > 0.25)) {
        score += 10;
        synergies.push(`물의 직관력이 두 배로 강해집니다`);
      }
      if (dayStem.element === 'fire' && (mbtiData.elements.화 > 0.25)) {
        score += 10;
        synergies.push(`불의 열정이 폭발적으로 발휘됩니다`);
      }
      
      // 부족한 오행 보완
      const sajuWeak = Object.entries(sajuEl).sort((a,b) => a[1] - b[1])[0][0];
      if (mbtiEl[sajuWeak] > 1.5) {
        score += 10;
        synergies.push(`MBTI가 사주에서 부족한 ${ELEMENTS[sajuWeak].name} 기운을 보완합니다`);
      }
      
      score = Math.min(100, Math.max(0, score));
      
      // 종합 인사이트 생성
      let insight = '';
      if (score >= 85) {
        insight = `${mbtiData.name} 성격과 ${dayMasterName} 일주가 환상의 조합입니다! 타고난 강점이 두 배로 발휘될 수 있어요.`;
      } else if (score >= 70) {
        insight = `${mbtiData.name}의 ${mbtiData.keyword}가 ${dayMasterName}의 기운과 잘 어울립니다. 서로 보완하며 성장할 수 있어요.`;
      } else if (score >= 50) {
        insight = `${mbtiData.name}와 ${dayMasterName}은 다른 색깔을 가지고 있어요. 이 다양성이 오히려 강점이 될 수 있습니다.`;
      } else {
        insight = `내면에 서로 다른 에너지가 있어요. 이 긴장감을 창의적으로 활용하면 독특한 강점이 됩니다.`;
      }
      
      return { score, synergies, conflicts, insight, sajuDominant, mbtiDominant };
    }

    // ===== B안: 조합 라벨 가져오기 =====
    function getComboLabel(mbti, stemIndex) {
      const key = `${mbti}_${stemIndex}`;
      return COMBO_LABELS[key] || { 
        label: "독특한 조합", 
        tagline: "당신만의 특별한 에너지" 
      };
    }

    // ===== B안: 프리미엄 티저 힌트 생성 =====
    function getPremiumHints(r) {
      const el = ELEMENTS[r.dominant];
      const stemName = STEMS[r.dayStemIndex].name;
      
      return {
        beauty: {
          icon: '💄', title: '뷰티',
          hint: `${el.name} 기운에 맞는 컬러는...`,
          full: `${el.name} 톤 메이크업 추천`
        },
        health: {
          icon: '🏥', title: '건강',
          hint: `${stemName}은 특히 ○○에 주의가 필요해요`,
          full: '체질별 건강 관리법'
        },
        fashion: {
          icon: '👗', title: '패션',
          hint: `당신에게 어울리는 스타일은 ○○계열`,
          full: '오행별 스타일링 가이드'
        },
        shopping: {
          icon: '🛍️', title: '쇼핑',
          hint: `이번 달 소비 운이 가장 좋은 날은...`,
          full: '월별 소비 길일'
        },
        invest: {
          icon: '📈', title: '투자',
          hint: `${el.name} 기운에 맞는 투자 타이밍은...`,
          full: '오행별 투자 전략'
        }
      };
    }

    // ===== RENDER =====
    function renderResult() {
      const r = result;
      const p = r.pillars;
      const today = new Date();
      document.getElementById('result-date').textContent = 
        `${today.getFullYear()}.${today.getMonth()+1}.${today.getDate()} 분석`;

      let html = '';
      
      // ===== B안 핵심: 유형 카드 (MBTI 입력 시에만) =====
      // v2.94: CHEMISTRY_DB 연동
      if (r.mbti && r.chemistry) {
        const combo = getComboLabel(r.mbti, r.dayStemIndex);
        const chemKey = `${r.mbti}_${r.dayStemIndex}`;
        const chemData = CHEMISTRY_DB[chemKey] || { score: r.chemistry.score, grade: 'B', title: combo.label, subtitle: combo.tagline, advice: '서로를 이해하며 성장하세요.' };
        const gradeColor = GRADE_COLORS[chemData.grade] || '#6495ED';
        const rankText = chemData.score >= 90 ? '상위 5%' : chemData.score >= 80 ? '상위 20%' : chemData.score >= 70 ? '상위 40%' : chemData.score >= 60 ? '상위 60%' : '상위 80%';
        
        html += `
          <div class="identity-card">
            <div class="identity-badge">YOUR TYPE</div>
            <div class="identity-label">⭐ ${chemData.title} ⭐</div>
            <div class="identity-combo">
              <span class="identity-combo-item">${r.mbti}</span>
              <span>×</span>
              <span class="identity-combo-item">${STEMS[r.dayStemIndex].name}</span>
            </div>
            <div class="identity-tagline">"${chemData.subtitle}"</div>
            <div class="identity-score">
              <span class="identity-score-label">케미 점수</span>
              <span class="identity-score-value" style="color:${gradeColor}">${chemData.score}</span>
              <span class="identity-score-max">/ 100</span>
            </div>
            <div style="display:flex; align-items:center; justify-content:center; gap:12px; margin-top:12px;">
              <span style="background:${gradeColor}; color:#000; padding:4px 12px; border-radius:20px; font-weight:bold; font-size:14px;">${chemData.grade} 등급</span>
              <span style="color:var(--text-secondary); font-size:12px;">160개 조합 중 ${rankText}</span>
            </div>
            <div style="margin-top:16px; padding:12px; background:rgba(255,215,0,0.1); border-radius:10px; font-size:13px; color:var(--text-secondary); line-height:1.6;">
              💡 <strong style="color:var(--accent);">핵심 조언:</strong> ${chemData.advice}
            </div>
            <button onclick="openChemistryReport()" style="margin-top:16px; width:100%; padding:14px; background:linear-gradient(135deg, #667eea, #764ba2); border:none; border-radius:12px; color:#fff; font-size:14px; font-weight:bold; cursor:pointer; transition:transform 0.2s;">
              📄 상세 케미 리포트 보기
            </button>
          </div>
        `;
      }

      // 오늘의 메시지
      html += `
        <div class="card">
          <div class="card-label">✨ 오늘의 메시지</div>
          <div class="card-header">
            <div class="message-text">"${r.message}"</div>
            <button class="refresh-btn" onclick="refreshMessage()">🔄</button>
          </div>
          <div class="element-badge">
            <span class="element-hanja">${ELEMENTS[r.dominant].icon}</span>
            <span class="element-name">${ELEMENTS[r.dominant].name}(${ELEMENTS[r.dominant].hanja}) 기운이 강한 날</span>
          </div>
        </div>
      `;

      // MBTI 케미 분석 (핵심 차별화!)
      if (r.mbti && r.chemistry) {
        html += `
          <div class="chemistry-card">
            <div class="chemistry-header">
              <span class="chemistry-icon">🧬</span>
              <span class="chemistry-title">MBTI × 사주 케미 분석</span>
              <span class="chemistry-badge">NEW</span>
            </div>
            
            <div class="chemistry-main">
              <div class="chemistry-type">
                <div class="chemistry-type-label">🧠 MBTI</div>
                <div class="chemistry-type-value">${r.mbti}</div>
                <div class="chemistry-type-sub">${r.mbtiData.name}</div>
              </div>
              <div class="chemistry-vs">×</div>
              <div class="chemistry-type">
                <div class="chemistry-type-label">🔮 사주 일주</div>
                <div class="chemistry-type-value">${r.dmKey}</div>
                <div class="chemistry-type-sub">${STEMS[p.day.stem].name.charAt(0)}${BRANCHES[p.day.branch].name}</div>
              </div>
            </div>
            
            <div class="chemistry-score">
              <div class="chemistry-score-label">조화도</div>
              <div class="chemistry-score-value">${r.chemistry.score}</div>
              <div class="chemistry-score-bar">
                <div class="chemistry-score-fill" style="width:${r.chemistry.score}%"></div>
              </div>
            </div>
            
            <div class="chemistry-insight">
              <div class="chemistry-insight-title">💡 케미 인사이트</div>
              <div class="chemistry-insight-text">${r.chemistry.insight}</div>
            </div>
            
            <div class="synergy-conflict">
              <div class="synergy-box">
                <div class="synergy-title">✨ 시너지</div>
                ${r.chemistry.synergies.slice(0,2).map(s => `<div class="synergy-item">• ${s}</div>`).join('')}
              </div>
              <div class="conflict-box">
                <div class="conflict-title">⚠️ 주의점</div>
                ${r.chemistry.conflicts.length ? 
                  r.chemistry.conflicts.slice(0,2).map(c => `<div class="conflict-item">• ${c}</div>`).join('') :
                  '<div class="conflict-item">• 특별한 충돌이 없어요!</div>'}
              </div>
            </div>
          </div>
          
          <!-- MBTI vs 사주 비교 -->
          <div class="comparison-card">
            <div class="card-label">🔍 MBTI가 보는 나 vs 사주가 보는 나</div>
            <div class="comparison-header">
              <div class="comparison-col">
                <div class="comparison-col-icon">🧠</div>
                <div class="comparison-col-title">MBTI</div>
              </div>
              <div class="comparison-col">
                <div style="font-size:20px;">⚡</div>
              </div>
              <div class="comparison-col">
                <div class="comparison-col-icon">🔮</div>
                <div class="comparison-col-title">사주</div>
              </div>
            </div>
            <div class="comparison-row">
              <div class="comparison-label">주요 기운</div>
              <div class="comparison-value mbti">${ELEMENTS[r.chemistry.mbtiDominant].icon} ${ELEMENTS[r.chemistry.mbtiDominant].name}</div>
              <div class="comparison-label"></div>
              <div class="comparison-value saju">${ELEMENTS[r.chemistry.sajuDominant].icon} ${ELEMENTS[r.chemistry.sajuDominant].name}</div>
            </div>
            <div class="comparison-row">
              <div class="comparison-label">성향</div>
              <div class="comparison-value mbti">${r.mbtiData.traits.split(', ').join(',<br>')}</div>
              <div class="comparison-label"></div>
              <div class="comparison-value saju">${STEMS[p.day.stem].personality.split(', ').join(',<br>')}</div>
            </div>
            <div class="comparison-row">
              <div class="comparison-label">스타일</div>
              <div class="comparison-value mbti">${r.mbtiData.style.split(', ').join(',<br>')}</div>
              <div class="comparison-label"></div>
              <div class="comparison-value saju">${STEMS[p.day.stem].strength.split(', ').join(',<br>')}</div>
            </div>
            <div class="comparison-conclusion">
              <div class="comparison-conclusion-title">💫 진짜 나는?</div>
              <div class="comparison-conclusion-text">${generateRealMeInsight(r)}</div>
            </div>
          </div>
        `;
        
        // ===== v2.5: 이중 분석 (Deep Dive) =====
        html += renderDeepDive(r);
        
        // ===== v2.5: 충돌/시너지 분석 =====
        html += renderPatterns(r);
      }

      html += `
        <!-- 일주 -->
        <div class="daymaster-card" onclick="openDmModal()">
          <div class="card-label">🌟 일주 (日柱)</div>
          <div class="daymaster-hanja">${r.dmKey}</div>
          <div class="daymaster-title">${r.dmInfo.title}</div>
          <div class="daymaster-traits">${r.dmInfo.traits}</div>
          <div class="click-hint">탭하여 상세 보기 →</div>
        </div>

        <!-- 사주팔자 -->
        <div class="card">
          <div class="card-label">📜 사주팔자</div>
          <div class="pillars-grid">
            <div class="pillar">
              <div class="pillar-label">시주</div>
              <div class="pillar-stem">${STEMS[p.hour.stem].hanja}</div>
              <div class="pillar-branch">${BRANCHES[p.hour.branch].hanja}</div>
              <div class="pillar-animal">${BRANCHES[p.hour.branch].emoji}</div>
            </div>
            <div class="pillar day-master">
              <div class="pillar-label">일주</div>
              <div class="pillar-stem">${STEMS[p.day.stem].hanja}</div>
              <div class="pillar-branch">${BRANCHES[p.day.branch].hanja}</div>
              <div class="pillar-animal">${BRANCHES[p.day.branch].emoji}</div>
              <div class="day-master-badge">★ 일간</div>
            </div>
            <div class="pillar">
              <div class="pillar-label">월주</div>
              <div class="pillar-stem">${STEMS[p.month.stem].hanja}</div>
              <div class="pillar-branch">${BRANCHES[p.month.branch].hanja}</div>
              <div class="pillar-animal">${BRANCHES[p.month.branch].emoji}</div>
            </div>
            <div class="pillar">
              <div class="pillar-label">년주</div>
              <div class="pillar-stem">${STEMS[p.year.stem].hanja}</div>
              <div class="pillar-branch">${BRANCHES[p.year.branch].hanja}</div>
              <div class="pillar-animal">${BRANCHES[p.year.branch].emoji}</div>
            </div>
          </div>
          ${r.unknownHour ? '<div class="pillars-note">* 시주는 참고용</div>' : ''}
        </div>

        <!-- 오행 분석 -->
        <div class="card">
          <div class="card-label">🔮 오행 분석</div>
          ${renderElementBars(r.sajuElements)}
        </div>

        <!-- 오늘의 에너지 -->
        <div class="card">
          <div class="card-label">⚡ 오늘의 에너지</div>
          <div style="font-size:15px;margin-bottom:12px;">${r.todayTip}</div>
          <div style="padding:12px;background:rgba(255,107,107,0.1);border-radius:10px;border-left:3px solid #ff6b6b;">
            <div style="font-size:11px;color:#ff6b6b;margin-bottom:4px;">⚠️ 주의</div>
            <div style="font-size:13px;color:var(--text-secondary);">${r.dailyCaution}</div>
          </div>
        </div>

        <!-- 행운 정보 -->
        <div class="card">
          <div class="card-label">🍀 행운 정보</div>
          <div class="lucky-grid">
            <div class="lucky-item">
              <div class="lucky-label">행운의 숫자</div>
              <div class="lucky-numbers">${r.luckyNums.join(' ')}</div>
            </div>
            <div class="lucky-item">
              <div class="lucky-label">행운의 색상</div>
              <div class="lucky-colors">
                <div class="color-dot" style="background:${r.luckyColors.colors[0]}"></div>
                <div class="color-dot" style="background:${r.luckyColors.colors[1]}"></div>
              </div>
            </div>
            <div class="lucky-item">
              <div class="lucky-label">길방위</div>
              <div style="font-size:18px;font-weight:600;color:var(--accent);">🧭 ${r.direction}</div>
            </div>
            <div class="lucky-item">
              <div class="lucky-label">주요 오행</div>
              <div style="font-size:18px;font-weight:600;">${ELEMENTS[r.dominant].icon} ${ELEMENTS[r.dominant].name}</div>
            </div>
          </div>
        </div>

        <!-- 주제별 운세 -->
        <div class="card">
          <div class="card-label">📖 주제별 운세</div>
          <div class="topic-grid">
            ${TOPICS.map(t => `
              <button class="topic-btn" onclick="showTopic('${t.id}')" id="topic-${t.id}">
                <span class="topic-icon">${t.icon}</span>
                <span>${t.name}</span>
              </button>
            `).join('')}
          </div>
          <div class="analysis-box" id="topic-analysis" style="display:none;"></div>
        </div>

        <!-- 프리미엄 (B안: 티저 힌트 추가) -->
        ${renderPremiumTeaser(r)}

        <div class="share-section">
          <div class="share-title">📤 결과 공유하기</div>
          <div class="share-buttons">
            <button class="share-btn kakao" onclick="shareKakao()">카카오톡</button>
            <button class="share-btn twitter" onclick="shareTwitter()">𝕏</button>
            <button class="share-btn copy" onclick="copyShareText()">📋 복사</button>
          </div>
        </div>
        
        <div class="share-section" style="margin-top: 16px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 16px;">
          <div class="share-title">🎧 오디오/텍스트 스크립트</div>
          <div class="share-buttons">
            <button class="share-btn" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);" onclick="copyScriptToClipboard()">📋 스크립트 복사</button>
            <button class="share-btn" style="background: linear-gradient(135deg, #10b981, #059669);" onclick="downloadScript()">📥 TXT 다운로드</button>
          </div>
        </div>

        <div class="result-footer">🇰🇷 K-Saju × MBTI</div>
      `;

      document.getElementById('result-content').innerHTML = html;
    }

    function generateRealMeInsight(r) {
      const mbtiDom = r.chemistry.mbtiDominant;
      const sajuDom = r.chemistry.sajuDominant;
      
      if (mbtiDom === sajuDom) {
        return `MBTI와 사주 모두 ${ELEMENTS[mbtiDom].name} 기운이 강해요. "${ELEMENTS[mbtiDom].desc}"의 특성이 당신의 핵심 정체성입니다.`;
      }
      
      const mbtiEl = ELEMENTS[mbtiDom];
      const sajuEl = ELEMENTS[sajuDom];
      
      return `겉으로는 ${mbtiEl.name}의 "${mbtiEl.desc.split(',')[0]}"가 보이지만, 내면에는 ${sajuEl.name}의 "${sajuEl.desc.split(',')[0]}"가 자리잡고 있어요. 이 두 에너지의 조화가 당신만의 매력입니다.`;
    }

    // ===== v2.5: MBTI 4축 이중 분석 =====
    // 십성 그룹명 → 개별 십성명 매핑
    const SIPSEONG_GROUP = {
      '비겁': ['비견', '겁재'],
      '식상': ['식신', '상관'],
      '재성': ['정재', '편재'],
      '관성': ['정관', '편관'],
      '인성': ['정인', '편인'],
      '정관': ['정관'],
      '편관': ['편관'],
      '정인': ['정인'],
      '편인': ['편인'],
      '식신': ['식신'],
      '상관': ['상관']
    };
    
    function analyzeMbtiAxes(mbti, r) {
      if (!mbti || mbti.length !== 4) return null;
      if (!r.sipseong) return null;
      
      const axes = [
        { axis: 'EI', letter: mbti[0], name: mbti[0] === 'E' ? '외향(E)' : '내향(I)', fullName: '에너지 방향' },
        { axis: 'SN', letter: mbti[1], name: mbti[1] === 'S' ? '감각(S)' : '직관(N)', fullName: '인식 기능' },
        { axis: 'TF', letter: mbti[2], name: mbti[2] === 'T' ? '사고(T)' : '감정(F)', fullName: '판단 기능' },
        { axis: 'JP', letter: mbti[3], name: mbti[3] === 'J' ? '판단(J)' : '인식(P)', fullName: '생활 양식' }
      ];
      
      return axes.map(a => {
        const mapping = MBTI_SIPSEONG_MAP[a.letter];
        if (!mapping) return null;
        
        // 해당 십성이 사주에 얼마나 있는지 체크 (그룹명 → 개별명 변환)
        let sipseongCount = 0;
        mapping.sipseong.forEach(groupName => {
          const individuals = SIPSEONG_GROUP[groupName] || [groupName];
          individuals.forEach(s => {
            if (r.sipseong[s]) sipseongCount += r.sipseong[s];
          });
        });
        
        // 해당 오행이 사주에 얼마나 있는지 체크
        let elementCount = 0;
        mapping.elements.forEach(e => {
          if (r.elementAnalysis && r.elementAnalysis.elements[e]) {
            elementCount += r.elementAnalysis.elements[e];
          }
        });
        
        // 일치도 계산 (십성 + 오행 기반)
        const matchScore = Math.min(100, (sipseongCount * 15) + (elementCount * 10));
        
        return {
          ...a,
          mapping,
          sipseongCount,
          elementCount,
          matchScore,
          isStrong: matchScore >= 40
        };
      });
    }

    // ===== v2.5: 충돌/시너지 패턴 분석 =====
    function analyzePatterns(mbti, r) {
      if (!mbti || !r || !r.sipseong || !r.elementAnalysis) {
        return { conflicts: [], synergies: [] };
      }
      
      const conflicts = [];
      const synergies = [];
      
      // 충돌 패턴 체크
      CONFLICT_PATTERNS.forEach(pattern => {
        try {
          if (mbti.includes(pattern.mbti) && pattern.sajuCondition(r)) {
            conflicts.push(pattern);
          }
        } catch(e) { /* skip */ }
      });
      
      // 시너지 패턴 체크
      SYNERGY_PATTERNS.forEach(pattern => {
        try {
          const hasAllMbti = pattern.mbti.every(m => mbti.includes(m));
          if (hasAllMbti && pattern.sajuCondition(r)) {
            synergies.push(pattern);
          }
        } catch(e) { /* skip */ }
      });
      
      return { conflicts, synergies };
    }

    // ===== v2.5: 이중 분석 렌더링 =====
    function renderDeepDive(r) {
      if (!r.mbti) return '';
      
      const axes = analyzeMbtiAxes(r.mbti, r);
      if (!axes) return '';
      
      return `
        <div class="deep-dive-section fade-in">
          <div class="deep-dive-header">
            <span>🔬</span>
            <span class="deep-dive-title">MBTI × 사주 이중 분석</span>
            <span class="deep-dive-badge">4축 교차</span>
          </div>
          <div class="axis-grid">
            ${axes.map(a => `
              <div class="axis-card ${a.isStrong ? 'active' : ''}">
                <div class="axis-header">
                  <span class="axis-mbti">${a.letter}</span>
                  <span class="axis-label">${a.fullName}</span>
                </div>
                <div class="axis-sipseong">
                  ${a.mapping.sipseong.map(s => `<span class="axis-sipseong-tag">${s}</span>`).join('')}
                  ${a.mapping.elements.map(e => `<span class="axis-sipseong-tag">${e}</span>`).join('')}
                </div>
                <div class="axis-description">
                  ${a.mapping.description}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // ===== v2.5: 충돌/시너지 패턴 렌더링 =====
    function renderPatterns(r) {
      if (!r.mbti) return '';
      
      const { conflicts, synergies } = analyzePatterns(r.mbti, r);
      
      if (conflicts.length === 0 && synergies.length === 0) {
        return `
          <div class="pattern-section fade-in">
            <div class="deep-dive-header">
              <span>⚡</span>
              <span class="deep-dive-title">충돌 & 시너지 분석</span>
            </div>
            <div class="pattern-empty">
              현재 MBTI와 사주 조합에서 특별한 충돌이나 시너지 패턴이 발견되지 않았습니다.<br>
              균형 잡힌 에너지 분포를 가지고 있어요! ✨
            </div>
          </div>
        `;
      }
      
      return `
        <div class="pattern-section fade-in">
          <div class="deep-dive-header">
            <span>⚡</span>
            <span class="deep-dive-title">충돌 & 시너지 분석</span>
            <span class="deep-dive-badge">${conflicts.length + synergies.length}개 발견</span>
          </div>
          
          ${synergies.map(p => `
            <div class="pattern-card synergy">
              <div class="pattern-header">
                <span class="pattern-icon">✨</span>
                <span class="pattern-type">시너지</span>
              </div>
              <div class="pattern-title">${p.title}</div>
              <div class="pattern-description">${p.description}</div>
              <div class="pattern-advice">💡 ${p.advice}</div>
            </div>
          `).join('')}
          
          ${conflicts.map(p => `
            <div class="pattern-card conflict">
              <div class="pattern-header">
                <span class="pattern-icon">⚠️</span>
                <span class="pattern-type">내적 충돌</span>
              </div>
              <div class="pattern-title">${p.title}</div>
              <div class="pattern-description">${p.description}</div>
              <div class="pattern-advice">💡 ${p.advice}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // ===== B안: MBTI 주제별 인사이트 =====
    function getMbtiTopicInsight(mbti, topic) {
      const insights = {
        // 재물운 (확장)
        wealth: {
          INTJ: { 
            summary: "장기 전략 투자에 강점",
            detail: "데이터 기반 분석력으로 시장을 읽는 능력이 뛰어납니다. 감정에 휘둘리지 않고 논리적 판단이 가능해요.",
            strength: "포트폴리오 설계, 리스크 관리, 장기 수익률",
            caution: "새로운 기회에 너무 보수적, 직관적 투자 기회 놓침"
          },
          INTP: {
            summary: "분석력으로 숨은 가치 발굴",
            detail: "남들이 못 보는 투자 기회를 찾아내는 안목이 있어요. 복잡한 재무제표도 척척 분석합니다.",
            strength: "가치투자, 퀀트분석, 새로운 자산군 발굴",
            caution: "과분석으로 타이밍 놓침, 실행력 부족"
          },
          ENTJ: {
            summary: "과감한 투자와 리더십",
            detail: "큰 그림을 보고 과감하게 베팅할 수 있는 배짱이 있어요. 투자 동호회나 스터디를 이끄는 것도 잘 맞습니다.",
            strength: "결단력, 대규모 투자, 자산 운용 전략",
            caution: "과신으로 인한 큰 손실 위험, 타인 의견 무시"
          },
          ENTP: {
            summary: "새로운 투자 기회 포착력",
            detail: "트렌드를 빠르게 읽고 새로운 투자처를 찾아내는 능력이 탁월해요. NFT, 암호화폐 같은 신규 자산에 강합니다.",
            strength: "트렌드 선점, 아이디어 투자, 네트워크 활용",
            caution: "분산 과다로 관리 어려움, 끈기 부족"
          },
          INFJ: {
            summary: "가치 투자 성향",
            detail: "의미 있는 기업, 사회에 기여하는 투자에 끌려요. ESG 투자나 임팩트 투자가 잘 맞습니다.",
            strength: "장기 비전, 윤리적 투자, 직관적 판단",
            caution: "수익성보다 가치에 치우침, 현실적 검증 부족"
          },
          INFP: {
            summary: "직관적 판단력 보유",
            detail: "느낌으로 좋은 투자처를 알아보는 감각이 있어요. 다만 그 직관을 데이터로 검증하는 습관이 필요합니다.",
            strength: "감각적 투자, 창의적 아이디어, 남다른 시각",
            caution: "감정적 결정, 손절 어려움, 현실 외면"
          },
          ENFJ: {
            summary: "인맥 통한 투자 정보력",
            detail: "사람들과의 관계에서 좋은 투자 정보를 얻는 능력이 있어요. 공동 투자나 크라우드펀딩에 강점입니다.",
            strength: "네트워크 투자, 정보 수집, 공동 투자 조율",
            caution: "남 따라 투자, 거절 못 함, 객관성 부족"
          },
          ENFP: {
            summary: "트렌드 감각 탁월",
            detail: "세상의 변화를 빠르게 읽고 다음에 뜰 것을 예측하는 능력이 있어요. 문화, 콘텐츠 관련 투자에 강합니다.",
            strength: "트렌드 예측, 스토리 투자, 열정적 학습",
            caution: "충동 투자, 끈기 부족, 관리 소홀"
          },
          ISTJ: {
            summary: "꾸준한 적립식 투자 강점",
            detail: "한번 정한 원칙을 꾸준히 지키는 힘이 최고의 무기예요. 복리의 마법을 가장 잘 누릴 수 있는 타입입니다.",
            strength: "원칙 고수, 꾸준함, 장기 복리 효과",
            caution: "변화 적응 느림, 좋은 기회도 의심"
          },
          ISFJ: {
            summary: "안전 자산 선호, 확실한 수익",
            detail: "리스크를 최소화하면서 안정적인 수익을 추구해요. 예적금, 채권, 배당주 같은 안전 자산에 강합니다.",
            strength: "안전한 선택, 원금 보존, 가족 재정 관리",
            caution: "너무 보수적, 인플레이션 리스크"
          },
          ESTJ: {
            summary: "체계적 포트폴리오 관리",
            detail: "명확한 기준과 원칙으로 자산을 관리해요. 스프레드시트로 꼼꼼히 기록하고 리밸런싱하는 것을 즐깁니다.",
            strength: "체계적 관리, 원칙 투자, 목표 달성",
            caution: "유연성 부족, 감정적 요소 무시"
          },
          ESFJ: {
            summary: "주변 조언 영향 큼",
            detail: "가족, 친구의 투자 성공담에 쉽게 영향받아요. 정보 수집력은 좋지만 자기만의 기준을 세우는 것이 중요합니다.",
            strength: "정보 수집, 트렌드 파악, 공동체 투자",
            caution: "묻지마 투자, 남 따라하기, 기준 없음"
          },
          ISTP: {
            summary: "실전형 트레이더 기질",
            detail: "차트 분석과 단기 매매에 강점이 있어요. 감정 없이 손절과 익절을 할 수 있는 냉정함이 무기입니다.",
            strength: "기술적 분석, 단기 매매, 빠른 판단",
            caution: "장기 투자 어려움, 과매매 위험"
          },
          ISFP: {
            summary: "감각적 소비 성향",
            detail: "좋아하는 것에는 과감하게 쓰는 타입이에요. 예산 관리와 투자-소비 균형을 의식적으로 맞추는 것이 핵심입니다.",
            strength: "가치 소비, 감각적 투자, 삶의 질 중시",
            caution: "충동 소비, 저축 어려움, 계획 부족"
          },
          ESTP: {
            summary: "리스크 감수하는 대담함",
            detail: "고위험 고수익 투자를 즐기고, 실제로 그런 환경에서 빛을 발해요. 다만 손절 타이밍이 생존의 열쇠입니다.",
            strength: "과감한 베팅, 위기 대응, 빠른 실행",
            caution: "도박성 투자, 과신, 손절 실패"
          },
          ESFP: {
            summary: "현재 즐기는 성향",
            detail: "지금 행복하게 사는 것을 중시해서 미래 대비가 약할 수 있어요. 자동이체 적금 같은 강제 저축 시스템이 효과적입니다.",
            strength: "현재 삶의 질, 인맥 투자, 경험 중시",
            caution: "미래 대비 부족, 계획 없는 소비"
          }
        },
        // 연애운 (확장)
        love: {
          INTJ: {
            summary: "진지한 관계 추구",
            detail: "깊이 있는 정신적 교감을 원해요. 가벼운 만남보다 진정한 파트너를 찾으려 하고, 한번 마음을 주면 헌신적입니다.",
            strength: "진지함, 헌신, 지적 교감, 장기적 관계",
            caution: "감정 표현 서툴러 오해받기 쉬움, 완벽주의"
          },
          INTP: {
            summary: "지적 교감 중시",
            detail: "대화가 통하는 것이 가장 중요해요. 같이 토론하고, 새로운 것을 배우고, 생각을 나눌 수 있는 파트너에게 끌립니다.",
            strength: "지적 호기심, 독립적 관계, 깊은 대화",
            caution: "일상적 로맨스 서툼, 감정 표현 부족"
          },
          ENTJ: {
            summary: "주도적 연애 스타일",
            detail: "관계에서도 리더십을 발휘하려 해요. 데이트 계획도 체계적으로 세우고, 관계의 방향도 주도하려 합니다.",
            strength: "리더십, 책임감, 목표 지향적 관계",
            caution: "상대 의견 무시, 통제적으로 보일 수 있음"
          },
          ENTP: {
            summary: "재치있는 대화로 매력 발산",
            detail: "유머와 위트로 상대방을 즐겁게 해줘요. 지루한 관계는 못 견디고, 항상 새로운 자극을 원합니다.",
            strength: "재치, 유머, 새로움 추구, 열린 사고",
            caution: "깊이 부족, 쉽게 지루해함, 감정적 친밀감 부족"
          },
          INFJ: {
            summary: "영혼의 단짝을 찾는 타입",
            detail: "표면적인 관계에 만족하지 못하고 진정한 소울메이트를 찾아요. 상대방의 내면을 깊이 이해하려 합니다.",
            strength: "깊은 이해, 헌신, 직관적 교감, 정서적 지지",
            caution: "이상이 너무 높음, 현실과 괴리, 실망하기 쉬움"
          },
          INFP: {
            summary: "로맨틱한 이상주의자",
            detail: "동화 같은 사랑을 꿈꿔요. 상대방을 이상화하는 경향이 있고, 진정한 사랑을 위해 많은 것을 감수합니다.",
            strength: "로맨틱함, 진정성, 창의적 애정 표현",
            caution: "현실적 기대 조정 필요, 갈등 회피"
          },
          ENFJ: {
            summary: "상대방 잘 챙기는 타입",
            detail: "연인의 필요를 먼저 읽고 챙겨주는 천사 같은 파트너예요. 다만 자기 감정도 표현하는 연습이 필요해요.",
            strength: "배려, 헌신, 관계 조율, 감정적 지지",
            caution: "자기 희생, 과한 기대, 번아웃"
          },
          ENFP: {
            summary: "설렘을 중시",
            detail: "연애 초반의 두근거림을 사랑해요. 관계가 안정되면 새로운 재미를 찾거나 권태기가 올 수 있어서 의식적인 노력이 필요합니다.",
            strength: "열정, 창의적 데이트, 긍정 에너지",
            caution: "쉽게 지루해함, 깊이보다 넓이, 현실적 문제 회피"
          },
          ISTJ: {
            summary: "신뢰와 헌신의 아이콘",
            detail: "약속을 지키고, 말보다 행동으로 사랑을 증명하는 타입이에요. 안정적이고 믿음직한 파트너가 됩니다.",
            strength: "신뢰, 헌신, 책임감, 안정적 관계",
            caution: "감정 표현 부족, 로맨틱함 부족"
          },
          ISFJ: {
            summary: "헌신적인 사랑",
            detail: "상대방을 위해 묵묵히 헌신하는 타입이에요. 작은 것도 세심하게 챙기고, 기념일도 절대 잊지 않습니다.",
            strength: "세심함, 헌신, 안정감, 가정적",
            caution: "자기 욕구 표현 부족, 과한 희생"
          },
          ESTJ: {
            summary: "책임감 있는 파트너",
            detail: "관계에서도 책임을 다하려 해요. 실질적인 도움으로 사랑을 표현하고, 안정적인 미래를 함께 계획합니다.",
            strength: "책임감, 실질적 지원, 안정적 계획",
            caution: "융통성 부족, 감정보다 논리"
          },
          ESFJ: {
            summary: "따뜻한 배려의 달인",
            detail: "상대방이 필요한 것을 미리 알아채고 챙겨주는 능력이 탁월해요. 가족과 친구들에게도 인정받는 파트너입니다.",
            strength: "배려, 사교성, 가족 관계, 화목함",
            caution: "과한 기대, 인정 욕구, 갈등 회피"
          },
          ISTP: {
            summary: "자유로운 관계 선호",
            detail: "서로의 공간을 존중하는 관계를 원해요. 구속받는 것을 싫어하고, 적당한 거리감을 유지하려 합니다.",
            strength: "독립적, 쿨한 매력, 자유로운 관계",
            caution: "감정적 친밀감 부족, 무관심해 보임"
          },
          ISFP: {
            summary: "감성적이고 따뜻함",
            detail: "조용히 곁에 있어주는 타입이에요. 말보다 분위기와 감성으로 사랑을 전하고, 예술적인 데이트를 좋아합니다.",
            strength: "감성, 따뜻함, 예술적 감각, 섬세함",
            caution: "갈등 회피, 표현 부족, 소극적"
          },
          ESTP: {
            summary: "액션있는 연애 좋아함",
            detail: "지루한 건 못 참아요. 함께 새로운 경험을 하고, 스릴 있는 데이트를 즐기는 타입입니다.",
            strength: "열정, 행동력, 즐거운 데이트, 현재 집중",
            caution: "안정기 관리, 장기적 계획 부족"
          },
          ESFP: {
            summary: "즐거운 연애의 달인",
            detail: "함께 있으면 항상 웃게 되는 타입이에요. 분위기 메이커로서 연인을 즐겁게 해주는 능력이 탁월합니다.",
            strength: "재미, 긍정, 사교성, 현재 행복",
            caution: "깊이 있는 대화 부족, 진지함 필요할 때"
          }
        },
        // 직장운 (확장)
        career: {
          INTJ: {
            summary: "전략 기획, 연구 분야에서 빛남",
            detail: "복잡한 문제를 분석하고 장기 전략을 세우는 일에 강해요. 혼자 집중해서 일할 때 최고의 성과를 냅니다.",
            strength: "전략 수립, 분석, 시스템 설계, 장기 프로젝트",
            caution: "팀워크 연습 필요, 소통 스타일 개선"
          },
          INTP: {
            summary: "혁신적 아이디어 뱅크",
            detail: "새로운 관점과 창의적인 해결책을 제시하는 능력이 탁월해요. 연구개발, 기술 분야에서 두각을 나타냅니다.",
            strength: "창의성, 분석력, 문제 해결, 혁신",
            caution: "실행력 보완, 마감 관리, 커뮤니케이션"
          },
          ENTJ: {
            summary: "리더십 포지션 적합",
            detail: "조직을 이끌고 목표를 달성하는 것에 천부적인 재능이 있어요. CEO, 경영자, 프로젝트 리더가 잘 맞습니다.",
            strength: "리더십, 결단력, 목표 달성, 조직 관리",
            caution: "세부사항 위임 필요, 팀원 감정 케어"
          },
          ENTP: {
            summary: "새 프로젝트 시작에 강점",
            detail: "0에서 1을 만들어내는 능력이 뛰어나요. 스타트업, 신사업 기획, 컨설팅 분야에서 능력을 발휘합니다.",
            strength: "아이디어, 적응력, 네트워킹, 프레젠테이션",
            caution: "마무리 집중 필요, 지속성 보완"
          },
          INFJ: {
            summary: "비전 제시와 팀 화합",
            detail: "큰 그림을 보여주고 팀원들의 마음을 하나로 모으는 능력이 있어요. 상담, 교육, HR 분야가 잘 맞습니다.",
            strength: "비전, 팀 화합, 상담, 글쓰기",
            caution: "경계 설정 필요, 과한 책임감 주의"
          },
          INFP: {
            summary: "창의적 역할에서 빛남",
            detail: "진정성 있는 콘텐츠, 의미 있는 프로젝트에서 열정을 발휘해요. 예술, 글쓰기, 디자인, 심리 분야가 맞습니다.",
            strength: "창의성, 진정성, 공감, 의미 추구",
            caution: "현실적 목표 설정, 마감 관리, 자기 PR"
          },
          ENFJ: {
            summary: "팀 리딩과 멘토링 최고",
            detail: "사람들을 이끌고 성장시키는 것에 재능이 있어요. 교육, 코칭, 인사, 영업 관리 분야에서 빛납니다.",
            strength: "팀 리딩, 멘토링, 동기부여, 커뮤니케이션",
            caution: "번아웃 주의, 자기 관리, 거절 연습"
          },
          ENFP: {
            summary: "아이디어와 네트워킹의 달인",
            detail: "창의적인 아이디어와 사람을 연결하는 능력이 탁월해요. 마케팅, 기획, PR, 스타트업이 잘 맞습니다.",
            strength: "창의력, 네트워킹, 열정, 트렌드 감각",
            caution: "집중력 보완, 루틴 업무 관리, 마무리"
          },
          ISTJ: {
            summary: "신뢰받는 실무자",
            detail: "맡은 일은 반드시 해내는 신뢰의 아이콘이에요. 재무, 회계, 품질관리, 공무원이 잘 맞습니다.",
            strength: "신뢰성, 정확성, 꾸준함, 원칙 준수",
            caution: "변화 적응력 기르기, 유연성 연습"
          },
          ISFJ: {
            summary: "꼼꼼한 서포터",
            detail: "팀의 든든한 지원군으로 꼼꼼하게 업무를 처리해요. 비서, 간호, 교육, 행정 분야가 잘 맞습니다.",
            strength: "꼼꼼함, 헌신, 팀 지원, 세부 관리",
            caution: "공로 인정받기, 자기 어필 연습"
          },
          ESTJ: {
            summary: "조직 관리의 달인",
            detail: "체계적으로 조직을 운영하고 목표를 달성하는 능력이 탁월해요. 관리직, 경영, 운영 분야가 맞습니다.",
            strength: "조직력, 효율성, 목표 관리, 실행력",
            caution: "유연한 리더십 추가, 팀원 감정 배려"
          },
          ESFJ: {
            summary: "팀 분위기 메이커",
            detail: "팀의 화합과 분위기를 이끄는 능력이 있어요. 고객 서비스, 교육, 인사, 이벤트 기획이 잘 맞습니다.",
            strength: "팀 화합, 고객 응대, 커뮤니케이션, 배려",
            caution: "자기 성과 어필, 경계 설정"
          },
          ISTP: {
            summary: "문제 해결 전문가",
            detail: "복잡한 문제를 손으로 직접 해결하는 것을 좋아해요. 엔지니어, 기술자, 분석가가 잘 맞습니다.",
            strength: "문제 해결, 기술력, 위기 대응, 실용성",
            caution: "장기 계획 세우기, 커뮤니케이션 연습"
          },
          ISFP: {
            summary: "창의적 실무에 강점",
            detail: "손으로 무언가를 만들거나 예술적인 작업에서 빛을 발해요. 디자인, 예술, 요리, 뷰티 분야가 맞습니다.",
            strength: "감각, 창의성, 섬세함, 예술성",
            caution: "자기 PR 연습, 적극성 기르기"
          },
          ESTP: {
            summary: "위기 대응 능력 탁월",
            detail: "돌발 상황에서 빠르게 판단하고 행동하는 능력이 뛰어나요. 영업, 협상, 응급 분야가 잘 맞습니다.",
            strength: "순발력, 협상력, 위기 대응, 실행력",
            caution: "장기 커리어 설계, 인내심 기르기"
          },
          ESFP: {
            summary: "프레젠테이션과 영업에 강점",
            detail: "사람들 앞에서 빛나고, 설득하는 능력이 탁월해요. 영업, 엔터테인먼트, 이벤트, 서비스업이 맞습니다.",
            strength: "프레젠테이션, 영업, 고객 응대, 적응력",
            caution: "꾸준함 추가, 서류 업무 관리"
          }
        },
        // 건강운 (확장)
        health: {
          INTJ: {
            summary: "정신적 피로 관리 중요",
            detail: "머리를 많이 쓰다 보니 정신적 피로가 쌓이기 쉬워요. 생각을 멈추고 쉬는 연습이 필요합니다.",
            strength: "계획적 건강 관리, 데이터 기반 운동",
            caution: "번아웃, 불면증, 혼자 끙끙앓기"
          },
          INTP: {
            summary: "생각 과다로 수면 부족 주의",
            detail: "밤에 생각이 많아져서 잠을 못 자는 경우가 많아요. 규칙적인 수면 루틴과 운동 습관화가 필요합니다.",
            strength: "건강 정보 분석력, 효율적 운동 설계",
            caution: "운동 부족, 불규칙한 생활, 카페인 과다"
          },
          ENTJ: {
            summary: "과로 주의",
            detail: "일에 몰두하다 보면 몸이 보내는 신호를 무시하기 쉬워요. 일과 휴식의 경계를 명확히 만드세요.",
            strength: "목표 설정 운동, 경쟁적 스포츠",
            caution: "과로, 스트레스성 질환, 휴식 무시"
          },
          ENTP: {
            summary: "불규칙한 생활 패턴 조심",
            detail: "흥미 있는 것에 빠지면 밤새는 것도 마다하지 않아요. 기본적인 생활 루틴을 만드는 것이 중요합니다.",
            strength: "다양한 운동 시도, 새로운 건강법 탐구",
            caution: "불규칙한 식사, 수면 부족, 끈기 부족"
          },
          INFJ: {
            summary: "감정 소모 주의",
            detail: "타인의 감정을 흡수하다 보니 에너지가 빨리 소진돼요. 혼자만의 충전 시간이 반드시 필요합니다.",
            strength: "마음챙김, 명상, 의미 있는 운동",
            caution: "감정적 번아웃, 혼자 삭이기, 경계 부족"
          },
          INFP: {
            summary: "스트레스가 몸으로",
            detail: "감정적 스트레스가 신체 증상으로 나타나기 쉬워요. 감정을 표현하고 해소하는 방법을 찾는 것이 중요합니다.",
            strength: "예술적 치유, 자연 속 휴식, 감성적 운동",
            caution: "원인 모를 통증, 우울감, 고립"
          },
          ENFJ: {
            summary: "남 챙기다 자기 건강 놓침",
            detail: "다른 사람을 돌보느라 정작 자기 건강은 뒷전이에요. 셀프케어를 최우선으로 두는 연습이 필요합니다.",
            strength: "함께하는 운동, 그룹 활동, 동기부여",
            caution: "번아웃, 과로, 자기 희생"
          },
          ENFP: {
            summary: "에너지 과소비 주의",
            detail: "열정적으로 활동하다 보면 에너지가 갑자기 바닥나요. 충분한 수면과 휴식으로 충전하는 것이 중요합니다.",
            strength: "재미있는 운동, 다양한 시도, 긍정적 마인드",
            caution: "무리한 일정, 수면 부족, 감정 롤러코스터"
          },
          ISTJ: {
            summary: "무리하다 갑자기 쓰러짐",
            detail: "아파도 티 안 내고 버티다가 갑자기 쓰러지는 타입이에요. 중간중간 휴식을 취하는 것이 중요합니다.",
            strength: "규칙적인 운동, 계획적 건강 관리",
            caution: "과로, 경고 신호 무시, 완고함"
          },
          ISFJ: {
            summary: "스트레스를 안으로 삼킴",
            detail: "힘들어도 표현하지 않고 혼자 삭이는 경향이 있어요. 감정을 표현하고 도움을 요청하는 습관이 필요합니다.",
            strength: "꾸준한 건강 습관, 가족과 함께 운동",
            caution: "소화 문제, 스트레스성 질환, 혼자 앓기"
          },
          ESTJ: {
            summary: "긴장성 두통/어깨 주의",
            detail: "책임감과 압박으로 인해 긴장성 두통이나 어깨 결림이 생기기 쉬워요. 스트레칭과 이완이 필수입니다.",
            strength: "목표 설정 운동, 체계적 건강 관리",
            caution: "긴장 이완 부족, 휴식 죄책감"
          },
          ESFJ: {
            summary: "감정 기복이 건강에 영향",
            detail: "인간관계의 스트레스가 건강에 직접적인 영향을 미쳐요. 정서적 안정감을 유지하는 것이 중요합니다.",
            strength: "그룹 운동, 사교적 활동, 함께 관리",
            caution: "감정적 식이, 타인 평가 민감"
          },
          ISTP: {
            summary: "무모한 도전으로 부상 주의",
            detail: "스릴을 즐기다가 부상을 당하기 쉬워요. 안전 장비 착용과 적절한 준비가 필요합니다.",
            strength: "실용적 운동, 기술적 스포츠, 도전",
            caution: "부상 위험, 안전 무시, 과신"
          },
          ISFP: {
            summary: "감성적 스트레스 관리 중요",
            detail: "예민한 감성이 스트레스에 취약할 수 있어요. 자연 속에서 휴식하거나 예술 활동으로 치유하는 것이 좋습니다.",
            strength: "자연 속 휴식, 예술적 치유, 감각적 운동",
            caution: "스트레스 회피, 고립, 불규칙한 생활"
          },
          ESTP: {
            summary: "과격한 활동 부상 주의",
            detail: "익스트림 스포츠나 과격한 활동을 좋아해서 부상 위험이 높아요. 준비운동과 안전 확보가 필수입니다.",
            strength: "활동적 운동, 스포츠, 빠른 회복력",
            caution: "부상, 과음/과식, 무리한 도전"
          },
          ESFP: {
            summary: "과식/과음 주의",
            detail: "즐기는 것을 좋아해서 먹고 마시는 것에서 절제가 어려울 수 있어요. 즐기면서도 적당히 조절하는 연습이 필요합니다.",
            strength: "즐거운 운동, 댄스, 그룹 활동",
            caution: "과식, 과음, 충동적 행동"
          }
        }
      };
      
      const data = insights[topic]?.[mbti];
      if (!data) return '';
      
      // 호환성: 기존 코드를 위해 문자열도 반환 가능
      if (typeof data === 'string') return data;
      return data.summary;
    }
    
    // ===== v2.5 B안: 확장된 MBTI 인사이트 가져오기 =====
    function getMbtiTopicFull(mbti, topic) {
      const insights = {
        wealth: getMbtiTopicInsightData().wealth,
        love: getMbtiTopicInsightData().love,
        career: getMbtiTopicInsightData().career,
        health: getMbtiTopicInsightData().health
      };
      return insights[topic]?.[mbti] || null;
    }
    
    // ===== v2.5 B안: MBTI × 오행 통합 조언 =====
    function getIntegratedAdvice(mbti, element, topic) {
      if (!mbti || !element) return null;
      
      // MBTI 유형 분류
      const mbtiStyle = {
        analysts: ['INTJ', 'INTP', 'ENTJ', 'ENTP'],
        diplomats: ['INFJ', 'INFP', 'ENFJ', 'ENFP'],
        sentinels: ['ISTJ', 'ISFJ', 'ESTJ', 'ESFJ'],
        explorers: ['ISTP', 'ISFP', 'ESTP', 'ESFP']
      };
      
      let mbtiGroup = '';
      for (const [group, types] of Object.entries(mbtiStyle)) {
        if (types.includes(mbti)) {
          mbtiGroup = group;
          break;
        }
      }
      
      // 오행 특성
      const elementTraits = {
        wood: { name: '목', style: '성장/확장', approach: '공격적' },
        fire: { name: '화', style: '열정/표현', approach: '적극적' },
        earth: { name: '토', style: '안정/신중', approach: '보수적' },
        metal: { name: '금', style: '논리/분석', approach: '체계적' },
        water: { name: '수', style: '유연/적응', approach: '기회주의적' }
      };
      
      const elTrait = elementTraits[element];
      
      // 주제별 통합 조언
      const advice = {
        wealth: {
          analysts: {
            wood: { type: "전략적 성장 투자가", synergy: "분석력 + 성장 마인드 = 장기 복리의 달인", tip: "성장주 분석에 강점, 분기별 리밸런싱 추천" },
            fire: { type: "과감한 전략가", synergy: "분석력 + 열정 = 큰 기회 포착", tip: "확신이 들 때 과감하게, 단 손절라인 필수" },
            earth: { type: "안정적 분석가", synergy: "분석력 + 신중함 = 철벽 방어", tip: "가치투자 최적화, 급등주는 피하기" },
            metal: { type: "퀀트 투자의 정석", synergy: "분석력 + 체계 = 시스템 투자", tip: "자동화 투자 시스템 구축 추천" },
            water: { type: "적응형 전략가", synergy: "분석력 + 유연함 = 시장 대응력", tip: "상황에 맞는 전략 전환이 강점" }
          },
          diplomats: {
            wood: { type: "가치 성장 투자자", synergy: "직관 + 성장 = 미래 가치 발굴", tip: "ESG, 임팩트 투자에서 빛을 발함" },
            fire: { type: "열정적 가치 투자자", synergy: "직관 + 열정 = 신념 투자", tip: "믿는 기업에 장기 투자, 단기 변동 무시" },
            earth: { type: "신중한 가치 투자자", synergy: "직관 + 안정 = 꾸준한 수익", tip: "배당주, 우량주 중심 포트폴리오" },
            metal: { type: "원칙 있는 가치 투자자", synergy: "직관 + 원칙 = 흔들리지 않는 투자", tip: "투자 원칙 문서화하고 지키기" },
            water: { type: "유연한 가치 투자자", synergy: "직관 + 유연 = 기회 포착", tip: "직관을 믿되 데이터로 검증" }
          },
          sentinels: {
            wood: { type: "성실한 성장 투자자", synergy: "꾸준함 + 성장 = 복리의 마법", tip: "적립식 투자 자동화가 최고의 전략" },
            fire: { type: "열정적 관리자", synergy: "꾸준함 + 열정 = 체계적 공격", tip: "계획된 공격 투자, 월별 리뷰 필수" },
            earth: { type: "철벽 수비형", synergy: "꾸준함 + 안정 = 원금 사수", tip: "예적금 + 채권 중심, 안전 제일" },
            metal: { type: "체계적 관리의 달인", synergy: "꾸준함 + 체계 = 완벽한 관리", tip: "스프레드시트로 자산 관리 추천" },
            water: { type: "안정적 기회주의자", synergy: "꾸준함 + 유연 = 기회 있을 때 출격", tip: "현금 비중 유지하다 기회에 투자" }
          },
          explorers: {
            wood: { type: "모험적 성장 투자자", synergy: "행동력 + 성장 = 빠른 수익", tip: "트렌드 선점에 강점, 분산 필수" },
            fire: { type: "불꽃 트레이더", synergy: "행동력 + 열정 = 단타의 달인", tip: "손절 룰 철저히, 감정 배제 훈련" },
            earth: { type: "실용적 투자자", synergy: "행동력 + 안정 = 실속 투자", tip: "눈에 보이는 자산 선호, 부동산 강점" },
            metal: { type: "기술적 트레이더", synergy: "행동력 + 분석 = 차트의 달인", tip: "기술적 분석 공부, 시스템 트레이딩" },
            water: { type: "기회주의 트레이더", synergy: "행동력 + 유연 = 시장 서핑", tip: "흐름을 타는 투자, 추세 추종" }
          }
        },
        love: {
          analysts: {
            wood: { type: "성장하는 파트너", synergy: "지적 교감 + 함께 성장", tip: "서로의 목표를 응원하는 관계가 이상적" },
            fire: { type: "열정적 지성인", synergy: "깊은 대화 + 열정적 표현", tip: "감정 표현 연습, 로맨틱한 시도 추가" },
            earth: { type: "안정적 지성인", synergy: "신뢰 + 지적 유대", tip: "말보다 행동으로 사랑을 증명" },
            metal: { type: "논리적 파트너", synergy: "명확한 소통 + 원칙", tip: "감정도 논리처럼 명확하게 표현" },
            water: { type: "깊이 있는 파트너", synergy: "깊은 이해 + 유연한 소통", tip: "상대의 감정에 더 귀 기울이기" }
          },
          diplomats: {
            wood: { type: "함께 성장하는 영혼", synergy: "깊은 교감 + 성장 지향", tip: "서로의 꿈을 함께 키워가는 관계" },
            fire: { type: "열정적 로맨티스트", synergy: "깊은 감정 + 열정적 표현", tip: "이상과 현실의 균형 찾기" },
            earth: { type: "헌신적 영혼의 반려", synergy: "깊은 이해 + 안정적 헌신", tip: "일상의 소소한 행복에 집중" },
            metal: { type: "진지한 영혼의 반려", synergy: "깊은 교감 + 원칙적 사랑", tip: "유연함을 더해 관계 윤활유 역할" },
            water: { type: "유연한 영혼의 반려", synergy: "깊은 이해 + 흐르는 사랑", tip: "직관을 믿되 소통도 놓치지 말기" }
          },
          sentinels: {
            wood: { type: "성장을 돕는 파트너", synergy: "헌신 + 함께 성장", tip: "변화를 두려워하지 말고 함께 도전" },
            fire: { type: "따뜻한 헌신자", synergy: "헌신 + 열정적 표현", tip: "가끔은 불꽃 튀는 이벤트로 활력" },
            earth: { type: "변함없는 반석", synergy: "헌신 + 안정감", tip: "지루함 방지를 위한 새로운 시도" },
            metal: { type: "원칙 있는 헌신자", synergy: "헌신 + 명확한 기준", tip: "융통성을 더해 부드러운 관계로" },
            water: { type: "적응하는 헌신자", synergy: "헌신 + 유연함", tip: "변화에 열린 마음으로 관계 성장" }
          },
          explorers: {
            wood: { type: "자유로운 성장 파트너", synergy: "자유 + 함께 성장", tip: "각자의 공간을 존중하며 성장" },
            fire: { type: "열정적 자유인", synergy: "자유 + 열정", tip: "함께하는 모험으로 불꽃 유지" },
            earth: { type: "안정을 주는 자유인", synergy: "자유 + 안정감", tip: "자유롭지만 믿을 수 있는 관계" },
            metal: { type: "쿨한 파트너", synergy: "자유 + 명확한 경계", tip: "서로의 영역을 존중하는 관계" },
            water: { type: "흐르는 대로 사랑", synergy: "자유 + 유연함", tip: "순간을 즐기되 깊이도 더하기" }
          }
        },
        career: {
          analysts: {
            wood: { type: "성장 전략가", synergy: "분석력 + 성장 마인드 = 비전 제시자", tip: "스타트업, 전략기획, R&D에서 빛남" },
            fire: { type: "혁신 리더", synergy: "분석력 + 열정 = 변화 주도자", tip: "신사업, 혁신 프로젝트 리딩 적합" },
            earth: { type: "안정적 전문가", synergy: "분석력 + 신중함 = 전문성 축적", tip: "연구, 분석, 컨설팅 분야 강점" },
            metal: { type: "시스템 설계자", synergy: "분석력 + 체계 = 구조 설계", tip: "IT, 금융, 품질관리 분야 적합" },
            water: { type: "적응형 전략가", synergy: "분석력 + 유연함 = 위기 대응", tip: "컨설팅, 투자, 기획 분야 강점" }
          },
          diplomats: {
            wood: { type: "비전 제시자", synergy: "직관 + 성장 = 영감 리더", tip: "교육, 코칭, 콘텐츠 분야 적합" },
            fire: { type: "열정적 멘토", synergy: "직관 + 열정 = 동기부여의 달인", tip: "강연, 코칭, HR 분야에서 빛남" },
            earth: { type: "안정적 조력자", synergy: "직관 + 헌신 = 든든한 지원군", tip: "상담, 교육, 사회복지 분야 적합" },
            metal: { type: "원칙 있는 조력자", synergy: "직관 + 원칙 = 공정한 중재자", tip: "HR, 법률, 윤리 분야 강점" },
            water: { type: "유연한 조력자", synergy: "직관 + 적응력 = 상황 맞춤 지원", tip: "상담, 예술, 치유 분야 적합" }
          },
          sentinels: {
            wood: { type: "성실한 성장 관리자", synergy: "꾸준함 + 성장 = 장기 성과", tip: "관리직, 운영, 재무 분야 적합" },
            fire: { type: "열정적 관리자", synergy: "꾸준함 + 열정 = 팀 동기부여", tip: "영업관리, 교육, 서비스 분야 강점" },
            earth: { type: "철벽 관리자", synergy: "꾸준함 + 안정 = 믿음직한 버팀목", tip: "공무원, 금융, 품질관리 적합" },
            metal: { type: "체계적 관리자", synergy: "꾸준함 + 체계 = 완벽한 운영", tip: "경영지원, 재무, 운영 분야 강점" },
            water: { type: "유연한 관리자", synergy: "꾸준함 + 적응력 = 변화 대응", tip: "물류, 고객서비스, 운영 분야 적합" }
          },
          explorers: {
            wood: { type: "기회 포착 실행가", synergy: "행동력 + 성장 = 빠른 성과", tip: "영업, 스타트업, 현장직 적합" },
            fire: { type: "열정적 실행가", synergy: "행동력 + 열정 = 돌파력", tip: "영업, 이벤트, 엔터테인먼트 강점" },
            earth: { type: "실용적 실행가", synergy: "행동력 + 안정 = 확실한 성과", tip: "기술직, 제조, 서비스 분야 적합" },
            metal: { type: "정밀한 실행가", synergy: "행동력 + 분석 = 기술의 달인", tip: "엔지니어, 기술자, 분석가 적합" },
            water: { type: "적응형 실행가", synergy: "행동력 + 유연함 = 위기 대응 전문", tip: "영업, 협상, 응급 분야 강점" }
          }
        },
        health: {
          analysts: {
            wood: { type: "성장형 건강 관리", synergy: "계획적 + 성장 마인드", tip: "운동 목표 설정, 단계적 강도 증가" },
            fire: { type: "열정적 건강 도전", synergy: "계획적 + 열정", tip: "목표 지향 운동, 단 과로 주의" },
            earth: { type: "안정적 건강 관리", synergy: "계획적 + 꾸준함", tip: "규칙적인 루틴이 최고의 건강법" },
            metal: { type: "시스템적 건강 관리", synergy: "계획적 + 체계", tip: "데이터 기반 건강 관리 앱 활용" },
            water: { type: "유연한 건강 관리", synergy: "계획적 + 적응", tip: "상황에 맞게 운동 종류 변경" }
          },
          diplomats: {
            wood: { type: "성장하는 마음 건강", synergy: "감성 + 성장", tip: "자기계발과 운동을 함께하기" },
            fire: { type: "열정적 마음 건강", synergy: "감성 + 열정", tip: "좋아하는 운동으로 스트레스 해소" },
            earth: { type: "안정적 마음 건강", synergy: "감성 + 안정", tip: "규칙적인 명상과 휴식이 핵심" },
            metal: { type: "원칙 있는 마음 건강", synergy: "감성 + 원칙", tip: "건강한 경계 설정이 마음 건강" },
            water: { type: "흐르는 마음 건강", synergy: "감성 + 유연함", tip: "자연 속 산책, 물 관련 활동 추천" }
          },
          sentinels: {
            wood: { type: "꾸준히 성장하는 건강", synergy: "성실함 + 성장", tip: "매일 조금씩, 꾸준한 운동 습관" },
            fire: { type: "성실한 건강 열정", synergy: "성실함 + 열정", tip: "목표 달성의 즐거움으로 동기부여" },
            earth: { type: "철벽 건강 관리", synergy: "성실함 + 안정", tip: "정해진 시간, 정해진 운동 루틴" },
            metal: { type: "체계적 건강 관리", synergy: "성실함 + 체계", tip: "건강검진 정기화, 기록 습관화" },
            water: { type: "유연한 건강 루틴", synergy: "성실함 + 적응", tip: "기본 루틴 유지하되 변화 수용" }
          },
          explorers: {
            wood: { type: "도전적 건강 관리", synergy: "활동성 + 성장", tip: "새로운 운동 도전으로 성장" },
            fire: { type: "열정적 액티비티", synergy: "활동성 + 열정", tip: "스포츠, 팀 활동으로 건강 유지" },
            earth: { type: "실용적 건강 관리", synergy: "활동성 + 안정", tip: "일상에 운동 녹이기, 실용적 접근" },
            metal: { type: "기술적 건강 관리", synergy: "활동성 + 분석", tip: "웨어러블로 데이터 체크하며 운동" },
            water: { type: "자유로운 건강 관리", synergy: "활동성 + 유연함", tip: "기분에 맞는 다양한 활동으로" }
          }
        }
      };
      
      return advice[topic]?.[mbtiGroup]?.[element] || null;
    }
    
    // 인사이트 데이터 접근용 헬퍼
    function getMbtiTopicInsightData() {
      // getMbtiTopicInsight 함수 내부의 insights 객체 참조
      // 실제로는 위에서 정의된 확장 데이터 사용
      return {
        wealth: {
          INTJ: { summary: "장기 전략 투자에 강점", detail: "데이터 기반 분석력으로 시장을 읽는 능력이 뛰어납니다.", strength: "포트폴리오 설계, 리스크 관리", caution: "새로운 기회에 너무 보수적" },
          // ... 나머지는 getMbtiTopicInsight 내부 참조
        }
      };
    }

    // ===== C안: 십성(十星) 기반 주제별 인사이트 =====
    function getSipseongTopicInsight(sipseong, topicId) {
      if (!sipseong) return null;
      
      // 십성 그룹 합계 계산
      const groups = {
        bigeop: (sipseong['비견'] || 0) + (sipseong['겁재'] || 0),     // 비겁 - 나와 같은 오행
        siksang: (sipseong['식신'] || 0) + (sipseong['상관'] || 0),    // 식상 - 내가 생하는 오행
        jaeseong: (sipseong['정재'] || 0) + (sipseong['편재'] || 0),   // 재성 - 내가 극하는 오행
        gwanseong: (sipseong['정관'] || 0) + (sipseong['편관'] || 0),  // 관성 - 나를 극하는 오행
        inseong: (sipseong['정인'] || 0) + (sipseong['편인'] || 0)     // 인성 - 나를 생하는 오행
      };
      
      // 개별 십성
      const detail = {
        bigyeon: sipseong['비견'] || 0,
        geopjae: sipseong['겁재'] || 0,
        siksin: sipseong['식신'] || 0,
        sanggwan: sipseong['상관'] || 0,
        jeongjae: sipseong['정재'] || 0,
        pyeonjae: sipseong['편재'] || 0,
        jeonggwan: sipseong['정관'] || 0,
        pyeongwan: sipseong['편관'] || 0,
        jeongin: sipseong['정인'] || 0,
        pyeonin: sipseong['편인'] || 0
      };
      
      // 주제별 관련 십성과 분석
      const insights = {
        wealth: {
          relatedGroups: ['jaeseong', 'siksang'],
          relatedLabels: ['재성(財星)', '식상(食傷)'],
          analysis: analyzeWealthSipseong(groups, detail)
        },
        love: {
          relatedGroups: ['gwanseong', 'jaeseong'],
          relatedLabels: ['관성(官星)', '재성(財星)'],
          analysis: analyzeLoveSipseong(groups, detail)
        },
        career: {
          relatedGroups: ['gwanseong', 'inseong'],
          relatedLabels: ['관성(官星)', '인성(印星)'],
          analysis: analyzeCareerSipseong(groups, detail)
        },
        health: {
          relatedGroups: ['siksang', 'bigeop'],
          relatedLabels: ['식상(食傷)', '비겁(比劫)'],
          analysis: analyzeHealthSipseong(groups, detail)
        }
      };
      
      return {
        groups,
        detail,
        ...insights[topicId]
      };
    }
    
    // 재물운 십성 분석
    function analyzeWealthSipseong(g, d) {
      const jae = g.jaeseong;
      const sik = g.siksang;
      
      if (jae >= 3) {
        return {
          verdict: "🌟 재성 과다 - 돈을 향한 강한 촉이 있는 사주",
          story: "혹시 <em>돈 되는 일에 유독 민감</em>하시죠? 그건 당신의 사주에 <em>재성(財星)이 과다</em>하기 때문이에요. 이는 재물에 대한 감각이 뛰어나고, 돈 버는 기회를 본능적으로 포착하는 능력이 있다는 뜻이에요. 다만, 욕심이 과하면 오히려 손해를 볼 수 있으니 <em>안정적인 재테크와 분산 투자</em>를 병행하세요.",
          jobs: "투자, 금융, 부동산, 영업, 사업",
          strength: "투자 감각, 기회 포착 능력, 재물 운 양호",
          caution: "과욕 주의, 인간관계 소홀 경계"
        };
      } else if (jae === 0) {
        return {
          verdict: "💎 재성 부재 - 물질보다 가치를 추구하는 영혼",
          story: "혹시 <em>돈에 크게 연연하지 않는 편</em>이시죠? 당신의 사주에는 <em>재성(財星)이 부재</em>해요. 이는 물질적 가치보다 정신적 풍요, 의미 있는 일, 자기 성장에 더 끌린다는 뜻이에요. 이런 성향은 장점이지만, 현실적인 재무 관리 능력을 키우는 것도 중요해요. <em>기초 재테크 공부</em>를 시작해보세요.",
          jobs: "교육, 연구, 예술, 비영리, 공익 분야",
          strength: "정신적 풍요, 가치 추구, 물욕에서 자유",
          caution: "재무 관리 소홀, 노후 대비 필요"
        };
      } else if (sik >= 2 && jae >= 1) {
        return {
          verdict: "✨ 식상생재 - 재능으로 돈을 버는 황금 구조",
          story: "당신의 사주에는 <em>식상(食傷)이 재성(財星)을 생(生)하는 구조</em>가 있어요! 이건 정말 좋은 구조예요. 당신의 <em>창의력, 재능, 표현력이 곧 돈이 되는</em> 구조거든요. 콘텐츠 제작, 프리랜서, 창작 분야에서 큰 수익을 올릴 수 있어요. 당신만의 재능을 적극적으로 수익화해보세요!",
          jobs: "유튜버, 작가, 디자이너, 프리랜서, 콘텐츠 크리에이터",
          strength: "재능 수익화, 창의적 수입원, 자기 표현",
          caution: "수입 변동성, 꾸준한 콘텐츠 생산 필요"
        };
      } else if (jae === 1 || jae === 2) {
        return {
          verdict: "⚖️ 재성 균형 - 건강한 재물 관념의 소유자",
          story: "당신의 사주에는 <em>재성이 적당히</em> 있어요. 이는 물질에 대한 건강한 욕구와 균형 잡힌 재무 관념을 가지고 있다는 뜻이에요. 무리한 투자보다 <em>꾸준한 저축과 분산 투자</em>가 당신에게 잘 맞습니다. 천천히, 하지만 확실하게 재물을 모아가세요.",
          jobs: "안정적 직장 + 부업, 적립식 투자, 실물 자산",
          strength: "균형 잡힌 재무 관리, 안정적 성장",
          caution: "큰 기회를 놓칠 수 있음, 과감함 필요할 때도"
        };
      }
      
      return {
        verdict: "📊 재물 운세 분석",
        story: "당신의 <em>재성과 식상의 분포</em>에 따라 재물 운이 결정됩니다. 자신에게 맞는 재테크 방법을 찾는 것이 중요해요.",
        jobs: "개인 성향에 맞는 수입원 탐색",
        strength: "상황에 맞는 재테크",
        caution: "극단적 투자 지양"
      };
    }
    
    // 연애운 십성 분석
    function analyzeLoveSipseong(g, d) {
      const gwan = g.gwanseong;
      const jae = g.jaeseong;
      
      if (gwan >= 3) {
        return {
          verdict: "💘 관성 과다 - 인연이 넘치는 사주",
          story: "혹시 <em>이성에게 관심을 많이 받는 편</em>이시죠? 당신의 사주에는 <em>관성(官星)이 과다</em>해요. 이는 이성 인연이 풍부하고, 매력적인 사람들이 주변에 많이 모인다는 뜻이에요. 하지만 선택지가 많다고 좋은 것만은 아니에요. <em>진정한 인연을 알아보는 눈</em>을 키우는 것이 중요합니다. 양보다 질에 집중하세요.",
          strength: "풍부한 인연, 매력 어필, 선택의 기회",
          caution: "우유부단 주의, 바람기로 오해받을 수 있음"
        };
      } else if (gwan === 0) {
        return {
          verdict: "🎯 관성 부재 - 연애보다 자기 세계가 중요한 타입",
          story: "혹시 <em>연애에 크게 목매지 않는 편</em>이시죠? 당신의 사주에는 <em>관성(官星)이 부재</em>해요. 이는 연애보다 자기 발전, 취미, 커리어에 더 큰 관심을 가진다는 뜻이에요. 이런 성향이 나쁜 건 아니지만, 좋은 인연을 놓치지 않으려면 <em>적극적으로 인연을 찾아 나서는 노력</em>이 필요해요. 소개팅이나 모임에 한번 나가보는 건 어떨까요?",
          strength: "독립적, 자기 세계 확립, 연애에 휘둘리지 않음",
          caution: "수동적 태도로 인연 놓침, 관심 표현 연습 필요"
        };
      } else if (d.jeonggwan >= 1 && d.pyeongwan === 0) {
        return {
          verdict: "💍 정관격 - 진지하고 순수한 연애 스타일",
          story: "당신의 사주에는 <em>정관(正官)만 있고 편관은 없어요</em>. 이건 연애에서 굉장히 좋은 구조예요. 한 사람에게 진심을 다하고, <em>가볍게 만나는 연애를 싫어하는</em> 타입이거든요. 결혼 운이 좋고, 안정적이고 따뜻한 가정을 꾸릴 가능성이 높아요. 당신의 진심은 반드시 전해질 거예요.",
          strength: "진지함, 헌신, 결혼 운 양호, 안정적 관계",
          caution: "이상이 높아 상대를 찾기 어려울 수 있음"
        };
      } else if (d.pyeongwan >= 2) {
        return {
          verdict: "🔥 편관 과다 - 드라마틱하고 강렬한 연애형",
          story: "혹시 <em>연애가 조용하게 진행되지 않는 편</em>이시죠? 당신의 사주에는 <em>편관(偏官)이 과다</em>해요. 이는 열정적이고 강렬한 연애를 한다는 뜻이에요. 밀당보다는 <em>솔직한 감정 표현</em>이 당신에게 더 잘 맞아요. 감정 기복이 있을 수 있으니 감정 조절 연습도 해보세요.",
          strength: "열정, 카리스마, 강한 끌림, 뜨거운 사랑",
          caution: "감정 기복, 관계 불안정, 질투심 조절"
        };
      } else if (gwan === 1 || gwan === 2) {
        return {
          verdict: "💕 관성 균형 - 건강하고 자연스러운 연애 운세",
          story: "당신의 사주에는 <em>관성이 적당히</em> 있어요. 이는 연애에 대한 건강한 관심과 좋은 관계 형성 능력을 가지고 있다는 뜻이에요. 억지로 인연을 찾기보다 <em>자연스러운 만남</em>에서 좋은 사람을 만날 가능성이 높아요. 조급해하지 말고 천천히 인연을 만들어가세요.",
          strength: "균형 잡힌 연애관, 자연스러운 관계",
          caution: "소극적 어프로치, 표현력 강화 필요"
        };
      }
      
      return {
        verdict: "❤️ 연애 운세 분석",
        story: "당신의 <em>관성 분포</em>에 따라 연애 스타일이 결정됩니다. 자신의 성향을 이해하고 그에 맞는 연애를 해보세요.",
        strength: "자기만의 매력",
        caution: "상대방 이해 노력 필요"
      };
    }
    
    // 직장운 십성 분석
    function analyzeCareerSipseong(g, d) {
      const gwan = g.gwanseong;
      const in_ = g.inseong;
      
      if (gwan >= 2 && in_ >= 1) {
        return {
          verdict: "👔 관인상생(官印相生) - 조직에서 승승장구하는 운명",
          story: "혹시 <em>회사에서 인정받는 편</em>이시죠? 그건 우연이 아니에요. 당신의 사주에는 <em>관성(官星)과 인성(印星)이 조화</em>를 이루고 있어서, 조직 내에서 자연스럽게 신뢰를 얻고 승진하는 구조를 타고났어요. 상사에게 인정받고, 후배들에게 존경받는 리더의 자질이 있습니다.",
          jobs: "대기업 관리직, 공무원, 전문직(변호사, 의사), 중간관리자",
          strength: "조직 적응력, 승진 운 양호, 신뢰 획득",
          caution: "창업보다 취업이 유리, 독립 시 신중히"
        };
      } else if (gwan >= 3) {
        return {
          verdict: "⚡ 관성 과다 - 책임감의 무게를 아는 사람",
          story: "혹시 <em>일에 대한 스트레스가 유독 크다</em>고 느끼시나요? 당신의 사주에는 <em>관성(官星)이 과다</em>해요. 이는 책임감이 강하고 프로의식이 뛰어나다는 뜻이지만, 동시에 스스로에게 가혹할 정도로 높은 기준을 적용한다는 의미이기도 해요. 완벽주의를 조금 내려놓고, 적절한 휴식을 취하는 것이 장기적인 성공의 열쇠입니다.",
          jobs: "품질관리, 감사, 법무, 공무원, 규제 관련 분야",
          strength: "책임감, 프로의식, 완벽 추구",
          caution: "번아웃 주의, 과로 경계, 스트레스 관리 필수"
        };
      } else if (gwan === 0) {
        return {
          verdict: "🚀 관성 부재 - 자유로운 영혼의 직업 운세",
          story: "혹시 <em>직장생활이 답답하다</em>고 느끼시나요? 그건 당신이 부족해서가 아니에요. 당신의 사주에는 <em>관성(官星)이 부재</em>해서, 위계질서나 조직의 규율에 맞추는 것이 본능적으로 불편한 거예요. 당신은 누군가의 지시를 받기보다 <em>스스로 결정하고 책임지는 환경</em>에서 훨씬 더 빛을 발합니다. 억지로 조직에 맞추려 하지 마세요.",
          jobs: "프리랜서, 1인 창업, 전문직(변호사, 의사), 예술가, 유튜버, 컨설턴트",
          strength: "자율성, 창의성, 독립심, 자기주도성",
          caution: "고정 수입 불안정, 자기 관리 역량 필요"
        };
      } else if (in_ >= 3) {
        return {
          verdict: "📚 인성 과다 - 배움의 길에서 빛나는 사람",
          story: "혹시 <em>공부하거나 새로운 것을 배우는 게 즐겁다</em>고 느끼시나요? 당신의 사주에는 <em>인성(印星)이 과다</em>해요. 이는 학습 능력이 뛰어나고, 깊이 있는 전문성을 쌓는 데 천부적인 재능이 있다는 뜻이에요. 현장에서 뛰는 것보다 연구하고 가르치는 역할이 더 잘 맞습니다.",
          jobs: "교수, 연구원, 교사, 작가, 분석가, 컨설턴트",
          strength: "학습 능력, 깊은 전문성, 지적 호기심",
          caution: "실행력 보완 필요, 생각이 많아 결정 지연"
        };
      } else if (gwan >= 1 && in_ >= 1) {
        return {
          verdict: "⚖️ 관인 균형 - 안정적인 커리어 운세",
          story: "당신의 사주에는 <em>관성과 인성이 적당히 균형</em>을 이루고 있어요. 이는 조직에서 인정받으면서도 자기 계발을 꾸준히 할 수 있는 좋은 구조예요. 너무 급하게 승진을 노리기보다, <em>실력을 쌓으면서 자연스럽게 기회를 잡는 전략</em>이 당신에게 잘 맞습니다.",
          jobs: "일반 기업, 중견기업, 전문직, 기술직",
          strength: "균형 잡힌 커리어, 꾸준한 성장",
          caution: "현상 유지에 안주하지 말 것, 도전 필요"
        };
      }
      
      return {
        verdict: "💼 직장 운세 분석",
        story: "당신의 <em>관성과 인성의 분포</em>에 따라 직장 운이 결정됩니다. 조직 적응력과 학습 능력의 균형을 찾는 것이 중요해요.",
        jobs: "개인 성향에 맞는 직업 탐색 추천",
        strength: "자기만의 역량 개발",
        caution: "환경에 맞는 선택 필요"
      };
    }
    
    // 건강운 십성 분석
    function analyzeHealthSipseong(g, d) {
      const sik = g.siksang;
      const bi = g.bigeop;
      
      if (sik >= 3) {
        return {
          verdict: "🍽️ 식상 과다 - 에너지 과소비 타입",
          story: "혹시 <em>밥 먹고 나면 유독 피곤</em>하거나, <em>소화가 잘 안 되는 편</em>이시죠? 당신의 사주에는 <em>식상(食傷)이 과다</em>해요. 이는 에너지 표출이 많고 활동적이지만, 그만큼 소화기에 부담이 간다는 뜻이에요. 규칙적인 식사, 천천히 먹기, 충분한 휴식이 당신의 건강을 지키는 핵심이에요.",
          strength: "활발한 대사, 에너지 넘침, 표현력",
          caution: "과식 주의, 소화불량, 과로로 인한 탈진"
        };
      } else if (sik === 0) {
        return {
          verdict: "🧘 식상 부재 - 내면에 쌓이는 스트레스 타입",
          story: "혹시 <em>스트레스를 속으로 삭이는 편</em>이시죠? 당신의 사주에는 <em>식상(食傷)이 부재</em>해요. 이는 감정이나 에너지를 밖으로 표출하기보다 내면에 축적한다는 뜻이에요. 겉으로는 침착해 보여도 안에서는 스트레스가 쌓일 수 있어요. <em>운동, 취미, 대화</em> 등으로 정기적으로 스트레스를 풀어주세요.",
          strength: "내면의 안정, 침착함, 인내심",
          caution: "스트레스 내면화, 우울감 주의, 표현 연습 필요"
        };
      } else if (bi >= 3) {
        return {
          verdict: "💪 비겁 과다 - 타고난 체력의 소유자",
          story: "혹시 <em>체력이 좋은 편</em>이시죠? 당신의 사주에는 <em>비겁(比劫)이 과다</em>해요. 이는 기초 체력이 좋고 회복력이 뛰어나다는 뜻이에요. 활동적인 운동이 잘 맞지만, 과신하다가 부상을 입을 수 있으니 <em>워밍업과 쿨다운</em>은 꼭 챙기세요. 규칙적인 운동으로 넘치는 에너지를 잘 분배하는 것이 중요해요.",
          strength: "타고난 체력, 빠른 회복력, 활동성",
          caution: "과격한 운동으로 부상 주의, 과신 경계"
        };
      } else if (bi === 0) {
        return {
          verdict: "🌿 비겁 부재 - 함께할 때 힘이 나는 타입",
          story: "혹시 <em>혼자 운동하는 것보다 누군가와 함께할 때</em> 더 동기부여가 되시죠? 당신의 사주에는 <em>비겁(比劫)이 부재</em>해요. 이는 혼자 버티는 힘보다 협력과 지원 속에서 에너지를 얻는다는 뜻이에요. 헬스 파트너, 그룹 운동, 팀 스포츠가 당신에게 잘 맞아요. <em>함께하는 건강 관리</em>를 추천드려요.",
          strength: "협력 추구, 팀워크, 함께하는 동기부여",
          caution: "혼자 버티기 어려움, 지속성 유지 노력"
        };
      } else {
        return {
          verdict: "⚖️ 균형 잡힌 건강 운세",
          story: "당신의 사주에는 <em>식상과 비겁이 적당히 균형</em>을 이루고 있어요. 이는 에너지 표출과 체력이 균형 잡혀 있다는 좋은 신호예요. 특별히 약한 부분은 없지만, <em>꾸준한 생활 습관</em>이 장기적인 건강의 핵심이에요. 방심하지 말고 규칙적인 운동과 식사를 유지하세요.",
          strength: "안정적 건강 관리 가능, 균형 잡힌 체질",
          caution: "방심으로 인한 문제 발생 경계"
        };
      }
    }

    // ===== v2.92: 종합 건강 리스크 분석 함수 (보험사 PoC 대응) =====
    function analyzeHealthRisk(result) {
      const elements = result.sajuElements || result.elementAnalysis?.elements;
      const sipseong = result.sipseong;
      const dominant = result.dominant;
      const weak = result.weak;
      
      // 오행 분포 정규화 (영문 키로)
      const elementsEn = {};
      const elMap = { '목': 'wood', '화': 'fire', '토': 'earth', '금': 'metal', '수': 'water' };
      if (elements['목'] !== undefined) {
        Object.entries(elements).forEach(([k, v]) => elementsEn[elMap[k]] = v);
      } else {
        Object.assign(elementsEn, elements);
      }
      
      // 부족 오행 (0~1개)
      const deficientElements = Object.entries(elementsEn)
        .filter(([k, v]) => v <= 1)
        .map(([k]) => k);
      
      // 과다 오행 (3개 이상)
      const excessElements = Object.entries(elementsEn)
        .filter(([k, v]) => v >= 3)
        .map(([k]) => k);
      
      // 1. 취약 장기 분석
      const weakOrgans = [];
      const riskDiseases = [];
      const bodyParts = [];
      const preventionTips = [];
      const checkups = [];
      const foods = { good: [], bad: [] };
      
      deficientElements.forEach(el => {
        const data = HEALTH_BY_ELEMENT[el];
        if (data) {
          weakOrgans.push(data.organs.main, data.organs.sub);
          riskDiseases.push(...data.diseases.deficiency.slice(0, 3));
          bodyParts.push(...data.bodyParts.slice(0, 2));
          preventionTips.push(...data.prevention.slice(0, 2));
          checkups.push(...data.checkups.slice(0, 2));
          foods.good.push(...data.foods.good.slice(0, 2));
          foods.bad.push(...data.foods.bad.slice(0, 1));
        }
      });
      
      excessElements.forEach(el => {
        const data = HEALTH_BY_ELEMENT[el];
        if (data) {
          riskDiseases.push(...data.diseases.excess.slice(0, 2));
          preventionTips.push(...data.prevention.slice(2, 4));
        }
      });
      
      // 2. 십성 기반 추가 리스크
      const sipseongRisks = [];
      if (sipseong) {
        Object.entries(sipseong).forEach(([name, count]) => {
          if (count >= 3 && HEALTH_BY_SIPSEONG[name]) {
            sipseongRisks.push({
              name,
              count,
              ...HEALTH_BY_SIPSEONG[name]
            });
          }
        });
      }
      
      // 3. 건강 리스크 점수 계산 (100점 만점, 높을수록 위험)
      let riskScore = 50; // 기본 점수
      riskScore += deficientElements.length * 15; // 부족 오행당 +15
      riskScore += excessElements.length * 10;    // 과다 오행당 +10
      riskScore += sipseongRisks.length * 8;      // 십성 과다당 +8
      riskScore = Math.min(95, Math.max(20, riskScore));
      
      // 4. 스트레스 유형 결정
      let stressType = '균형형';
      if (deficientElements.includes('wood')) stressType = HEALTH_BY_ELEMENT.wood.stressType;
      else if (deficientElements.includes('fire')) stressType = HEALTH_BY_ELEMENT.fire.stressType;
      else if (excessElements.includes('fire')) stressType = HEALTH_BY_ELEMENT.fire.stressType;
      else if (excessElements.includes('wood')) stressType = HEALTH_BY_ELEMENT.wood.stressType;
      
      // 5. 계절별 주의사항
      const currentMonth = new Date().getMonth() + 1;
      const seasonalRisk = MONTHLY_HEALTH_RISK[currentMonth];
      
      // 6. 월별 건강 운세 (12개월)
      const monthlyHealth = {};
      for (let m = 1; m <= 12; m++) {
        const monthRisk = MONTHLY_HEALTH_RISK[m];
        const isHighRisk = deficientElements.includes(monthRisk.element) || 
                          excessElements.includes(monthRisk.element);
        monthlyHealth[m] = {
          riskLevel: isHighRisk ? 'high' : 'normal',
          element: monthRisk.element,
          warning: monthRisk.risk,
          focus: monthRisk.focus,
          score: isHighRisk ? Math.floor(Math.random() * 20) + 60 : Math.floor(Math.random() * 25) + 35
        };
      }
      
      // 7. 추천 운동 & 검진
      const exercises = [];
      if (HEALTH_BY_ELEMENT[weak]) {
        exercises.push(...HEALTH_BY_ELEMENT[weak].exercises);
      }
      if (HEALTH_BY_ELEMENT[dominant]) {
        exercises.push(...HEALTH_BY_ELEMENT[dominant].exercises.slice(0, 2));
      }
      
      return {
        // 기본 정보
        riskScore,
        riskLevel: riskScore >= 70 ? 'high' : riskScore >= 50 ? 'medium' : 'low',
        
        // 취약점
        weakOrgans: [...new Set(weakOrgans)],
        riskDiseases: [...new Set(riskDiseases)],
        bodyParts: [...new Set(bodyParts)],
        
        // 원인 분석
        deficientElements: deficientElements.map(e => HEALTH_BY_ELEMENT[e]?.name || e),
        excessElements: excessElements.map(e => HEALTH_BY_ELEMENT[e]?.name || e),
        sipseongRisks,
        stressType,
        
        // 예방/관리
        preventionTips: [...new Set(preventionTips)].slice(0, 5),
        checkups: [...new Set(checkups)].slice(0, 4),
        exercises: [...new Set(exercises)].slice(0, 4),
        foods,
        
        // 시간별
        seasonalRisk,
        monthlyHealth,
        
        // 종합 메시지
        summary: generateHealthSummary(riskScore, deficientElements, excessElements, sipseongRisks)
      };
    }
    
    function generateHealthSummary(score, deficient, excess, sipseongRisks) {
      let summary = '';
      
      if (score >= 70) {
        summary = '건강 관리에 각별한 주의가 필요한 사주입니다. ';
      } else if (score >= 50) {
        summary = '전반적으로 균형 잡힌 편이나, 일부 취약점이 있습니다. ';
      } else {
        summary = '건강운이 양호한 사주입니다. ';
      }
      
      if (deficient.length > 0) {
        const names = deficient.map(e => HEALTH_BY_ELEMENT[e]?.name || e).join(', ');
        summary += `${names} 기운이 부족하여 해당 장기 관리가 필요합니다. `;
      }
      
      if (excess.length > 0) {
        const names = excess.map(e => HEALTH_BY_ELEMENT[e]?.name || e).join(', ');
        summary += `${names} 기운이 과다하여 과부하 주의가 필요합니다. `;
      }
      
      if (sipseongRisks.length > 0) {
        summary += `${sipseongRisks[0].name} 과다로 ${sipseongRisks[0].risk}에 주의하세요.`;
      }
      
      return summary;
    }
    
    // 월별 건강운 상세 생성 함수
    function generateMonthlyHealthFortune(month, result) {
      const healthRisk = analyzeHealthRisk(result);
      const monthData = healthRisk.monthlyHealth[month];
      const seasonalData = MONTHLY_HEALTH_RISK[month];
      
      const isHighRisk = monthData.riskLevel === 'high';
      
      const highRiskMsgs = [
        `${month}월은 건강에 특별히 주의가 필요한 시기입니다. ${seasonalData.risk} 당신의 오행 구성상 이 시기에 ${HEALTH_BY_ELEMENT[seasonalData.element]?.organs.main || '관련 장기'}에 부담이 갈 수 있어요. 무리하지 말고 충분한 휴식을 취하세요. 이상 신호가 있으면 미루지 말고 병원을 방문하세요.`,
        `${month}월, ${seasonalData.focus}에 집중하세요. 평소보다 피로감을 더 느낄 수 있고, 면역력도 떨어지기 쉬운 시기입니다. 규칙적인 수면과 영양 섭취가 중요해요. 스트레스 관리도 필수입니다.`,
        `${month}월은 당신에게 건강 관리의 달입니다. ${seasonalData.risk} 예방 차원에서 관련 검진을 받아보는 것도 좋아요. 몸의 신호에 귀 기울이고, 무리한 일정은 조정하세요.`
      ];
      
      const normalMsgs = [
        `${month}월 건강운은 안정적입니다. ${seasonalData.focus}만 신경 쓰면 큰 문제 없이 지나갈 수 있어요. 규칙적인 생활 습관을 유지하고, 가벼운 운동으로 컨디션을 관리하세요.`,
        `${month}월, 전반적으로 양호한 건강 상태가 예상됩니다. 다만 ${seasonalData.risk.split(',')[0]}는 누구에게나 해당되니 기본적인 주의는 필요해요. 충분한 수분 섭취와 적절한 휴식을 챙기세요.`,
        `${month}월은 건강 관리하기 좋은 시기입니다. 새로운 운동을 시작하거나 건강한 습관을 들이기에 적합해요. ${seasonalData.focus}를 목표로 삼아보세요.`
      ];
      
      const tips = isHighRisk 
        ? [
            `${HEALTH_BY_ELEMENT[seasonalData.element]?.checkups[0] || '정기검진'} 권장`,
            `${HEALTH_BY_ELEMENT[seasonalData.element]?.foods.good.slice(0, 2).join(', ') || '균형 잡힌 식단'} 섭취`,
            `${HEALTH_BY_ELEMENT[seasonalData.element]?.exercises[0] || '가벼운 운동'} 추천`,
            `충분한 수면 확보`
          ]
        : [
            `규칙적인 운동 유지`,
            `균형 잡힌 식단`,
            `스트레스 관리`,
            `정기 건강검진`
          ];
      
      return {
        score: monthData.score,
        riskLevel: monthData.riskLevel,
        content: isHighRisk ? highRiskMsgs[month % 3] : normalMsgs[month % 3],
        tips,
        focus: seasonalData.focus,
        element: HEALTH_BY_ELEMENT[seasonalData.element]?.name || seasonalData.element
      };
    }

    // ===== B안: 프리미엄 티저 렌더링 =====
    function renderPremiumTeaser(r) {
      const el = ELEMENTS[r.dominant];
      const stemName = STEMS[r.dayStemIndex].name;
      const mbtiName = r.mbti ? MBTI_DATA[r.mbti].name : '';
      
      // 오행별 힌트 키워드
      const colorHints = {
        wood: '그린/민트 계열',
        fire: '레드/코랄 계열',
        earth: '브라운/베이지 계열',
        metal: '실버/화이트 계열',
        water: '블루/네이비 계열'
      };
      
      const healthParts = {
        wood: '간, 눈, 근육',
        fire: '심장, 혈액순환',
        earth: '소화기관, 위장',
        metal: '폐, 호흡기, 피부',
        water: '신장, 뼈, 관절'
      };
      
      const styleKeywords = {
        wood: '내추럴, 캐주얼',
        fire: '화려함, 트렌디',
        earth: '클래식, 편안함',
        metal: '모던, 미니멀',
        water: '유니크, 플루이드'
      };

      return `
        <div class="premium-section">
          <div class="premium-title">💎 프리미엄 분석</div>
          <div class="premium-grid">
            <div class="premium-item">
              <div class="premium-item-header">
                <span class="premium-item-icon">💄</span>
                <span class="premium-item-title">뷰티</span>
                <span class="premium-item-lock">🔒</span>
              </div>
              <div class="premium-item-hint">"${colorHints[r.dominant]} 컬러가..."</div>
              <div class="premium-item-cta">→ 프리미엄에서 확인</div>
            </div>
            <div class="premium-item">
              <div class="premium-item-header">
                <span class="premium-item-icon">🏥</span>
                <span class="premium-item-title">건강</span>
                <span class="premium-item-lock">🔒</span>
              </div>
              <div class="premium-item-hint">"${healthParts[r.dominant]} 부분 체크가..."</div>
              <div class="premium-item-cta">→ 프리미엄에서 확인</div>
            </div>
            <div class="premium-item">
              <div class="premium-item-header">
                <span class="premium-item-icon">👗</span>
                <span class="premium-item-title">패션</span>
                <span class="premium-item-lock">🔒</span>
              </div>
              <div class="premium-item-hint">"${styleKeywords[r.dominant]} 스타일이..."</div>
              <div class="premium-item-cta">→ 프리미엄에서 확인</div>
            </div>
            <div class="premium-item">
              <div class="premium-item-header">
                <span class="premium-item-icon">📈</span>
                <span class="premium-item-title">투자</span>
                <span class="premium-item-lock">🔒</span>
              </div>
              <div class="premium-item-hint">"${el.name} 기운 투자 타이밍은..."</div>
              <div class="premium-item-cta">→ 프리미엄에서 확인</div>
            </div>
            <div class="premium-item premium-compatibility" onclick="showCompatibilityTeaser()">
              <div class="premium-item-header">
                <span class="premium-item-icon">💑</span>
                <span class="premium-item-title">궁합</span>
                <span class="premium-item-badge">NEW</span>
              </div>
              <div class="premium-item-hint">"나와 잘 맞는 사람은 어떤 사주?"</div>
              <div class="premium-item-cta">→ 상대방 정보 입력하기</div>
            </div>
          </div>
          <div class="premium-coming">🚀 2단계 오픈 시 이용 가능</div>
        </div>
      `;
    }

    function renderElementBars(elements) {
      const elOrder = ['wood', 'fire', 'earth', 'metal', 'water'];
      const maxVal = Math.max(...Object.values(elements));
      return elOrder.map(key => {
        const el = ELEMENTS[key];
        const val = elements[key];
        const pct = (val / maxVal) * 100;
        return `
          <div class="element-row">
            <div class="element-icon"><span>${el.icon}</span><span>${el.name}</span></div>
            <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${el.color}"></div></div>
            <div class="bar-count">${val}</div>
          </div>
        `;
      }).join('');
    }

    function refreshMessage() {
      result.message = MESSAGES[Math.floor(Math.random() * MESSAGES.length)];
      renderResult();
    }

    function showTopic(topicId) {
      document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(`topic-${topicId}`).classList.add('active');
      
      const r = result;
      const el = ELEMENTS[r.dominant];
      const elName = el.name;
      
      // v2.5 B안: 3블록 구조
      let analysis = '';
      
      // 주제 아이콘/이름
      const topicInfo = {
        wealth: { icon: '💰', name: '재물운' },
        love: { icon: '❤️', name: '연애운' },
        career: { icon: '💼', name: '직장운' },
        health: { icon: '💪', name: '건강운' },
        direction: { icon: '🧭', name: '길방위' },
        timing: { icon: '📅', name: '길일' }
      };
      
      const topic = topicInfo[topicId];
      
      // 길방위/길일은 기존 로직 유지
      if (topicId === 'direction' || topicId === 'timing') {
        analysis = getBasicTopicContent(topicId, r);
        document.getElementById('topic-analysis').innerHTML = analysis;
        document.getElementById('topic-analysis').style.display = 'block';
        return;
      }
      
      // ===== 3블록 구조 =====
      analysis = `<div class="topic-title">${topic.icon} ${topic.name}</div>\n\n`;
      
      // === 블록 1: MBTI 관점 ===
      if (r.mbti) {
        const mbtiData = getMbtiTopicInsight(r.mbti, topicId);
        const fullData = getFullMbtiInsight(r.mbti, topicId);
        
        analysis += `<div class="topic-block mbti-block">
<div class="block-header">🧠 MBTI 관점: ${r.mbti}의 ${topic.name}</div>
<div class="block-content">`;
        
        if (fullData) {
          analysis += `<div class="insight-summary">${fullData.summary}</div>
<div class="insight-detail">${fullData.detail}</div>
<div class="insight-tags">
  <span class="tag-strength">💪 강점: ${fullData.strength}</span>
  <span class="tag-caution">⚠️ 주의: ${fullData.caution}</span>
</div>`;
        } else {
          analysis += `<div class="insight-summary">${mbtiData || '분석 준비 중'}</div>`;
        }
        
        analysis += `</div></div>\n\n`;
      }
      
      // === 블록 2: 사주 관점 ===
      analysis += `<div class="topic-block saju-block">
<div class="block-header">🔮 사주 관점: ${elName}(${el.hanja}) 기운</div>
<div class="block-content">`;
      
      analysis += getSajuTopicContent(topicId, r.dominant);
      
      analysis += `</div></div>\n\n`;
      
      // === 블록 3: 통합 조언 ===
      if (r.mbti) {
        const integrated = getIntegratedAdvice(r.mbti, r.dominant, topicId);
        
        if (integrated) {
          analysis += `<div class="topic-block integrated-block">
<div class="block-header">⚡ MBTI × 사주 통합 조언</div>
<div class="block-content">
  <div class="integrated-type">"${integrated.type}"</div>
  <div class="integrated-synergy">✨ 시너지: ${integrated.synergy}</div>
  <div class="integrated-tip">💡 실행 팁: ${integrated.tip}</div>
</div></div>`;
        }
      }
      
      // === 블록 4: 십성(十星) 관점 (C안) ===
      if (r.sipseong) {
        const sipseongInsight = getSipseongTopicInsight(r.sipseong, topicId);
        
        if (sipseongInsight && sipseongInsight.analysis) {
          const { groups, relatedGroups, relatedLabels, analysis: sipAnalysis } = sipseongInsight;
          
          // 관련 십성 그룹의 개수 계산
          const groupNames = {
            bigeop: '비겁',
            siksang: '식상', 
            jaeseong: '재성',
            gwanseong: '관성',
            inseong: '인성'
          };
          
          const groupIcons = {
            bigeop: '👥',
            siksang: '💡', 
            jaeseong: '💰',
            gwanseong: '👔',
            inseong: '📚'
          };
          
          analysis += `<div class="topic-block sipseong-block">
<div class="block-header">🌟 십성(十星) 심층 분석</div>
<div class="block-content">
  <div class="sipseong-chart">`;
          
          // 주요 십성 분포 표시 (더 눈에 띄게)
          relatedGroups.forEach(gKey => {
            const count = groups[gKey];
            const highlight = count >= 2 ? 'highlight' : (count === 0 ? 'zero' : '');
            analysis += `<div class="sipseong-item ${highlight}">
      <span class="sipseong-label">${groupIcons[gKey]} ${groupNames[gKey]}</span>
      <span class="sipseong-count">${count}</span>
      <span class="sipseong-unit">개</span>
    </div>`;
          });
          
          analysis += `</div>
  <div class="sipseong-analysis">
    <div class="sipseong-verdict">${sipAnalysis.verdict}</div>
    <div class="sipseong-story">${sipAnalysis.story}</div>
    ${sipAnalysis.jobs ? `<div class="sipseong-jobs">🎯 <strong>추천 분야:</strong> ${sipAnalysis.jobs}</div>` : ''}
  </div>
  <div class="insight-tags">
    <span class="tag-strength">💪 강점: ${sipAnalysis.strength}</span>
    <span class="tag-caution">⚠️ 주의: ${sipAnalysis.caution}</span>
  </div>
</div></div>`;
        }
      }
      
      document.getElementById('topic-analysis').innerHTML = analysis;
      document.getElementById('topic-analysis').style.display = 'block';
    }
    
    // 확장된 MBTI 인사이트 가져오기
    function getFullMbtiInsight(mbti, topic) {
      const insights = {
        wealth: {
          INTJ: { summary: "장기 전략 투자에 강점", detail: "데이터 기반 분석력으로 시장을 읽는 능력이 뛰어납니다. 감정에 휘둘리지 않고 논리적 판단이 가능해요.", strength: "포트폴리오 설계, 리스크 관리, 장기 수익률", caution: "새로운 기회에 너무 보수적, 직관적 투자 기회 놓침" },
          INTP: { summary: "분석력으로 숨은 가치 발굴", detail: "남들이 못 보는 투자 기회를 찾아내는 안목이 있어요. 복잡한 재무제표도 척척 분석합니다.", strength: "가치투자, 퀀트분석, 새로운 자산군 발굴", caution: "과분석으로 타이밍 놓침, 실행력 부족" },
          ENTJ: { summary: "과감한 투자와 리더십", detail: "큰 그림을 보고 과감하게 베팅할 수 있는 배짱이 있어요. 투자 동호회나 스터디를 이끄는 것도 잘 맞습니다.", strength: "결단력, 대규모 투자, 자산 운용 전략", caution: "과신으로 인한 큰 손실 위험, 타인 의견 무시" },
          ENTP: { summary: "새로운 투자 기회 포착력", detail: "트렌드를 빠르게 읽고 새로운 투자처를 찾아내는 능력이 탁월해요.", strength: "트렌드 선점, 아이디어 투자, 네트워크 활용", caution: "분산 과다로 관리 어려움, 끈기 부족" },
          INFJ: { summary: "가치 투자 성향", detail: "의미 있는 기업, 사회에 기여하는 투자에 끌려요. ESG 투자나 임팩트 투자가 잘 맞습니다.", strength: "장기 비전, 윤리적 투자, 직관적 판단", caution: "수익성보다 가치에 치우침, 현실적 검증 부족" },
          INFP: { summary: "직관적 판단력 보유", detail: "느낌으로 좋은 투자처를 알아보는 감각이 있어요.", strength: "감각적 투자, 창의적 아이디어, 남다른 시각", caution: "감정적 결정, 손절 어려움, 현실 외면" },
          ENFJ: { summary: "인맥 통한 투자 정보력", detail: "사람들과의 관계에서 좋은 투자 정보를 얻는 능력이 있어요.", strength: "네트워크 투자, 정보 수집, 공동 투자 조율", caution: "남 따라 투자, 거절 못 함, 객관성 부족" },
          ENFP: { summary: "트렌드 감각 탁월", detail: "세상의 변화를 빠르게 읽고 다음에 뜰 것을 예측하는 능력이 있어요.", strength: "트렌드 예측, 스토리 투자, 열정적 학습", caution: "충동 투자, 끈기 부족, 관리 소홀" },
          ISTJ: { summary: "꾸준한 적립식 투자 강점", detail: "한번 정한 원칙을 꾸준히 지키는 힘이 최고의 무기예요. 복리의 마법을 가장 잘 누릴 수 있는 타입입니다.", strength: "원칙 고수, 꾸준함, 장기 복리 효과", caution: "변화 적응 느림, 좋은 기회도 의심" },
          ISFJ: { summary: "안전 자산 선호", detail: "리스크를 최소화하면서 안정적인 수익을 추구해요.", strength: "안전한 선택, 원금 보존, 가족 재정 관리", caution: "너무 보수적, 인플레이션 리스크" },
          ESTJ: { summary: "체계적 포트폴리오 관리", detail: "명확한 기준과 원칙으로 자산을 관리해요.", strength: "체계적 관리, 원칙 투자, 목표 달성", caution: "유연성 부족, 감정적 요소 무시" },
          ESFJ: { summary: "주변 조언 영향 큼", detail: "가족, 친구의 투자 성공담에 쉽게 영향받아요.", strength: "정보 수집, 트렌드 파악, 공동체 투자", caution: "묻지마 투자, 남 따라하기, 기준 없음" },
          ISTP: { summary: "실전형 트레이더 기질", detail: "차트 분석과 단기 매매에 강점이 있어요.", strength: "기술적 분석, 단기 매매, 빠른 판단", caution: "장기 투자 어려움, 과매매 위험" },
          ISFP: { summary: "감각적 소비 성향", detail: "좋아하는 것에는 과감하게 쓰는 타입이에요.", strength: "가치 소비, 감각적 투자, 삶의 질 중시", caution: "충동 소비, 저축 어려움, 계획 부족" },
          ESTP: { summary: "리스크 감수하는 대담함", detail: "고위험 고수익 투자를 즐기고, 실제로 그런 환경에서 빛을 발해요.", strength: "과감한 베팅, 위기 대응, 빠른 실행", caution: "도박성 투자, 과신, 손절 실패" },
          ESFP: { summary: "현재 즐기는 성향", detail: "지금 행복하게 사는 것을 중시해서 미래 대비가 약할 수 있어요.", strength: "현재 삶의 질, 인맥 투자, 경험 중시", caution: "미래 대비 부족, 계획 없는 소비" }
        },
        love: {
          INTJ: { summary: "진지한 관계 추구", detail: "깊이 있는 정신적 교감을 원해요. 한번 마음을 주면 헌신적입니다.", strength: "진지함, 헌신, 지적 교감, 장기적 관계", caution: "감정 표현 서툴러 오해받기 쉬움" },
          INTP: { summary: "지적 교감 중시", detail: "대화가 통하는 것이 가장 중요해요.", strength: "지적 호기심, 독립적 관계, 깊은 대화", caution: "일상적 로맨스 서툼, 감정 표현 부족" },
          ENTJ: { summary: "주도적 연애 스타일", detail: "관계에서도 리더십을 발휘하려 해요.", strength: "리더십, 책임감, 목표 지향적 관계", caution: "상대 의견 무시, 통제적으로 보일 수 있음" },
          ENTP: { summary: "재치있는 대화로 매력 발산", detail: "유머와 위트로 상대방을 즐겁게 해줘요.", strength: "재치, 유머, 새로움 추구, 열린 사고", caution: "깊이 부족, 쉽게 지루해함" },
          INFJ: { summary: "영혼의 단짝을 찾는 타입", detail: "표면적인 관계에 만족하지 못하고 진정한 소울메이트를 찾아요.", strength: "깊은 이해, 헌신, 직관적 교감", caution: "이상이 너무 높음, 실망하기 쉬움" },
          INFP: { summary: "로맨틱한 이상주의자", detail: "동화 같은 사랑을 꿈꿔요.", strength: "로맨틱함, 진정성, 창의적 애정 표현", caution: "현실적 기대 조정 필요, 갈등 회피" },
          ENFJ: { summary: "상대방 잘 챙기는 타입", detail: "연인의 필요를 먼저 읽고 챙겨주는 천사 같은 파트너예요.", strength: "배려, 헌신, 관계 조율, 감정적 지지", caution: "자기 희생, 과한 기대, 번아웃" },
          ENFP: { summary: "설렘을 중시", detail: "연애 초반의 두근거림을 사랑해요.", strength: "열정, 창의적 데이트, 긍정 에너지", caution: "쉽게 지루해함, 현실적 문제 회피" },
          ISTJ: { summary: "신뢰와 헌신의 아이콘", detail: "약속을 지키고, 말보다 행동으로 사랑을 증명해요.", strength: "신뢰, 헌신, 책임감, 안정적 관계", caution: "감정 표현 부족, 로맨틱함 부족" },
          ISFJ: { summary: "헌신적인 사랑", detail: "상대방을 위해 묵묵히 헌신하는 타입이에요.", strength: "세심함, 헌신, 안정감, 가정적", caution: "자기 욕구 표현 부족, 과한 희생" },
          ESTJ: { summary: "책임감 있는 파트너", detail: "관계에서도 책임을 다하려 해요.", strength: "책임감, 실질적 지원, 안정적 계획", caution: "융통성 부족, 감정보다 논리" },
          ESFJ: { summary: "따뜻한 배려의 달인", detail: "상대방이 필요한 것을 미리 알아채고 챙겨줘요.", strength: "배려, 사교성, 가족 관계, 화목함", caution: "과한 기대, 인정 욕구" },
          ISTP: { summary: "자유로운 관계 선호", detail: "서로의 공간을 존중하는 관계를 원해요.", strength: "독립적, 쿨한 매력, 자유로운 관계", caution: "감정적 친밀감 부족" },
          ISFP: { summary: "감성적이고 따뜻함", detail: "조용히 곁에 있어주는 타입이에요.", strength: "감성, 따뜻함, 예술적 감각, 섬세함", caution: "갈등 회피, 표현 부족" },
          ESTP: { summary: "액션있는 연애 좋아함", detail: "지루한 건 못 참아요. 함께 새로운 경험을 해요.", strength: "열정, 행동력, 즐거운 데이트", caution: "안정기 관리, 장기적 계획 부족" },
          ESFP: { summary: "즐거운 연애의 달인", detail: "함께 있으면 항상 웃게 되는 타입이에요.", strength: "재미, 긍정, 사교성, 현재 행복", caution: "깊이 있는 대화 부족" }
        },
        career: {
          INTJ: { summary: "전략 기획, 연구 분야에서 빛남", detail: "복잡한 문제를 분석하고 장기 전략을 세우는 일에 강해요.", strength: "전략 수립, 분석, 시스템 설계", caution: "팀워크 연습 필요" },
          INTP: { summary: "혁신적 아이디어 뱅크", detail: "새로운 관점과 창의적인 해결책을 제시하는 능력이 탁월해요.", strength: "창의성, 분석력, 문제 해결, 혁신", caution: "실행력 보완, 마감 관리" },
          ENTJ: { summary: "리더십 포지션 적합", detail: "조직을 이끌고 목표를 달성하는 것에 천부적인 재능이 있어요.", strength: "리더십, 결단력, 목표 달성", caution: "세부사항 위임 필요" },
          ENTP: { summary: "새 프로젝트 시작에 강점", detail: "0에서 1을 만들어내는 능력이 뛰어나요.", strength: "아이디어, 적응력, 네트워킹", caution: "마무리 집중 필요" },
          INFJ: { summary: "비전 제시와 팀 화합", detail: "큰 그림을 보여주고 팀원들의 마음을 하나로 모으는 능력이 있어요.", strength: "비전, 팀 화합, 상담, 글쓰기", caution: "경계 설정 필요" },
          INFP: { summary: "창의적 역할에서 빛남", detail: "진정성 있는 콘텐츠, 의미 있는 프로젝트에서 열정을 발휘해요.", strength: "창의성, 진정성, 공감", caution: "현실적 목표 설정" },
          ENFJ: { summary: "팀 리딩과 멘토링 최고", detail: "사람들을 이끌고 성장시키는 것에 재능이 있어요.", strength: "팀 리딩, 멘토링, 동기부여", caution: "번아웃 주의" },
          ENFP: { summary: "아이디어와 네트워킹의 달인", detail: "창의적인 아이디어와 사람을 연결하는 능력이 탁월해요.", strength: "창의력, 네트워킹, 열정", caution: "집중력 보완" },
          ISTJ: { summary: "신뢰받는 실무자", detail: "맡은 일은 반드시 해내는 신뢰의 아이콘이에요.", strength: "신뢰성, 정확성, 꾸준함", caution: "변화 적응력 기르기" },
          ISFJ: { summary: "꼼꼼한 서포터", detail: "팀의 든든한 지원군으로 꼼꼼하게 업무를 처리해요.", strength: "꼼꼼함, 헌신, 팀 지원", caution: "공로 인정받기" },
          ESTJ: { summary: "조직 관리의 달인", detail: "체계적으로 조직을 운영하고 목표를 달성하는 능력이 탁월해요.", strength: "조직력, 효율성, 목표 관리", caution: "유연한 리더십 추가" },
          ESFJ: { summary: "팀 분위기 메이커", detail: "팀의 화합과 분위기를 이끄는 능력이 있어요.", strength: "팀 화합, 고객 응대, 커뮤니케이션", caution: "자기 성과 어필" },
          ISTP: { summary: "문제 해결 전문가", detail: "복잡한 문제를 손으로 직접 해결하는 것을 좋아해요.", strength: "문제 해결, 기술력, 위기 대응", caution: "장기 계획 세우기" },
          ISFP: { summary: "창의적 실무에 강점", detail: "손으로 무언가를 만들거나 예술적인 작업에서 빛을 발해요.", strength: "감각, 창의성, 섬세함", caution: "자기 PR 연습" },
          ESTP: { summary: "위기 대응 능력 탁월", detail: "돌발 상황에서 빠르게 판단하고 행동하는 능력이 뛰어나요.", strength: "순발력, 협상력, 위기 대응", caution: "장기 커리어 설계" },
          ESFP: { summary: "프레젠테이션과 영업에 강점", detail: "사람들 앞에서 빛나고, 설득하는 능력이 탁월해요.", strength: "프레젠테이션, 영업, 적응력", caution: "꾸준함 추가" }
        },
        health: {
          INTJ: { summary: "정신적 피로 관리 중요", detail: "머리를 많이 쓰다 보니 정신적 피로가 쌓이기 쉬워요.", strength: "계획적 건강 관리", caution: "번아웃, 불면증" },
          INTP: { summary: "생각 과다로 수면 부족 주의", detail: "밤에 생각이 많아져서 잠을 못 자는 경우가 많아요.", strength: "건강 정보 분석력", caution: "운동 부족, 카페인 과다" },
          ENTJ: { summary: "과로 주의", detail: "일에 몰두하다 보면 몸이 보내는 신호를 무시하기 쉬워요.", strength: "목표 설정 운동", caution: "과로, 스트레스성 질환" },
          ENTP: { summary: "불규칙한 생활 패턴 조심", detail: "흥미 있는 것에 빠지면 밤새는 것도 마다하지 않아요.", strength: "다양한 운동 시도", caution: "불규칙한 식사, 수면 부족" },
          INFJ: { summary: "감정 소모 주의", detail: "타인의 감정을 흡수하다 보니 에너지가 빨리 소진돼요.", strength: "마음챙김, 명상", caution: "감정적 번아웃" },
          INFP: { summary: "스트레스가 몸으로", detail: "감정적 스트레스가 신체 증상으로 나타나기 쉬워요.", strength: "예술적 치유, 자연 속 휴식", caution: "원인 모를 통증" },
          ENFJ: { summary: "남 챙기다 자기 건강 놓침", detail: "다른 사람을 돌보느라 정작 자기 건강은 뒷전이에요.", strength: "함께하는 운동", caution: "번아웃, 과로" },
          ENFP: { summary: "에너지 과소비 주의", detail: "열정적으로 활동하다 보면 에너지가 갑자기 바닥나요.", strength: "재미있는 운동", caution: "수면 부족" },
          ISTJ: { summary: "무리하다 갑자기 쓰러짐", detail: "아파도 티 안 내고 버티다가 갑자기 쓰러지는 타입이에요.", strength: "규칙적인 운동", caution: "과로, 경고 신호 무시" },
          ISFJ: { summary: "스트레스를 안으로 삼킴", detail: "힘들어도 표현하지 않고 혼자 삭이는 경향이 있어요.", strength: "꾸준한 건강 습관", caution: "소화 문제" },
          ESTJ: { summary: "긴장성 두통/어깨 주의", detail: "책임감과 압박으로 인해 긴장성 두통이 생기기 쉬워요.", strength: "체계적 건강 관리", caution: "긴장 이완 부족" },
          ESFJ: { summary: "감정 기복이 건강에 영향", detail: "인간관계의 스트레스가 건강에 직접적인 영향을 미쳐요.", strength: "그룹 운동", caution: "감정적 식이" },
          ISTP: { summary: "무모한 도전으로 부상 주의", detail: "스릴을 즐기다가 부상을 당하기 쉬워요.", strength: "실용적 운동", caution: "부상 위험" },
          ISFP: { summary: "감성적 스트레스 관리 중요", detail: "예민한 감성이 스트레스에 취약할 수 있어요.", strength: "자연 속 휴식", caution: "스트레스 회피" },
          ESTP: { summary: "과격한 활동 부상 주의", detail: "익스트림 스포츠를 좋아해서 부상 위험이 높아요.", strength: "활동적 운동", caution: "부상, 과음" },
          ESFP: { summary: "과식/과음 주의", detail: "즐기는 것을 좋아해서 절제가 어려울 수 있어요.", strength: "즐거운 운동", caution: "과식, 과음" }
        }
      };
      
      return insights[topic]?.[mbti] || null;
    }
    
    // 사주 오행별 주제 콘텐츠
    function getSajuTopicContent(topicId, dominant) {
      const contents = {
        wealth: {
          wood: `🌳 성장하는 투자에 강점이 있어요. 스타트업, 교육 사업, 친환경 분야처럼 성장 가능성이 있는 곳에 투자하면 좋은 결과를 얻을 수 있습니다.

단, 조급하게 수익을 기대하기보다 나무가 자라듯 장기적 관점으로 접근하세요.

💡 추천: 성장주, 적립식 펀드, 자기계발 투자`,
          fire: `🔥 열정적인 투자 스타일을 가지고 있어요. 트렌드를 빠르게 읽고 과감하게 움직이는 것이 강점입니다.

하지만 충동적인 결정은 금물! 중위험 중수익으로 균형을 잡는 것이 좋습니다.

💡 추천: 배당주, 리츠(REITs), 적정 비율의 공격적 펀드`,
          earth: `⛰️ 안정적인 투자를 선호하는 타입이에요. 꾸준히 쌓아가는 것을 좋아합니다.

부동산, 장기 적금, 국채 같은 안전자산이 잘 맞아요. 노후 대비에 강점이 있습니다.

💡 추천: 부동산, 예적금, 채권형 펀드, 연금저축`,
          metal: `⚔️ 논리적이고 분석적인 투자가 강점이에요. 데이터와 숫자를 꼼꼼히 따져보고 결정합니다.

감정에 휘둘리지 않아 손절과 익절 타이밍을 잘 잡는 편이에요.

💡 추천: 가치투자, ETF, 시스템 트레이딩`,
          water: `💧 유연한 재테크 능력이 있어요. 상황에 따라 다양한 전략을 구사할 수 있습니다.

여러 곳에 분산 투자하는 것이 좋고, 물처럼 흐름을 타는 투자가 잘 맞습니다.

💡 추천: 분산 포트폴리오, 글로벌 펀드, 달러 자산`
        },
        love: {
          wood: `🌳 함께 성장하는 관계를 원해요. 서로를 발전시켜주는 파트너에게 끌립니다.

상대방의 성장을 응원해주고 함께 꿈을 키워나가는 것이 이상적입니다.

💕 궁합: 水(수) 또는 火(화) 기운의 파트너와 좋은 케미`,
          fire: `🔥 열정적이고 로맨틱한 연애를 해요! 사랑에 빠지면 온 마음을 다해 표현합니다.

질투나 집착은 줄이고 신뢰를 키우세요.

💕 궁합: 木(목) 또는 土(토) 기운의 파트너와 좋은 케미`,
          earth: `⛰️ 안정적이고 헌신적인 사랑을 해요. 한번 마음을 주면 쉽게 변하지 않습니다.

일상의 소소한 배려로 사랑을 표현하는 타입이에요.

💕 궁합: 火(화) 또는 金(금) 기운의 파트너와 좋은 케미`,
          metal: `⚔️ 진지하고 신중한 연애 스타일이에요. 진정한 인연을 찾으려 합니다.

마음을 좀 더 열고 따뜻한 말 한마디를 건네보세요.

💕 궁합: 土(토) 또는 水(수) 기운의 파트너와 좋은 케미`,
          water: `💧 감성적이고 깊은 사랑을 해요. 상대방의 감정을 잘 읽고 공감해줍니다.

솔직하게 감정을 표현하고, 혼자 끙끙 앓지 마세요.

💕 궁합: 金(금) 또는 木(목) 기운의 파트너와 좋은 케미`
        },
        career: {
          wood: `🌳 창의적이고 성장 가능성이 있는 분야에서 빛을 발해요.

스타트업, 교육, 기획, 콘텐츠 제작 분야가 잘 맞아요.

🎯 강점: 아이디어, 추진력, 성장 마인드`,
          fire: `🔥 리더십을 발휘하거나 주목받는 위치에서 능력을 발휘해요.

마케팅, 영업, 엔터테인먼트, 강연 분야가 잘 맞아요.

🎯 강점: 카리스마, 추진력, 프레젠테이션`,
          earth: `⛰️ 안정적이고 체계적인 조직에서 능력을 발휘해요.

공무원, 금융권, 부동산, 요식업 분야가 잘 맞아요.

🎯 강점: 신뢰성, 꾸준함, 조직 관리`,
          metal: `⚔️ 논리적이고 정확함이 요구되는 분야에서 두각을 나타내요.

금융, 법률, IT, 의료, 품질관리 분야가 잘 맞아요.

🎯 강점: 분석력, 정확성, 결단력`,
          water: `💧 유연한 적응력으로 다양한 분야에서 활약할 수 있어요.

예술, 연구, 상담, 물류, 무역 분야가 잘 맞아요.

🎯 강점: 적응력, 소통력, 직관력`
        },
        health: {
          wood: `🌳 간(肝)과 담(膽), 근육과 힘줄에 주의가 필요해요.

규칙적인 스트레칭과 유연성 운동이 필수예요.

🏃 추천 운동: 요가, 필라테스, 등산`,
          fire: `🔥 심장(心)과 소장(小腸), 혈액순환에 주의가 필요해요.

충분한 수면과 휴식이 필수예요.

🏃 추천 운동: 수영, 걷기, 자전거, 명상`,
          earth: `⛰️ 소화기관(脾, 胃)에 주의가 필요해요.

과식을 피하고 규칙적인 식사 습관이 중요해요.

🏃 추천 운동: 걷기, 가벼운 조깅, 스트레칭`,
          metal: `⚔️ 폐(肺)와 대장(大腸), 호흡기와 피부에 주의가 필요해요.

호흡 운동과 피부 관리에 신경 쓰세요.

🏃 추천 운동: 호흡 명상, 수영, 유산소`,
          water: `💧 신장(腎)과 방광(膀胱), 뼈와 관절에 주의가 필요해요.

물을 충분히 마시고 무리한 운동은 피하세요.

🏃 추천 운동: 수중 운동, 스트레칭, 태극권`
        }
      };
      
      return contents[topicId]?.[dominant] || '분석 준비 중입니다.';
    }
    
    // 기본 주제 콘텐츠 (길방위, 길일)
    function getBasicTopicContent(topicId, r) {
      const el = ELEMENTS[r.dominant];
      
      if (topicId === 'direction') {
        return `🧭 길방위

${el.name}(${el.hanja}) 기운이 강한 당신에게 좋은 방위입니다.

📍 주요 길방: ${r.direction}

${el.name} 기운을 보충하거나 균형을 맞추는 방향으로, 중요한 일이 있을 때 참고하세요.

집을 구하거나 여행지를 정할 때, 책상이나 침대 방향을 정할 때 활용할 수 있어요.`;
      }
      
      if (topicId === 'timing') {
        return `📅 길일

${el.name}(${el.hanja}) 기운이 강한 당신의 길일 정보입니다.

🍀 오늘의 행운 숫자: ${r.luckyNums.join(', ')}
🎨 행운의 색상: ${r.luckyColors.name}

중요한 일정을 잡거나 새로운 시작을 할 때 참고하세요.

${el.name} 기운이 강한 날에는 당신의 에너지가 더욱 활성화됩니다.`;
      }
      
      return '';
    }
    

    function openDmModal() {
      const r = result;
      const stem = STEMS[r.pillars.day.stem];
      const branch = BRANCHES[r.pillars.day.branch];
      
      document.getElementById('dm-modal-content').innerHTML = `
        <div class="modal-hanja">${r.dmKey}</div>
        <div class="modal-title">${r.dmInfo.title}</div>
        <div class="modal-section">
          <div class="modal-section-title">일간 - ${stem.name}</div>
          <div class="modal-section-content">${stem.desc}</div>
          <div class="modal-traits">
            <span class="modal-trait">강점: ${stem.strength}</span>
            <span class="modal-trait">약점: ${stem.weak}</span>
          </div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">일지 - ${branch.animal}띠</div>
          <div class="modal-section-content">${branch.emoji} ${ELEMENTS[branch.element].name} 기운 • ${branch.time}</div>
        </div>
        ${r.mbti ? `
        <div class="modal-section">
          <div class="modal-section-title">🧠 + 🔮 조합</div>
          <div class="modal-section-content">${r.mbti} × ${stem.name} = 케미 ${r.chemistry.score}점</div>
        </div>` : ''}
      `;
      document.getElementById('dm-modal').classList.add('active');
    }

    function closeDmModal(e) {
      if (!e || e.target.classList.contains('modal-overlay')) {
        document.getElementById('dm-modal').classList.remove('active');
      }
    }

    // 궁합 모달 함수들
    function showCompatibilityTeaser() {
      document.getElementById('compatibility-modal').classList.add('active');
    }
    
    function closeCompatibilityModal(e) {
      if (!e || e.target.classList.contains('modal-overlay')) {
        document.getElementById('compatibility-modal').classList.remove('active');
        // 입력 화면으로 리셋
        setTimeout(() => showCompatInput(), 300);
      }
    }
    
    // 궁합 관련 상태
    let compatRelation = 'lover';
    let partnerResult = null;
    
    function selectRelation(rel) {
      compatRelation = rel;
      document.querySelectorAll('.compat-rel-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.rel === rel);
      });
    }
    
    function showCompatInput() {
      document.getElementById('compat-input-screen').style.display = 'block';
      document.getElementById('compat-result-screen').style.display = 'none';
    }
    
    function analyzeCompatibility() {
      let year = parseInt(document.getElementById('compat-year').value);
      let month = parseInt(document.getElementById('compat-month').value);
      let day = parseInt(document.getElementById('compat-day').value);
      const gender = document.getElementById('compat-gender').value;
      
      // 유효성 검사
      if (!year || !month || !day || !gender) {
        document.getElementById('compat-error').textContent = '성별, 연도, 월, 일을 입력해주세요.';
        return;
      }
      
      // v2.91: 음력 → 양력 변환
      if (modalCalendarType === 'lunar') {
        const converted = convertLunarToSolar(year, month, day);
        if (converted.success) {
          year = converted.year;
          month = converted.month;
          day = converted.day;
        } else {
          document.getElementById('compat-error').textContent = '음력 날짜 변환에 실패했습니다.';
          return;
        }
      }
      
      document.getElementById('compat-error').textContent = '';
      
      const hour = document.getElementById('compat-hour').value;
      const name = document.getElementById('compat-name').value || '상대방';
      const mbti = document.getElementById('compat-mbti').value;
      
      // 상대방 사주 계산 (year, month, day는 이미 숫자로 변환됨)
      partnerResult = calculateSajuForPartner(year, month, day, hour ? parseInt(hour) : null, mbti);
      partnerResult.name = name;
      partnerResult.mbti = mbti || null;
      
      // 궁합 분석 실행
      const compatibility = calculateCompatibility(result, partnerResult, compatRelation);
      
      // 결과 렌더링
      renderCompatibilityResult(compatibility, name);
      
      // 화면 전환
      document.getElementById('compat-input-screen').style.display = 'none';
      document.getElementById('compat-result-screen').style.display = 'block';
    }
    
    // 상대방 사주 계산 함수
    function calculateSajuForPartner(y, m, d, h, mbti) {
      const unknownHour = (h === null);
      if (unknownHour) h = 12;

      // 사주 계산
      const adjYear = new Date(y, m - 1, d) < new Date(y, 1, 4) ? y - 1 : y;
      const yStem = ((adjYear - 4) % 10 + 10) % 10;
      const yBranch = ((adjYear - 4) % 12 + 12) % 12;
      const mBranch = getSolarTermBranch(y, m, d);
      const mStem = (((yStem % 5) * 2 + 2) + ((mBranch - 2 + 12) % 12)) % 10;
      const base = Date.UTC(1900, 0, 1);
      const birth = Date.UTC(y, m - 1, d);
      const days = Math.floor((birth - base) / 86400000);
      const dStem = ((days % 10) + 10) % 10;
      const dBranch = ((days + 10) % 12 + 12) % 12;
      // v2.92: 30분 기준 시진 계산 (한국 표준시 보정)
      const hBranch = Math.floor((h + 0.5) / 2) % 12;
      const hStem = ((dStem % 5) * 2 + hBranch) % 10;

      // 사주 오행
      const sajuElements = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
      [yStem, mStem, dStem, hStem].forEach(i => sajuElements[STEMS[i].element]++);
      [yBranch, mBranch, dBranch, hBranch].forEach(i => sajuElements[BRANCHES[i].element]++);
      
      // 십성 계산
      const dayStemElement = STEMS[dStem].element;
      const dayStemYin = dStem % 2 === 1;
      
      const generating = { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' };
      const controlling = { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' };
      const generatedBy = { wood: 'water', fire: 'wood', earth: 'fire', metal: 'earth', water: 'metal' };
      const controlledBy = { wood: 'metal', fire: 'water', earth: 'wood', metal: 'fire', water: 'earth' };
      
      const sipseong = {
        '비견': 0, '겁재': 0, '식신': 0, '상관': 0,
        '정재': 0, '편재': 0, '정관': 0, '편관': 0,
        '정인': 0, '편인': 0
      };
      
      [yStem, mStem, hStem].forEach(stemIdx => {
        const stemElement = STEMS[stemIdx].element;
        const stemYin = stemIdx % 2 === 1;
        const sameYinYang = (dayStemYin === stemYin);
        
        if (stemElement === dayStemElement) {
          sipseong[sameYinYang ? '비견' : '겁재']++;
        } else if (stemElement === generating[dayStemElement]) {
          sipseong[sameYinYang ? '식신' : '상관']++;
        } else if (stemElement === controlling[dayStemElement]) {
          sipseong[sameYinYang ? '편재' : '정재']++;
        } else if (stemElement === controlledBy[dayStemElement]) {
          sipseong[sameYinYang ? '편관' : '정관']++;
        } else if (stemElement === generatedBy[dayStemElement]) {
          sipseong[sameYinYang ? '편인' : '정인']++;
        }
      });
      
      [yBranch, mBranch, dBranch, hBranch].forEach(branchIdx => {
        const branchElement = BRANCHES[branchIdx].element;
        if (branchElement === dayStemElement) {
          sipseong['비견']++;
        } else if (branchElement === generating[dayStemElement]) {
          sipseong['식신']++;
        } else if (branchElement === controlling[dayStemElement]) {
          sipseong['편재']++;
        } else if (branchElement === controlledBy[dayStemElement]) {
          sipseong['편관']++;
        } else if (branchElement === generatedBy[dayStemElement]) {
          sipseong['편인']++;
        }
      });

      // 주요 오행
      const sorted = Object.entries(sajuElements).sort((a, b) => b[1] - a[1]);
      const dominant = sorted[0][0];

      const dmKey = STEMS[dStem].hanja + BRANCHES[dBranch].hanja;
      
      return {
        pillars: {
          year: { stem: yStem, branch: yBranch },
          month: { stem: mStem, branch: mBranch },
          day: { stem: dStem, branch: dBranch },
          hour: { stem: hStem, branch: hBranch }
        },
        dayStemIndex: dStem,
        dominant,
        sipseong,
        dmKey
      };
    }
    
    // 오행 상생상극 관계
    const ELEMENT_RELATIONS = {
      // 상생 (生): 나무→불→흙→금→물→나무
      generates: { wood: 'fire', fire: 'earth', earth: 'metal', metal: 'water', water: 'wood' },
      // 상극 (剋): 나무→흙→물→불→금→나무
      overcomes: { wood: 'earth', earth: 'water', water: 'fire', fire: 'metal', metal: 'wood' }
    };
    
    function calculateCompatibility(me, partner, relation) {
      const scores = {
        element: analyzeElementCompat(me, partner),
        dayMaster: analyzeDayMasterCompat(me, partner),
        mbti: analyzeMbtiCompat(me, partner),
        sipseong: analyzeSipseongCompat(me, partner, relation)
      };
      
      // 관계 유형별 가중치
      const weights = {
        lover: { element: 25, dayMaster: 30, mbti: 25, sipseong: 20 },
        friend: { element: 20, dayMaster: 25, mbti: 35, sipseong: 20 },
        business: { element: 30, dayMaster: 25, mbti: 20, sipseong: 25 }
      };
      
      const w = weights[relation];
      const totalScore = Math.round(
        (scores.element.score * w.element + 
         scores.dayMaster.score * w.dayMaster + 
         scores.mbti.score * w.mbti + 
         scores.sipseong.score * w.sipseong) / 100
      );
      
      return {
        total: totalScore,
        grade: getCompatGrade(totalScore),
        relation,
        scores,
        advice: getCompatAdvice(totalScore, relation, scores)
      };
    }
    
    function analyzeElementCompat(me, partner) {
      const myEl = me.dominant;
      const partnerEl = partner.dominant;
      
      let score = 50;
      let relation = 'neutral';
      let desc = '';
      let dynamics = { strength: '', caution: '', tip: '' };
      
      // 같은 오행
      if (myEl === partnerEl) {
        score = 75;
        relation = 'same';
        desc = `둘 다 <em>${ELEMENTS[myEl].name}</em> 기운이 강해요! 서로의 생각과 가치관이 비슷해서 <em>편안한 관계</em>를 유지할 수 있어요. 말하지 않아도 통하는 부분이 많고, 서로를 자연스럽게 이해해요.`;
        dynamics.strength = '서로 이해가 빠르고, 갈등이 적어요';
        dynamics.caution = '비슷해서 새로운 자극이 부족할 수 있어요';
        dynamics.tip = '함께 새로운 경험을 시도해보세요';
      }
      // 내가 상대를 생(生)하는 관계
      else if (ELEMENT_RELATIONS.generates[myEl] === partnerEl) {
        score = 85;
        relation = 'i-generate';
        desc = `당신의 <em>${ELEMENTS[myEl].name}</em>이 상대의 <em>${ELEMENTS[partnerEl].name}</em>을 살려주는 <em>상생(相生) 관계</em>예요! 당신이 자연스럽게 베풀고 지원하는 역할을 하게 되고, 상대는 당신 덕분에 성장해요. 헌신적인 사랑을 하는 타입이에요.`;
        dynamics.strength = '당신의 지원이 상대에게 큰 힘이 돼요';
        dynamics.caution = '너무 많이 주다 보면 지칠 수 있어요';
        dynamics.tip = '가끔은 받는 연습도 해보세요';
      }
      // 상대가 나를 생(生)하는 관계
      else if (ELEMENT_RELATIONS.generates[partnerEl] === myEl) {
        score = 90;
        relation = 'partner-generates';
        desc = `상대의 <em>${ELEMENTS[partnerEl].name}</em>이 당신의 <em>${ELEMENTS[myEl].name}</em>을 살려주는 <em>상생(相生) 관계</em>예요! 상대가 당신을 자연스럽게 지원하고 응원해줘요. 함께 있으면 에너지가 충전되는 느낌을 받을 거예요.`;
        dynamics.strength = '상대의 지지 덕분에 자신감이 올라가요';
        dynamics.caution = '너무 의존하게 될 수 있어요';
        dynamics.tip = '감사함을 자주 표현해주세요';
      }
      // 내가 상대를 극(剋)하는 관계
      else if (ELEMENT_RELATIONS.overcomes[myEl] === partnerEl) {
        score = 45;
        relation = 'i-overcome';
        desc = `당신의 <em>${ELEMENTS[myEl].name}</em>이 상대의 <em>${ELEMENTS[partnerEl].name}</em>을 누르는 <em>상극(相剋) 관계</em>예요. 당신이 주도권을 가지기 쉽고, 상대가 위축될 수 있어요. 하지만 적절한 긴장감이 관계에 활력을 줄 수도 있어요.`;
        dynamics.strength = '당신이 리드하면 일이 잘 풀려요';
        dynamics.caution = '상대가 눌린다고 느낄 수 있어요';
        dynamics.tip = '상대의 의견을 먼저 물어봐주세요';
      }
      // 상대가 나를 극(剋)하는 관계
      else if (ELEMENT_RELATIONS.overcomes[partnerEl] === myEl) {
        score = 40;
        relation = 'partner-overcomes';
        desc = `상대의 <em>${ELEMENTS[partnerEl].name}</em>이 당신의 <em>${ELEMENTS[myEl].name}</em>을 누르는 <em>상극(相剋) 관계</em>예요. 상대가 주도권을 가지기 쉽고, 당신이 맞춰가는 경우가 많을 수 있어요. 균형을 맞추려는 노력이 필요해요.`;
        dynamics.strength = '상대를 통해 성장할 수 있어요';
        dynamics.caution = '자기 주장을 못 할 수 있어요';
        dynamics.tip = '당신의 의견도 충분히 표현하세요';
      }
      // 그 외 (상생도 상극도 아닌 관계)
      else {
        score = 65;
        relation = 'neutral';
        desc = `<em>${ELEMENTS[myEl].name}</em>과 <em>${ELEMENTS[partnerEl].name}</em>은 직접적인 상생/상극 관계가 아니에요. 서로 <em>독립적인 영역</em>을 유지하면서 존중하는 관계가 될 수 있어요. 각자의 개성을 인정하는 것이 중요해요.`;
        dynamics.strength = '서로에게 간섭이 적어 편해요';
        dynamics.caution = '정서적 교감이 부족할 수 있어요';
        dynamics.tip = '의도적으로 대화 시간을 만들어보세요';
      }
      
      return { score, relation, desc, myEl, partnerEl, dynamics };
    }
    
    function analyzeDayMasterCompat(me, partner) {
      const myStem = me.dayStemIndex;
      const partnerStem = partner.dayStemIndex;
      const myBranch = me.pillars.day.branch;
      const partnerBranch = partner.pillars.day.branch;
      
      let score = 50;
      let desc = '';
      const tags = [];
      let dynamics = { strength: '', caution: '', tip: '' };
      
      // 천간 합(合) 관계 체크: 갑기, 을경, 병신, 정임, 무계
      const stemCombos = [[0,5], [1,6], [2,7], [3,8], [4,9]];
      const stemComboNames = ['갑기합(甲己合)', '을경합(乙庚合)', '병신합(丙辛合)', '정임합(丁壬合)', '무계합(戊癸合)'];
      let foundStemCombo = -1;
      stemCombos.forEach(([a,b], idx) => {
        if ((myStem === a && partnerStem === b) || (myStem === b && partnerStem === a)) {
          foundStemCombo = idx;
        }
      });
      
      if (foundStemCombo >= 0) {
        score += 25;
        tags.push({ text: '천간합 💫', type: 'good' });
        desc += `일간이 <em>${stemComboNames[foundStemCombo]}</em>을 이루고 있어요! 이것은 <em>운명적인 끌림</em>을 의미해요. 처음 만났을 때부터 묘하게 마음이 가거나, 오래 알고 지낸 것 같은 편안함을 느꼈을 수 있어요. 천간합은 동양 사주학에서 가장 강력한 인연의 신호 중 하나예요. `;
        dynamics.strength = '설명할 수 없는 끌림과 편안함이 있어요';
      }
      
      // 지지 육합(六合) 체크
      const branchCombos = [[0,1], [2,11], [3,10], [4,9], [5,8], [6,7]]; // 자축, 인해, 묘술, 진유, 사신, 오미
      const branchComboNames = ['자축합(子丑合)', '인해합(寅亥合)', '묘술합(卯戌合)', '진유합(辰酉合)', '사신합(巳申合)', '오미합(午未合)'];
      let foundBranchCombo = -1;
      branchCombos.forEach(([a,b], idx) => {
        if ((myBranch === a && partnerBranch === b) || (myBranch === b && partnerBranch === a)) {
          foundBranchCombo = idx;
        }
      });
      
      if (foundBranchCombo >= 0) {
        score += 20;
        tags.push({ text: '지지육합 ✨', type: 'good' });
        desc += `일지가 <em>${branchComboNames[foundBranchCombo]}</em>을 이루고 있어요! 일지는 일상생활의 패턴을 나타내는데, 육합이 있다면 <em>생활 리듬이 잘 맞아요</em>. 함께 살거나 자주 만나도 스트레스가 적고, 자연스럽게 맞춰가는 부분이 많아요. `;
        dynamics.strength = (dynamics.strength ? dynamics.strength + ', ' : '') + '일상에서 마찰이 적어요';
      }
      
      // 지지 충(沖) 체크
      const branchClash = [[0,6], [1,7], [2,8], [3,9], [4,10], [5,11]]; // 자오, 축미, 인신, 묘유, 진술, 사해
      const branchClashNames = ['자오충(子午沖)', '축미충(丑未沖)', '인신충(寅申沖)', '묘유충(卯酉沖)', '진술충(辰戌沖)', '사해충(巳亥沖)'];
      let foundBranchClash = -1;
      branchClash.forEach(([a,b], idx) => {
        if ((myBranch === a && partnerBranch === b) || (myBranch === b && partnerBranch === a)) {
          foundBranchClash = idx;
        }
      });
      
      if (foundBranchClash >= 0) {
        score -= 15;
        tags.push({ text: '지지충 ⚡', type: 'bad' });
        desc += `일지가 <em>${branchClashNames[foundBranchClash]}</em>을 이루고 있어요. 충(沖)은 <em>긴장감과 갈등</em>을 의미하지만, 동시에 강한 끌림이기도 해요. 서로 다른 점이 자극이 되어 끌리지만, 오래 함께하면 생활 패턴 차이로 마찰이 생길 수 있어요. `;
        dynamics.caution = '생활 방식의 차이를 인정해야 해요';
        dynamics.tip = '각자만의 공간과 시간을 존중해주세요';
      }
      
      // 같은 일간
      if (myStem === partnerStem) {
        score += 10;
        tags.push({ text: '동일 일간', type: 'good' });
        desc += `둘 다 같은 <em>${STEMS[myStem].name}</em> 일간이에요! 사고방식과 가치관이 비슷해서 서로를 <em>거울처럼</em> 느낄 거예요. 장점도 단점도 닮아 있어서, 서로의 모습에서 자신을 발견하게 돼요. `;
        dynamics.strength = (dynamics.strength ? dynamics.strength + ', ' : '') + '생각의 결이 비슷해요';
      }
      
      if (!desc) {
        desc = '특별한 천간합이나 지지 육합/충은 없지만, 이것이 나쁜 것은 아니에요. 오히려 <em>안정적이고 무난한 관계</em>를 유지할 수 있어요. 극적인 끌림보다 서서히 정이 드는 타입의 인연이에요.';
        dynamics.strength = '큰 파도 없이 평온한 관계가 가능해요';
        dynamics.tip = '꾸준한 관심과 노력이 사랑을 키워요';
      }
      
      if (!dynamics.tip) dynamics.tip = '서로의 일상을 공유해보세요';
      if (!dynamics.caution) dynamics.caution = '익숙함에 소홀해지지 않도록 주의하세요';
      
      score = Math.max(30, Math.min(100, score));
      
      return { score, desc, tags, myStem: STEMS[myStem].name, partnerStem: STEMS[partnerStem].name, dynamics };
    }
    
    function analyzeMbtiCompat(me, partner) {
      if (!me.mbti || !partner.mbti) {
        return { 
          score: 60, 
          desc: 'MBTI 정보가 없어 기본 점수를 적용했어요.',
          available: false 
        };
      }
      
      const myMbti = me.mbti;
      const partnerMbti = partner.mbti;
      
      // MBTI 궁합 매트릭스 (간소화)
      const compatMap = {
        // 황금궁합 (90+)
        'INFJ-ENFP': 95, 'INFJ-ENTP': 90, 'INTJ-ENFP': 90, 'INTJ-ENTP': 92,
        'INFP-ENFJ': 95, 'INFP-ENTJ': 88, 'INTP-ENTJ': 90, 'INTP-ENFJ': 85,
        // 좋은 궁합 (75-89)
        'ISFJ-ESFP': 85, 'ISFJ-ESTP': 80, 'ISTJ-ESFP': 82, 'ISTJ-ESTP': 78,
        'ESFJ-ISFP': 85, 'ESFJ-ISTP': 78, 'ESTJ-ISFP': 80, 'ESTJ-ISTP': 75,
        // 같은 유형
        'INTJ-INTJ': 75, 'INFJ-INFJ': 78, 'ENFP-ENFP': 72, 'ENTP-ENTP': 70
      };
      
      const key1 = `${myMbti}-${partnerMbti}`;
      const key2 = `${partnerMbti}-${myMbti}`;
      
      let score = compatMap[key1] || compatMap[key2] || calculateMbtiScore(myMbti, partnerMbti);
      
      // 상세 분석
      const analysis = analyzeMbtiDetail(myMbti, partnerMbti);
      
      return { 
        score, 
        desc: analysis.desc,
        synergies: analysis.synergies,
        conflicts: analysis.conflicts,
        dynamics: analysis.dynamics,
        available: true 
      };
    }
    
    function calculateMbtiScore(m1, m2) {
      let score = 60;
      
      // 같은 축 비교
      if (m1[0] === m2[0]) score += 5; // E/I
      if (m1[1] === m2[1]) score += 8; // S/N - 가장 중요
      if (m1[2] === m2[2]) score += 5; // T/F
      if (m1[3] === m2[3]) score += 4; // J/P
      
      // N-N 또는 S-S는 보너스 (세계관 공유)
      if (m1[1] === m2[1]) score += 5;
      
      // E-I 조합 보너스 (에너지 균형)
      if (m1[0] !== m2[0]) score += 3;
      
      return Math.min(score, 100);
    }
    
    function analyzeMbtiDetail(m1, m2) {
      const synergies = [];
      const conflicts = [];
      let desc = '';
      let dynamics = { strength: '', caution: '', tip: '' };
      
      // E/I 분석
      if (m1[0] !== m2[0]) {
        synergies.push('외향+내향 밸런스');
        desc += `<em>E와 I의 조합</em>은 서로를 보완해요. 외향적인 사람이 사회적 상황을 리드하고, 내향적인 사람이 깊이 있는 대화와 안정감을 제공해요. `;
        dynamics.strength = '서로 다른 에너지로 균형을 맞춰요';
      } else if (m1[0] === 'E') {
        conflicts.push('둘 다 주목받고 싶어할 수 있음');
        desc += `둘 다 <em>외향형(E)</em>이라 함께 있으면 에너지가 넘쳐요! 다만 둘 다 말하고 싶어서 경쟁이 될 수 있어요. `;
        dynamics.caution = '상대 말에 귀 기울이는 연습이 필요해요';
      } else {
        conflicts.push('함께 있어도 각자 세계에 빠질 수 있음');
        desc += `둘 다 <em>내향형(I)</em>이라 조용하고 깊은 관계가 가능해요. 다만 서로 먼저 다가가지 않으면 멀어질 수 있어요. `;
        dynamics.tip = '의도적으로 대화 시간을 만들어보세요';
      }
      
      // S/N 분석
      if (m1[1] !== m2[1]) {
        conflicts.push('현실 vs 이상의 관점 차이');
        desc += `<em>S(현실주의)와 N(이상주의)</em>의 차이가 있어요. 한 명은 구체적인 현실을 보고, 다른 한 명은 가능성과 의미를 봐요. 이 차이가 오해의 원인이 되기도 하지만, 보완도 돼요. `;
        dynamics.caution = (dynamics.caution ? dynamics.caution + ', ' : '') + '같은 상황을 다르게 해석할 수 있어요';
      } else {
        synergies.push(m1[1] === 'N' ? '함께 꿈꾸는 파트너' : '현실적 문제해결 팀');
        if (m1[1] === 'N') {
          desc += `둘 다 <em>직관형(N)</em>이라 아이디어와 가능성에 대한 대화가 잘 통해요. 함께 꿈꾸고 상상하는 것을 즐겨요. `;
        } else {
          desc += `둘 다 <em>감각형(S)</em>이라 현실적이고 실용적인 대화가 잘 통해요. 구체적인 계획을 세우고 실행하는 데 강해요. `;
        }
        dynamics.strength = (dynamics.strength ? dynamics.strength + ', ' : '') + '세상을 보는 시각이 비슷해요';
      }
      
      // T/F 분석
      if (m1[2] !== m2[2]) {
        synergies.push('논리+감성 균형');
        desc += `<em>T(사고형)와 F(감정형)</em>의 조합이에요. 논리적 판단과 감정적 공감이 균형을 이뤄요. 결정을 내릴 때 다양한 관점을 고려할 수 있어요. `;
      } else if (m1[2] === 'T') {
        desc += `둘 다 <em>사고형(T)</em>이라 논리적인 대화가 잘 통해요. 다만 감정 표현이 부족해 서운함이 쌓일 수 있어요. `;
        dynamics.tip = (dynamics.tip ? dynamics.tip + ', ' : '') + '감정도 가끔 말로 표현해주세요';
      } else {
        desc += `둘 다 <em>감정형(F)</em>이라 서로의 감정에 공감을 잘 해요. 다만 갈등 상황에서 논리적 해결이 어려울 수 있어요. `;
      }
      
      // J/P 분석
      if (m1[3] !== m2[3]) {
        conflicts.push('계획 vs 즉흥 스타일 차이');
        desc += `<em>J(계획형)와 P(즉흥형)</em>의 차이가 있어요. 여행 계획, 약속 시간 등에서 스타일 차이가 날 수 있어요. 서로의 방식을 존중하는 것이 중요해요. `;
        dynamics.tip = (dynamics.tip ? dynamics.tip + ', ' : '') + '중요한 일은 미리 합의하세요';
      } else {
        synergies.push(m1[3] === 'J' ? '함께 계획하고 실행' : '유연하게 흘러가는 관계');
      }
      
      if (!dynamics.strength) dynamics.strength = '성격적으로 무난한 조합이에요';
      if (!dynamics.caution) dynamics.caution = '너무 비슷하면 자극이 부족할 수 있어요';
      if (!dynamics.tip) dynamics.tip = '서로의 장점을 자주 표현해주세요';
      
      return { desc, synergies, conflicts, dynamics };
    }
    
    function analyzeSipseongCompat(me, partner, relation) {
      if (!me.sipseong || !partner.sipseong) {
        return { score: 60, desc: '십성 분석 불가' };
      }
      
      let score = 60;
      let desc = '';
      const tips = [];
      
      // 내 십성 분포
      const myJae = (me.sipseong['정재'] || 0) + (me.sipseong['편재'] || 0);
      const myGwan = (me.sipseong['정관'] || 0) + (me.sipseong['편관'] || 0);
      const mySik = (me.sipseong['식신'] || 0) + (me.sipseong['상관'] || 0);
      const myIn = (me.sipseong['정인'] || 0) + (me.sipseong['편인'] || 0);
      const myBi = (me.sipseong['비견'] || 0) + (me.sipseong['겁재'] || 0);
      
      // 상대 십성 분포
      const pJae = (partner.sipseong['정재'] || 0) + (partner.sipseong['편재'] || 0);
      const pGwan = (partner.sipseong['정관'] || 0) + (partner.sipseong['편관'] || 0);
      const pSik = (partner.sipseong['식신'] || 0) + (partner.sipseong['상관'] || 0);
      const pIn = (partner.sipseong['정인'] || 0) + (partner.sipseong['편인'] || 0);
      
      if (relation === 'lover') {
        // 연인 관계 분석
        if (myGwan >= 2 && pGwan >= 2) {
          score -= 10;
          desc += '둘 다 관성이 강해 주도권 다툼이 있을 수 있어요. ';
          tips.push('양보와 타협 연습');
        }
        if (myJae >= 2 && pSik >= 2) {
          score += 15;
          desc += '상대의 재능이 당신에게 도움이 되는 구조예요! ';
        }
        if (mySik >= 2 && pIn >= 2) {
          score += 10;
          desc += '당신의 표현을 상대가 잘 받아줘요. ';
        }
      } else if (relation === 'business') {
        // 비즈니스 관계 분석
        if (myGwan >= 2 && pJae >= 2) {
          score += 20;
          desc += '당신이 관리하고 상대가 수익을 만드는 좋은 구조예요! ';
        }
        if (myIn >= 2 && pSik >= 2) {
          score += 15;
          desc += '서로의 전문성을 보완하는 관계예요. ';
        }
        if (myBi >= 3 && pJae === 0) {
          score -= 10;
          tips.push('수익 모델 명확히 정하기');
        }
      } else {
        // 친구 관계
        if (myBi >= 2 && pSik >= 2) {
          score += 10;
          desc += '편하게 어울리는 친구 관계예요. ';
        }
        if (mySik >= 2 && pSik >= 2) {
          score += 15;
          desc += '함께 있으면 즐거운 조합이에요! ';
        }
      }
      
      if (!desc) {
        desc = '십성 관계에서 특별한 상생/상극은 없어요. 노력으로 좋은 관계를 만들 수 있어요.';
      }
      
      // 추가 분석
      let dynamics = { strength: '', caution: '', tip: '' };
      
      // 비겁 분석 (자존심, 독립성)
      if (myBi >= 3 && (partner.sipseong['비견'] || 0) + (partner.sipseong['겁재'] || 0) >= 3) {
        desc += ' 둘 다 자존심이 강해서 양보하기 어려울 수 있어요.';
        dynamics.caution = '자존심 싸움 주의';
        tips.push('작은 것은 양보하기');
      }
      
      // 인성 분석 (배려, 지원)
      if (myIn >= 2 && pIn >= 2) {
        desc += ' 서로를 배려하고 지원하는 관계가 될 수 있어요.';
        dynamics.strength = '서로를 챙겨주는 관계';
      }
      
      // 식상 분석 (표현, 소통)
      if (mySik >= 2 && pSik >= 2) {
        desc += ' 대화가 잘 통하고 함께 있으면 즐거워요!';
        dynamics.strength = (dynamics.strength ? dynamics.strength + ', ' : '') + '소통이 원활함';
      } else if (mySik === 0 && pSik === 0) {
        desc += ' 둘 다 표현이 서툴 수 있어요. 마음을 말로 표현하는 연습이 필요해요.';
        tips.push('감정 표현 연습하기');
      }
      
      if (!dynamics.strength) dynamics.strength = '서로 다른 점이 오히려 배움이 돼요';
      if (!dynamics.caution) dynamics.caution = '가치관 차이를 인정하는 것이 중요해요';
      if (!dynamics.tip) dynamics.tip = '정기적으로 솔직한 대화 시간을 가져보세요';
      
      return { score: Math.max(40, Math.min(100, score)), desc, tips, dynamics };
    }
    
    function getCompatGrade(score) {
      if (score >= 90) return { text: '천생연분 💫', emoji: '💫', color: '#ffd700' };
      if (score >= 80) return { text: '환상의 케미 ✨', emoji: '✨', color: '#ec4899' };
      if (score >= 70) return { text: '좋은 궁합 💕', emoji: '💕', color: '#22c55e' };
      if (score >= 60) return { text: '무난한 관계 👍', emoji: '👍', color: '#60a5fa' };
      if (score >= 50) return { text: '노력이 필요해요 💪', emoji: '💪', color: '#fbbf24' };
      return { text: '도전적인 관계 🔥', emoji: '🔥', color: '#ef4444' };
    }
    
    function getCompatAdvice(score, relation, scores) {
      const relationNames = { lover: '연인', friend: '친구', business: '비즈니스 파트너' };
      const relName = relationNames[relation];
      
      // 분야별 조언 객체
      const advice = {
        summary: '',
        strengths: [],
        cautions: [],
        tips: [],
        doNot: []
      };
      
      // 종합 요약
      if (score >= 80) {
        advice.summary = `${relName} 관계로 <em>정말 좋은 궁합</em>이에요! 자연스럽게 서로를 이해하고 맞춰가는 관계예요. 특별히 노력하지 않아도 편안함을 느낄 수 있지만, 그렇다고 소홀히 하면 안 돼요.`;
      } else if (score >= 60) {
        advice.summary = `${relName} 관계로 <em>무난한 궁합</em>이에요. 큰 충돌 없이 관계를 유지할 수 있어요. 서로의 차이를 이해하고 맞춰가려는 노력이 있다면 더욱 깊은 관계로 발전할 수 있어요.`;
      } else {
        advice.summary = `${relName} 관계로 <em>도전적인 궁합</em>이에요. 하지만 다름이 반드시 나쁜 것은 아니에요! 오히려 서로에게 부족한 부분을 채워줄 수 있는 관계예요. 차이를 인정하고 존중하면 성장의 기회가 돼요.`;
      }
      
      // 잘 맞는 부분 수집
      if (scores.element.dynamics?.strength) {
        advice.strengths.push(`💚 오행: ${scores.element.dynamics.strength}`);
      }
      if (scores.dayMaster.dynamics?.strength) {
        advice.strengths.push(`💜 일주: ${scores.dayMaster.dynamics.strength}`);
      }
      if (scores.mbti.dynamics?.strength) {
        advice.strengths.push(`💙 성격: ${scores.mbti.dynamics.strength}`);
      }
      if (scores.sipseong.dynamics?.strength) {
        advice.strengths.push(`💛 관계: ${scores.sipseong.dynamics.strength}`);
      }
      
      // 조심해야 할 부분 수집
      if (scores.element.dynamics?.caution) {
        advice.cautions.push(`⚠️ 오행: ${scores.element.dynamics.caution}`);
      }
      if (scores.dayMaster.dynamics?.caution) {
        advice.cautions.push(`⚠️ 일주: ${scores.dayMaster.dynamics.caution}`);
      }
      if (scores.mbti.dynamics?.caution) {
        advice.cautions.push(`⚠️ 성격: ${scores.mbti.dynamics.caution}`);
      }
      if (scores.sipseong.dynamics?.caution) {
        advice.cautions.push(`⚠️ 관계: ${scores.sipseong.dynamics.caution}`);
      }
      
      // 맞춰가야 할 부분 (팁)
      if (scores.element.dynamics?.tip) {
        advice.tips.push(`💡 ${scores.element.dynamics.tip}`);
      }
      if (scores.dayMaster.dynamics?.tip) {
        advice.tips.push(`💡 ${scores.dayMaster.dynamics.tip}`);
      }
      if (scores.mbti.dynamics?.tip) {
        advice.tips.push(`💡 ${scores.mbti.dynamics.tip}`);
      }
      if (scores.sipseong.dynamics?.tip) {
        advice.tips.push(`💡 ${scores.sipseong.dynamics.tip}`);
      }
      
      // 하지 말아야 할 것
      if (scores.element.score < 50) {
        advice.doNot.push('❌ 상대를 바꾸려 하지 마세요');
      }
      if (scores.dayMaster.tags?.some(t => t.text.includes('지지충'))) {
        advice.doNot.push('❌ 생활 방식을 강요하지 마세요');
      }
      if (scores.mbti.conflicts?.length > 1) {
        advice.doNot.push('❌ 성격 차이를 단점으로 비난하지 마세요');
      }
      if (score < 50) {
        advice.doNot.push('❌ 포기하거나 회피하지 마세요');
      }
      
      // 기본값 추가
      if (advice.strengths.length === 0) {
        advice.strengths.push('💚 서로 다른 점이 오히려 신선해요');
      }
      if (advice.cautions.length === 0) {
        advice.cautions.push('⚠️ 익숙함에 소홀해지지 않도록 주의하세요');
      }
      if (advice.tips.length === 0) {
        advice.tips.push('💡 정기적인 대화 시간을 만들어보세요');
      }
      if (advice.doNot.length === 0) {
        advice.doNot.push('❌ 당연하다고 생각하지 마세요');
      }
      
      return advice;
    }
    
    function renderCompatibilityResult(compat, partnerName) {
      const myName = '나';
      const rel = { lover: '연인', friend: '친구', business: '비즈니스' }[compat.relation];
      
      const html = `
        <div class="compat-result-header">
          <div class="compat-vs">
            <div class="compat-person">
              <div class="compat-person-icon">👤</div>
              <div class="compat-person-name">${myName}</div>
              <div class="compat-person-dm">${result.dmKey}</div>
            </div>
            <div class="compat-heart">💕</div>
            <div class="compat-person">
              <div class="compat-person-icon">👤</div>
              <div class="compat-person-name">${partnerName}</div>
              <div class="compat-person-dm">${partnerResult.dmKey}</div>
            </div>
          </div>
          <div class="compat-total-score">
            <div class="compat-score-label">${rel} 궁합 점수</div>
            <div class="compat-score-value">${compat.total}</div>
            <div class="compat-score-grade">${compat.grade.text}</div>
          </div>
        </div>
        
        <!-- 오행 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">🔥</span>
            <span class="compat-section-title">오행 궁합</span>
            <span class="compat-section-score">${compat.scores.element.score}점</span>
          </div>
          <div class="compat-element-grid">
            <div class="compat-element-box">
              <div class="compat-element-icon">${ELEMENTS[compat.scores.element.myEl].icon}</div>
              <div class="compat-element-name">${ELEMENTS[compat.scores.element.myEl].name}</div>
            </div>
            <div class="compat-element-arrow ${compat.scores.element.score >= 70 ? 'good' : compat.scores.element.score >= 50 ? 'neutral' : 'bad'}">
              ${compat.scores.element.score >= 70 ? '💕' : compat.scores.element.score >= 50 ? '↔️' : '⚡'}
            </div>
            <div class="compat-element-box">
              <div class="compat-element-icon">${ELEMENTS[compat.scores.element.partnerEl].icon}</div>
              <div class="compat-element-name">${ELEMENTS[compat.scores.element.partnerEl].name}</div>
            </div>
          </div>
          <div class="compat-section-content">${compat.scores.element.desc}</div>
        </div>
        
        <!-- 일주 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">💫</span>
            <span class="compat-section-title">일주 궁합</span>
            <span class="compat-section-score">${compat.scores.dayMaster.score}점</span>
          </div>
          <div class="compat-section-content">
            ${myName}의 일간 <em>${compat.scores.dayMaster.myStem}</em> × ${partnerName}의 일간 <em>${compat.scores.dayMaster.partnerStem}</em>
            <br><br>
            ${compat.scores.dayMaster.desc}
          </div>
          ${compat.scores.dayMaster.tags?.length ? `
          <div class="compat-tags">
            ${compat.scores.dayMaster.tags.map(t => `<span class="compat-tag ${t.type}">${t.text}</span>`).join('')}
          </div>` : ''}
        </div>
        
        <!-- MBTI 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">🧠</span>
            <span class="compat-section-title">MBTI 궁합</span>
            <span class="compat-section-score">${compat.scores.mbti.score}점</span>
          </div>
          <div class="compat-section-content">
            ${result.mbti && partnerResult.mbti ? 
              `<em>${result.mbti}</em> × <em>${partnerResult.mbti}</em><br><br>${compat.scores.mbti.desc}` :
              compat.scores.mbti.desc
            }
          </div>
          ${compat.scores.mbti.synergies?.length || compat.scores.mbti.conflicts?.length ? `
          <div class="compat-tags">
            ${(compat.scores.mbti.synergies || []).map(s => `<span class="compat-tag good">✓ ${s}</span>`).join('')}
            ${(compat.scores.mbti.conflicts || []).map(c => `<span class="compat-tag bad">! ${c}</span>`).join('')}
          </div>` : ''}
        </div>
        
        <!-- 십성 궁합 -->
        <div class="compat-section">
          <div class="compat-section-header">
            <span class="compat-section-icon">⭐</span>
            <span class="compat-section-title">십성 관계 분석</span>
            <span class="compat-section-score">${compat.scores.sipseong.score}점</span>
          </div>
          <div class="compat-section-content">${compat.scores.sipseong.desc}</div>
          ${compat.scores.sipseong.tips?.length ? `
          <div class="compat-tags">
            ${compat.scores.sipseong.tips.map(t => `<span class="compat-tag tip">💡 ${t}</span>`).join('')}
          </div>` : ''}
        </div>
        
        <!-- 종합 조언 (분야별) -->
        <div class="compat-advice-box">
          <div class="compat-advice-title">💝 종합 조언</div>
          <div class="compat-advice-content">${compat.advice.summary}</div>
        </div>
        
        <div class="compat-section" style="background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(34,197,94,0.2);">
            <span class="compat-section-icon">💚</span>
            <span class="compat-section-title" style="color: #22c55e;">잘 맞는 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.strengths.map(s => `<div style="margin-bottom: 8px;">${s}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(251,191,36,0.2);">
            <span class="compat-section-icon">⚠️</span>
            <span class="compat-section-title" style="color: #fbbf24;">조심해야 할 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.cautions.map(c => `<div style="margin-bottom: 8px;">${c}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(96,165,250,0.1); border: 1px solid rgba(96,165,250,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(96,165,250,0.2);">
            <span class="compat-section-icon">💡</span>
            <span class="compat-section-title" style="color: #60a5fa;">맞춰가면 좋은 부분</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.tips.map(t => `<div style="margin-bottom: 8px;">${t}</div>`).join('')}
          </div>
        </div>
        
        <div class="compat-section" style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);">
          <div class="compat-section-header" style="border-bottom-color: rgba(239,68,68,0.2);">
            <span class="compat-section-icon">🚫</span>
            <span class="compat-section-title" style="color: #ef4444;">하지 말아야 할 것</span>
          </div>
          <div class="compat-section-content">
            ${compat.advice.doNot.map(d => `<div style="margin-bottom: 8px;">${d}</div>`).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('compat-result-content').innerHTML = html;
    }

    function getShareText() {
      if (!result) return '';
      const r = result;
      const mbtiStr = r.mbti ? ` × ${r.mbti}` : '';
      const chemStr = r.chemistry ? `\n⚡ 케미: ${r.chemistry.score}점` : '';
      return `🔮 K-Saju 분석 결과${mbtiStr}

✨ 일주: ${r.dmKey} - ${r.dmInfo.title}
🌟 주 오행: ${ELEMENTS[r.dominant].icon} ${ELEMENTS[r.dominant].name}${chemStr}

나도 분석받기 👇`;
    }

    function shareKakao() {
      window.open(`https://story.kakao.com/share?url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
    function shareTwitter() {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(getShareText())}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
    function copyShareText() {
      navigator.clipboard.writeText(getShareText() + '\n' + window.location.href).then(() => showToast('복사되었습니다!'));
    }
    function showToast(msg) {
      const existing = document.querySelector('.share-toast');
      if (existing) existing.remove();
      const toast = document.createElement('div');
      toast.className = 'share-toast';
      toast.textContent = msg;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    // ===== v2.94: 상세 케미 리포트 생성 (25페이지) =====
    function openChemistryReport() {
      if (!result || !result.mbti) {
        showToast('MBTI 정보가 필요합니다');
        return;
      }
      
      const r = result;
      const mbti = r.mbti;
      const stemIndex = r.dayStemIndex;
      const stem = STEMS[stemIndex];
      const chemKey = `${mbti}_${stemIndex}`;
      const chemData = CHEMISTRY_DB[chemKey];
      const mbtiData = MBTI_DATA[mbti];
      
      if (!chemData) {
        showToast('케미 데이터를 찾을 수 없습니다');
        return;
      }
      
      const gradeColor = GRADE_COLORS[chemData.grade] || '#6495ED';
      const rankText = chemData.score >= 90 ? '상위 5%' : chemData.score >= 80 ? '상위 20%' : chemData.score >= 70 ? '상위 40%' : chemData.score >= 60 ? '상위 60%' : '상위 80%';
      
      // 일간 오행
      const stemOhang = STEM_OHANG[stemIndex];
      const stemOhangName = { '木': '목', '火': '화', '土': '토', '金': '금', '水': '수' }[stemOhang];
      const stemOhangColor = { '木': '#22c55e', '火': '#ef4444', '土': '#eab308', '金': '#a855f7', '水': '#3b82f6' }[stemOhang];
      
      // MBTI 4축 분해
      const axes = mbti.split('');
      const cogStack = COGNITIVE_STACKS[mbti];
      
      // 4축별 관계 계산
      const axisRelations = axes.map(axis => {
        const axisOhang = MBTI_AXIS_OHANG[axis].ohang;
        const rel = getOhangRelation(stemOhang, axisOhang);
        return { axis, axisData: MBTI_AXIS_OHANG[axis], relation: rel };
      });
      
      // 상생/상극/동기 카운트
      const sangCount = axisRelations.filter(a => a.relation.type === '상생').length;
      const geukCount = axisRelations.filter(a => a.relation.type === '상극').length;
      const dongCount = axisRelations.filter(a => a.relation.type === '동기').length;
      
      // MBTI 아이콘
      const MBTI_ICONS = {
        INTJ: '♟️', INTP: '🔬', ENTJ: '👑', ENTP: '💡',
        INFJ: '🌌', INFP: '🌈', ENFJ: '🌟', ENFP: '🦋',
        ISTJ: '📋', ISFJ: '🛡️', ESTJ: '📊', ESFJ: '🏠',
        ISTP: '🔧', ISFP: '🎨', ESTP: '🎲', ESFP: '🎉'
      };
      
      const html = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MBTI × 사주 케미 리포트 - ${mbti} × ${stem.name}</title>
  <style>
    /* ===== 기본 스타일 ===== */
    @page { size: A4; margin: 10mm; }
    * { 
      margin: 0; padding: 0; box-sizing: border-box;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    body { font-family: 'Noto Sans KR', -apple-system, sans-serif; font-size: 10pt; line-height: 1.7; color: #e5e5e5; background: #0a0a0a; }
    .page { width: 210mm; min-height: 280mm; margin: 0 auto; padding: 15mm; background: #0a0a0a; page-break-after: always; overflow: hidden; }
    .page:last-of-type { page-break-after: auto; }
    
    h1 { font-size: 20pt; color: #ffd700; margin-bottom: 12px; text-align: center; letter-spacing: 2px; }
    h2 { font-size: 13pt; color: #ffd700; margin: 20px 0 12px 0; padding-bottom: 6px; border-bottom: 1px solid #333; page-break-after: avoid; }
    h3 { font-size: 11pt; color: #f5c542; margin: 15px 0 8px 0; page-break-after: avoid; }
    h4 { font-size: 10pt; color: #ffd700; margin: 12px 0 6px 0; page-break-after: avoid; }
    .subtitle { text-align: center; color: #888; font-size: 10pt; margin-bottom: 20px; }
    p { margin-bottom: 10px; color: #ccc; }
    strong { color: #ffd700; }
    
    .card { background: #1a1a1a; border: 1px solid #333; border-radius: 10px; padding: 15px; margin: 12px 0; page-break-inside: avoid; }
    .card-title { font-weight: 700; color: #ffd700; margin-bottom: 10px; font-size: 10pt; }
    .highlight-box { background: linear-gradient(135deg, #2a2000, #1a1500); border: 1px solid #ffd700; border-radius: 10px; padding: 15px; margin: 12px 0; page-break-inside: avoid; }
    .score-box { background: linear-gradient(135deg, #1a1020, #0a0510); border: 2px solid ${gradeColor}; border-radius: 14px; padding: 25px; text-align: center; page-break-inside: avoid; }
    .score-number { font-size: 42pt; font-weight: 900; color: ${gradeColor}; text-shadow: 0 0 20px ${gradeColor}40; }
    .versus { display: flex; justify-content: center; gap: 15px; margin: 15px 0; flex-wrap: wrap; align-items: center; page-break-inside: avoid; }
    .versus-item { background: #1a1a1a; border: 1px solid #ffd700; border-radius: 10px; padding: 12px 20px; text-align: center; }
    .versus-arrow { font-size: 20pt; color: #ffd700; }
    
    table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 8pt; page-break-inside: avoid; }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; }
    th { background: #1a1a1a; color: #ffd700; }
    td { background: #0a0a0a; }
    
    .analysis-box { border-radius: 10px; padding: 15px; margin: 12px 0; border: 1px solid #333; line-height: 1.8; page-break-inside: avoid; }
    .analysis-box.positive { background: linear-gradient(135deg, #0a2010, #0a1a0a); border-left: 4px solid #22c55e; }
    .analysis-box.warning { background: linear-gradient(135deg, #2a2000, #1a1500); border-left: 4px solid #eab308; }
    .analysis-box.negative { background: linear-gradient(135deg, #200a0a, #1a0a0a); border-left: 4px solid #ef4444; }
    .analysis-box.info { background: linear-gradient(135deg, #0a1a2a, #0a1020); border-left: 4px solid #3b82f6; }
    .formula-box { background: linear-gradient(135deg, #1a1a2a, #0a0a1a); border: 1px solid #667eea; border-radius: 10px; padding: 20px; margin: 15px 0; text-align: center; page-break-inside: avoid; }
    .strategy-box { background: #1a1a1a; border: 1px dashed #ffd700; border-radius: 10px; padding: 15px; margin: 12px 0; page-break-inside: avoid; }
    .grade-badge { display: inline-block; background: ${gradeColor}; color: #000; padding: 5px 14px; border-radius: 20px; font-weight: bold; font-size: 9pt; }
    
    /* 월별 카드 */
    .month-card { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 12px; margin: 8px 0; page-break-inside: avoid; }
    .month-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .month-title { font-weight: bold; color: #ffd700; font-size: 11pt; }
    .month-badge { background: #333; color: #ffd700; padding: 3px 10px; border-radius: 12px; font-size: 8pt; }
    
    /* ===== 인쇄 최적화 ===== */
    @media print {
      body { background: #0a0a0a !important; }
      .page { margin: 0 !important; width: 100% !important; min-height: auto !important; padding: 12mm !important; }
      .page:last-of-type { page-break-after: auto !important; }
      button, .no-print { display: none !important; }
      h2, h3, h4 { page-break-after: avoid !important; }
      .card, .analysis-box, .highlight-box, .formula-box, .strategy-box, .score-box, .month-card, table, .versus { page-break-inside: avoid !important; }
      tr { page-break-inside: avoid !important; }
    }
    @media screen { body { padding: 20px; background: #000; } .page { margin: 20px auto; box-shadow: 0 0 30px rgba(255,215,0,0.1); } }
    /* ===== 궁합 탭 숨김 (solo 모드) ===== */
    #tab-btn-compat { display: none !important; }
    #tab-compat { display: none !important; }
    #compatibility-modal { display: none !important; }
  </style>
</head>
<body>

<!-- ===== 페이지 1: 표지 ===== -->
<div class="page">
  <div style="text-align:center; padding-top:60px;">
    <p style="font-size:14pt; color:#888;">성격심리학과 동양 명리학의 융합</p>
    <h1 style="font-size:32pt; margin:30px 0; color:#ffd700;">MBTI × 사주 케미 분석</h1>
    <p style="font-size:12pt; color:#666;">당신만의 160분의 1 조합</p>
    
    <div class="score-box" style="margin:50px auto; max-width:400px;">
      <p style="font-size:14pt; margin-bottom:10px; color:${gradeColor};">${mbti} × ${stem.hanja}${stemOhang}</p>
      <div class="score-number">${chemData.score}점</div>
      <p style="margin-top:10px; color:#888;">160가지 조합 중 ${rankText} 시너지</p>
    </div>
    
    <div style="margin-top:50px;">
      <p style="font-size:18pt; font-weight:bold; color:#ffd700;">⭐ ${chemData.title} ⭐</p>
      <p style="font-size:11pt; color:#888; margin-top:10px;">"${chemData.subtitle}"</p>
    </div>
    
    <div style="margin-top:80px; color:#666; font-size:9pt;">
      <p>생성일: ${new Date().toLocaleDateString('ko-KR')}</p>
    </div>
  </div>
</div>

<!-- ===== 페이지 2: 케미 분석 소개 + MBTI×오행 이론 ===== -->
<div class="page">
  <h1>🔮 ${mbti} × ${stem.hanja}${stemOhang} 케미 분석</h1>
  <p class="subtitle">당신만의 MBTI×사주 조합이 만들어내는 특별한 시너지</p>
  
  <div class="versus" style="margin:15px 0;">
    <div class="versus-item">
      <p style="font-size:14pt;">MBTI</p>
      <p style="font-size:22pt; color:#ffd700;">${MBTI_ICONS[mbti]} ${mbti}</p>
      <p style="font-size:8pt;">${mbtiData.name}형</p>
    </div>
    <div class="versus-arrow">×</div>
    <div class="versus-item">
      <p style="font-size:14pt;">사주 일간</p>
      <p style="font-size:22pt; color:${stemOhangColor};">${stem.hanja}${stemOhang}</p>
      <p style="font-size:8pt;">${stem.name}</p>
    </div>
    <div class="versus-arrow">=</div>
    <div class="versus-item">
      <p style="font-size:14pt;">케미 점수</p>
      <p style="font-size:22pt; color:${gradeColor};">${chemData.score}점</p>
      <p style="font-size:8pt;">${chemData.grade}등급</p>
    </div>
  </div>
  
  <div class="card" style="line-height:1.8; padding:12px 15px;">
    <p>기존 서비스들은 사주 따로, MBTI 따로 분석해요. 하지만 <strong>K-Saju 케미 분석</strong>은 MBTI의 4가지 축을 오행(五行)으로 변환해서 사주와 직접 비교해요. 그래서 <strong>"왜 나는 이런 성격인데 저런 행동을 할까?"</strong>의 답을 찾을 수 있어요.</p>
  </div>
  
  <h2>【MBTI → 오행 변환】</h2>
  
  <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:10px 0;">
    ${axes.map((a, i) => {
      const axisLabels = ['에너지', '인식', '판단', '생활'];
      return `<div style="background:#1a1a1a; border:2px solid ${MBTI_AXIS_OHANG[a].color}; padding:10px 15px; border-radius:10px; text-align:center; min-width:70px;">
        <div style="font-size:8pt; color:#888;">${axisLabels[i]}</div>
        <div style="font-size:18pt; color:${MBTI_AXIS_OHANG[a].color}; font-weight:bold;">${a}</div>
        <div style="font-size:14pt; color:${MBTI_AXIS_OHANG[a].color};">${MBTI_AXIS_OHANG[a].ohang}</div>
      </div>`;
    }).join('')}
  </div>
  
  <h2>【${mbti} 오행 vs ${stem.hanja}${stemOhang} 비교 분석】</h2>
  
  <div class="highlight-box" style="line-height:1.8;">
    <p><strong>📌 핵심:</strong> ${mbti}의 오행(${axes.map(a => MBTI_AXIS_OHANG[a].ohang).join(', ')})과 사주 일간 ${stem.hanja}${stemOhang}(${stemOhangName})이 만나 <strong>${chemData.title}</strong>라는 독특한 조합이 탄생해요.</p>
    
    <p style="margin-top:12px;"><strong>🔥 상생 ${sangCount}개:</strong> ${sangCount > 0 ? `${mbti}의 에너지가 ${stem.hanja}${stemOhang}과 자연스럽게 흐르는 영역이에요. 이 부분에서는 노력 대비 성과가 좋고, 스트레스도 적게 받아요. 타고난 시너지를 적극 활용하세요!` : '상생 관계는 없지만, 다른 관계에서 균형을 찾을 수 있어요.'}</p>
    
    <p style="margin-top:8px;"><strong>⚡ 동기 ${dongCount}개:</strong> ${dongCount > 0 ? `같은 오행 에너지가 만나 2배로 강화되는 영역이에요! ${mbti}의 특성과 ${stem.hanja}${stemOhang}의 기운이 완벽하게 일치하는 부분으로, 이 영역은 당신의 <strong>핵심 강점</strong>이에요.` : '동기 관계가 없어도 괜찮아요. 오히려 다양한 에너지의 조합이 풍부한 관점을 만들어줘요.'}</p>
    
    <p style="margin-top:8px;"><strong>💫 상극 ${geukCount}개:</strong> ${geukCount > 0 ? `긴장이 있지만, 이건 <strong>성장의 동력</strong>이에요. ${mbti}의 성향과 ${stem.hanja}${stemOhang}의 기운이 부딪히는 부분에서 내면의 갈등을 느낄 수 있어요. 하지만 이 긴장을 인식하고 활용하면 깊이와 균형이 생겨요.` : '상극 관계가 없어서 내면의 갈등이 적은 편이에요. 안정적이지만, 때로는 의도적인 도전이 성장에 도움이 돼요.'}</p>
  </div>
  
  <h3 style="margin-top:40px;">📊 케미 점수 산출</h3>
  
  <table style="font-size:9pt;">
    <tr><th>분석 항목</th><th>결과</th><th>점수</th></tr>
    <tr><td>MBTI 4축 × 오행 관계</td><td>상생 ${sangCount}, 동기 ${dongCount}, 상극 ${geukCount}</td><td>+${sangCount * 5 + dongCount * 3}</td></tr>
    <tr><td>인지기능 × 일간</td><td>${cogStack.desc}</td><td>+10</td></tr>
    <tr><td>${mbti} × ${stem.hanja}${stemOhang} 시너지</td><td>${chemData.advice.slice(0, 20)}...</td><td>+8</td></tr>
    <tr style="background:#2a2000;"><td colspan="2" style="color:#ffd700;"><strong>최종 케미 점수</strong></td><td style="color:#ffd700;"><strong>${chemData.score}점 (${chemData.grade})</strong></td></tr>
  </table>
  
  <h3>💡 ${chemData.score}점 케미를 200% 활용하는 법</h3>
  
  <div class="analysis-box ${chemData.score >= 75 ? 'positive' : chemData.score >= 50 ? 'info' : 'warning'}" style="line-height:1.8;">
    <p>${chemData.score >= 75 ? `<strong>A등급 케미</strong>를 가진 당신은 ${mbti}의 특성과 ${stem.hanja}${stemOhang}의 기운이 자연스럽게 조화를 이뤄요. 이 시너지를 최대한 활용하려면, ${axes[0] === 'E' ? '사람들과의 교류에서 당신의 火 에너지를 발산하면서도' : '내면의 깊이를 탐구하는 水 에너지를 활용하면서도'} ${stem.hanja}${stemOhang}의 ${stemOhangName} 기운을 의식적으로 조절해보세요.` : chemData.score >= 50 ? `<strong>B등급 케미</strong>는 균형 잡힌 조합이에요. ${mbti}의 ${cogStack.main} 주기능과 ${stem.hanja}${stemOhang}의 에너지가 적절히 조화를 이루고 있어요. 더 높은 시너지를 위해 ${sangCount > 0 ? '상생 관계인 영역을 집중적으로 발전시키고' : '동기 관계인 영역의 강점을 더욱 키우고'}, ${geukCount > 0 ? '상극 관계는 보완점으로 인식해 균형을 맞춰보세요' : '새로운 도전을 통해 성장의 폭을 넓혀보세요'}.` : `<strong>C등급 케미</strong>라고 해서 나쁜 것이 아니에요! 오히려 ${mbti}와 ${stem.hanja}${stemOhang} 사이의 긴장감이 당신을 더 다채롭고 깊이 있는 사람으로 만들어줘요. ${geukCount}개의 상극 관계는 내면의 복잡함을 의미하고, 이 복잡함을 이해하고 활용하면 남들이 갖지 못한 독특한 강점이 돼요.`}</p>
    
    <p style="margin-top:12px;"><strong>🎯 ${mbti} 인지기능 활용법:</strong> ${cogStack.main}(${FUNC_OHANG[cogStack.main].name})은 당신의 가장 강력한 무기예요. ${axes[2] === 'T' ? `논리적 분석력을 발휘해 상황을 체계적으로 정리하고, ${cogStack.aux}로 실행력을 더하세요.` : `공감과 조화의 능력을 발휘해 관계를 이끌고, ${cogStack.aux}로 방향성을 잡으세요.`} ${stem.hanja}${stemOhang}의 ${stemOhangName} 에너지가 이 과정을 ${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '상생' ? '자연스럽게 지원해줘요.' : getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '동기' ? '강력하게 증폭시켜줘요.' : '도전하게 만들어 성장시켜줘요.'}</p>
    
    <p style="margin-top:12px;"><strong>⚡ 에너지 관리 비결:</strong> ${stemOhang === '火' ? '火 일간인 당신은 에너지가 빠르게 타오르고 빠르게 소진돼요. 중간중간 水 에너지(휴식, 명상, 물 관련 활동)로 균형을 맞추면 지속 가능한 성과를 낼 수 있어요.' : stemOhang === '水' ? '水 일간인 당신은 에너지가 깊고 은은해요. 급하게 불태우지 말고 천천히 흐르듯 진행하면 마라톤 같은 장기 성과에 강해요.' : stemOhang === '木' ? '木 일간인 당신은 성장하는 에너지가 있어요. 새로운 것을 배우고 확장할 때 가장 활기차니, 정체되지 않게 도전을 이어가세요.' : stemOhang === '金' ? '金 일간인 당신은 날카롭고 정밀한 에너지가 있어요. 완벽을 추구하되 때로는 "충분히 좋다"에서 멈추는 연습도 필요해요.' : '土 일간인 당신은 안정적이고 신뢰할 수 있는 에너지가 있어요. 변화가 느리더라도 꾸준함이 큰 성과를 만들어요.'}</p>
    
    <p style="margin-top:12px;"><strong>🔮 실전 팁:</strong> ${axes[2] === 'T' ? `논리적인 ${cogStack.main} 기능을 활용해 자신의 패턴을 분석해보세요. 언제 에너지가 높고 낮은지, 어떤 상황에서 ${stemOhang} 기운이 잘 발휘되는지 데이터로 기록하면 자기 이해가 깊어져요. 일주일간 에너지 일지를 써보는 것도 좋아요!` : `공감 능력이 뛰어난 당신은 주변 사람들과의 관계에서 ${stemOhang} 에너지의 흐름을 느껴보세요. 누구와 함께할 때 에너지가 채워지고, 누구와 있을 때 빠지는지 감정으로 파악해보세요. 관계 지도를 그려보면 인사이트를 얻을 수 있어요!`}</p>
  </div>
</div>

<!-- ===== 페이지 3: MBTI×오행 상세 이론 ===== -->
<div class="page">
  <h1>🧭 MBTI × 오행 연결 원리</h1>
  <p class="subtitle">왜 ${mbti}가 ${axes.map(a => MBTI_AXIS_OHANG[a].ohang).join('+')}인가요?</p>
  
  <div class="card" style="line-height:1.8;">
    <p>MBTI의 각 축은 동양 오행의 특성과 놀라울 정도로 일치해요. 이건 동서양 심리학이 인간 본성에 대해 비슷한 통찰을 가졌기 때문이에요.</p>
  </div>
  
  <h2>【MBTI 축 → 오행 변환 원리】</h2>
  
  <table>
    <tr><th>MBTI 축</th><th>유형</th><th>오행</th><th>연결 이유</th></tr>
    <tr><td rowspan="2">에너지 방향</td><td style="color:#ef4444;">E 외향</td><td style="color:#ef4444;">火</td><td>에너지를 밖으로 발산, 뜨거운 열정</td></tr>
    <tr><td style="color:#3b82f6;">I 내향</td><td style="color:#3b82f6;">水</td><td>에너지를 안으로 수렴, 깊은 내면</td></tr>
    <tr><td rowspan="2">인식 기능</td><td style="color:#eab308;">S 감각</td><td style="color:#eab308;">土</td><td>현실에 뿌리, 구체적이고 실용적</td></tr>
    <tr><td style="color:#22c55e;">N 직관</td><td style="color:#22c55e;">木</td><td>가능성으로 성장, 미래지향적</td></tr>
    <tr><td rowspan="2">판단 기능</td><td style="color:#a855f7;">T 사고</td><td style="color:#a855f7;">金</td><td>날카로운 분석, 논리적 판단</td></tr>
    <tr><td style="color:#22c55e;">F 감정</td><td style="color:#22c55e;">木</td><td>조화와 공감, 관계 중심</td></tr>
    <tr><td rowspan="2">생활 양식</td><td style="color:#eab308;">J 판단</td><td style="color:#eab308;">土</td><td>체계와 안정, 계획적</td></tr>
    <tr><td style="color:#3b82f6;">P 인식</td><td style="color:#3b82f6;">水</td><td>유연한 흐름, 적응적</td></tr>
  </table>
  
  <h2>【${mbti}의 오행 에너지 해석】</h2>
  
  <div class="analysis-box" style="line-height:1.9;">
    <p><strong>${axes[0]} (${axes[0] === 'E' ? '외향' : '내향'}) → ${MBTI_AXIS_OHANG[axes[0]].ohang}:</strong> ${axes[0] === 'E' ? `당신은 에너지를 외부로 발산하는 火의 특성을 가졌어요. 사람들과의 교류에서 에너지를 얻고, 활발한 소통을 즐겨요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '火').type} 관계예요.` : `당신은 에너지를 내면으로 수렴하는 水의 특성을 가졌어요. 혼자만의 시간에서 충전하고, 깊이 있는 사고를 즐겨요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '水').type} 관계예요.`}</p>
    
    <p style="margin-top:10px;"><strong>${axes[1]} (${axes[1] === 'S' ? '감각' : '직관'}) → ${MBTI_AXIS_OHANG[axes[1]].ohang}:</strong> ${axes[1] === 'S' ? `현실적이고 구체적인 土의 에너지가 있어요. 실제 경험과 사실에 기반해 판단하고, 실용적인 해결책을 선호해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '土').type} 관계예요.` : `성장과 가능성을 추구하는 木의 에너지가 있어요. 패턴과 의미를 찾고, 미래의 가능성에 주목해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '木').type} 관계예요.`}</p>
    
    <p style="margin-top:10px;"><strong>${axes[2]} (${axes[2] === 'T' ? '사고' : '감정'}) → ${MBTI_AXIS_OHANG[axes[2]].ohang}:</strong> ${axes[2] === 'T' ? `날카로운 분석력의 金 에너지가 있어요. 논리와 객관성을 중시하고, 공정한 판단을 추구해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '金').type} 관계예요.` : `조화와 공감의 木 에너지가 있어요. 관계와 가치를 중시하고, 사람들의 감정에 민감해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '木').type} 관계예요.`}</p>
    
    <p style="margin-top:10px;"><strong>${axes[3]} (${axes[3] === 'J' ? '판단' : '인식'}) → ${MBTI_AXIS_OHANG[axes[3]].ohang}:</strong> ${axes[3] === 'J' ? `안정과 체계의 土 에너지가 있어요. 계획적이고 조직적으로 일하며, 결정을 내리는 것을 선호해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '土').type} 관계예요.` : `유연함과 적응의 水 에너지가 있어요. 열린 자세로 새로운 정보를 받아들이고, 상황에 맞게 유연하게 대응해요. ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, '水').type} 관계예요.`}</p>
  </div>
  
  <div class="highlight-box" style="margin-top:40px;">
    <p>💡 <strong>종합:</strong> ${mbti}의 ${axes.map(a => MBTI_AXIS_OHANG[a].ohang).join('+')} 에너지와 ${stem.hanja}${stemOhang}의 ${stemOhangName} 에너지가 만나, <strong>상생 ${sangCount}개 / 동기 ${dongCount}개 / 상극 ${geukCount}개</strong>의 관계가 형성돼요. 이 조합이 바로 "${chemData.title}"의 정체성이에요!</p>
  </div>
  
  <h2>【${mbti} × ${stem.hanja}${stemOhang} 관계별 실전 가이드】</h2>
  
  <div class="card" style="line-height:1.8;">
    ${sangCount > 0 ? `<p><strong>✨ 상생 영역 (${sangCount}개) - 타고난 재능</strong></p>
    <p style="margin-left:10px;">상생 관계에서는 노력이 자연스럽게 결실로 이어져요. ${mbti}의 ${cogStack.main}(${FUNC_OHANG[cogStack.main].name}) 기능이 ${stem.hanja}${stemOhang}의 에너지와 상생할 때, 당신은 마치 물 흐르듯 자연스럽게 성과를 만들어낼 수 있어요. 이 영역에서는 자신감을 가지고 적극적으로 도전하세요!</p>` : ''}
    
    ${dongCount > 0 ? `<p style="margin-top:12px;"><strong>🔥 동기 영역 (${dongCount}개) - 2배의 파워</strong></p>
    <p style="margin-left:10px;">같은 오행이 만나 에너지가 2배로 강해지는 영역이에요. ${axes.filter(a => MBTI_AXIS_OHANG[a].ohang === stemOhang).length > 0 ? `특히 ${mbti}의 ${axes.filter(a => MBTI_AXIS_OHANG[a].ohang === stemOhang).join(', ')} 축이 ${stem.hanja}${stemOhang}과 완벽하게 일치해요. 이 강점을 활용해 ${stemOhang === '火' ? '리더십과 추진력' : stemOhang === '水' ? '깊이 있는 통찰력' : stemOhang === '木' ? '성장과 혁신' : stemOhang === '金' ? '분석력과 정확성' : '안정감과 신뢰'}을 발휘하세요!` : '당신의 핵심 에너지가 증폭되는 영역이에요.'}</p>` : ''}
    
    ${geukCount > 0 ? `<p style="margin-top:12px;"><strong>⚡ 상극 영역 (${geukCount}개) - 성장의 기회</strong></p>
    <p style="margin-left:10px;">상극 관계는 긴장과 갈등을 만들지만, 이것이 바로 성장의 씨앗이에요. ${mbti}의 열등기능인 ${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})를 의식적으로 발달시키면, 상극의 긴장이 오히려 균형 잡힌 힘으로 변해요. 이 영역에서 작은 도전을 시작해보세요!</p>` : `<p style="margin-top:12px;"><strong>☯️ 조화로운 조합</strong></p>
    <p style="margin-left:10px;">상극 관계가 없어서 내면의 갈등이 적은 편이에요. 하지만 때로는 의도적인 도전이 성장에 도움이 돼요. ${mbti}의 열등기능인 ${cogStack.inf}를 조금씩 연습해보세요.</p>`}
  </div>
</div>

<!-- ===== 페이지 4-7: 4축별 분석 ===== -->
${axisRelations.map((ar, idx) => {
  const axisNames = { 'E': '외향', 'I': '내향', 'S': '감각', 'N': '직관', 'T': '사고', 'F': '감정', 'J': '판단', 'P': '인식' };
  const axisDescs = {
    'E': '에너지를 외부로 발산하는 성향',
    'I': '에너지를 내부로 수렴하는 성향',
    'S': '현실적이고 구체적인 것을 선호하는 성향',
    'N': '가능성과 아이디어를 탐구하는 성향',
    'T': '논리적으로 분석하고 판단하는 성향',
    'F': '가치와 감정을 중시하는 성향',
    'J': '계획적이고 체계적인 생활 방식',
    'P': '유연하고 즉흥적인 생활 방식'
  };
  const relClass = ar.relation.type === '상생' ? 'positive' : ar.relation.type === '상극' ? 'negative' : 'info';
  const relIcon = ar.relation.type === '상생' ? '✨' : ar.relation.type === '상극' ? '⚡' : '🔥';
  
  return `
<div class="page">
  <h1>${ar.axisData.icon} ${ar.axis}(${axisNames[ar.axis]}) × ${stem.hanja}${stemOhang} 분석</h1>
  <p class="subtitle">${ar.relation.type === '동기' ? '같은 오행 - 에너지 강화' : ar.relation.type === '상생' ? '상생 관계 - 시너지!' : '상극 관계 - 긴장과 성장'}</p>
  
  <div class="versus">
    <div class="versus-item">
      <p style="font-size:20pt; color:${stemOhangColor};">${stem.hanja}</p>
      <p>${stem.name}</p>
    </div>
    <div style="font-size:16pt; color:${ar.relation.color};">${ar.relation.symbol}</div>
    <div class="versus-item">
      <p style="font-size:20pt; color:${ar.axisData.color};">${ar.axis}</p>
      <p>${axisNames[ar.axis]}</p>
    </div>
  </div>
  
  <div class="highlight-box" style="text-align:center;">
    <p style="font-size:14pt;"><strong>${stemOhang} ${ar.relation.type === '동기' ? '=' : ar.relation.type === '상생' ? '→' : '↔'} ${ar.axisData.ohang} = ${ar.relation.type}!</strong></p>
    <p>${ar.relation.desc}</p>
  </div>
  
  <h2>【이게 무슨 의미예요?】</h2>
  
  <div class="card" style="line-height:1.9;">
    <p>MBTI의 <strong>${ar.axis}(${axisNames[ar.axis]})</strong>는 ${axisDescs[ar.axis]}예요.</p>
    <p>이것이 ${ar.axisData.ohang} 오행으로 변환되어, 사주의 ${stem.hanja}${stemOhang}과 <strong>${ar.relation.type}</strong> 관계를 형성해요.</p>
  </div>
  
  <div class="analysis-box ${relClass}" style="line-height:1.9;">
    <strong>${relIcon} ${ar.relation.type === '동기' ? '에너지 강화 효과' : ar.relation.type === '상생' ? '시너지 효과' : '긴장 효과'}</strong><br><br>
    ${ar.relation.type === '동기' ? 
      `<p>같은 오행이 만나면 해당 에너지가 2배로 강화돼요!</p><p>이건 ${axisNames[ar.axis]} 성향이 선천적으로 타고난 것임을 의미해요.</p><p>다만, 과하면 균형이 무너질 수 있으니 의식적인 조절이 필요해요.</p>` :
      ar.relation.type === '상생' ?
      `<p>상생 관계는 자연스러운 시너지를 만들어요!</p><p>${stem.hanja}${stemOhang}의 에너지가 ${ar.axis}(${axisNames[ar.axis]}) 성향을 자연스럽게 지원해줘요.</p><p>이 부분에서 가장 편안하고 자연스러운 모습을 보여줄 수 있어요.</p>` :
      `<p>상극 관계는 내부 긴장을 만들어요.</p><p>하지만 걱정 마세요! 이 긴장은 오히려 성장의 동력이 될 수 있어요.</p><p>${stem.hanja}${stemOhang}의 에너지와 ${ar.axis}(${axisNames[ar.axis]}) 사이의 밀고 당기기가 깊이와 다양성을 만들어줘요.</p>`
    }
  </div>
  
  <div class="strategy-box">
    <h4>💡 활용 전략</h4>
    ${ar.relation.type === '동기' ? 
      `<p>• 이 영역은 자신감을 가지고 발휘하세요</p><p>• 다만, 과열되지 않도록 휴식 시간도 확보하세요</p><p>• ${ar.axisData.ohang}의 반대 오행으로 균형을 맞춰보세요</p>` :
      ar.relation.type === '상생' ?
      `<p>• 이 영역에서 자연스럽게 빛나세요</p><p>• 타고난 시너지를 적극 활용하세요</p><p>• 관련 활동을 통해 에너지를 충전하세요</p>` :
      `<p>• 이 영역에서 완벽을 추구하지 마세요</p><p>• 긴장을 인정하고, 양쪽 모두를 존중하세요</p><p>• 때로는 한 발 물러서서 상황을 관찰하세요</p>`
    }
  </div>
</div>`;
}).join('')}

<!-- ===== 페이지 8: 4축 종합 정리 ===== -->
<div class="page">
  <h1>📊 4축 종합 분석</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang}의 전체 그림</p>
  
  <table>
    <tr><th>MBTI 축</th><th>오행</th><th>일간 오행</th><th>관계</th><th>의미</th></tr>
    ${axisRelations.map(ar => `
    <tr>
      <td>${ar.axis}</td>
      <td style="color:${ar.axisData.color};">${ar.axisData.ohang}</td>
      <td style="color:${stemOhangColor};">${stemOhang}</td>
      <td style="color:${ar.relation.color};">${ar.relation.type}</td>
      <td>${ar.relation.type === '동기' ? '에너지 강화' : ar.relation.type === '상생' ? '자연스러운 시너지' : '성장 긴장'}</td>
    </tr>`).join('')}
  </table>
  
  <h2>【종합 해석】</h2>
  
  <div class="highlight-box" style="line-height:1.9;">
    <p><strong>${mbti} × ${stem.hanja}${stemOhang}</strong> 조합은:</p>
    <p>• <strong style="color:#22c55e;">상생 ${sangCount}개</strong>: 자연스러운 강점 영역</p>
    <p>• <strong style="color:#f59e0b;">동기 ${dongCount}개</strong>: 타고난 에너지 영역</p>
    <p>• <strong style="color:#ef4444;">상극 ${geukCount}개</strong>: 성장과 깊이의 영역</p>
    <p style="margin-top:15px;">${sangCount + dongCount >= 3 ? 
      '전반적으로 조화로운 조합이에요! 자연스럽게 능력을 발휘할 수 있어요.' : 
      sangCount + dongCount >= 2 ?
      '균형 잡힌 조합이에요. 상생 영역은 자신 있게, 상극 영역은 의식적으로 관리하세요.' :
      '도전적인 조합이지만, 그만큼 깊이와 다양성이 있어요. 자기 이해가 중요해요.'}</p>
  </div>
  
  <div class="formula-box">
    <p style="font-size:14pt; margin-bottom:15px;"><strong>"${chemData.title}"의 공식</strong></p>
    <p>${mbti}의 체계성 + ${stem.hanja}${stemOhang}의 에너지</p>
    <p style="font-size:20pt; margin:10px 0;">=</p>
    <p style="font-size:12pt;">"${chemData.subtitle}"</p>
  </div>
</div>

<!-- ===== 페이지 9: 인지기능 스택 × 사주 ===== -->
<div class="page">
  <h1>🧠 인지기능 스택 × 사주</h1>
  <p class="subtitle">${mbti}의 4가지 인지기능과 ${stem.hanja}${stemOhang}의 만남</p>
  
  <div class="card" style="line-height:1.9;">
    <p><strong>인지기능 스택</strong>이란?</p>
    <p>MBTI 유형마다 4가지 인지기능(사고, 감정, 감각, 직관)을 사용하는 순서가 달라요. 이게 같은 유형이라도 개인차가 생기는 이유예요.</p>
  </div>
  
  <h2>【${mbti}의 인지기능 스택】</h2>
  
  <table>
    <tr><th>순위</th><th>기능</th><th>이름</th><th>연결 오행</th><th>일간과 관계</th></tr>
    <tr>
      <td>주기능</td>
      <td style="font-weight:bold;">${cogStack.main}</td>
      <td>${FUNC_OHANG[cogStack.main].name}</td>
      <td style="color:${{ '木': '#22c55e', '火': '#ef4444', '土': '#eab308', '金': '#a855f7', '水': '#3b82f6' }[FUNC_OHANG[cogStack.main].ohang]};">${FUNC_OHANG[cogStack.main].ohang}</td>
      <td>${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type}</td>
    </tr>
    <tr>
      <td>부기능</td>
      <td>${cogStack.aux}</td>
      <td>${FUNC_OHANG[cogStack.aux].name}</td>
      <td style="color:${{ '木': '#22c55e', '火': '#ef4444', '土': '#eab308', '金': '#a855f7', '水': '#3b82f6' }[FUNC_OHANG[cogStack.aux].ohang]};">${FUNC_OHANG[cogStack.aux].ohang}</td>
      <td>${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.aux].ohang).type}</td>
    </tr>
    <tr>
      <td>3차기능</td>
      <td>${cogStack.tert}</td>
      <td>${FUNC_OHANG[cogStack.tert].name}</td>
      <td style="color:${{ '木': '#22c55e', '火': '#ef4444', '土': '#eab308', '金': '#a855f7', '水': '#3b82f6' }[FUNC_OHANG[cogStack.tert].ohang]};">${FUNC_OHANG[cogStack.tert].ohang}</td>
      <td>${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.tert].ohang).type}</td>
    </tr>
    <tr>
      <td>열등기능</td>
      <td style="color:#888;">${cogStack.inf}</td>
      <td>${FUNC_OHANG[cogStack.inf].name}</td>
      <td style="color:${{ '木': '#22c55e', '火': '#ef4444', '土': '#eab308', '金': '#a855f7', '水': '#3b82f6' }[FUNC_OHANG[cogStack.inf].ohang]};">${FUNC_OHANG[cogStack.inf].ohang}</td>
      <td>${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.inf].ohang).type}</td>
    </tr>
  </table>
  
  <h2>【주기능 ${cogStack.main} × ${stem.hanja}${stemOhang}】</h2>
  
  <div class="analysis-box ${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '상생' ? 'positive' : getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '상극' ? 'warning' : 'info'}">
    <p><strong>${FUNC_OHANG[cogStack.main].name}</strong>은 ${mbti}가 가장 자연스럽게 사용하는 기능이에요.</p>
    <p>${FUNC_OHANG[cogStack.main].desc}</p>
    <p style="margin-top:10px;">이 기능이 ${stem.hanja}${stemOhang}과 <strong>${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type}</strong> 관계를 형성해요.</p>
  </div>
  
  <h2>【열등기능 ${cogStack.inf} 주의점】</h2>
  
  <div class="analysis-box warning">
    <p><strong>${FUNC_OHANG[cogStack.inf].name}</strong>은 ${mbti}가 가장 약한 기능이에요.</p>
    <p>스트레스 상황에서 이 기능이 부정적으로 나타날 수 있어요.</p>
    <p style="margin-top:10px;">💡 <strong>팁:</strong> 평소에 이 기능을 의식적으로 연습하면 더 균형 잡힌 성격이 될 수 있어요.</p>
  </div>
</div>

<!-- ===== 페이지 10: 16유형 궁합표 ===== -->
<div class="page">
  <h1>💑 ${stem.hanja}${stemOhang}과 16유형 궁합</h1>
  <p class="subtitle">160개 조합 중 ${mbti}×${stem.hanja}${stemOhang}의 위치</p>
  
  <h2>【궁합 등급표】</h2>
  
  <table style="font-size:8pt;">
    <tr>
      <th>MBTI</th><th>점수</th><th>등급</th>
      <th>MBTI</th><th>점수</th><th>등급</th>
    </tr>
    ${['INTJ', 'INTP', 'ENTJ', 'ENTP', 'INFJ', 'INFP', 'ENFJ', 'ENFP'].map((m, i) => {
      const m2 = ['ISTJ', 'ISFJ', 'ESTJ', 'ESFJ', 'ISTP', 'ISFP', 'ESTP', 'ESFP'][i];
      const k1 = m + '_' + stemIndex;
      const k2 = m2 + '_' + stemIndex;
      const d1 = CHEMISTRY_DB[k1] || { score: 70, grade: 'B' };
      const d2 = CHEMISTRY_DB[k2] || { score: 70, grade: 'B' };
      const hl1 = m === mbti ? 'background:#2a2000;' : '';
      const hl2 = m2 === mbti ? 'background:#2a2000;' : '';
      return '<tr><td style="' + hl1 + '">' + m + '</td><td style="' + hl1 + '">' + d1.score + '</td><td style="' + hl1 + 'color:' + (GRADE_COLORS[d1.grade] || '#888') + ';">' + d1.grade + '</td><td style="' + hl2 + '">' + m2 + '</td><td style="' + hl2 + '">' + d2.score + '</td><td style="' + hl2 + 'color:' + (GRADE_COLORS[d2.grade] || '#888') + ';">' + d2.grade + '</td></tr>';
    }).join('')}
  </table>
  
  <p style="text-align:center; font-size:9pt; color:#888; margin-top:10px;">* 노란 배경 = 현재 조합 (${mbti})</p>
  
  <h2>【${stem.hanja}${stemOhang}과 최고 궁합 TOP 3】</h2>
  
  <div class="card">
    <p>🥇 <strong>ENTJ × ${stem.hanja}${stemOhang}</strong> - 리더십 극대화</p>
    <p>🥈 <strong>ESTJ × ${stem.hanja}${stemOhang}</strong> - 실행력의 정점</p>
    <p>🥉 <strong>ENFJ × ${stem.hanja}${stemOhang}</strong> - 영향력 확대</p>
  </div>
  
  <h2>【${mbti}×${stem.hanja}${stemOhang} (${chemData.score}점)의 위치】</h2>
  
  <div class="highlight-box">
    <p>160가지 조합 중 <strong>${rankText}</strong>에 위치해요!</p>
    <p style="margin-top:10px;">${chemData.score >= 85 ? 
      '최상위권 조합이에요. 자신감을 가지세요!' : 
      chemData.score >= 75 ?
      '상위권 조합이에요. 충분히 좋은 시너지를 낼 수 있어요!' :
      chemData.score >= 65 ?
      '평균 이상의 조합이에요. 의식적인 노력으로 더 좋아질 수 있어요.' :
      '도전적인 조합이지만, 그만큼 성장 잠재력이 커요!'}</p>
  </div>
</div>

<!-- ===== 페이지 11: 케미라벨 심층 해설 1 ===== -->
<div class="page">
  <h1>⭐ ${chemData.title}</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang} 조합만의 특별한 이야기</p>
  
  <div class="highlight-box" style="line-height:1.9;">
    <p style="text-align:center; font-size:14pt;"><strong>"${chemData.subtitle}"</strong></p>
    <p style="text-align:center; margin-top:15px;">${mbti} × ${stem.hanja}${stemOhang} 조합은 마치 <strong>용광로를 운영하는 기술자</strong>와 같아요.<br>${stem.hanja}${stemOhang}의 에너지를 ${mbti}의 체계로 다스려 실질적인 성과를 만들어내는 거예요.</p>
  </div>
  
  <h2>【왜 "${chemData.title}"인가요?】</h2>
  
  <div class="card" style="line-height:1.9;">
    <p>${chemData.title}가 무슨 일을 하는지 생각해보세요.</p>
    <p><strong>꿈(비전)</strong>을 <strong>현실(성과)</strong>로 만들어내요. 그냥 꿈만 꾸는 게 아니라, 실제로 땅 위에 서 있는 무언가를 만들어내는 거죠.</p>
    <p>${mbti}의 <strong>체계적인 실행력</strong>이 ${stem.hanja}${stemOhang}의 <strong>열정과 비전</strong>을 현실에 구현해요.</p>
    <p>그래서 주변 사람들은 종종 이렇게 느껴요:</p>
    <p style="margin-left:20px; color:#666;">"저 사람은 말만 하는 게 아니라, 진짜로 해낸다."</p>
  </div>
  
  <h2>【${mbti}×${stem.hanja}${stemOhang}의 핵심 메커니즘】</h2>
  
  <div class="formula-box">
    <p style="margin-bottom:10px;">🔥 ${stem.hanja}${stemOhang}의 열정과 추진력</p>
    <p style="font-size:24pt; margin:15px 0;">+</p>
    <p style="margin-bottom:10px;">📊 ${mbti}의 체계와 관리 능력</p>
    <p style="font-size:24pt; margin:15px 0;">=</p>
    <p style="font-size:14pt;"><strong>실현 가능한 큰 그림을 그리는 사람</strong></p>
  </div>
</div>

<!-- ===== 페이지 12: 케미라벨 심층 해설 2 ===== -->
<div class="page">
  <h2>【작동 메커니즘】</h2>
  
  <div class="analysis-box positive" style="line-height:1.9;">
    <p><strong>1단계 - ${stem.hanja}${stemOhang}이 점화해요</strong></p>
    <p>어떤 목표나 아이디어가 떠오르면, ${stem.hanja}${stemOhang}의 에너지가 <strong>"이거 해보고 싶다!"</strong>는 동기를 만들어요.</p>
    <p>보통 사람들은 여기서 그냥 상상으로 끝나는 경우가 많아요.</p>
  </div>
  
  <div class="analysis-box info" style="line-height:1.9;">
    <p><strong>2단계 - ${mbti}가 설계해요</strong></p>
    <p>${mbti} 성향이 바로 작동해요. <strong>"이걸 어떻게 실현할까?"</strong></p>
    <p>${cogStack.main}이 논리적으로 단계를 나누고, ${cogStack.aux}가 계획을 세워요.</p>
  </div>
  
  <div class="analysis-box positive" style="line-height:1.9;">
    <p><strong>3단계 - 함께 실행해요</strong></p>
    <p>${stem.hanja}${stemOhang}의 지속적인 에너지 공급 + ${mbti}의 꾸준한 관리가 합쳐져서 <strong>실제로 결과물</strong>이 나와요.</p>
    <p>이게 <strong>"말한 건 해내는 사람"</strong>이 되는 이유예요.</p>
  </div>
  
  <h2>【${stem.hanja}${stemOhang}이 ${mbti}에게 주는 선물】</h2>
  
  <div class="card" style="line-height:1.9;">
    <div class="card-title">🎁 일반 ${mbti}에게 없는 것들</div>
    <p>솔직히 말해서, 일반 ${mbti}는 때로 <strong>딱딱하고 융통성 없다</strong>는 인식이 있어요.</p>
    <p>그런데 ${stem.hanja}${stemOhang}은 이런 ${mbti}의 이미지를 <strong>완전히 바꿔놔요</strong>.</p>
  </div>
  
  <table style="font-size:9pt;">
    <tr><th>영역</th><th>일반 ${mbti}</th><th>${stem.hanja}${stemOhang} + ${mbti}</th></tr>
    <tr><td>첫인상</td><td>차갑고 딱딱함</td><td><strong>따뜻하고 카리스마 있음</strong></td></tr>
    <tr><td>리더십</td><td>규칙과 통제 중심</td><td><strong>비전 제시 + 동기부여</strong></td></tr>
    <tr><td>소통 방식</td><td>지시적</td><td><strong>열정적, 설득력 있음</strong></td></tr>
    <tr><td>문제 해결</td><td>기존 방식 고수</td><td><strong>창의적 접근도 가능</strong></td></tr>
  </table>
</div>

<!-- ===== 페이지 13: ${mbti}가 ${stem.hanja}${stemOhang}에게 주는 선물 ===== -->
<div class="page">
  <h2>【${mbti}가 ${stem.hanja}${stemOhang}에게 주는 선물】</h2>
  
  <div class="card" style="line-height:1.9;">
    <div class="card-title">🛡️ ${stem.hanja}${stemOhang}의 약점을 보완해줘요</div>
    <p>순수 ${stem.hanja}${stemOhang} 기운만 가진 사람들은 종종 <strong>과열</strong> 문제가 생겨요. 충동적이고, 지속력이 부족하고, 세부사항을 놓치죠.</p>
    <p>${mbti}는 이런 ${stem.hanja}${stemOhang}의 에너지를 <strong>안전하게 관리</strong>해줘요.</p>
  </div>
  
  <table style="font-size:9pt;">
    <tr><th>${stem.hanja}${stemOhang}의 약점</th><th>${mbti}가 주는 해결책</th></tr>
    <tr><td>충동적 결정</td><td>${cogStack.main}의 논리적 검토 과정</td></tr>
    <tr><td>지속력 부족</td><td>${cogStack.aux}의 꾸준한 실행 습관</td></tr>
    <tr><td>디테일 놓침</td><td>체계적인 점검 시스템</td></tr>
    <tr><td>과도한 낙관</td><td>현실적 리스크 평가</td></tr>
    <tr><td>갈등 유발</td><td>규칙과 절차로 예방</td></tr>
  </table>
  
  <h2>【"${chemData.title}"로서 잘 맞는 역할】</h2>
  
  <div class="card">
    <p>✅ 프로젝트 매니저 / 팀 리더</p>
    <p>✅ 창업가 / 사업 운영자</p>
    <p>✅ 컨설턴트 / 전략 기획자</p>
    <p>✅ 교육자 / 코치</p>
    <p>✅ 영업 / 마케팅 리더</p>
  </div>
  
  <div class="highlight-box">
    <p>핵심은 <strong>"비전을 현실로 만드는"</strong> 역할이에요.</p>
    <p>아이디어만 있는 사람도 아니고, 실행만 하는 사람도 아닌, <strong>둘 다 할 수 있는</strong> 희귀한 조합이에요!</p>
  </div>
</div>

<!-- ===== 페이지 14: 강점과 주의점 ===== -->
<div class="page">
  <h1>💪 강점 & ⚠️ 주의점</h1>
  <p class="subtitle">${chemData.title}의 양면</p>
  
  <h2>【슈퍼파워 TOP 5】</h2>
  
  <div class="analysis-box positive">
    <p><strong>1. 실행력</strong> - 말한 건 반드시 해낸다</p>
    <p><strong>2. 리더십</strong> - 사람들을 자연스럽게 이끈다</p>
    <p><strong>3. 설득력</strong> - 논리와 열정으로 움직인다</p>
    <p><strong>4. 지속력</strong> - 끝까지 완주한다</p>
    <p><strong>5. 현실감각</strong> - 꿈과 현실의 균형</p>
  </div>
  
  <h2>【그림자 TOP 5】</h2>
  
  <div class="analysis-box warning">
    <p><strong>1. 과열</strong> - 너무 달리다 번아웃</p>
    <p><strong>2. 완고함</strong> - "내 방식이 맞아"</p>
    <p><strong>3. 조급함</strong> - 결과를 빨리 보고 싶어함</p>
    <p><strong>4. 통제욕</strong> - 모든 걸 관리하려 함</p>
    <p><strong>5. 감정 억압</strong> - 약한 모습을 숨김</p>
  </div>
  
  <h2>【균형 전략】</h2>
  
  <div class="strategy-box">
    <h4>🌊 ${stem.hanja}${stemOhang}의 과열을 식히는 水 보충법</h4>
    <p>• 명상, 독서 등 혼자만의 시간 확보</p>
    <p>• 물 관련 활동 (수영, 목욕, 바다 여행)</p>
    <p>• 결정 전 24시간 쿨다운 규칙</p>
    <p>• "멈춤"의 가치를 인정하기</p>
  </div>
</div>

<!-- ===== 페이지 15: 관계 가이드 ===== -->
<div class="page">
  <h1>👥 관계 가이드</h1>
  <p class="subtitle">${chemData.title}의 대인관계 전략</p>
  
  <h2>【이런 사람과 잘 맞아요】</h2>
  
  <div class="analysis-box positive">
    <p>✅ <strong>비전을 함께 나눌 수 있는 사람</strong></p>
    <p>✅ <strong>실행력이 있는 사람</strong></p>
    <p>✅ <strong>솔직하고 직접적인 사람</strong></p>
    <p>✅ <strong>목표 지향적인 사람</strong></p>
    <p>✅ <strong>피드백을 건설적으로 주고받는 사람</strong></p>
  </div>
  
  <h2>【이런 상황은 피하세요】</h2>
  
  <div class="analysis-box negative">
    <p>❌ <strong>결정을 미루는 관계</strong></p>
    <p>❌ <strong>수동적 공격성</strong> (뒤에서 불만)</p>
    <p>❌ <strong>과도한 감정 기복</strong></p>
    <p>❌ <strong>책임 회피</strong></p>
    <p>❌ <strong>비효율적인 회의/미팅</strong></p>
  </div>
  
  <h2>【갈등 해결 팁】</h2>
  
  <div class="strategy-box">
    <p>💡 <strong>"왜 저렇게 행동할까?"</strong>를 먼저 생각하세요</p>
    <p>💡 상대방의 <strong>감정</strong>을 먼저 인정하세요 (${cogStack.inf} 연습!)</p>
    <p>💡 <strong>승패</strong>가 아닌 <strong>해결</strong>에 집중하세요</p>
    <p>💡 필요하면 <strong>시간을 두고</strong> 대화하세요</p>
  </div>
</div>

<!-- ===== 페이지 16: 커리어 가이드 ===== -->
<div class="page">
  <h1>💼 커리어 가이드</h1>
  <p class="subtitle">${chemData.title}의 직업 전략</p>
  
  <h2>【최적 업무 환경】</h2>
  
  <div class="card">
    <p>✅ 명확한 목표와 성과 측정이 있는 곳</p>
    <p>✅ 자율성과 책임이 주어지는 곳</p>
    <p>✅ 성장과 승진 기회가 보이는 곳</p>
    <p>✅ 능력주의 문화가 있는 곳</p>
    <p>✅ 비전을 공유하는 팀이 있는 곳</p>
  </div>
  
  <h2>【피해야 할 환경】</h2>
  
  <div class="analysis-box warning">
    <p>❌ 정치적 게임이 심한 조직</p>
    <p>❌ 변화를 거부하는 보수적 문화</p>
    <p>❌ 성과보다 연공서열 중시</p>
    <p>❌ 마이크로매니징이 심한 상사</p>
    <p>❌ 비효율적인 프로세스가 고착된 곳</p>
  </div>
  
  <h2>【커리어 성장 전략】</h2>
  
  <div class="highlight-box">
    <p><strong>단기 (1-2년):</strong> 현재 역할에서 눈에 보이는 성과 만들기</p>
    <p><strong>중기 (3-5년):</strong> 리더십 역할로 확장, 팀 관리 경험</p>
    <p><strong>장기 (5년+):</strong> 조직/사업 단위의 의사결정권 확보</p>
    <p style="margin-top:15px;">💡 <strong>핵심:</strong> "실행력 있는 비전가"로 포지셔닝하세요!</p>
  </div>
</div>

<!-- ===== 페이지 17: 2026년 MBTI×사주 운세 (상반기) ===== -->
<div class="page">
  <h1>🔮 2026년 ${mbti} × ${stem.hanja}${stemOhang} 운세</h1>
  <p class="subtitle">${chemData.title}의 병오년(丙午年) 상반기 가이드</p>
  
  <div class="card" style="line-height:1.8;">
    <p>2026년은 <strong>병오년(丙午年)</strong>으로, 火 에너지가 강하게 흐르는 해예요. ${stem.hanja}${stemOhang} 일간을 가진 당신에게 이 해는 ${getOhangRelation(stemOhang, '火').type === '동기' ? '에너지가 폭발적으로 상승하는 특별한 시기' : getOhangRelation(stemOhang, '火').type === '상생' ? '자연스러운 성장과 발전의 기회' : '새로운 도전과 균형이 필요한 시기'}가 될 거예요.</p>
    <p style="margin-top:8px;">${mbti}의 주기능 <strong>${cogStack.main}(${FUNC_OHANG[cogStack.main].name})</strong>과 부기능 <strong>${cogStack.aux}(${FUNC_OHANG[cogStack.aux].name})</strong>를 의식적으로 활용하면, ${stem.hanja}${stemOhang}의 기운과 시너지를 극대화할 수 있어요.</p>
  </div>
  
  <h2>【상반기 월별 ${mbti} 맞춤 전략】</h2>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🌸 1월 (寅월 - 木)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '木').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> ${stemOhang}과 木의 ${getOhangRelation(stemOhang, '木').type} 관계예요. ${getOhangRelation(stemOhang, '木').type === '상생' ? '새해 첫 달부터 좋은 기운이 흘러요. 木은 성장과 시작의 에너지라서, 새로운 프로젝트나 목표를 세우기에 최적의 시기예요.' : getOhangRelation(stemOhang, '木').type === '상극' ? '도전적인 에너지가 흐르지만, 이 긴장감이 오히려 당신을 더 날카롭게 만들어줘요. 신중하게 결정하되 두려워하지는 마세요.' : '안정적인 에너지로 차분하게 한 해를 시작할 수 있어요. 큰 변화보다는 기존 계획의 점검에 집중하세요.'}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[0] === 'E' ? `외향적 에너지(火)를 활용해 새해 모임과 네트워킹에 적극 참여하세요. ${cogStack.main} 기능으로 빠르게 상황을 파악하고, 올해의 핵심 인맥을 구축하세요.` : `내향적 에너지(水)로 조용히 한 해의 방향을 설정하세요. ${cogStack.main} 기능을 활용해 깊이 있는 목표를 세우고, 실행 계획을 구체화하세요.`} ${axes[2] === 'T' ? `${cogStack.aux}로 논리적인 목표 세분화를 해보세요.` : `${cogStack.aux}로 가치에 맞는 목표인지 점검해보세요.`}</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">💧 2월 (卯월 - 木)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '木').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 木 기운이 이어지며 ${getOhangRelation(stemOhang, '木').type === '상생' ? '성장의 모멘텀이 유지돼요. 1월에 세운 계획을 본격적으로 실행하기 좋은 때예요. 씨앗이 싹트듯, 당신의 아이디어도 구체화되기 시작해요.' : '내면을 돌아보며 진짜 원하는 것이 무엇인지 성찰하는 시간을 가져보세요. 木의 에너지가 내면의 성장을 자극해요.'}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[1] === 'S' ? `감각형(土)의 강점을 살려 구체적인 실행 계획을 세워보세요. ${cogStack.main}과 ${cogStack.aux}를 조합해 "언제, 어디서, 무엇을" 명확하게 정의하고, 체크리스트를 만들어 하나씩 실행하세요.` : `직관형(木)의 강점을 살려 새로운 가능성을 탐색해보세요. ${cogStack.main}이 큰 그림을 그리고, ${cogStack.aux}가 실현 가능성을 검토하는 방식으로 아이디어를 발전시키세요.`} ${axes[3] === 'J' ? '체계적인 루틴을 확립하면 효율이 높아져요.' : '유연하게 여러 시도를 해보는 것도 좋아요.'}</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🌱 3월 (辰월 - 土)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '土').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> ${stemOhang}과 土의 ${getOhangRelation(stemOhang, '土').type} 관계예요. ${getOhangRelation(stemOhang, '土').type === '상생' ? '土는 안정과 실현의 에너지예요. 지금까지 준비한 것들이 구체적인 형태를 갖추기 시작하는 달이에요.' : '균형을 잡으며 천천히 나아가는 것이 좋아요. 급하게 밀어붙이기보다 기반을 다지는 시간이에요.'}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[0] === 'E' ? `${cogStack.main}(${FUNC_OHANG[cogStack.main].name})을 활용해 팀 프로젝트에서 리더십을 발휘하세요. 당신의 외향적 에너지가 팀을 이끄는 힘이 돼요.` : `${cogStack.main}(${FUNC_OHANG[cogStack.main].name})을 활용해 전문성을 깊이 있게 쌓아가세요. 혼자 집중하는 시간이 당신의 경쟁력을 만들어요.`} ${cogStack.tert}(3차 기능)도 조금씩 연습하면, 더 균형 잡힌 성장이 가능해요.</p>
  </div>
</div>

<!-- ===== 페이지 18: 2026년 상반기 (4~6월) ===== -->
<div class="page">
  <h1>🔮 2026년 상반기 (4~6월)</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang} 火 에너지 본격화</p>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🔥 4월 (巳월 - 火)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '火').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 火 기운이 본격적으로 상승해요! ${getOhangRelation(stemOhang, '火').type === '동기' ? `${stem.hanja}${stemOhang}과 火가 만나 에너지가 2배로 강해져요. 이 폭발적인 추진력을 활용해 큰 도전을 시도하세요. 단, 과열되면 번아웃이 오니 의식적인 조절이 필요해요.` : getOhangRelation(stemOhang, '火').type === '상생' ? `火 에너지가 ${stem.hanja}${stemOhang}을 밝게 비춰줘요. 열정을 활용하기 최적의 시기! ${mbti}의 강점이 빛나는 달이에요.` : `강한 火 에너지가 흐르니 중심을 잘 잡으세요. 외부의 열기에 휩쓸리지 말고, ${stemOhang}의 본연의 기운을 유지하세요.`}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[2] === 'T' ? `사고형(金)의 냉철함으로 열정을 통제하세요. ${cogStack.main}이 논리적 판단을 내리고, ${cogStack.aux}가 실행 계획을 세워요. 열정에 논리를 더하면 최강의 조합이 돼요!` : `감정형(木)의 공감력으로 팀원들에게 동기부여를 하세요. ${cogStack.main}이 관계를 조율하고, ${cogStack.aux}가 방향을 잡아요. 함께 달리면 더 멀리 갈 수 있어요!`} 이 달은 ${mbti}의 강점이 최대로 발휘되는 시기예요.</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">☀️ 5월 (午월 - 火)</span>
      <span class="month-badge">🌟 최고조!</span>
    </div>
    <p><strong>사주 에너지:</strong> <strong>병오년 午월</strong> - 火 에너지가 최고조에 달해요! ${stemOhang === '火' ? `${stem.hanja}火 일간인 당신에게 이 달은 일생에 몇 번 없는 특별한 시기예요. 본인의 에너지와 시대의 에너지가 완벽하게 공명해요. 하지만 불꽃이 너무 강하면 스스로를 태울 수 있어요. 의식적인 휴식이 반드시 필요해요!` : `외부 에너지가 매우 강해요. ${stemOhang} 기운을 가진 당신은 이 火 에너지를 ${getOhangRelation(stemOhang, '火').type === '상생' ? '성장의 연료로' : '도전의 기회로'} 활용할 수 있어요. 자신의 페이스를 유지하면서 기회를 잡으세요.`}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[0] === 'E' ? `외향형의 사교 활동이 절정에 달하는 시기예요. ${cogStack.main}으로 중요한 관계를 파악하고, ${cogStack.aux}로 깊이를 더하세요. 하지만 ${cogStack.inf}(열등기능)가 약해지기 쉬우니, 의식적으로 ${FUNC_OHANG[cogStack.inf].name}을 챙기세요.` : `내향형인 당신은 과도한 자극을 피하고 재충전 시간을 확보하세요. ${cogStack.main}으로 본질에 집중하고, ${cogStack.aux}로 선택과 집중을 하세요. 모든 것에 반응하지 않아도 돼요.`} ${axes[3] === 'J' ? '계획된 휴식 스케줄을 반드시 지키세요!' : '즉흥적인 휴식도 좋지만, 최소한의 휴식은 보장하세요!'}</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🌿 6월 (未월 - 土)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '土').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 土 기운이 돌아오며 안정화되는 시기예요. 상반기 동안의 火 에너지가 土로 전환되며, 그동안 달려온 것들이 구체적인 성과로 정리돼요. 수확의 시간이에요.</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[1] === 'S' ? `감각형의 강점을 살려 구체적인 수치로 상반기 성과를 측정하세요. ${cogStack.main}으로 데이터를 수집하고, ${cogStack.aux}로 패턴을 분석하세요. 기록은 하반기 전략의 기초가 돼요.` : `직관형의 강점을 살려 상반기 경험에서 인사이트를 도출하세요. ${cogStack.main}으로 큰 흐름을 파악하고, ${cogStack.aux}로 핵심 교훈을 정리하세요.`} ${axes[2] === 'F' ? `팀원들과 성과를 나누고 감사를 표현하면, ${cogStack.aux}가 더욱 발달해요.` : `객관적인 평가를 통해 하반기 전략을 세우면, ${cogStack.main}이 더욱 날카로워져요.`}</p>
  </div>
  
  <div class="strategy-box">
    <h4>📊 상반기 ${mbti} × ${stem.hanja}${stemOhang} 핵심 요약</h4>
    <p>• <strong>최적 시기:</strong> ${getOhangRelation(stemOhang, '火').type === '상생' || getOhangRelation(stemOhang, '火').type === '동기' ? '4~5월 (火 에너지 최대 활용)' : '1~3월 (木/土 에너지 활용)'}</p>
    <p>• <strong>주의 시기:</strong> 5월 (火 과열 → ${cogStack.inf} 약화 주의, 번아웃 방지)</p>
    <p>• <strong>${mbti} 핵심 기능:</strong> ${cogStack.main}(주) + ${cogStack.aux}(부) 조합으로 시너지 극대화</p>
    <p>• <strong>성장 포인트:</strong> ${cogStack.tert}(3차) 연습하면 더 균형 잡힌 상반기!</p>
  </div>
</div>

<!-- ===== 페이지 19: 2026년 하반기 (7~12월) ===== -->
<div class="page">
  <h1>🔮 2026년 하반기 운세</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang} 하반기 ${cogStack.main}+${cogStack.aux} 전략</p>
  
  <div class="card" style="line-height:1.8;">
    <p>하반기는 火 에너지가 점차 수그러들고 金→水→土 순으로 에너지가 전환돼요. ${mbti}의 <strong>${cogStack.main}(${FUNC_OHANG[cogStack.main].name})</strong>과 <strong>${cogStack.aux}(${FUNC_OHANG[cogStack.aux].name})</strong>를 하반기 에너지 흐름에 맞춰 활용하면, ${stem.hanja}${stemOhang}의 기운과 조화로운 마무리를 할 수 있어요.</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🍃 7월 (申월 - 金)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '金').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 하반기가 시작되며 金 기운이 흘러요. 金은 분석, 정리, 수확의 에너지예요. ${stemOhang}과 金의 ${getOhangRelation(stemOhang, '金').type} 관계로, ${getOhangRelation(stemOhang, '金').type === '상극' ? `도전적인 상황이 생길 수 있어요. 하지만 金의 날카로움이 ${stem.hanja}${stemOhang}의 무딘 부분을 다듬어주는 기회가 돼요.` : `정리와 분석에 최적의 시기예요. 상반기의 경험을 체계적으로 정리하고, 하반기 방향을 명확히 설정하세요.`}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[2] === 'T' ? `사고형(金)인 당신에게 7월은 최고의 달이에요! ${cogStack.main}이 더욱 날카로워지고, ${cogStack.aux}가 실행력을 더해요. 전략 수립, 데이터 분석, 프로세스 개선에 집중하세요.` : `감정형(木)인 당신은 金 에너지가 다소 부담스러울 수 있어요. ${cogStack.main}으로 관계의 균형을 유지하면서, ${cogStack.aux}를 활용해 논리적인 부분을 보완하세요.`} ${cogStack.tert}(3차 기능)도 활용하면 더 균형 잡힌 접근이 가능해요.</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🌾 8월 (酉월 - 金)</span>
      <span class="month-badge">🌟 전환점!</span>
    </div>
    <p><strong>사주 에너지:</strong> 金 기운이 최고조에 달하며 <strong>2026년의 중요한 전환점</strong>이에요. 상반기에 뿌린 씨앗이 결실을 맺거나, 새로운 방향으로 전환이 일어나는 시기예요. ${getOhangRelation(stemOhang, '金').type === '상극' ? `예상치 못한 변화가 있을 수 있어요. 하지만 ${mbti}의 ${cogStack.main} 기능을 발휘하면 이 변화를 기회로 만들 수 있어요.` : `결실과 수확의 에너지가 강해요. 그동안의 노력이 인정받는 시기예요.`}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[3] === 'J' ? `판단형(土)인 당신은 이 전환점에서 계획을 점검하고 필요하면 수정하세요. ${cogStack.main}으로 상황을 판단하고, ${cogStack.aux}로 세부 사항을 조정하세요.` : `인식형(水)인 당신은 새로운 기회에 열린 자세를 유지하세요. ${cogStack.main}이 가능성을 탐지하고, ${cogStack.aux}가 실현 가능성을 평가해요.`} ${axes[0] === 'E' ? `외향적 에너지로 적극적으로 기회를 포착하세요.` : `내면의 직관을 믿고 신중하게 선택하세요.`}</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🍂 9월 (戌월 - 土)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '土').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 土 기운이 돌아와 안정감을 가져다줘요. 8월의 전환점을 지나 새로운 방향이 자리 잡는 시기예요. 성과를 정리하고 다음 단계를 준비하기 좋은 달이에요.</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[1] === 'S' ? `감각형(土)인 당신에게 9월은 강점을 발휘하기 좋은 달이에요. ${cogStack.main}으로 구체적인 데이터를 수집하고, ${cogStack.aux}로 체계적으로 정리하세요.` : `직관형(木)인 당신은 土 에너지를 활용해 아이디어를 현실화하세요. ${cogStack.main}이 비전을 그리고, ${cogStack.aux}가 실행 가능한 계획으로 만들어요.`} ${cogStack.aux}(부기능)를 의식적으로 발달시키면 더 균형 잡힌 성장이 가능해요.</p>
  </div>
</div>

<!-- ===== 페이지 20: 2026년 하반기 (10~12월) + 연간 요약 ===== -->
<div class="page">
  <h1>🔮 2026년 하반기 (10~12월)</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang} 한 해 마무리</p>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">💧 10월 (亥월 - 水)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '水').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 水 기운이 흐르기 시작해요. ${stemOhang === '火' ? `火 일간인 당신에게 水는 균형을 맞춰주는 에너지예요. 상반기에 과열됐던 것들이 진정되고, 내면의 안정을 찾는 시기예요.` : `水의 유연함과 적응력이 높아지는 시기예요. 변화에 순응하면서도 본질을 유지하는 지혜가 필요해요.`}</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[0] === 'I' ? `내향형인 당신에게 10월은 내면을 깊이 성찰하기 최적의 시기예요. ${cogStack.main}이 깊이 있는 통찰을 만들고, ${cogStack.aux}가 이를 정리해요. 일 년간의 경험에서 의미를 찾아보세요.` : `외향형인 당신은 활동량을 조금 줄이고 재충전하는 것이 좋아요. ${cogStack.main}의 에너지를 내부로 돌려 ${cogStack.inf}(열등기능)를 조금씩 연습해보세요.`} ${axes[2] === 'F' ? `감정을 정리하고 소중한 관계를 돌아보는 시간을 가지세요.` : `논리적으로 한 해를 회고하고 배운 점을 정리하세요.`}</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">❄️ 11월 (子월 - 水)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '水').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 水 기운이 강화되며 휴식과 충전의 시기예요. 한 해 동안 달려온 당신에게 필요한 재충전의 시간이에요. 水는 만물을 품고 기다리는 에너지예요.</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> ${axes[3] === 'P' ? `인식형(水)인 당신에게 11월은 자연스러운 달이에요. ${cogStack.main}으로 자유롭게 탐색하고, 다양한 가능성을 열어두세요. 여유를 즐기면서 영감을 얻으세요.` : `판단형(土)인 당신은 이 시기를 활용해 내년 계획을 체계적으로 세워보세요. ${cogStack.main}으로 목표를 설정하고, ${cogStack.aux}로 실행 계획을 구체화하세요.`} ${mbti}의 열등기능 <strong>${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})</strong> 발달을 시도해보세요. 평소와 다른 방식을 경험하면서 더 균형 잡힌 사람으로 성장할 수 있어요.</p>
  </div>
  
  <div class="month-card">
    <div class="month-header">
      <span class="month-title">🎄 12월 (丑월 - 土)</span>
      <span class="month-badge">${getOhangRelation(stemOhang, '土').type}</span>
    </div>
    <p><strong>사주 에너지:</strong> 土 기운으로 한 해를 마무리해요. 土는 안정과 수확의 에너지예요. 2026년 병오년(丙午年)의 火 에너지가 土로 전환되며, 한 해의 경험이 당신의 일부로 굳어져요.</p>
    <p style="margin-top:8px;"><strong>${mbti} 맞춤 전략:</strong> "${chemData.title}"로서 어떤 성장을 이뤘는지 정리해보세요. ${axes[1] === 'S' ? `${cogStack.main}을 활용해 구체적인 성과를 기록하고 아카이빙해두세요. 숫자로 측정할 수 있는 것들을 정리하면 성취감이 높아져요.` : `${cogStack.main}을 활용해 경험에서 얻은 지혜와 통찰을 정리해보세요. 한 해의 이야기를 내러티브로 만들어보면 의미가 깊어져요.`} ${axes[0] === 'E' ? `소중한 사람들에게 감사를 표현하고 따뜻한 연말을 보내세요. 관계 속에서 한 해를 마무리하면 ${cogStack.aux}가 더 발달해요.` : `조용히 자신과의 시간을 가지며 한 해를 마무리하세요. 내면의 성찰이 ${cogStack.main}을 더 깊게 만들어요.`}</p>
  </div>
  
  <div class="highlight-box">
    <h4>🎯 2026년 ${mbti} × ${stem.hanja}${stemOhang} 연간 핵심 전략</h4>
    <p>• <strong>상반기 (1~6월):</strong> ${axes[0] === 'E' ? '적극적 확장과 네트워킹' : '내실 다지기와 전문성 강화'}, 5월 火 최고조 → ${cogStack.inf} 관리 필수</p>
    <p>• <strong>하반기 (7~12월):</strong> ${axes[3] === 'J' ? '체계적 정리와 수확' : '유연한 적응과 기회 포착'}, 8월 전환점 → ${cogStack.main}+${cogStack.aux} 최대 활용</p>
    <p>• <strong>연간 성장 포인트:</strong> ${cogStack.tert}(3차) → ${cogStack.inf}(열등) 순으로 연습하면 균형 잡힌 성장!</p>
    <p>• <strong>키 메시지:</strong> "${chemData.title}"의 ${stemOhang} 에너지와 ${mbti}의 ${cogStack.main}+${cogStack.aux} 시너지를 최대로!</p>
  </div>
</div>
<div class="page">
  <h1>🍀 행운 가이드</h1>
  <p class="subtitle">${chemData.title}를 위한 행운 요소</p>
  
  <h2>【럭키 컬러】</h2>
  
  <div class="versus" style="justify-content:space-around;">
    <div style="text-align:center;">
      <div style="width:60px; height:60px; background:#3b82f6; border-radius:50%; margin:0 auto;"></div>
      <p style="margin-top:10px;">파랑 (水)</p>
      <p style="font-size:9pt; color:#888;">균형과 지혜</p>
    </div>
    <div style="text-align:center;">
      <div style="width:60px; height:60px; background:#111; border:2px solid #333; border-radius:50%; margin:0 auto;"></div>
      <p style="margin-top:10px;">검정 (水)</p>
      <p style="font-size:9pt; color:#888;">깊이와 안정</p>
    </div>
    <div style="text-align:center;">
      <div style="width:60px; height:60px; background:#22c55e; border-radius:50%; margin:0 auto;"></div>
      <p style="margin-top:10px;">초록 (木)</p>
      <p style="font-size:9pt; color:#888;">성장과 조화</p>
    </div>
  </div>
  
  <h2>【럭키 방향】</h2>
  
  <div class="card">
    <p>🧭 <strong>북쪽</strong> - 水의 방향, 균형 회복</p>
    <p>🧭 <strong>동쪽</strong> - 木의 방향, 새로운 시작</p>
    <p style="margin-top:10px; color:#888;">💡 중요한 미팅이나 면접 시 해당 방향으로 앉으세요</p>
  </div>
  
  <h2>【럭키 아이템】</h2>
  
  <div class="versus" style="justify-content:space-around;">
    <div class="versus-item" style="min-width:80px;">
      <p style="font-size:24pt;">💎</p>
      <p>수정</p>
    </div>
    <div class="versus-item" style="min-width:80px;">
      <p style="font-size:24pt;">🌊</p>
      <p>물 관련</p>
    </div>
    <div class="versus-item" style="min-width:80px;">
      <p style="font-size:24pt;">🌿</p>
      <p>식물</p>
    </div>
  </div>
  
  <div class="highlight-box">
    <p>💡 <strong>핵심 원리:</strong> ${stem.hanja}${stemOhang}의 과열을 식혀주는 水와 木 요소를 가까이 하세요!</p>
  </div>
</div>

<!-- ===== 페이지 21: 일일 루틴 가이드 ===== -->
<div class="page">
  <h1>⏰ ${mbti} × ${stem.hanja}${stemOhang} 일일 루틴 (1)</h1>
  <p class="subtitle">${chemData.title}를 위한 아침 & 오전 설계</p>
  
  <div class="card" style="line-height:1.8;">
    <p>${mbti}의 에너지 패턴과 ${stem.hanja}${stemOhang}의 오행 흐름을 고려한 맞춤형 일일 루틴이에요. ${axes[0] === 'E' ? '외향형인 당신은 사람들과의 교류에서 에너지를 얻으니, 오후에 협업 시간을 배치했어요.' : '내향형인 당신은 혼자 집중하는 시간에서 에너지를 얻으니, 오전에 딥워크 시간을 확보했어요.'} 하루의 시작이 그 날의 흐름을 결정해요!</p>
  </div>
  
  <h2>【아침 루틴 (06:00-08:00)】</h2>
  
  <div class="analysis-box positive" style="line-height:1.8;">
    <p><strong>🌅 ${stem.hanja}${stemOhang} 에너지 점화 시간</strong></p>
    <p>${stemOhang === '火' ? '火 일간인 당신은 아침에 에너지가 빠르게 올라와요. 이 시간을 활용해 하루의 방향을 설정하면 폭발적인 추진력을 얻을 수 있어요. 단, 너무 급하게 시작하면 오후에 지칠 수 있으니 적당한 워밍업이 필요해요.' : stemOhang === '水' ? '水 일간인 당신은 아침에 천천히 깨어나는 타입이에요. 급하게 시작하지 말고, 충분히 몸과 마음이 깨어날 시간을 주세요. 따뜻한 물 한 잔으로 하루를 시작하면 水 에너지가 부드럽게 흐르기 시작해요.' : stemOhang === '木' ? '木 일간인 당신은 아침에 성장의 에너지가 샘솟아요. 새로운 아이디어와 계획을 아침에 구상하면 좋아요. 창문을 열어 신선한 공기를 마시면 木의 생명력이 활성화돼요.' : stemOhang === '金' ? '金 일간인 당신은 아침에 명료한 사고가 가능해요. 중요한 분석이나 판단은 아침에 하면 정확도가 높아져요. 정돈된 환경에서 시작하면 金의 정밀함이 발휘돼요.' : '土 일간인 당신은 아침에 안정적인 에너지가 흘러요. 매일 같은 시간에 일어나고 같은 루틴을 따르면 하루가 편안하게 흘러가요. 土의 신뢰성이 당신의 강점이에요.'}</p>
    
    <p style="margin-top:10px;"><strong>${mbti} 맞춤 아침:</strong> ${cogStack.main}(${FUNC_OHANG[cogStack.main].name})을 깨우기 위해 ${axes[1] === 'S' ? '구체적인 오늘의 할 일 3가지를 적어보세요. 체크리스트가 당신의 하루를 구조화해요. 어제 완료한 것들을 체크하면서 성취감도 느껴보세요.' : '5분간 자유롭게 마인드맵을 그려보세요. 오늘의 가능성들이 펼쳐져요. 정해진 틀 없이 떠오르는 아이디어를 자유롭게 적어보세요.'}</p>
    
    <p style="margin-top:10px;"><strong>추천 아침 활동:</strong> ${axes[0] === 'E' ? '가벼운 스트레칭이나 운동으로 火 에너지를 점화하세요. 음악을 틀거나 팟캐스트를 들으면서 활기차게 시작해보세요. 에너지가 넘치는 아침이 하루 전체의 톤을 잡아줘요.' : '조용한 명상이나 독서로 水 에너지를 충전하세요. 5분 호흡 명상이나 한 페이지 독서로 내면을 정돈하면, 온종일 맑은 상태를 유지할 수 있어요.'}</p>
  </div>
  
  <h2>【오전 루틴 (09:00-12:00)】</h2>
  
  <div class="analysis-box info" style="line-height:1.8;">
    <p><strong>💪 ${cogStack.main} 최적 업무 시간</strong></p>
    <p>오전은 ${mbti}의 주기능인 <strong>${cogStack.main}(${FUNC_OHANG[cogStack.main].name})</strong>이 가장 활발한 시간이에요. ${FUNC_OHANG[cogStack.main].ohang} 에너지가 ${stem.hanja}${stemOhang}과 ${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type} 관계를 형성하며, ${getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '상생' ? '자연스러운 시너지가 발생해요. 이 시간에 가장 중요한 업무를 처리하세요! 흐름을 타면 놀라운 성과가 나와요.' : getOhangRelation(stemOhang, FUNC_OHANG[cogStack.main].ohang).type === '동기' ? '에너지가 2배로 강해지는 시간이에요. 도전적인 과제를 이 시간에 배치하세요! 평소에 어렵던 일도 이 시간엔 쉽게 풀릴 수 있어요.' : '약간의 긴장감이 있지만, 이게 오히려 집중력을 높여줘요. 적당한 도전이 최고의 성과를 만들어요.'}</p>
    
    <p style="margin-top:10px;"><strong>황금 시간대:</strong> 특히 <strong>10:00-11:00</strong>는 ${mbti}의 절대 집중 시간이에요. 이 한 시간에 하루의 가장 중요한 업무를 배치하세요. ${axes[2] === 'T' ? '논리적 분석, 전략 수립, 데이터 검토, 의사결정 등 사고력이 필요한 핵심 업무를 이 시간에 집중하세요.' : '관계 조율, 팀 빌딩, 피드백 정리, 중요한 대화 등 감정적 에너지가 필요한 핵심 업무를 이 시간에 처리하세요.'}</p>
    
    <p style="margin-top:10px;"><strong>환경 설정:</strong> 회의는 최소화하고, ${cogStack.main}이 깊이 몰입할 수 있는 환경을 만드세요. ${axes[0] === 'E' ? '완전한 고립보다는 적당한 백색소음이나 카페 분위기가 도움이 될 수 있어요.' : '조용하고 방해받지 않는 공간에서 혼자 집중하는 시간을 확보하세요.'} 휴대폰 알림을 끄고 딥워크 모드로 들어가세요!</p>
  </div>
</div>

<!-- ===== 페이지: 일일 루틴 (2) - 오후 & 저녁 ===== -->
<div class="page">
  <h1>⏰ ${mbti} × ${stem.hanja}${stemOhang} 일일 루틴 (2)</h1>
  <p class="subtitle">${chemData.title}를 위한 오후 & 저녁 설계</p>
  
  <h2>【오후 루틴 (14:00-17:00)】</h2>
  
  <div class="analysis-box warning" style="line-height:1.7;">
    <p><strong>🤝 ${cogStack.aux} 활용 & 협업 시간</strong></p>
    <p>오후는 부기능인 <strong>${cogStack.aux}(${FUNC_OHANG[cogStack.aux].name})</strong>가 활성화되는 시간이에요. ${axes[0] === 'E' ? '외향형인 당신은 팀 미팅, 브레인스토밍, 네트워킹에서 에너지를 재충전할 수 있어요.' : '내향형인 당신은 필요한 협업을 이 시간에 집중 처리하고, 저녁엔 재충전 시간을 확보하세요.'}</p>
    <p style="margin-top:8px;"><strong>오후 슬럼프 극복:</strong> ${stemOhang === '火' ? '火 일간은 과열되기 쉬우니 차가운 물과 잠깐의 산책으로 열기를 식혀주세요.' : '10분 휴식이 남은 오후의 생산성을 2배로 만들어요.'} ${cogStack.inf}(열등기능)가 약해지는 시간이니, 이 영역의 업무는 피하세요.</p>
  </div>
  
  <h2>【저녁 루틴 (19:00 이후)】</h2>
  
  <div class="strategy-box" style="line-height:1.7;">
    <p><strong>🌊 水 에너지 충전 시간</strong></p>
    <p>저녁은 火 에너지를 식히고 水 에너지로 재충전하는 시간이에요. ${stemOhang === '火' ? '火 일간인 당신에게 특히 중요해요. 의식적으로 열기를 내리지 않으면 수면의 질이 떨어져요.' : '水 에너지와 친화적인 활동으로 하루를 마무리하세요.'}</p>
    
    <p style="margin-top:10px;"><strong>${mbti} 맞춤 저녁:</strong></p>
    <p>• <strong>업무 마감 (19:00):</strong> ${axes[3] === 'J' ? '내일 할 일을 정리해두면 마음이 편안해져요.' : '오늘 완료한 것에 집중하고, 내일은 내일 생각하세요.'}</p>
    <p>• <strong>水 활동 (20:00):</strong> 목욕, 따뜻한 차, 물소리 듣기 등이 ${stem.hanja}${stemOhang}의 균형을 맞춰줘요.</p>
    <p>• <strong>${cogStack.tert} 연습 (21:00):</strong> 3차 기능을 가볍게 쓰는 취미로 균형 잡힌 성장을!</p>
    <p>• <strong>수면 준비 (22:00):</strong> ${axes[0] === 'E' ? '혼자만의 조용한 시간으로 마무리하세요.' : '조용한 환경에서 자연스럽게 잠들도록 해주세요.'} 7-8시간 수면 필수!</p>
  </div>
  
  <div class="highlight-box" style="margin-top:20px;">
    <h4>⚡ ${chemData.title} 하루 에너지 흐름 요약</h4>
    <p>• <strong>아침:</strong> ${stemOhang} 에너지 점화 → <strong>오전:</strong> ${cogStack.main} 최대 활용 → <strong>오후:</strong> ${cogStack.aux} 협업 → <strong>저녁:</strong> 水 충전</p>
    <p>• <strong>핵심:</strong> 오전에 중요한 일을 끝내고, 저녁엔 반드시 쿨다운하세요!</p>
  </div>
</div>

<!-- ===== 페이지: 스트레스 관리 (1) - 신호 감지 ===== -->
<div class="page">
  <h1>🧘 ${mbti} × ${stem.hanja}${stemOhang} 스트레스 관리 (1)</h1>
  <p class="subtitle">${chemData.title}만의 스트레스 패턴과 초기 신호</p>
  
  <div class="card" style="line-height:1.8;">
    <p>스트레스는 누구에게나 찾아오지만, ${mbti}와 ${stem.hanja}${stemOhang}의 조합인 당신에게는 <strong>특유의 스트레스 패턴</strong>이 있어요. 평소에는 주기능 <strong>${cogStack.main}(${FUNC_OHANG[cogStack.main].name})</strong>과 부기능 <strong>${cogStack.aux}(${FUNC_OHANG[cogStack.aux].name})</strong>가 균형 있게 작동하지만, 스트레스가 쌓이면 열등기능 <strong>${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})</strong>가 비정상적으로 튀어나와요. 이 신호를 알아채는 것이 번아웃을 막는 첫걸음이에요.</p>
  </div>
  
  <h2>【${cogStack.inf} 과부하 신호 🚨】</h2>
  
  <div class="analysis-box negative" style="line-height:1.8;">
    <p><strong>열등기능 ${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})가 폭주하면 이런 증상이 나타나요:</strong></p>
    <p style="margin-top:10px;">${cogStack.inf === 'Se' ? `평소 미래 지향적이던 당신이 갑자기 <strong>충동적인 행동</strong>을 해요. 과식, 과소비, 무계획 여행 등 "지금 당장"에 집착하게 돼요. 몸의 감각에 과도하게 빠져들거나, 반대로 건강을 완전히 무시해요.` : 
    cogStack.inf === 'Si' ? `평소 새로운 것을 추구하던 당신이 갑자기 <strong>과거에 집착</strong>해요. "예전엔 이랬는데..."를 반복하고, 사소한 디테일에 강박적으로 매달려요. 익숙한 것만 고집하거나 건강 염려증이 생겨요.` :
    cogStack.inf === 'Ne' ? `평소 현실적이던 당신이 갑자기 <strong>최악의 시나리오</strong>만 상상해요. "이게 안 되면 어떡해?"라는 부정적 가능성이 끝없이 떠올라요. 근거 없는 불안과 의심이 커져요.` :
    cogStack.inf === 'Ni' ? `평소 유연하던 당신이 갑자기 <strong>하나의 비전에 집착</strong>해요. "이것만이 답이야"라는 확신에 사로잡히고, 다른 가능성을 완전히 무시해요. 편집증적인 의심이 생겨요.` :
    cogStack.inf === 'Te' ? `평소 조화를 중시하던 당신이 갑자기 <strong>비판적이고 공격적</strong>이 돼요. 사람들의 무능함을 지적하고, 효율성만 강조해요. 차갑고 냉정한 말투로 관계를 해칠 수 있어요.` :
    cogStack.inf === 'Ti' ? `평소 관계 지향적이던 당신이 갑자기 <strong>논리적 오류에 집착</strong>해요. 상대방의 말에서 모순을 찾아내고, 끝없이 분석하고 비판해요. 지나치게 냉소적이 돼요.` :
    cogStack.inf === 'Fe' ? `평소 독립적이던 당신이 갑자기 <strong>타인의 평가에 예민</strong>해져요. "나를 싫어하는 것 같아"라는 생각에 사로잡히고, 과도하게 친절하거나 반대로 완전히 단절해요.` :
    `평소 객관적이던 당신이 갑자기 <strong>감정에 휩쓸려요</strong>. 작은 일에도 상처받고, "아무도 날 이해 못해"라는 외로움이 커져요. 눈물이 갑자기 나거나, 화가 폭발해요.`}</p>
  </div>
  
  <h2>【${stem.hanja}${stemOhang} 일간의 스트레스 원인】</h2>
  
  <div class="analysis-box warning" style="line-height:1.8;">
    <p><strong>${stem.hanja}${stemOhang} 일간이 스트레스받는 상황:</strong></p>
    <p style="margin-top:10px;">${stemOhang === '火' ? `火 일간인 당신은 <strong>인정받지 못할 때</strong> 가장 힘들어요. 열정을 쏟았는데 무시당하거나, 자신의 빛이 가려질 때 내면이 타들어가요. 또한 너무 오래 제자리에 있거나, 변화 없이 반복되는 일상도 스트레스 원인이에요. 火는 움직여야 살아요.` : 
    stemOhang === '水' ? `水 일간인 당신은 <strong>통제당할 때</strong> 가장 힘들어요. 자유롭게 흐르지 못하고 틀에 갇히면 내면이 답답해져요. 또한 너무 많은 사람들 사이에서 에너지가 분산되거나, 깊이 있는 사고 시간이 없을 때도 고갈돼요.` :
    stemOhang === '木' ? `木 일간인 당신은 <strong>성장이 막힐 때</strong> 가장 힘들어요. 발전 없이 정체되거나, 자신의 가치관과 맞지 않는 일을 해야 할 때 내면이 시들어요. 또한 불의를 보고도 참아야 할 때 큰 스트레스를 받아요.` :
    stemOhang === '金' ? `金 일간인 당신은 <strong>혼란스러울 때</strong> 가장 힘들어요. 명확한 기준 없이 모호한 상황이 계속되면 내면이 날카로워져요. 또한 자신의 원칙이 무시당하거나, 불공정한 대우를 받을 때 깊이 상처받아요.` :
    `土 일간인 당신은 <strong>불안정할 때</strong> 가장 힘들어요. 급격한 변화나 예측 불가능한 상황이 계속되면 내면이 흔들려요. 또한 신뢰가 깨지거나, 자신의 헌신이 당연하게 여겨질 때 마음이 무거워져요.`}</p>
  </div>
  
  <h2>【${axes[0]}축 에너지 고갈 신호】</h2>
  
  <div class="card" style="line-height:1.8;">
    <p>${axes[0] === 'E' ? `<strong>외향형(E)인 당신의 에너지 고갈 신호:</strong> 평소 사람들과 어울리길 좋아하던 당신이 갑자기 <strong>혼자 있고 싶어져요</strong>. 대화가 피곤하게 느껴지고, 사람들을 피하게 돼요. 이건 火 에너지(외향)가 바닥났다는 신호예요. 하지만 주의할 점은, 이때 완전히 고립되면 오히려 더 우울해질 수 있어요. <strong>가까운 소수</strong>와의 편안한 시간이 필요해요.` : 
    `<strong>내향형(I)인 당신의 에너지 고갈 신호:</strong> 평소 혼자만의 시간을 즐기던 당신이 갑자기 <strong>외로움을 강하게 느껴요</strong>. 고립감이 커지고, 아무도 나를 이해하지 못한다는 생각이 들어요. 이건 水 에너지(내향)가 정체됐다는 신호예요. 역설적이지만, 이때는 <strong>신뢰하는 사람과의 대화</strong>가 물꼬를 터줘요.`}</p>
  </div>
</div>

<!-- ===== 페이지: 스트레스 관리 (2) - 회복 전략 ===== -->
<div class="page">
  <h1>🧘 ${mbti} × ${stem.hanja}${stemOhang} 스트레스 관리 (2)</h1>
  <p class="subtitle">${chemData.title}를 위한 맞춤형 회복 전략</p>
  
  <h2>【${cogStack.main} 기반 즉각 회복법】</h2>
  
  <div class="analysis-box positive" style="line-height:1.8;">
    <p><strong>주기능 ${cogStack.main}(${FUNC_OHANG[cogStack.main].name})을 활용한 빠른 회복:</strong></p>
    <p style="margin-top:10px;">${cogStack.main === 'Te' ? `외향 사고(Te)인 당신은 <strong>문제를 해결하면</strong> 스트레스가 풀려요. 지금 당장 할 수 있는 작은 일을 찾아 "완료"하세요. 할 일 목록에서 하나라도 체크하면 통제감이 돌아와요. 정리정돈이나 계획 세우기도 효과적이에요.` :
    cogStack.main === 'Ti' ? `내향 사고(Ti)인 당신은 <strong>이해하면</strong> 스트레스가 풀려요. 지금 겪는 상황을 분석해보세요. "왜 이런 일이 생겼지?"를 논리적으로 정리하면 혼란이 가라앉아요. 글로 적거나 다이어그램으로 그려보세요.` :
    cogStack.main === 'Fe' ? `외향 감정(Fe)인 당신은 <strong>공유하면</strong> 스트레스가 풀려요. 신뢰하는 사람에게 지금 느끼는 감정을 말해보세요. 해결책이 아니라 공감만으로도 마음이 가벼워져요. 다른 사람을 도와주는 것도 역설적으로 힐링이 돼요.` :
    cogStack.main === 'Fi' ? `내향 감정(Fi)인 당신은 <strong>혼자 감정을 정리하면</strong> 스트레스가 풀려요. 조용한 공간에서 지금 느끼는 감정을 마주하세요. 일기 쓰기, 음악 듣기, 예술 활동이 내면을 정화해요. 자신의 가치관을 재확인하는 시간이에요.` :
    cogStack.main === 'Se' ? `외향 감각(Se)인 당신은 <strong>움직이면</strong> 스트레스가 풀려요. 생각을 멈추고 몸을 쓰세요. 운동, 산책, 요리, 정원 가꾸기 등 오감을 자극하는 활동이 즉각적인 해방감을 줘요. 자연 속에서 시간을 보내는 것도 효과적이에요.` :
    cogStack.main === 'Si' ? `내향 감각(Si)인 당신은 <strong>익숙한 것으로 돌아가면</strong> 스트레스가 풀려요. 좋아하는 음식, 익숙한 장소, 편안한 루틴으로 안정감을 찾으세요. 과거의 좋았던 기억을 떠올리거나, 앨범을 보는 것도 힐링이 돼요.` :
    cogStack.main === 'Ne' ? `외향 직관(Ne)인 당신은 <strong>새로운 가능성을 탐색하면</strong> 스트레스가 풀려요. 지금 상황에서 벗어나 다른 관점을 찾아보세요. 브레인스토밍, 새로운 아이디어 구상, 흥미로운 콘텐츠 탐색이 막힌 마음을 뚫어줘요.` :
    `내향 직관(Ni)인 당신은 <strong>큰 그림을 보면</strong> 스트레스가 풀려요. 현재의 어려움을 장기적 관점에서 바라보세요. "5년 후에 이게 중요할까?"라는 질문이 도움이 돼요. 명상이나 비전 보드 만들기도 효과적이에요.`}</p>
  </div>
  
  <h2>【${stemOhang} 에너지 균형 회복법】</h2>
  
  <div class="analysis-box info" style="line-height:1.8;">
    <p><strong>${stem.hanja}${stemOhang} 일간을 위한 오행 균형 회복:</strong></p>
    <p style="margin-top:10px;">${stemOhang === '火' ? `火 일간인 당신에게는 <strong>水 에너지</strong>가 균형을 맞춰줘요. 물 마시기, 수영, 목욕, 명상 등 水 활동으로 열기를 식히세요. 파란색/검정색 아이템을 가까이 두거나, 물소리를 들으면 진정 효과가 있어요. 밤 10시 이전 취침으로 水의 시간(亥子)에 충분히 쉬세요.` : 
    stemOhang === '水' ? `水 일간인 당신에게는 <strong>木 에너지</strong>가 활력을 줘요. 식물 가꾸기, 숲 산책, 새로운 것 배우기 등 木 활동으로 정체된 물을 흐르게 하세요. 녹색 아이템이나 식물을 가까이 두면 생기가 돌아요. 아침 일찍(寅卯시) 일어나 木의 시간을 활용하세요.` :
    stemOhang === '木' ? `木 일간인 당신에게는 <strong>火 에너지</strong>가 성장을 도와요. 햇빛 쬐기, 운동으로 땀 흘리기, 열정적인 활동 등 火 활동으로 생명력을 발산하세요. 빨간색/주황색 아이템이 활기를 줘요. 단, 이미 과열됐다면 水로 먼저 진정하세요.` :
    stemOhang === '金' ? `金 일간인 당신에게는 <strong>土 에너지</strong>가 안정을 줘요. 자연 속 걷기, 맨발로 땅 밟기, 도자기/흙 관련 활동 등 土 활동으로 날카로움을 부드럽게 하세요. 황토색/베이지 아이템이 마음을 편안하게 해요. 규칙적인 식사와 수면으로 土의 안정을 유지하세요.` :
    `土 일간인 당신에게는 <strong>金 에너지</strong>가 명확함을 줘요. 공간 정리, 불필요한 것 버리기, 명확한 기준 세우기 등 金 활동으로 흐릿한 것을 정돈하세요. 흰색/은색 아이템이 명료함을 더해요. 저녁(申酉시) 시간에 하루를 정리하면 金의 에너지가 도와요.`}</p>
  </div>
  
  <h2>【장기 스트레스 관리 & 번아웃 예방】</h2>
  
  <div class="highlight-box" style="line-height:1.8;">
    <p><strong>💡 "${chemData.title}"의 핵심 원칙:</strong></p>
    <p style="margin-top:8px;">${axes[2] === 'T' ? `사고형(T)인 당신은 스트레스를 "해결해야 할 문제"로 접근해요. 하지만 때로는 감정을 그냥 느끼는 것도 필요해요. <strong>"지금 힘들다"를 인정</strong>하는 것이 첫걸음이에요.` : 
    `감정형(F)인 당신은 스트레스를 "관계의 문제"로 접근해요. 하지만 때로는 객관적 분석도 필요해요. <strong>"사실은 무엇인가?"</strong>를 냉정하게 파악하면 해결의 실마리가 보여요.`} ${stemOhang === '火' || stemOhang === '木' ? `${stemOhang} 에너지는 확장하려 해서 "더 열심히"로 대응하기 쉽지만, <strong>"멈춤"과 "쉼"</strong>이 진짜 해결책일 때가 많아요.` : `${stemOhang} 에너지는 안정을 추구해서 "참고 견디기"로 대응하기 쉽지만, <strong>적극적 변화 시도</strong>가 필요할 때도 있어요.`}</p>
    
    <p style="margin-top:15px;"><strong>⚡ 번아웃 예방 3원칙:</strong></p>
    <p>1️⃣ <strong>${cogStack.inf} 과부하 신호</strong>가 나타나면 즉시 휴식 (무시하지 말 것!)</p>
    <p>2️⃣ <strong>${stemOhang === '火' || stemOhang === '木' ? '水' : stemOhang === '水' ? '木' : stemOhang === '金' ? '土' : '金'} 활동</strong>을 주 2-3회 의식적으로 실천</p>
    <p>3️⃣ <strong>${axes[0] === 'E' ? '혼자만의 시간' : '신뢰하는 사람과의 대화'}</strong>를 정기적으로 확보</p>
  </div>
</div>

<!-- ===== 페이지 21: 성장 로드맵 ===== -->
<div class="page">
  <h1>🗺️ ${mbti} × ${stem.hanja}${stemOhang} 성장 로드맵</h1>
  <p class="subtitle">${chemData.title}의 단계별 자기계발 가이드</p>
  
  <h2>【1단계: 자기 인식】</h2>
  
  <div class="card" style="line-height:1.7;">
    <p>성장의 첫 걸음은 자신을 정확히 아는 것이에요. ${mbti}와 ${stem.hanja}${stemOhang}의 조합이 만들어내는 "${chemData.title}"의 특성을 깊이 이해하세요. ${cogStack.main}(${FUNC_OHANG[cogStack.main].name})이 당신의 핵심 강점이고, ${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})가 성장 포인트예요. ${stemOhang === '火' ? '火 에너지가 과열되는 패턴을 파악하고, 언제 멈춰야 하는지 알아두세요.' : `${stemOhang} 에너지의 흐름을 관찰하고, 당신만의 리듬을 찾아보세요.`}</p>
  </div>
  
  <h2>【2단계: 균형 연습】</h2>
  
  <div class="card" style="line-height:1.7;">
    <p>강점만으로는 한계가 있어요. 열등기능인 <strong>${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})</strong>를 의식적으로 연습하면 더 균형 잡힌 사람이 될 수 있어요. ${axes[0] === 'E' ? '외향적 에너지를 발산하는 것도 좋지만, 가끔은 혼자만의 시간으로 水 에너지를 보충하세요.' : '내면의 깊이를 키우는 것도 좋지만, 가끔은 외부 세계와 적극적으로 교류해보세요.'} "멈춤"의 가치를 인정하고, 휴식도 성장의 일부라는 것을 받아들이세요.</p>
  </div>
  
  <h2>【3단계: 시너지 극대화】</h2>
  
  <div class="card" style="line-height:1.7;">
    <p>균형이 잡히면, 이제 강점 영역에서 전문성을 구축할 차례예요. ${cogStack.main}과 ${cogStack.aux}의 조합은 "${chemData.title}"만의 독특한 경쟁력이에요. ${axes[2] === 'T' ? '논리적 분석력과 체계적 실행력을 바탕으로 전문가로 자리잡으세요.' : '공감 능력과 관계 구축력을 바탕으로 사람들을 이끄는 역할을 맡아보세요.'} ${stemOhang} 에너지와 ${mbti}의 시너지를 최대로 발휘하면, 남들이 따라올 수 없는 차별화가 만들어져요.</p>
  </div>
  
  <h2>【4단계: 영향력 확대】</h2>
  
  <div class="highlight-box" style="line-height:1.7;">
    <p>성장의 최종 단계는 자신을 넘어 주변에 긍정적 영향을 미치는 것이에요. "${chemData.title}"로서 조직이나 커뮤니티에서 변화를 주도하고, 후배들에게 멘토가 되어주세요. ${axes[0] === 'E' ? '당신의 에너지와 추진력이 주변을 밝게 만들 거예요.' : '당신의 깊이 있는 통찰이 사람들에게 방향을 제시할 거예요.'} ${stem.hanja}${stemOhang}의 기운과 ${mbti}의 강점을 사회에 환원하는 것, 그것이 "${chemData.title}"의 궁극적 성장이에요.</p>
  </div>
</div>

<!-- ===== 페이지: 추천 콘텐츠 ===== -->
<div class="page">
  <h1>📚 ${mbti} × ${stem.hanja}${stemOhang} 맞춤 콘텐츠</h1>
  <p class="subtitle">${chemData.title}의 성장을 위한 선별 자료</p>
  
  <div class="card" style="line-height:1.8;">
    <p>모든 책과 활동이 모든 사람에게 맞는 건 아니에요. ${mbti}의 인지기능 스택과 ${stem.hanja}${stemOhang}의 오행 특성을 고려해, <strong>당신에게 실제로 도움이 될 콘텐츠</strong>만 선별했어요. 주기능 ${cogStack.main}을 강화하고, 열등기능 ${cogStack.inf}를 보완하며, ${stemOhang} 에너지의 균형을 맞추는 데 초점을 맞췄어요.</p>
  </div>
  
  <h2>【${cogStack.main} 강화 도서】</h2>
  
  <div class="analysis-box positive" style="line-height:1.8;">
    <p><strong>주기능 ${cogStack.main}(${FUNC_OHANG[cogStack.main].name})을 더욱 날카롭게:</strong></p>
    <p style="margin-top:10px;">${cogStack.main === 'Te' || cogStack.main === 'Ti' ? 
    `📖 <strong>「생각에 관한 생각」</strong> (다니엘 카너먼) - 사고 과정의 편향을 이해하면 ${cogStack.main}이 더욱 정교해져요. 논리적 판단력의 한계와 가능성을 모두 알 수 있어요.` :
    cogStack.main === 'Fe' || cogStack.main === 'Fi' ?
    `📖 <strong>「비폭력대화」</strong> (마셜 로젠버그) - 감정을 효과적으로 표현하고 받아들이는 방법을 배우면 ${cogStack.main}이 더욱 성숙해져요. 관계의 질이 달라져요.` :
    cogStack.main === 'Se' || cogStack.main === 'Si' ?
    `📖 <strong>「몰입의 즐거움」</strong> (미하이 칙센트미하이) - 현재에 완전히 집중하는 방법을 배우면 ${cogStack.main}이 극대화돼요. 감각 경험의 깊이가 달라져요.` :
    `📖 <strong>「빅픽처」</strong> (숀 캐럴) - 큰 그림을 보는 안목을 키우면 ${cogStack.main}이 더욱 넓어져요. 직관의 정확도가 높아져요.`}</p>
    <p style="margin-top:10px;">${axes[2] === 'T' ?
    `📖 <strong>「원칙」</strong> (레이 달리오) - 체계적인 의사결정 프레임워크가 ${mbti}의 논리적 강점을 한 단계 업그레이드해줘요.` :
    `📖 <strong>「연결의 기술」</strong> (신수정) - 진정한 관계를 만드는 방법을 배우면 ${mbti}의 공감 능력이 더욱 깊어져요.`}</p>
  </div>
  
  <h2>【${cogStack.inf} 보완 도서】</h2>
  
  <div class="analysis-box info" style="line-height:1.8;">
    <p><strong>열등기능 ${cogStack.inf}(${FUNC_OHANG[cogStack.inf].name})를 부드럽게 발달시키기:</strong></p>
    <p style="margin-top:10px;">${cogStack.inf === 'Se' || cogStack.inf === 'Si' ? 
    `📖 <strong>「바디 키핑 더 스코어」</strong> (베셀 반 데어 콜크) - 몸과 마음의 연결을 이해하면 ${cogStack.inf}가 덜 위협적으로 느껴져요. 감각을 친구로 만드는 방법이에요.` :
    cogStack.inf === 'Ne' || cogStack.inf === 'Ni' ?
    `📖 <strong>「리프레이밍」</strong> - 다른 관점에서 상황을 보는 연습을 하면 ${cogStack.inf}가 점차 발달해요. 가능성을 두려움 대신 설렘으로 받아들일 수 있어요.` :
    cogStack.inf === 'Te' || cogStack.inf === 'Ti' ?
    `📖 <strong>「똑바로 일하라」</strong> (제이슨 프라이드) - 효율성과 논리를 부드럽게 연습할 수 있어요. ${cogStack.inf}를 덜 부담스럽게 발달시키는 방법이에요.` :
    `📖 <strong>「감정은 어떻게 만들어지는가」</strong> (리사 펠드먼 배럿) - 감정의 과학을 이해하면 ${cogStack.inf}가 덜 두렵게 느껴져요. 감정도 논리적으로 이해할 수 있어요.`}</p>
  </div>
  
  <h2>【${stemOhang} 균형 활동】</h2>
  
  <div class="highlight-box" style="line-height:1.8;">
    <p><strong>${stem.hanja}${stemOhang} 일간을 위한 맞춤 활동:</strong></p>
    <p style="margin-top:10px;">${stemOhang === '火' ? 
    `🌊 <strong>수영/아쿠아 요가</strong> - 火 일간에게 水 활동은 최고의 균형제예요. 물 속에서 움직이면 열기가 식으면서도 에너지는 발산돼요. 주 1-2회 권장해요.
    <br>🧘 <strong>명상/마음챙김</strong> - "멈춤"을 연습하면 火의 과열을 예방해요. 앱(마보, 코끼리) 활용을 추천해요. 하루 10분이면 충분해요.` :
    stemOhang === '水' ?
    `🌱 <strong>원예/식물 가꾸기</strong> - 水 일간에게 木 활동은 정체를 막아줘요. 생명이 자라는 걸 보면서 당신의 흐름도 살아나요.
    <br>📝 <strong>창작 활동</strong> - 글쓰기, 그림, 음악 등 표현하는 활동이 水의 깊이를 바깥으로 흐르게 해줘요.` :
    stemOhang === '木' ?
    `☀️ <strong>아침 햇빛 산책</strong> - 木 일간에게 火 활동은 성장을 촉진해요. 아침 햇빛을 받으며 걸으면 木의 생명력이 확장돼요.
    <br>🎯 <strong>새로운 것 배우기</strong> - 성장 욕구가 강한 木은 배움에서 에너지를 얻어요. 온라인 클래스나 독서 모임을 추천해요.` :
    stemOhang === '金' ?
    `🏔️ <strong>자연 속 걷기</strong> - 金 일간에게 土 활동은 날카로움을 부드럽게 해줘요. 흙길을 걷거나 산에 오르면 마음이 정돈돼요.
    <br>🧹 <strong>정리/미니멀리즘</strong> - 金의 특성과 맞아요. 불필요한 것을 버리는 활동이 내면까지 정리해줘요.` :
    `🤝 <strong>커뮤니티 활동</strong> - 土 일간에게 金 활동은 명확함을 더해줘요. 모임이나 봉사활동이 土의 신뢰성을 발휘할 기회예요.
    <br>✍️ <strong>저널링/일기</strong> - 하루를 정리하며 기록하면 土의 안정감이 강화돼요. 매일 같은 시간에 5분 쓰기를 추천해요.`}</p>
  </div>
  
  <h2>【${mbti} × ${stem.hanja}${stemOhang} 피해야 할 것】</h2>
  
  <div class="analysis-box warning" style="line-height:1.8;">
    <p><strong>"${chemData.title}"가 특히 조심해야 할 것들:</strong></p>
    <p style="margin-top:10px;">${stemOhang === '火' || stemOhang === '木' ?
    `❌ <strong>과도한 카페인</strong> - ${stemOhang} 에너지가 이미 활발한데 카페인은 과열을 촉진해요. 하루 1잔 이하로 제한하세요.
    <br>❌ <strong>수면 부족</strong> - "잠 줄여서 일하자"는 ${stemOhang}의 큰 적이에요. 7시간 이상 수면이 필수예요.
    <br>❌ <strong>과도한 멀티태스킹</strong> - ${stemOhang} 에너지가 분산되면 어느 것도 제대로 못 해요. 하나에 집중하세요.` :
    `❌ <strong>과도한 고립</strong> - ${stemOhang} 에너지가 정체되면 우울해지기 쉬워요. 일주일에 최소 1-2회는 사람을 만나세요.
    <br>❌ <strong>변화 회피</strong> - 안정을 추구하다 보면 성장 기회를 놓칠 수 있어요. 작은 변화라도 시도해보세요.
    <br>❌ <strong>과도한 걱정</strong> - 미래에 대한 불안이 현재를 갉아먹어요. 지금 할 수 있는 것에 집중하세요.`}</p>
    <p style="margin-top:10px;">${axes[2] === 'T' ?
    `❌ <strong>감정 무시</strong> - "감정은 비효율적"이라고 무시하면 ${cogStack.inf}가 폭발해요. 감정도 데이터예요.
    <br>❌ <strong>완벽주의 집착</strong> - 80%로 충분한 일에 100%를 쏟으면 효율이 떨어져요. 때로는 "이 정도면 됐다"도 필요해요.` :
    `❌ <strong>갈등 회피</strong> - 조화를 위해 문제를 묻어두면 더 커져요. 작을 때 직면하는 게 관계를 지켜요.
    <br>❌ <strong>자기 희생</strong> - 남을 돕다가 자신을 잃으면 결국 아무도 못 도와요. 자기 돌봄이 먼저예요.`}</p>
    <p style="margin-top:10px;">❌ <strong>혼자 다 해결하려는 태도</strong> - "${chemData.title}"의 능력을 믿지만, 도움을 요청하는 것도 능력이에요.</p>
    <p>❌ <strong>비교 함정</strong> - SNS에서 남과 비교하면 끝이 없어요. 어제의 나와 비교하세요.</p>
  </div>
  
  <div class="strategy-box" style="margin-top:15px; line-height:1.8;">
    <p><strong>💪 "${chemData.title}" 성장을 위한 추천 루틴:</strong></p>
    <p>🌅 <strong>아침:</strong> ${stemOhang === '火' || stemOhang === '木' ? '5분 명상으로 火/木 에너지 조절' : '가벼운 스트레칭으로 정체된 에너지 활성화'}</p>
    <p>📚 <strong>점심:</strong> ${axes[1] === 'N' ? '10분 독서로 직관(木) 자극' : '산책으로 감각(土) 리프레시'}</p>
    <p>🌙 <strong>저녁:</strong> ${axes[0] === 'E' ? '혼자만의 조용한 시간 20분 확보' : '가까운 사람과 5분 대화'}</p>
    <p>📝 <strong>주간:</strong> ${cogStack.inf} 기능 연습 활동 1회 (열등기능 발달)</p>
  </div>
</div>

<!-- ===== 페이지 23: 핵심 정리 ===== -->
<div class="page">
  <h1>📋 핵심 정리</h1>
  <p class="subtitle">${mbti} × ${stem.hanja}${stemOhang} = ${chemData.title}</p>
  
  <div class="score-box" style="margin:30px 0;">
    <p style="color:#888;">최종 케미 점수</p>
    <div class="score-number">${chemData.score}<span style="font-size:20pt;">점</span></div>
    <div class="grade-badge">${chemData.grade} 등급</div>
    <p style="margin-top:10px; color:#888;">${rankText}</p>
  </div>
  
  <h2>【5가지 핵심 메시지】</h2>
  
  <div class="highlight-box">
    <p><strong>1️⃣ 당신은 "비전 + 실행력"을 가진 희귀한 조합이에요</strong></p>
    <p><strong>2️⃣ 과열 주의! 의식적인 휴식과 균형이 필요해요</strong></p>
    <p><strong>3️⃣ 리더십은 타고났어요. 자신감을 가지세요</strong></p>
    <p><strong>4️⃣ 水 에너지로 균형을 맞추세요</strong></p>
    <p><strong>5️⃣ "${chemData.subtitle}"</strong></p>
  </div>
  
  <h2>【기억하세요】</h2>
  
  <div class="formula-box">
    <p style="font-size:14pt;">"${chemData.title}"의 사명은</p>
    <p style="font-size:18pt; margin:15px 0; color:#ffd700;"><strong>꿈을 현실로 만드는 것</strong></p>
    <p>당신은 이미 그 능력을 가지고 있어요!</p>
  </div>
</div>

<!-- ===== 페이지 24: 감사 & 안내 ===== -->
<div class="page">
  <div style="text-align:center; padding-top:60px;">
    <h1 style="font-size:28pt;">감사합니다</h1>
    <p style="margin-top:30px; font-size:12pt; color:#888;">이 분석이 삶에 도움이 되길 바랍니다.</p>
    
    <div style="margin-top:60px; padding:30px; background:#1a1a1a; border-radius:16px; display:inline-block;">
      <p style="font-size:14pt; color:#ffd700;"><strong>K-Saju Premium</strong></p>
      <p style="font-size:11pt; color:#888; margin-top:10px;">MBTI × 사주 케미 분석 서비스</p>
    </div>
    
    <div style="margin-top:50px;">
      <p style="font-size:11pt; color:#666;">분석 생성일: ${new Date().toLocaleDateString('ko-KR')}</p>
      <p style="font-size:11pt; color:#666;">조합: ${mbti} × ${stem.hanja}${stemOhang} (${stem.name})</p>
      <p style="font-size:11pt; color:#666;">케미 점수: ${chemData.score}/100점 (${chemData.grade}등급)</p>
    </div>
    
    <div style="margin-top:40px;">
      <button onclick="window.print()" style="padding:15px 40px; background:linear-gradient(135deg, #667eea, #764ba2); border:none; border-radius:12px; color:#fff; font-size:14pt; font-weight:bold; cursor:pointer;">🖨️ PDF로 저장하기</button>
      <div class="no-print" style="margin-top:15px; padding:15px; background:#1a1a1a; border-radius:8px; max-width:400px; margin-left:auto; margin-right:auto;">
        <p style="font-size:9pt; color:#888; margin:0;">💡 <strong style="color:#ffd700;">PDF 저장 설정</strong></p>
        <p style="font-size:8pt; color:#666; margin:5px 0 0 0;">대상: PDF로 저장 | 배경 그래픽: ✅ 체크</p>
        <p style="font-size:8pt; color:#666; margin:2px 0 0 0;">여백: 없음 또는 최소</p>
      </div>
    </div>
    
    <div style="margin-top:40px; color:#444; font-size:9pt;">
      <p>© 2025 K-Saju. All rights reserved.</p>
      <p>본 분석은 참고용이며, 중요한 결정은 전문가와 상담하세요.</p>
    </div>
  </div>
</div>

</body>
</html>`;
      
      // 새 창에서 열기
      const newWindow = window.open('', '_blank');
      newWindow.document.write(html);
      newWindow.document.close();
    }

    init();
  </script>
</body>
</html>
